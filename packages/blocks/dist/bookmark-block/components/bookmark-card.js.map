{"version":3,"file":"bookmark-card.js","sourceRoot":"","sources":["../../../src/bookmark-block/components/bookmark-card.ts"],"names":[],"mappings":"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","sourcesContent":["import { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { html } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\n\nimport { OpenIcon, WebIcon16 } from '../../_common/icons/text.js';\nimport { ThemeObserver } from '../../_common/theme/theme-observer.js';\nimport { getEmbedCardIcons } from '../../_common/utils/url.js';\nimport type { BookmarkBlockComponent } from '../bookmark-block.js';\nimport { styles } from '../styles.js';\n\n@customElement('bookmark-card')\nexport class BookmarkCard extends WithDisposable(ShadowlessElement) {\n  static override styles = styles;\n\n  @state()\n  private accessor _isSelected = false;\n\n  private readonly _themeObserver = new ThemeObserver();\n\n  @property({ attribute: false })\n  accessor bookmark!: BookmarkBlockComponent;\n\n  @property({ attribute: false })\n  accessor loading!: boolean;\n\n  @property({ attribute: false })\n  accessor error!: boolean;\n\n  private _selectBlock() {\n    const selectionManager = this.bookmark.host.selection;\n    const blockSelection = selectionManager.create('block', {\n      blockId: this.bookmark.blockId,\n    });\n    selectionManager.setGroup('note', [blockSelection]);\n  }\n\n  private _handleClick(event: MouseEvent) {\n    event.stopPropagation();\n    if (!this.bookmark.isInSurface) {\n      this._selectBlock();\n    }\n  }\n\n  private _handleDoubleClick(event: MouseEvent) {\n    event.stopPropagation();\n    this.bookmark.open();\n  }\n\n  private _getHostName(url: string) {\n    try {\n      return new URL(url).hostname;\n    } catch {\n      return url;\n    }\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n\n    this.disposables.add(\n      this.bookmark.model.propsUpdated.on(() => {\n        this.requestUpdate();\n      })\n    );\n\n    this._themeObserver.observe(document.documentElement);\n    this._themeObserver.on(() => this.requestUpdate());\n    this.disposables.add(() => this._themeObserver.dispose());\n\n    this.disposables.add(\n      this.bookmark.selection.slots.changed.on(() => {\n        this._isSelected =\n          !!this.bookmark.selected?.is('block') ||\n          !!this.bookmark.selected?.is('surface');\n      })\n    );\n  }\n\n  override render() {\n    const { icon, title, url, description, image, style } = this.bookmark.model;\n\n    const cardClassMap = classMap({\n      loading: this.loading,\n      error: this.error,\n      [style]: true,\n      selected: this._isSelected,\n    });\n\n    const domainName = url.match(\n      /^(?:https?:\\/\\/)?(?:[^@\\n]+@)?(?:www\\.)?([^:/\\n]+)/im\n    )?.[1];\n\n    const titleText = this.loading\n      ? 'Loading...'\n      : !title\n        ? this.error\n          ? domainName ?? 'Link card'\n          : ''\n        : title;\n\n    const { LoadingIcon, EmbedCardBannerIcon } = getEmbedCardIcons();\n\n    const titleIconType =\n      !icon?.split('.').pop() || icon?.split('.').pop() === 'svg'\n        ? 'svg+xml'\n        : icon?.split('.').pop();\n\n    const titleIcon = this.loading\n      ? LoadingIcon\n      : icon\n        ? html`<object\n            type=\"image/${titleIconType}\"\n            data=${icon}\n            draggable=\"false\"\n          >\n            ${WebIcon16}\n          </object>`\n        : WebIcon16;\n\n    const descriptionText = this.loading\n      ? ''\n      : !description\n        ? this.error\n          ? 'Failed to retrieve link information.'\n          : url\n        : description ?? '';\n\n    const bannerImage =\n      !this.loading && image\n        ? html`<object type=\"image/webp\" data=${image} draggable=\"false\">\n            ${EmbedCardBannerIcon}\n          </object>`\n        : EmbedCardBannerIcon;\n\n    return html`\n      <div\n        class=\"affine-bookmark-card ${cardClassMap}\"\n        @click=${this._handleClick}\n        @dblclick=${this._handleDoubleClick}\n      >\n        <div class=\"affine-bookmark-content\">\n          <div class=\"affine-bookmark-content-title\">\n            <div class=\"affine-bookmark-content-title-icon\">${titleIcon}</div>\n            <div class=\"affine-bookmark-content-title-text\">${titleText}</div>\n          </div>\n          <div class=\"affine-bookmark-content-description\">\n            ${descriptionText}\n          </div>\n          <div class=\"affine-bookmark-content-url\" @click=${this.bookmark.open}>\n            <span>${this._getHostName(url)}</span>\n            <div class=\"affine-bookmark-content-url-icon\">${OpenIcon}</div>\n          </div>\n        </div>\n        <div class=\"affine-bookmark-banner\">${bannerImage}</div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'bookmark-card': BookmarkCard;\n  }\n}\n"]}