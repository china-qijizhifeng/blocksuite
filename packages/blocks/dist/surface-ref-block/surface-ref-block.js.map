{"version":3,"file":"surface-ref-block.js","sourceRoot":"","sources":["../../src/surface-ref-block/surface-ref-block.ts"],"names":[],"mappings":"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","sourcesContent":["import './surface-ref-portal.js';\n\nimport { PathFinder } from '@blocksuite/block-std';\nimport { BlockElement } from '@blocksuite/block-std';\nimport { assertExists, type Disposable, noop } from '@blocksuite/global/utils';\nimport {\n  css,\n  html,\n  nothing,\n  type PropertyDeclaration,\n  type TemplateResult,\n} from 'lit';\nimport { customElement, query, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { BlockCaptionEditor } from '../_common/components/block-caption.js';\nimport { Peekable } from '../_common/components/peekable.js';\nimport {\n  EdgelessModeIcon,\n  FrameIcon,\n  MoreDeleteIcon,\n} from '../_common/icons/index.js';\nimport { requestConnectedFrame } from '../_common/utils/event.js';\nimport type { FrameBlockModel } from '../frame-block/index.js';\nimport { getBackgroundGrid } from '../root-block/edgeless/utils/query.js';\nimport type { Renderer } from '../surface-block/canvas-renderer/renderer.js';\nimport type { SurfaceBlockModel } from '../surface-block/index.js';\nimport { Bound } from '../surface-block/utils/bound.js';\nimport { deserializeXYWH } from '../surface-block/utils/xywh.js';\nimport type { SurfaceRefBlockModel } from './surface-ref-model.js';\nimport { SurfaceRefPortal } from './surface-ref-portal.js';\nimport type { SurfaceRefRenderer } from './surface-ref-renderer.js';\nimport type { SurfaceRefBlockService } from './surface-ref-service.js';\nimport { noContentPlaceholder } from './utils.js';\n\nnoop(SurfaceRefPortal);\n\nconst REF_LABEL_ICON = {\n  'affine:frame': FrameIcon,\n  DEFAULT_NOTE_HEIGHT: EdgelessModeIcon,\n} as Record<string, TemplateResult>;\n\nconst NO_CONTENT_TITLE = {\n  'affine:frame': 'Frame',\n  group: 'Group',\n  DEFAULT: 'Content',\n} as Record<string, string>;\n\nconst NO_CONTENT_REASON = {\n  group: 'This content was ungrouped or deleted on edgeless mode',\n  DEFAULT: 'This content was deleted on edgeless mode',\n} as Record<string, string>;\n\ntype RefElementModel = BlockSuite.SurfaceElementModelType | FrameBlockModel;\n\n@customElement('affine-surface-ref')\n@Peekable()\nexport class SurfaceRefBlockComponent extends BlockElement<\n  SurfaceRefBlockModel,\n  SurfaceRefBlockService\n> {\n  get isInSurface() {\n    return this._isInSurface;\n  }\n\n  private get _shouldRender() {\n    return (\n      this.isConnected &&\n      this.parentElement &&\n      !this.parentBlockElement.closest('affine-surface-ref')\n    );\n  }\n\n  get surfaceRenderer() {\n    return this._surfaceRefRenderer.surfaceRenderer;\n  }\n\n  get referenceModel() {\n    return this._referencedModel;\n  }\n\n  static override styles = css`\n    .affine-surface-ref {\n      position: relative;\n      user-select: none;\n      margin: 10px 0;\n    }\n\n    .ref-placeholder {\n      padding: 26px 0px 0px;\n    }\n\n    .placeholder-image {\n      margin: 0 auto;\n      text-align: center;\n    }\n\n    .placeholder-text {\n      margin: 12px auto 0;\n      text-align: center;\n      font-size: 28px;\n      font-weight: 600;\n      line-height: 36px;\n      font-family: var(--affine-font-family);\n    }\n\n    .placeholder-action {\n      margin: 32px auto 0;\n      text-align: center;\n    }\n\n    .delete-button {\n      width: 204px;\n      padding: 4px 18px;\n\n      display: inline-flex;\n      justify-content: center;\n      align-items: center;\n      gap: 4px;\n\n      border-radius: 8px;\n      border: 1px solid var(--affine-border-color);\n\n      font-family: var(--affine-font-family);\n      font-size: 12px;\n      font-weight: 500;\n      line-height: 20px;\n\n      background-color: transparent;\n      cursor: pointer;\n    }\n\n    .delete-button > .icon > svg {\n      color: var(--affine-icon-color);\n      width: 16px;\n      height: 16px;\n      display: block;\n    }\n\n    .placeholder-reason {\n      margin: 72px auto 0;\n      padding: 10px;\n\n      text-align: center;\n      font-size: 12px;\n      font-family: var(--affine-font-family);\n      line-height: 20px;\n\n      color: var(--affine-warning-color);\n      background-color: var(--affine-background-error-color);\n    }\n\n    .ref-content {\n      position: relative;\n      padding: 20px;\n      background-color: var(--affine-background-primary-color);\n      background: radial-gradient(\n        var(--affine-edgeless-grid-color) 1px,\n        var(--affine-background-primary-color) 1px\n      );\n    }\n\n    .ref-viewport {\n      max-width: 100%;\n      margin: 0 auto;\n      position: relative;\n      overflow: hidden;\n      pointer-events: none;\n      user-select: none;\n    }\n\n    .ref-viewport.frame {\n      border-radius: 2px;\n      border: 1px solid var(--affine-black-30);\n    }\n\n    .ref-canvas-container {\n      height: 100%;\n      width: 100%;\n      position: relative;\n    }\n\n    .surface-ref-mask {\n      position: absolute;\n      left: 0;\n      top: 0;\n      width: 100%;\n      height: 100%;\n    }\n\n    .surface-ref-mask:hover {\n      background-color: rgba(211, 211, 211, 0.1);\n    }\n\n    .surface-ref-mask:hover .ref-label {\n      display: block;\n    }\n\n    .ref-label {\n      display: none;\n      user-select: none;\n    }\n\n    .ref-label {\n      position: absolute;\n      left: 0;\n      bottom: 0;\n\n      width: 100%;\n      padding: 8px 16px;\n      border: 1px solid var(--affine-border-color);\n      gap: 14px;\n\n      background: var(--affine-background-primary-color);\n\n      font-size: 12px;\n\n      user-select: none;\n    }\n\n    .ref-label .title {\n      display: inline-block;\n      font-weight: 600;\n      font-family: var(--affine-font-family);\n      line-height: 20px;\n\n      color: var(--affine-text-secondary-color);\n    }\n\n    .ref-label .title > svg {\n      color: var(--affine-icon-secondary);\n      display: inline-block;\n      vertical-align: baseline;\n      width: 20px;\n      height: 20px;\n      vertical-align: bottom;\n    }\n\n    .ref-label .suffix {\n      display: inline-block;\n      font-weight: 400;\n      color: var(--affine-text-disable-color);\n      line-height: 20px;\n    }\n  `;\n\n  @state()\n  private accessor _surfaceModel: SurfaceBlockModel | null = null;\n\n  @state()\n  private accessor _focused: boolean = false;\n\n  private _surfaceRefRenderer!: SurfaceRefRenderer;\n\n  private _referencedModel: RefElementModel | null = null;\n\n  private _isInSurface = false;\n\n  @query('.ref-canvas-container')\n  accessor container!: HTMLDivElement;\n\n  @query('surface-ref-portal')\n  accessor portal!: SurfaceRefPortal;\n\n  @query('affine-surface-ref > block-caption-editor')\n  accessor captionElement!: BlockCaptionEditor;\n\n  private _attachRenderer() {\n    if (\n      this._surfaceRefRenderer?.surfaceRenderer.canvas.isConnected ||\n      !this.container ||\n      !this.portal\n    )\n      return;\n\n    this.surfaceRenderer.attach(this.container);\n    if (this.portal.isUpdatePending) {\n      this.portal.updateComplete\n        .then(() => {\n          this.portal.setStackingCanvas(\n            this._surfaceRefRenderer.surfaceRenderer.stackingCanvas\n          );\n        })\n        .catch(console.error);\n    } else {\n      this.portal.setStackingCanvas(\n        this._surfaceRefRenderer.surfaceRenderer.stackingCanvas\n      );\n    }\n  }\n\n  private _initHotkey() {\n    const selection = this.host.selection;\n    const addParagraph = () => {\n      if (!this.doc.getParent(this.model)) return;\n\n      const [paragraphId] = this.doc.addSiblingBlocks(this.model, [\n        {\n          flavour: 'affine:paragraph',\n        },\n      ]);\n      const model = this.doc.getBlockById(paragraphId);\n      assertExists(model, `Failed to add paragraph block.`);\n\n      requestConnectedFrame(() => {\n        selection.update(selList => {\n          return selList\n            .filter(sel => !sel.is('block'))\n            .concat(\n              selection.create('text', {\n                from: {\n                  blockId: model.id,\n                  index: 0,\n                  length: 0,\n                },\n                to: null,\n              })\n            );\n        });\n      }, this);\n    };\n\n    this.bindHotKey({\n      Enter: () => {\n        if (!this._focused) return;\n        addParagraph();\n        return true;\n      },\n    });\n  }\n\n  private _initReferencedModel() {\n    let refWatcher: Disposable | null = null;\n    const init = () => {\n      refWatcher?.dispose();\n\n      const referencedModel = this._surfaceRefRenderer.getModel(\n        this.model.reference\n      ) as RefElementModel;\n      this._referencedModel =\n        referencedModel && 'xywh' in referencedModel ? referencedModel : null;\n\n      if (!referencedModel) return;\n\n      if ('propsUpdated' in referencedModel) {\n        refWatcher = referencedModel.propsUpdated.on(() => {\n          if (referencedModel.flavour !== this.model.refFlavour) {\n            this.doc.updateBlock(this.model, {\n              refFlavour: referencedModel.flavour,\n            });\n          }\n\n          this.updateComplete\n            .then(() => {\n              this._refreshViewport();\n            })\n            .catch(console.error);\n        });\n      }\n\n      this._refreshViewport();\n    };\n\n    init();\n\n    this._disposables.add(() => {\n      this.doc.slots.blockUpdated.on(({ type, id }) => {\n        if (type === 'delete' && id === this.model.reference) {\n          init();\n        }\n      });\n    });\n\n    this._disposables.add(() => {\n      this.model.propsUpdated.on(() => {\n        if (this.model.reference !== this._referencedModel?.id) {\n          init();\n        }\n      });\n    });\n\n    this._disposables.add(() => {\n      refWatcher?.dispose();\n    });\n  }\n\n  private _initSelection() {\n    const selection = this.host.selection;\n    this._disposables.add(\n      selection.slots.changed.on(selList => {\n        this._focused = selList.some(\n          sel => sel.blockId === this.blockId && sel.is('block')\n        );\n      })\n    );\n  }\n\n  private _refreshViewport() {\n    if (!this._referencedModel) {\n      return;\n    }\n\n    const referencedModel = this._referencedModel;\n\n    // trigger a rerender to update element's size\n    // and set viewport after element's size has been updated\n    this.requestUpdate();\n    this.updateComplete\n      .then(() => {\n        this.surfaceRenderer.onResize();\n        this.surfaceRenderer.setViewportByBound(\n          Bound.fromXYWH(deserializeXYWH(referencedModel.xywh))\n        );\n\n        // update portal transform\n        this.portal?.setViewport(this.surfaceRenderer);\n      })\n      .catch(console.error);\n  }\n\n  private _deleteThis() {\n    this.doc.deleteBlock(this.model);\n  }\n\n  private _focusBlock() {\n    this.selection.update(() => {\n      return [this.selection.create('block', { blockId: this.blockId })];\n    });\n  }\n\n  private _renderMask(referencedModel: RefElementModel, flavourOrType: string) {\n    const title = 'title' in referencedModel ? referencedModel.title : '';\n\n    return html`\n      <div class=\"surface-ref-mask\">\n        <div class=\"ref-label\">\n          <div class=\"title\">\n            ${REF_LABEL_ICON[flavourOrType ?? 'DEFAULT'] ??\n            REF_LABEL_ICON.DEFAULT}\n            <span>${title}</span>\n          </div>\n          <div class=\"suffix\">from edgeless mode</div>\n        </div>\n      </div>\n    `;\n  }\n\n  private _renderRefPlaceholder(model: SurfaceRefBlockModel) {\n    return html`<div class=\"ref-placeholder\">\n      <div class=\"placeholder-image\">${noContentPlaceholder}</div>\n      <div class=\"placeholder-text\">\n        No Such\n        ${NO_CONTENT_TITLE[model.refFlavour ?? 'DEFAULT'] ??\n        NO_CONTENT_TITLE.DEFAULT}\n      </div>\n      <div class=\"placeholder-action\">\n        <button class=\"delete-button\" type=\"button\" @click=${this._deleteThis}>\n          <span class=\"icon\">${MoreDeleteIcon}</span\n          ><span>Delete this block</span>\n        </button>\n      </div>\n      <div class=\"placeholder-reason\">\n        ${NO_CONTENT_REASON[model.refFlavour ?? 'DEFAULT'] ??\n        NO_CONTENT_REASON.DEFAULT}\n      </div>\n    </div>`;\n  }\n\n  private _renderRefContent(\n    referencedModel: RefElementModel,\n    renderer: Renderer\n  ) {\n    const [, , w, h] = deserializeXYWH(referencedModel.xywh);\n    const { zoom } = renderer;\n    const { gap } = getBackgroundGrid(zoom, true);\n    const flavourOrType =\n      'flavour' in referencedModel\n        ? referencedModel.flavour\n        : referencedModel.type;\n    const edgelessBlocks =\n      flavourOrType === 'affine:frame' || flavourOrType === 'group'\n        ? html`<surface-ref-portal\n            .doc=${this.doc}\n            .host=${this.host}\n            .refModel=${referencedModel}\n            .renderModel=${this.host.renderModel}\n          ></surface-ref-portal>`\n        : nothing;\n\n    return html`<div\n      class=\"ref-content\"\n      style=${styleMap({\n        backgroundSize: `${gap}px ${gap}px`,\n      })}\n    >\n      <div\n        class=\"ref-viewport ${flavourOrType === 'affine:frame' ? 'frame' : ''}\"\n        style=${styleMap({\n          width: `${w}px`,\n          aspectRatio: `${w} / ${h}`,\n        })}\n      >\n        ${edgelessBlocks}\n        <div class=\"ref-canvas-container\">\n          <!-- attach canvas here -->\n        </div>\n      </div>\n      ${this._renderMask(referencedModel, flavourOrType)}\n    </div>`;\n  }\n\n  override requestUpdate(\n    name?: PropertyKey | undefined,\n    oldValue?: unknown,\n    options?: PropertyDeclaration<unknown, unknown> | undefined\n  ): void {\n    super.requestUpdate(name, oldValue, options);\n\n    this._surfaceRefRenderer?.surfaceRenderer?.refresh();\n    this.portal?.requestUpdate();\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this.contentEditable = 'false';\n\n    const parent = this.host.doc.getParent(this.model);\n    this._isInSurface = parent?.flavour === 'affine:surface';\n\n    if (!this._shouldRender) return;\n\n    const service = this.service;\n    assertExists(service, `Surface ref block must run with its service.`);\n    this._surfaceRefRenderer = service.getRenderer(\n      PathFinder.id(this.path),\n      this.doc,\n      true\n    );\n    this._disposables.add(() => {\n      this.service?.removeRenderer(this._surfaceRefRenderer.id);\n    });\n    this._disposables.add(\n      this._surfaceRefRenderer.slots.surfaceModelChanged.on(model => {\n        this._surfaceModel = model;\n      })\n    );\n    this._disposables.add(\n      this._surfaceRefRenderer.slots.surfaceRendererRefresh.on(() => {\n        this.requestUpdate();\n      })\n    );\n    this._disposables.add(\n      this._surfaceRefRenderer.slots.surfaceRendererInit.on(() => {\n        let lastWidth = 0;\n        const observer = new ResizeObserver(entries => {\n          if (entries[0].contentRect.width !== lastWidth) {\n            lastWidth = entries[0].contentRect.width;\n            this._refreshViewport();\n          }\n        });\n        observer.observe(this);\n\n        this._disposables.add(() => observer.disconnect());\n      })\n    );\n    this._disposables.add(\n      this._surfaceRefRenderer.surfaceService.layer.slots.layerUpdated.on(\n        () => {\n          this.portal.setStackingCanvas(\n            this._surfaceRefRenderer.surfaceRenderer.stackingCanvas\n          );\n        }\n      )\n    );\n    this._surfaceRefRenderer.mount();\n    this._initHotkey();\n    this._initReferencedModel();\n    this._initSelection();\n  }\n\n  override updated() {\n    if (!this._shouldRender) return;\n\n    this._attachRenderer();\n  }\n\n  viewInEdgeless() {\n    if (!this._referencedModel) return;\n\n    const viewport = {\n      xywh: this._referencedModel.xywh,\n      padding: [60, 20, 20, 20] as [number, number, number, number],\n    };\n    const pageService = this.std.spec.getService('affine:page');\n\n    pageService.editPropsStore.setItem('viewport', viewport);\n    pageService.docModeService.setMode('edgeless');\n  }\n\n  override render() {\n    if (!this._shouldRender) return;\n\n    const { _surfaceModel, _referencedModel, surfaceRenderer, model } = this;\n    const isEmpty =\n      !_surfaceModel || !_referencedModel || !_referencedModel.xywh;\n    const content = isEmpty\n      ? this._renderRefPlaceholder(model)\n      : this._renderRefContent(_referencedModel, surfaceRenderer);\n\n    return html`\n      <div\n        class=\"affine-surface-ref\"\n        @click=${this._focusBlock}\n        style=${styleMap({\n          outline: this._focused\n            ? '2px solid var(--affine-primary-color)'\n            : undefined,\n        })}\n      >\n        ${content}\n      </div>\n\n      <block-caption-editor .block=${this}></block-caption-editor>\n\n      ${Object.values(this.widgets)}\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-surface-ref': SurfaceRefBlockComponent;\n  }\n}\n"]}