{"version":3,"file":"note-model.js","sourceRoot":"","sources":["../../src/note-block/note-model.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,iBAAiB,EAAE,MAAM,mBAAmB,CAAC;AAElE,OAAO,EAAE,UAAU,EAAE,MAAM,sBAAsB,CAAC;AAClD,OAAO,EAAE,UAAU,EAAE,MAAM,kDAAkD,CAAC;AAC9E,OAAO,EACL,6BAA6B,EAC7B,mBAAmB,GACpB,MAAM,oCAAoC,CAAC;AAC5C,OAAO,EAAE,eAAe,EAAE,MAAM,qBAAqB,CAAC;AACtD,OAAO,EAAE,WAAW,EAAE,MAAM,4BAA4B,CAAC;AACzD,OAAO,EAAE,KAAK,EAAE,MAAM,iCAAiC,CAAC;AAGxD,MAAM,CAAC,MAAM,eAAe,GAAG,iBAAiB,CAAC;IAC/C,OAAO,EAAE,aAAa;IACtB,KAAK,EAAE,GAAc,EAAE,CAAC,CAAC;QACvB,IAAI,EAAE,QAAQ,UAAU,MAAM;QAC9B,UAAU,EAAE,6BAA6B;QACzC,KAAK,EAAE,IAAI;QACX,MAAM,EAAE,KAAK;QACb,WAAW,EAAE,eAAe,CAAC,cAAc;QAC3C,QAAQ,EAAE;YACR,KAAK,EAAE;gBACL,YAAY,EAAE,CAAC;gBACf,UAAU,EAAE,CAAC;gBACb,WAAW,EAAE,WAAW,CAAC,IAAI;gBAC7B,UAAU,EAAE,mBAAmB;aAChC;SACF;KACF,CAAC;IACF,QAAQ,EAAE;QACR,OAAO,EAAE,CAAC;QACV,IAAI,EAAE,KAAK;QACX,MAAM,EAAE,CAAC,aAAa,CAAC;QACvB,QAAQ,EAAE;YACR,kBAAkB;YAClB,aAAa;YACb,aAAa;YACb,gBAAgB;YAChB,iBAAiB;YACjB,kBAAkB;YAClB,cAAc;YACd,iBAAiB;YACjB,mBAAmB;YACnB,oBAAoB;YACpB,gBAAgB;SACjB;KACF;IACD,OAAO,EAAE,GAAG,EAAE;QACZ,OAAO,IAAI,cAAc,EAAE,CAAC;IAC9B,CAAC;CACF,CAAC,CAAC;AA+BH,MAAM,OAAO,cAAe,SAAQ,UAAU,CAAY,UAAU,CAAC;IAC3D,aAAa;QACnB,OAAO,IAAI,CAAC,WAAW,KAAK,eAAe,CAAC,OAAO,CAAC;IACtD,CAAC;IAEQ,OAAO,CAAC,CAAS,EAAE,CAAS;QACnC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;YAAE,OAAO,KAAK,CAAC;QAExC,MAAM,KAAK,GAAG,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3C,OAAO,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IACzC,CAAC;IAEQ,iBAAiB,CAAC,MAAa;QACtC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;YAAE,OAAO,KAAK,CAAC;QACxC,OAAO,KAAK,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC;IACzC,CAAC;IAEQ,SAAS,CAAC,KAAY;QAC7B,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;YAAE,OAAO,KAAK,CAAC;QACxC,OAAO,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;IAChC,CAAC;CACF","sourcesContent":["import { BlockModel, defineBlockSchema } from '@blocksuite/store';\n\nimport { NOTE_WIDTH } from '../_common/consts.js';\nimport { selectable } from '../_common/edgeless/mixin/edgeless-selectable.js';\nimport {\n  DEFAULT_NOTE_BACKGROUND_COLOR,\n  DEFAULT_NOTE_SHADOW,\n} from '../_common/edgeless/note/consts.js';\nimport { NoteDisplayMode } from '../_common/types.js';\nimport { StrokeStyle } from '../surface-block/consts.js';\nimport { Bound } from '../surface-block/utils/bound.js';\nimport type { SerializedXYWH } from '../surface-block/utils/xywh.js';\n\nexport const NoteBlockSchema = defineBlockSchema({\n  flavour: 'affine:note',\n  props: (): NoteProps => ({\n    xywh: `[0,0,${NOTE_WIDTH},95]`,\n    background: DEFAULT_NOTE_BACKGROUND_COLOR,\n    index: 'a0',\n    hidden: false,\n    displayMode: NoteDisplayMode.DocAndEdgeless,\n    edgeless: {\n      style: {\n        borderRadius: 0,\n        borderSize: 4,\n        borderStyle: StrokeStyle.None,\n        shadowType: DEFAULT_NOTE_SHADOW,\n      },\n    },\n  }),\n  metadata: {\n    version: 1,\n    role: 'hub',\n    parent: ['affine:page'],\n    children: [\n      'affine:paragraph',\n      'affine:list',\n      'affine:code',\n      'affine:divider',\n      'affine:database',\n      'affine:data-view',\n      'affine:image',\n      'affine:bookmark',\n      'affine:attachment',\n      'affine:surface-ref',\n      'affine:embed-*',\n    ],\n  },\n  toModel: () => {\n    return new NoteBlockModel();\n  },\n});\n\ntype NoteProps = {\n  xywh: SerializedXYWH;\n  background: string;\n  index: string;\n  displayMode: NoteDisplayMode;\n  edgeless: NoteEdgelessProps;\n  /**\n   * @deprecated\n   * use `displayMode` instead\n   * hidden:true -> displayMode:NoteDisplayMode.EdgelessOnly:\n   *  means the note is visible only in the edgeless mode\n   * hidden:false -> displayMode:NoteDisplayMode.DocAndEdgeless:\n   *  means the note is visible in the doc and edgeless mode\n   */\n  hidden: boolean;\n};\n\ntype NoteEdgelessProps = {\n  style: {\n    borderRadius: number;\n    borderSize: number;\n    borderStyle: StrokeStyle;\n    shadowType: string;\n  };\n  collapse?: boolean;\n  collapsedHeight?: number;\n  scale?: number;\n};\n\nexport class NoteBlockModel extends selectable<NoteProps>(BlockModel) {\n  private _isSelectable(): boolean {\n    return this.displayMode !== NoteDisplayMode.DocOnly;\n  }\n\n  override hitTest(x: number, y: number): boolean {\n    if (!this._isSelectable()) return false;\n\n    const bound = Bound.deserialize(this.xywh);\n    return bound.isPointInBound([x, y], 0);\n  }\n\n  override containedByBounds(bounds: Bound): boolean {\n    if (!this._isSelectable()) return false;\n    return super.containedByBounds(bounds);\n  }\n\n  override boxSelect(bound: Bound): boolean {\n    if (!this._isSelectable()) return false;\n    return super.boxSelect(bound);\n  }\n}\n\ndeclare global {\n  namespace BlockSuite {\n    interface EdgelessBlockModelMap {\n      'affine:note': NoteBlockModel;\n    }\n  }\n}\n"]}