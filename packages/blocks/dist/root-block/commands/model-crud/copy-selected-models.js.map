{"version":3,"file":"copy-selected-models.js","sourceRoot":"","sources":["../../../../src/root-block/commands/model-crud/copy-selected-models.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,YAAY,EAAE,MAAM,0BAA0B,CAAC;AACxD,OAAO,EAAmB,YAAY,EAAE,MAAM,mBAAmB,CAAC;AAClE,OAAO,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AAE1C,MAAM,CAAC,MAAM,yBAAyB,GAAyC,CAC7E,GAAG,EACH,IAAI,EACJ,EAAE;IACF,MAAM,MAAM,GAAG,GAAG,CAAC,cAAc,CAAC;IAClC,YAAY,CACV,MAAM,EACN,uHAAuH,CACxH,CAAC;IAEF,MAAM,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;IAExC,MAAM,QAAQ,GAAG,CAAC,KAAiB,EAAE,EAAE;QACrC,MAAM,UAAU,GAAG,KAAK,CAAC,OAAO,KAAK,iBAAiB,CAAC;QACvD,MAAM,QAAQ,GAAG,UAAU;YACzB,CAAC,CAAC,KAAK,CAAC,QAAQ;YAChB,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE;gBAC5B,MAAM,GAAG,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,KAAK,CAAC,EAAE,CAAC,CAAC;gBACrD,OAAO,GAAG,IAAI,CAAC,CAAC;YAClB,CAAC,CAAC,CAAC;QAEP,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;YACvB,MAAM,GAAG,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,KAAK,CAAC,EAAE,CAAC,CAAC;YACrD,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC;gBACb,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;YACxB,CAAC;YACD,QAAQ,CAAC,KAAK,CAAC,CAAC;QAClB,CAAC,CAAC,CAAC;QACH,KAAK,CAAC,QAAQ,GAAG,QAAQ,CAAC;IAC5B,CAAC,CAAC;IACF,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IAEzB,MAAM,KAAK,GAAG,KAAK,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;IAEpD,GAAG,CAAC,GAAG,CAAC,SAAS;SACd,IAAI,CAAC,KAAK,CAAC;SACX,IAAI,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAC;SAC1B,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;IACxB,OAAO,IAAI,EAAE,CAAC;AAChB,CAAC,CAAC","sourcesContent":["import type { Command } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { type DraftModel, toDraftModel } from '@blocksuite/store';\nimport { Slice } from '@blocksuite/store';\n\nexport const copySelectedModelsCommand: Command<'selectedModels' | 'onCopy'> = (\n  ctx,\n  next\n) => {\n  const models = ctx.selectedModels;\n  assertExists(\n    models,\n    '`selectedModels` is required, you need to use `getSelectedModels` command before adding this command to the pipeline.'\n  );\n\n  const drafts = models.map(toDraftModel);\n\n  const traverse = (model: DraftModel) => {\n    const isDatabase = model.flavour === 'affine:database';\n    const children = isDatabase\n      ? model.children\n      : model.children.filter(child => {\n          const idx = drafts.findIndex(m => m.id === child.id);\n          return idx >= 0;\n        });\n\n    children.forEach(child => {\n      const idx = drafts.findIndex(m => m.id === child.id);\n      if (idx >= 0) {\n        drafts.splice(idx, 1);\n      }\n      traverse(child);\n    });\n    model.children = children;\n  };\n  drafts.forEach(traverse);\n\n  const slice = Slice.fromModels(ctx.std.doc, drafts);\n\n  ctx.std.clipboard\n    .copy(slice)\n    .then(() => ctx.onCopy?.())\n    .catch(console.error);\n  return next();\n};\n\ndeclare global {\n  namespace BlockSuite {\n    interface CommandContext {\n      onCopy?: () => void;\n    }\n    interface Commands {\n      copySelectedModels: typeof copySelectedModelsCommand;\n    }\n  }\n}\n"]}