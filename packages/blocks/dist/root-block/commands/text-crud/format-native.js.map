{"version":3,"file":"format-native.js","sourceRoot":"","sources":["../../../../src/root-block/commands/text-crud/format-native.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,gBAAgB,EAA0B,MAAM,oBAAoB,CAAC;AAE9E,OAAO,EAAE,8BAA8B,EAAE,MAAM,gDAAgD,CAAC;AAChG,OAAO,EAAE,aAAa,EAAE,MAAM,4BAA4B,CAAC;AAG3D,mBAAmB;AACnB,MAAM,CAAC,MAAM,mBAAmB,GAQ5B,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE;IAChB,MAAM,EAAE,MAAM,EAAE,IAAI,GAAG,OAAO,EAAE,GAAG,GAAG,CAAC;IAEvC,IAAI,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;IACtB,IAAI,CAAC,KAAK,EAAE,CAAC;QACX,MAAM,SAAS,GAAG,QAAQ,CAAC,YAAY,EAAE,CAAC;QAC1C,IAAI,CAAC,SAAS,IAAI,SAAS,CAAC,UAAU,KAAK,CAAC;YAAE,OAAO;QACrD,KAAK,GAAG,SAAS,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;IAClC,CAAC;IACD,IAAI,CAAC,KAAK;QAAE,OAAO;IAEnB,MAAM,qBAAqB,GAAG,KAAK,CAAC,IAAI,CACtC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,gBAAgB,GAAG,CAAC,CACvD;SACE,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,EAAE,cAAc,CAAC,EAAE,CAAC,CAAC;SACvC,MAAM,CAAC,EAAE,CAAC,EAAE;QACX,MAAM,YAAY,GAAG,EAAE,CAAC,OAAO,CAAe,IAAI,aAAa,GAAG,CAAC,CAAC;QACpE,IAAI,YAAY,EAAE,CAAC;YACjB,OAAO,8BAA8B,CAAC,QAAQ,CAC5C,YAAY,CAAC,KAAK,CAAC,OAA6B,CACjD,CAAC;QACJ,CAAC;QACD,OAAO,KAAK,CAAC;IACf,CAAC,CAAC;SACD,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,YAAY,CAAC,CAAC;IAE9B,qBAAqB,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE;QAC3C,MAAM,WAAW,GAAG,YAAY,CAAC,cAAc,EAAE,CAAC;QAClD,IAAI,CAAC,WAAW;YAAE,OAAO;QAEzB,YAAY,CAAC,UAAU,CAAC,WAAW,EAAE,MAAM,EAAE;YAC3C,IAAI;SACL,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAI,EAAE,CAAC;AACT,CAAC,CAAC","sourcesContent":["import type { Command } from '@blocksuite/block-std';\nimport type { BlockElement } from '@blocksuite/block-std';\nimport { INLINE_ROOT_ATTR, type InlineRootElement } from '@blocksuite/inline';\n\nimport { FORMAT_NATIVE_SUPPORT_FLAVOURS } from '../../../_common/configs/text-format/consts.js';\nimport { BLOCK_ID_ATTR } from '../../../_common/consts.js';\nimport type { AffineTextAttributes } from '../../../_common/inline/presets/affine-inline-specs.js';\n\n// for native range\nexport const formatNativeCommand: Command<\n  never,\n  never,\n  {\n    range?: Range;\n    styles: AffineTextAttributes;\n    mode?: 'replace' | 'merge';\n  }\n> = (ctx, next) => {\n  const { styles, mode = 'merge' } = ctx;\n\n  let range = ctx.range;\n  if (!range) {\n    const selection = document.getSelection();\n    if (!selection || selection.rangeCount === 0) return;\n    range = selection.getRangeAt(0);\n  }\n  if (!range) return;\n\n  const selectedInlineEditors = Array.from<InlineRootElement>(\n    ctx.std.host.querySelectorAll(`[${INLINE_ROOT_ATTR}]`)\n  )\n    .filter(el => range?.intersectsNode(el))\n    .filter(el => {\n      const blockElement = el.closest<BlockElement>(`[${BLOCK_ID_ATTR}]`);\n      if (blockElement) {\n        return FORMAT_NATIVE_SUPPORT_FLAVOURS.includes(\n          blockElement.model.flavour as BlockSuite.Flavour\n        );\n      }\n      return false;\n    })\n    .map(el => el.inlineEditor);\n\n  selectedInlineEditors.forEach(inlineEditor => {\n    const inlineRange = inlineEditor.getInlineRange();\n    if (!inlineRange) return;\n\n    inlineEditor.formatText(inlineRange, styles, {\n      mode,\n    });\n  });\n\n  next();\n};\n\ndeclare global {\n  namespace BlockSuite {\n    interface Commands {\n      formatNative: typeof formatNativeCommand;\n    }\n  }\n}\n"]}