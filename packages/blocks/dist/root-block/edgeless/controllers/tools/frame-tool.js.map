{"version":3,"file":"frame-tool.js","sourceRoot":"","sources":["../../../../../src/root-block/edgeless/controllers/tools/frame-tool.ts"],"names":[],"mappings":"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","sourcesContent":["import type { PointerEventState } from '@blocksuite/block-std';\nimport { assertExists, noop } from '@blocksuite/global/utils';\nimport { DocCollection } from '@blocksuite/store';\n\nimport type { IPoint } from '../../../../_common/utils/index.js';\nimport type { FrameBlockModel } from '../../../../frame-block/index.js';\nimport { Bound, type IVec, Vec } from '../../../../surface-block/index.js';\nimport { EdgelessToolController } from './edgeless-tool.js';\n\ntype FrameTool = {\n  type: 'frame';\n};\n\nexport class FrameToolController extends EdgelessToolController<FrameTool> {\n  private _startPoint: IVec | null = null;\n\n  private _frame: FrameBlockModel | null = null;\n\n  readonly tool = {\n    type: 'frame',\n  } as FrameTool;\n\n  private _toModelCoord(p: IPoint): IVec {\n    return this._service.viewport.toModelCoord(p.x, p.y);\n  }\n\n  override onContainerPointerDown(): void {\n    noop();\n  }\n\n  override onContainerDragStart(e: PointerEventState): void {\n    this._doc.captureSync();\n    const { point } = e;\n    this._startPoint = this._toModelCoord(point);\n  }\n\n  override onContainerDragMove(e: PointerEventState): void {\n    const currentPoint = this._toModelCoord(e.point);\n    assertExists(this._startPoint);\n    if (Vec.dist(this._startPoint, currentPoint) < 8 && !this._frame) return;\n    if (!this._frame) {\n      const frames = this._service.frames;\n\n      const id = this._service.addBlock(\n        'affine:frame',\n        {\n          title: new DocCollection.Y.Text(`Frame ${frames.length + 1}`),\n          xywh: Bound.fromPoints([this._startPoint, currentPoint]).serialize(),\n        },\n        this._service.surface\n      );\n      this._service.telemetryService?.track('CanvasElementAdded', {\n        control: 'canvas:draw',\n        page: 'whiteboard editor',\n        module: 'toolbar',\n        segment: 'toolbar',\n        type: 'frame',\n      });\n      this._frame = this._service.getElementById(id) as FrameBlockModel;\n      this._frame.stash('xywh');\n      return;\n    }\n    assertExists(this._frame);\n\n    this._service.updateElement(this._frame.id, {\n      xywh: Bound.fromPoints([this._startPoint, currentPoint]).serialize(),\n    });\n  }\n\n  override onContainerDragEnd(): void {\n    if (this._frame) {\n      const frame = this._frame;\n      this._doc.transact(() => {\n        frame.pop('xywh');\n      });\n      this._edgeless.tools.setEdgelessTool({ type: 'default' });\n      this._edgeless.service.selection.set({\n        elements: [this._frame.id],\n        editing: false,\n      });\n      this._doc.captureSync();\n    }\n    this._frame = null;\n    this._startPoint = null;\n  }\n\n  override onContainerClick(): void {\n    noop();\n  }\n\n  override onContainerDblClick(): void {\n    noop();\n  }\n\n  override onContainerTripleClick(): void {\n    noop();\n  }\n\n  override onContainerMouseMove(): void {\n    noop();\n  }\n\n  override onContainerMouseOut(): void {\n    noop();\n  }\n\n  override onContainerContextMenu(): void {\n    noop();\n  }\n\n  override onPressShiftKey(): void {\n    noop();\n  }\n\n  override onPressSpaceBar(_pressed: boolean): void {\n    noop();\n  }\n\n  override beforeModeSwitch(): void {\n    noop();\n  }\n\n  override afterModeSwitch(): void {\n    noop();\n  }\n}\n\ndeclare global {\n  namespace BlockSuite {\n    interface EdgelessToolMap {\n      frame: FrameToolController;\n    }\n  }\n}\n"]}