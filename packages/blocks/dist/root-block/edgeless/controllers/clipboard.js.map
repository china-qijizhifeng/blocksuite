{"version":3,"file":"clipboard.js","sourceRoot":"","sources":["../../../../src/root-block/edgeless/controllers/clipboard.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  BlockStdScope,\n  SurfaceSelection,\n  UIEventStateContext,\n} from '@blocksuite/block-std';\nimport type { EditorHost } from '@blocksuite/block-std';\nimport {\n  assertExists,\n  assertInstanceOf,\n  DisposableGroup,\n} from '@blocksuite/global/utils';\nimport {\n  type BlockSnapshot,\n  BlockSnapshotSchema,\n  DocCollection,\n  fromJSON,\n  Job,\n  type SliceSnapshot,\n} from '@blocksuite/store';\nimport DOMPurify from 'dompurify';\n\nimport {\n  CANVAS_EXPORT_IGNORE_TAGS,\n  EMBED_CARD_HEIGHT,\n  EMBED_CARD_WIDTH,\n} from '../../../_common/consts.js';\nimport type { EdgelessSelectableProps } from '../../../_common/edgeless/mixin/edgeless-selectable.js';\nimport { matchFlavours } from '../../../_common/utils/index.js';\nimport { groupBy } from '../../../_common/utils/iterable.js';\nimport {\n  blockElementGetter,\n  getRootByEditorHost,\n  isInsidePageEditor,\n} from '../../../_common/utils/query.js';\nimport { isUrlInClipboard } from '../../../_common/utils/url.js';\nimport { BookmarkStyles } from '../../../bookmark-block/bookmark-model.js';\nimport { EdgelessTextBlockModel } from '../../../edgeless-text/edgeless-text-model.js';\nimport type { NoteBlockModel } from '../../../note-block/note-model.js';\nimport type { IBound } from '../../../surface-block/consts.js';\nimport {\n  type SerializedElement,\n  SurfaceGroupLikeModel,\n} from '../../../surface-block/element-model/base.js';\nimport { CanvasElementType } from '../../../surface-block/element-model/index.js';\nimport { splitIntoLines } from '../../../surface-block/elements/text/utils.js';\nimport {\n  type Connection,\n  getBoundsWithRotation,\n} from '../../../surface-block/index.js';\nimport { ConnectorElementModel } from '../../../surface-block/index.js';\nimport { compare } from '../../../surface-block/managers/layer-utils.js';\nimport { Bound, getCommonBound } from '../../../surface-block/utils/bound.js';\nimport {\n  type IVec,\n  type IVec2,\n  Vec,\n} from '../../../surface-block/utils/vec.js';\nimport { ClipboardAdapter } from '../../clipboard/adapter.js';\nimport { PageClipboard } from '../../clipboard/index.js';\nimport {\n  decodeClipboardBlobs,\n  encodeClipboardBlobs,\n} from '../../clipboard/utils.js';\nimport type { EdgelessRootBlockComponent } from '../edgeless-root-block.js';\nimport { edgelessElementsBound } from '../utils/bound-utils.js';\nimport { getCloneElements, serializeElement } from '../utils/clone-utils.js';\nimport { DEFAULT_NOTE_HEIGHT, DEFAULT_NOTE_WIDTH } from '../utils/consts.js';\nimport { deleteElements } from '../utils/crud.js';\nimport {\n  isAttachmentBlock,\n  isCanvasElementWithText,\n  isImageBlock,\n  isTopLevelBlock,\n} from '../utils/query.js';\n\nconst BLOCKSUITE_SURFACE = 'blocksuite/surface';\nconst IMAGE_PNG = 'image/png';\n\nconst { GROUP, MINDMAP } = CanvasElementType;\nconst IMAGE_PADDING = 5; // for rotated shapes some padding is needed\n\ninterface CanvasExportOptions {\n  dpr?: number;\n  padding?: number;\n  background?: string;\n}\n\nexport class EdgelessClipboardController extends PageClipboard {\n  private get std() {\n    return this.host.std;\n  }\n\n  private get doc() {\n    return this.host.doc;\n  }\n\n  private get surface() {\n    return this.host.surface;\n  }\n\n  private get edgeless() {\n    return this.surface.edgeless;\n  }\n\n  private get toolManager() {\n    return this.host.tools;\n  }\n\n  private get selectionManager() {\n    return this.host.service.selection;\n  }\n\n  private get _rootService() {\n    return this.std.spec.getService('affine:page');\n  }\n\n  private get _exportManager() {\n    return this._rootService.exportManager;\n  }\n\n  constructor(public override host: EdgelessRootBlockComponent) {\n    super(host);\n  }\n\n  private _initEdgelessClipboard = () => {\n    this.host.handleEvent(\n      'copy',\n      ctx => {\n        const { surfaceSelections, selectedIds } = this.selectionManager;\n\n        if (selectedIds.length === 0) return false;\n\n        this._onCopy(ctx, surfaceSelections);\n        return;\n      },\n      { global: true }\n    );\n\n    this.host.handleEvent(\n      'paste',\n      ctx => {\n        this._onPaste(ctx).catch(console.error);\n      },\n      { global: true }\n    );\n\n    this.host.handleEvent(\n      'cut',\n      ctx => {\n        this._onCut(ctx);\n      },\n      { global: true }\n    );\n  };\n\n  private _onCopy = (\n    _context: UIEventStateContext,\n    surfaceSelection: SurfaceSelection[]\n  ) => {\n    const event = _context.get('clipboardState').raw;\n    event.preventDefault();\n\n    const elements = getCloneElements(\n      this.selectionManager.selectedElements,\n      this.surface.edgeless.service.frame\n    );\n\n    // when note active, handle copy like page mode\n    if (surfaceSelection[0] && surfaceSelection[0].editing) {\n      // use build-in copy handler in rich-text when copy in surface text element\n      if (isCanvasElementWithText(elements[0])) return;\n      this.onPageCopy(_context);\n      return;\n    }\n\n    this.std.clipboard\n      .writeToClipboard(async _items => {\n        const data = await prepareClipboardData(elements, this.std);\n        return {\n          ..._items,\n          [BLOCKSUITE_SURFACE]: JSON.stringify(data),\n        };\n      })\n      .catch(console.error);\n  };\n\n  private _onPaste = async (_context: UIEventStateContext) => {\n    if (\n      document.activeElement instanceof HTMLInputElement ||\n      document.activeElement instanceof HTMLTextAreaElement\n    ) {\n      return;\n    }\n    const event = _context.get('clipboardState').raw;\n    event.preventDefault();\n\n    const { surfaceSelections, selectedElements } = this.selectionManager;\n\n    if (surfaceSelections[0]?.editing) {\n      // use build-in paste handler in rich-text when paste in surface text element\n      if (isCanvasElementWithText(selectedElements[0])) return;\n      this.onPagePaste(_context);\n      return;\n    }\n\n    const data = event.clipboardData;\n    if (!data) return;\n\n    const { lastMousePos } = this.toolManager;\n    const point: IVec2 = [lastMousePos.x, lastMousePos.y];\n\n    if (isPureFileInClipboard(data)) {\n      const files = data.files;\n      if (files.length === 0) return;\n\n      const imageFiles: File[] = [],\n        attachmentFiles: File[] = [];\n\n      [...files].forEach(file => {\n        if (file.type.startsWith('image/')) {\n          imageFiles.push(file);\n        } else {\n          attachmentFiles.push(file);\n        }\n      });\n\n      // when only images in clipboard, add image-blocks else add all files as attachments\n      if (attachmentFiles.length === 0) {\n        await this.host.addImages(imageFiles, point);\n      } else {\n        await this.host.addAttachments([...files], point);\n      }\n\n      this._rootService.telemetryService?.track('CanvasElementAdded', {\n        control: 'canvas:paste',\n        page: 'whiteboard editor',\n        module: 'toolbar',\n        segment: 'toolbar',\n        type: attachmentFiles.length === 0 ? 'image' : 'attachment',\n      });\n\n      return;\n    }\n\n    if (isUrlInClipboard(data)) {\n      const url = data.getData('text/plain');\n      const { lastMousePos } = this.toolManager;\n      const [x, y] = this.host.service.viewport.toModelCoord(\n        lastMousePos.x,\n        lastMousePos.y\n      );\n\n      // try interpret url as affine doc url\n      const doc = await this._rootService.quickSearchService?.searchDoc({\n        action: 'insert',\n        userInput: url,\n        skipSelection: true,\n      });\n      const pageId = doc && 'docId' in doc ? doc.docId : undefined;\n\n      const embedOptions = this._rootService.getEmbedBlockOptions(url);\n      const flavour = pageId\n        ? 'affine:embed-linked-doc'\n        : embedOptions\n          ? (embedOptions.flavour as BlockSuite.EdgelessModelKeyType)\n          : 'affine:bookmark';\n      const style = pageId\n        ? 'vertical'\n        : embedOptions\n          ? embedOptions.styles[0]\n          : BookmarkStyles[0];\n      const width = EMBED_CARD_WIDTH[style];\n      const height = EMBED_CARD_HEIGHT[style];\n\n      const options: Record<string, unknown> = {\n        xywh: Bound.fromCenter(\n          Vec.toVec({\n            x,\n            y,\n          }),\n          width,\n          height\n        ).serialize(),\n        style,\n      };\n\n      if (pageId) {\n        options.pageId = pageId;\n      } else {\n        options.url = url;\n      }\n\n      const id = this.host.service.addBlock(\n        flavour,\n        options,\n        this.surface.model.id\n      );\n\n      this._rootService.telemetryService?.track('CanvasElementAdded', {\n        control: 'canvas:paste',\n        page: 'whiteboard editor',\n        module: 'toolbar',\n        segment: 'toolbar',\n        type: flavour.split(':')[1],\n      });\n\n      this._rootService.telemetryService?.track('LinkedDocCreated', {\n        page: 'whiteboard editor',\n        segment: 'whiteboard',\n        category: 'pasted link',\n        other: 'existing doc',\n      });\n\n      this.selectionManager.set({\n        editing: false,\n        elements: [id],\n      });\n\n      return;\n    }\n\n    const svg = tryGetSvgFromClipboard(data);\n    if (svg) {\n      await this.host.addImages([svg], point);\n      return;\n    }\n    try {\n      // check for surface elements in clipboard\n      const json = this.std.clipboard.readFromClipboard(data);\n      const mayBeSurfaceDataJson = json[BLOCKSUITE_SURFACE];\n      if (mayBeSurfaceDataJson !== undefined) {\n        const elementsRawData = JSON.parse(mayBeSurfaceDataJson);\n        const { snapshot, blobs } = elementsRawData;\n        const job = new Job({ collection: this.std.collection });\n        const map = job.assetsManager.getAssets();\n        decodeClipboardBlobs(blobs, map);\n        for (const blobId of map.keys()) {\n          await job.assetsManager.writeToBlob(blobId);\n        }\n        await this._pasteShapesAndBlocks(snapshot);\n        return;\n      }\n      // check for slice snapshot in clipboard\n      const mayBeSliceDataJson = json[ClipboardAdapter.MIME];\n      if (mayBeSliceDataJson === undefined) return;\n      const clipData = JSON.parse(mayBeSliceDataJson);\n      const sliceSnapShot = clipData?.snapshot as SliceSnapshot;\n      this._pasteTextContentAsNote(sliceSnapShot.content);\n    } catch (_) {\n      // if it is not parsable\n      this._pasteTextContentAsNote(data.getData('text/plain'));\n    }\n  };\n\n  private _onCut = (_context: UIEventStateContext) => {\n    const { surfaceSelections, selectedElements } = this.selectionManager;\n\n    if (selectedElements.length === 0) return;\n\n    const event = _context.get('clipboardState').event;\n    event.preventDefault();\n\n    this._onCopy(_context, surfaceSelections);\n\n    if (surfaceSelections[0]?.editing) {\n      // use build-in cut handler in rich-text when cut in surface text element\n      if (isCanvasElementWithText(selectedElements[0])) return;\n      this.onPageCut(_context);\n      return;\n    }\n\n    const elements = getCloneElements(\n      this.selectionManager.selectedElements,\n      this.surface.edgeless.service.frame\n    );\n    this.doc.transact(() => {\n      deleteElements(this.surface, elements);\n    });\n\n    this.selectionManager.set({\n      editing: false,\n      elements: [],\n    });\n  };\n\n  private _createCanvasElement(\n    clipboardData: Record<string, unknown>,\n    idMap: Map<string, string>\n  ) {\n    if (clipboardData.type === GROUP) {\n      const yMap = new DocCollection.Y.Map();\n      const children = clipboardData.children ?? {};\n      for (const [key, value] of Object.entries(children)) {\n        const newKey = idMap.get(key);\n        assertExists(newKey);\n        yMap.set(newKey, value);\n      }\n      clipboardData.children = yMap;\n    }\n\n    if (clipboardData.type === MINDMAP) {\n      const yMap = new DocCollection.Y.Map();\n      const children = clipboardData.children ?? {};\n      for (const [key, value] of Object.entries(children)) {\n        const newKey = idMap.get(key);\n        assertExists(newKey);\n\n        if (value.parent) {\n          const newParent = idMap.get(value.parent);\n          assertExists(newParent);\n          value.parent = newParent;\n        }\n\n        yMap.set(newKey, value);\n      }\n      clipboardData.children = yMap;\n    }\n\n    const id = this.host.service.addElement(\n      clipboardData.type as CanvasElementType,\n      clipboardData\n    );\n    this.host.service.telemetryService?.track('CanvasElementAdded', {\n      control: 'canvas:paste',\n      page: 'whiteboard editor',\n      module: 'toolbar',\n      segment: 'toolbar',\n      type: clipboardData.type as string,\n    });\n    const element = this.host.service.getElementById(\n      id\n    ) as BlockSuite.SurfaceModelType;\n    assertExists(element);\n    return element;\n  }\n\n  private _createCanvasElements(\n    elements: SerializedElement[],\n    idMap: Map<string, string>\n  ) {\n    const result = groupBy(elements, item => {\n      switch (item.type) {\n        case 'connector':\n          return 'connectors';\n        case 'group':\n          return 'groups';\n        case 'mindmap':\n          return 'mindmaps';\n        default:\n          return 'others';\n      }\n    });\n\n    return [\n      ...(result.others\n        ?.map(d => {\n          const oldId = d.id as string;\n          assertExists(oldId);\n          const element = this._createCanvasElement(d, idMap);\n          idMap.set(oldId, element.id);\n          return element;\n        })\n        .filter(e => !!e) ?? []),\n\n      ...(result.connectors?.map(connector => {\n        const oldId = connector.id as string;\n        const sourceId = (connector.source as Connection).id;\n        if (sourceId) {\n          (connector.source as Connection).id =\n            idMap.get(sourceId) ?? (sourceId as string);\n        }\n        const targetId = (connector.target as Connection).id;\n        if (targetId) {\n          (connector.target as Connection).id =\n            idMap.get(targetId) ?? (targetId as string);\n        }\n        const element = this._createCanvasElement(connector, idMap);\n        idMap.set(oldId, element.id);\n        return element;\n      }) ?? []),\n\n      ...(result.groups?.map(group => {\n        const oldId = group.id as string;\n        assertExists(oldId);\n        const element = this._createCanvasElement(group, idMap);\n        idMap.set(oldId, element.id);\n        return element;\n      }) ?? []),\n\n      ...(result.mindmaps?.map(mindmap => {\n        const oldId = mindmap.id as string;\n        assertExists(oldId);\n        const element = this._createCanvasElement(mindmap, idMap);\n        idMap.set(oldId, element.id);\n        return element;\n      }) ?? []),\n    ];\n  }\n\n  private _createNoteBlocks(\n    notes: BlockSnapshot[],\n    oldToNewIdMap: Map<string, string>\n  ) {\n    const { host } = this;\n    const noteIds = notes.map(({ id, props, children }) => {\n      delete props.index;\n      assertExists(props.xywh);\n      const noteId = host.service.addBlock(\n        'affine:note',\n        props,\n        this.doc.root!.id\n      );\n      const note = host.service.getElementById(noteId) as NoteBlockModel;\n      if (id) oldToNewIdMap.set(id, noteId);\n      assertExists(note);\n\n      children.forEach((child, index) => {\n        this.onBlockSnapshotPaste(child, this.doc, note.id, index);\n      });\n      return noteId;\n    });\n    return noteIds;\n  }\n\n  private _createEdgelessTextBlocks(\n    edgelessTexts: BlockSnapshot[],\n    oldToNewIdMap: Map<string, string>\n  ) {\n    const { host } = this;\n    const edgelessTextIds = edgelessTexts.map(({ id, props, children }) => {\n      delete props.index;\n      assertExists(props.xywh);\n      const textId = host.service.addBlock(\n        'affine:edgeless-text',\n        props,\n        this.edgeless.surface.model.id\n      );\n      const text = host.service.getElementById(textId);\n      oldToNewIdMap.set(id, textId);\n      assertInstanceOf(text, EdgelessTextBlockModel);\n\n      children.forEach((child, index) => {\n        this.onBlockSnapshotPaste(child, this.doc, text.id, index);\n      });\n      return textId;\n    });\n    return edgelessTextIds;\n  }\n\n  private _createFrameBlocks(frames: BlockSnapshot[]) {\n    const frameIds = frames.map(({ props }) => {\n      const { xywh, title, background } = props;\n      const frameId = this.host.service.addBlock(\n        'affine:frame',\n        {\n          xywh,\n          background,\n          title: fromJSON(title),\n        },\n        this.surface.model.id\n      );\n      return frameId;\n    });\n    return frameIds;\n  }\n\n  private async _createImageBlocks(\n    images: BlockSnapshot[],\n    oldToNewIdMap: Map<string, string>\n  ) {\n    const imageIds = [];\n    for (const { props, id } of images) {\n      const { xywh, rotate, sourceId, size, width, height, caption } = props;\n      if (!(await this.host.std.collection.blobSync.get(sourceId as string))) {\n        continue;\n      }\n      const imageId = this.host.service.addBlock(\n        'affine:image',\n        {\n          caption,\n          sourceId,\n          xywh,\n          rotate,\n          size,\n          width,\n          height,\n        },\n        this.surface.model.id\n      );\n      if (id) oldToNewIdMap.set(id, imageId);\n      imageIds.push(imageId);\n    }\n    return imageIds;\n  }\n\n  private async _createAttachmentBlocks(attachments: BlockSnapshot[]) {\n    const attachmentIds = [];\n    for (const { props } of attachments) {\n      const { xywh, rotate, sourceId, name, size, type, embed, style } = props;\n      if (!(await this.host.std.collection.blobSync.get(sourceId as string))) {\n        continue;\n      }\n      const attachmentId = this.host.service.addBlock(\n        'affine:attachment',\n        {\n          xywh,\n          rotate,\n          sourceId,\n          name,\n          size,\n          type,\n          embed,\n          style,\n        },\n        this.surface.model.id\n      );\n      attachmentIds.push(attachmentId);\n    }\n    return attachmentIds;\n  }\n\n  private _createBookmarkBlocks(bookmarks: BlockSnapshot[]) {\n    const bookmarkIds = bookmarks.map(({ props }) => {\n      const { xywh, style, url, caption, description, icon, image, title } =\n        props;\n      const bookmarkId = this.host.service.addBlock(\n        'affine:bookmark',\n        {\n          xywh,\n          style,\n          url,\n          caption,\n          description,\n          icon,\n          image,\n          title,\n        },\n        this.surface.model.id\n      );\n      return bookmarkId;\n    });\n    return bookmarkIds;\n  }\n\n  private _createGithubEmbedBlocks(githubEmbeds: BlockSnapshot[]) {\n    const embedGithubIds = githubEmbeds.map(({ props }) => {\n      const {\n        xywh,\n        style,\n        owner,\n        repo,\n        githubType,\n        githubId,\n        url,\n        caption,\n        image,\n        status,\n        statusReason,\n        title,\n        description,\n        createdAt,\n        assignees,\n      } = props;\n\n      const embedGithubId = this.host.service.addBlock(\n        'affine:embed-github',\n        {\n          xywh,\n          style,\n          owner,\n          repo,\n          githubType,\n          githubId,\n          url,\n          caption,\n          image,\n          status,\n          statusReason,\n          title,\n          description,\n          createdAt,\n          assignees,\n        },\n        this.surface.model.id\n      );\n      return embedGithubId;\n    });\n    return embedGithubIds;\n  }\n\n  private _createYoutubeEmbedBlocks(youtubeEmbeds: BlockSnapshot[]) {\n    const embedYoutubeIds = youtubeEmbeds.map(({ props }) => {\n      const {\n        xywh,\n        style,\n        url,\n        caption,\n        videoId,\n        image,\n        title,\n        description,\n        creator,\n        creatorUrl,\n        creatorImage,\n      } = props;\n\n      const embedYoutubeId = this.host.service.addBlock(\n        'affine:embed-youtube',\n        {\n          xywh,\n          style,\n          url,\n          caption,\n          videoId,\n          image,\n          title,\n          description,\n          creator,\n          creatorUrl,\n          creatorImage,\n        },\n        this.surface.model.id\n      );\n      return embedYoutubeId;\n    });\n    return embedYoutubeIds;\n  }\n\n  private _createFigmaEmbedBlocks(figmaEmbeds: BlockSnapshot[]) {\n    const embedFigmaIds = figmaEmbeds.map(({ props }) => {\n      const { xywh, style, url, caption, title, description } = props;\n\n      const embedFigmaId = this.host.service.addBlock(\n        'affine:embed-figma',\n        {\n          xywh,\n          style,\n          url,\n          caption,\n          title,\n          description,\n        },\n        this.surface.model.id\n      );\n      return embedFigmaId;\n    });\n    return embedFigmaIds;\n  }\n\n  private _createLinkedDocEmbedBlocks(linkedDocEmbeds: BlockSnapshot[]) {\n    const embedLinkedDocIds = linkedDocEmbeds.map(({ props }) => {\n      const { xywh, style, caption, pageId } = props;\n\n      return this.host.service.addBlock(\n        'affine:embed-linked-doc',\n        {\n          xywh,\n          style,\n          caption,\n          pageId,\n        },\n        this.surface.model.id\n      );\n    });\n    return embedLinkedDocIds;\n  }\n\n  private _createSyncedDocEmbedBlocks(syncedDocEmbeds: BlockSnapshot[]) {\n    const embedSyncedDocIds = syncedDocEmbeds.map(({ props }) => {\n      const { xywh, style, caption, scale, pageId } = props;\n\n      return this.host.service.addBlock(\n        'affine:embed-synced-doc',\n        {\n          xywh,\n          style,\n          caption,\n          scale,\n          pageId,\n        },\n        this.surface.model.id\n      );\n    });\n    return embedSyncedDocIds;\n  }\n\n  private _createHtmlEmbedBlocks(htmlEmbeds: BlockSnapshot[]) {\n    const embedHtmlIds = htmlEmbeds.map(({ props }) => {\n      const { xywh, style, caption, html, design } = props;\n\n      const embedHtmlId = this.host.service.addBlock(\n        'affine:embed-html',\n        {\n          xywh,\n          style,\n          caption,\n          html,\n          design,\n        },\n        this.surface.model.id\n      );\n      return embedHtmlId;\n    });\n    return embedHtmlIds;\n  }\n\n  private _createLoomEmbedBlocks(loomEmbeds: BlockSnapshot[]) {\n    const embedLoomIds = loomEmbeds.map(({ props }) => {\n      const { xywh, style, url, caption, videoId, image, title, description } =\n        props;\n\n      const embedLoomId = this.host.service.addBlock(\n        'affine:embed-loom',\n        {\n          xywh,\n          style,\n          url,\n          caption,\n          videoId,\n          image,\n          title,\n          description,\n        },\n        this.surface.model.id\n      );\n      return embedLoomId;\n    });\n    return embedLoomIds;\n  }\n\n  private _emitSelectionChangeAfterPaste(\n    canvasElementIds: string[],\n    blockIds: string[]\n  ) {\n    const newSelected = [\n      ...canvasElementIds,\n      ...blockIds.filter(id => {\n        return isTopLevelBlock(this.doc.getBlockById(id));\n      }),\n    ];\n\n    this.selectionManager.set({\n      editing: false,\n      elements: newSelected,\n    });\n  }\n\n  private _updatePastedElementsIndex(\n    elements: BlockSuite.EdgelessModelType[],\n    originalIndexes: Map<string, string>\n  ) {\n    function compare(\n      a: BlockSuite.EdgelessModelType,\n      b: BlockSuite.EdgelessModelType\n    ) {\n      if (a instanceof SurfaceGroupLikeModel && a.hasDescendant(b)) {\n        return -1;\n      } else if (b instanceof SurfaceGroupLikeModel && b.hasDescendant(a)) {\n        return 1;\n      } else {\n        const aGroups = a.groups;\n        const bGroups = b.groups;\n        const minGroups = Math.min(aGroups.length, bGroups.length);\n\n        for (let i = 0; i < minGroups; ++i) {\n          if (aGroups[i] !== bGroups[i]) {\n            const aGroup = aGroups[i] ?? a;\n            const bGroup = bGroups[i] ?? b;\n\n            return aGroup.index === bGroup.index\n              ? 0\n              : aGroup.index < bGroup.index\n                ? -1\n                : 1;\n          }\n        }\n\n        if (originalIndexes.get(a.id)! < originalIndexes.get(b.id)!) return -1;\n        else if (originalIndexes.get(a.id)! > originalIndexes.get(b.id)!)\n          return 1;\n        return 0;\n      }\n    }\n\n    const idxGenerator = this.edgeless.service.layer.createIndexGenerator(true);\n    const sortedElements = elements.sort(compare);\n    sortedElements.forEach(ele => {\n      this.edgeless.service.updateElement(ele.id, {\n        index: idxGenerator(isTopLevelBlock(ele) ? ele.flavour : ele.type),\n      });\n    });\n  }\n\n  private _pasteTextContentAsNote(content: BlockSnapshot[] | string) {\n    const edgeless = this.host;\n    const { lastMousePos } = this.toolManager;\n    const [x, y] = edgeless.service.viewport.toModelCoord(\n      lastMousePos.x,\n      lastMousePos.y\n    );\n\n    const noteProps = {\n      xywh: new Bound(\n        x,\n        y,\n        DEFAULT_NOTE_WIDTH,\n        DEFAULT_NOTE_HEIGHT\n      ).serialize(),\n    };\n\n    const noteId = edgeless.service.addBlock(\n      'affine:note',\n      noteProps,\n      this.doc.root!.id\n    );\n\n    edgeless.service.telemetryService?.track('CanvasElementAdded', {\n      control: 'canvas:paste',\n      page: 'whiteboard editor',\n      module: 'toolbar',\n      segment: 'toolbar',\n      type: 'note',\n    });\n\n    if (typeof content === 'string') {\n      splitIntoLines(content).forEach((line, idx) => {\n        edgeless.service.addBlock(\n          'affine:paragraph',\n          { text: new DocCollection.Y.Text(line) },\n          noteId,\n          idx\n        );\n      });\n    } else {\n      content.forEach((child, idx) => {\n        this.onBlockSnapshotPaste(child, this.doc, noteId, idx);\n      });\n    }\n\n    edgeless.service.selection.set({\n      elements: [noteId],\n      editing: false,\n    });\n    edgeless.tools.setEdgelessTool({ type: 'default' });\n  }\n\n  private async _pasteShapesAndBlocks(\n    elementsRawData: (SerializedElement | BlockSnapshot)[]\n  ) {\n    const { canvasElements, blockModels } =\n      await this.createElementsFromClipboardData(elementsRawData);\n    this._emitSelectionChangeAfterPaste(\n      canvasElements.map(ele => ele.id),\n      blockModels.map(block => block.id)\n    );\n  }\n\n  private async _replaceRichTextWithSvgElement(element: HTMLElement) {\n    const richList = Array.from(element.querySelectorAll('.inline-editor'));\n    await Promise.all(\n      richList.map(rich => {\n        const svgEle = this._elementToSvgElement(\n          rich.cloneNode(true) as HTMLElement,\n          rich.clientWidth,\n          rich.clientHeight + 1\n        );\n        rich.parentElement?.append(svgEle);\n        rich.remove();\n      })\n    );\n  }\n\n  private _elementToSvgElement(\n    node: HTMLElement,\n    width: number,\n    height: number\n  ) {\n    const xmlns = 'http://www.w3.org/2000/svg';\n    const svg = document.createElementNS(xmlns, 'svg');\n    const foreignObject = document.createElementNS(xmlns, 'foreignObject');\n\n    svg.setAttribute('width', `${width}`);\n    svg.setAttribute('height', `${height}`);\n    svg.setAttribute('viewBox', `0 0 ${width} ${height}`);\n\n    foreignObject.setAttribute('width', '100%');\n    foreignObject.setAttribute('height', '100%');\n    foreignObject.setAttribute('x', '0');\n    foreignObject.setAttribute('y', '0');\n    foreignObject.setAttribute('externalResourcesRequired', 'true');\n\n    svg.append(foreignObject);\n    foreignObject.append(node);\n    return svg;\n  }\n\n  private async _edgelessToCanvas(\n    edgeless: EdgelessRootBlockComponent,\n    bound: IBound,\n    nodes?: BlockSuite.EdgelessBlockModelType[],\n    canvasElements: BlockSuite.SurfaceModelType[] = [],\n    {\n      background,\n      padding = IMAGE_PADDING,\n      dpr = window.devicePixelRatio || 1,\n    }: CanvasExportOptions = {}\n  ): Promise<HTMLCanvasElement | undefined> {\n    const host = edgeless.host;\n    const rootModel = this.doc.root;\n    if (!rootModel) return;\n\n    const html2canvas = (await import('html2canvas')).default;\n    if (!(html2canvas instanceof Function)) return;\n\n    const pathname = location.pathname;\n    const editorMode = isInsidePageEditor(host);\n\n    const rootElement = getRootByEditorHost(host);\n    assertExists(rootElement);\n\n    const container = rootElement.querySelector(\n      '.affine-block-children-container'\n    );\n    if (!container) return;\n\n    const canvas = document.createElement('canvas');\n    canvas.width = (bound.w + padding * 2) * dpr;\n    canvas.height = (bound.h + padding * 2) * dpr;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n    if (background) {\n      ctx.fillStyle = background;\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n    }\n    ctx.scale(dpr, dpr);\n\n    const replaceImgSrcWithSvg = this._exportManager.replaceImgSrcWithSvg;\n    const replaceRichTextWithSvgElementFunc =\n      this._replaceRichTextWithSvgElement.bind(this);\n\n    const imageProxy = host.std.clipboard.configs.get('imageProxy');\n    const html2canvasOption = {\n      ignoreElements: function (element: Element) {\n        if (\n          CANVAS_EXPORT_IGNORE_TAGS.includes(element.tagName) ||\n          element.classList.contains('dg')\n        ) {\n          return true;\n        } else {\n          return false;\n        }\n      },\n\n      onclone: async function (documentClone: Document, element: HTMLElement) {\n        // html2canvas can't support transform feature\n        element.style.setProperty('transform', 'none');\n        const layer = documentClone.querySelector('.affine-edgeless-layer');\n        if (layer && layer instanceof HTMLElement) {\n          layer.style.setProperty('transform', 'none');\n        }\n\n        const boxShadowElements = documentClone.querySelectorAll(\n          \"[style*='box-shadow']\"\n        );\n        boxShadowElements.forEach(function (element) {\n          if (element instanceof HTMLElement) {\n            element.style.setProperty('box-shadow', 'none');\n          }\n        });\n        await replaceImgSrcWithSvg(element);\n        await replaceRichTextWithSvgElementFunc(element);\n      },\n      backgroundColor: 'transparent',\n      useCORS: imageProxy ? false : true,\n      proxy: imageProxy,\n    };\n\n    const _drawTopLevelBlock = async (\n      block: BlockSuite.EdgelessBlockModelType,\n      isInFrame = false\n    ) => {\n      let blockElement = blockElementGetter(\n        block,\n        this.std.view\n      )?.parentElement;\n      const blockPortalSelector = block.flavour.replace(\n        'affine:',\n        '.edgeless-block-portal-'\n      );\n      blockElement = blockElement?.closest(blockPortalSelector);\n      if (!blockElement) {\n        throw new Error('Could not find edgeless block portal.');\n      }\n\n      const blockBound = Bound.deserialize(block.xywh);\n      const canvasData = await html2canvas(\n        blockElement as HTMLElement,\n        html2canvasOption\n      );\n      ctx.drawImage(\n        canvasData,\n        blockBound.x - bound.x + padding,\n        blockBound.y - bound.y + padding,\n        blockBound.w,\n        isInFrame\n          ? (blockBound.w / canvasData.width) * canvasData.height\n          : blockBound.h\n      );\n    };\n\n    const nodeElements =\n      nodes ??\n      (edgeless.service.pickElementsByBound(\n        bound,\n        'blocks'\n      ) as BlockSuite.EdgelessBlockModelType[]);\n    for (const nodeElement of nodeElements) {\n      await _drawTopLevelBlock(nodeElement);\n\n      if (matchFlavours(nodeElement, ['affine:frame'])) {\n        const blocksInsideFrame: BlockSuite.EdgelessBlockModelType[] = [];\n        this.edgeless.service.frame\n          .getElementsInFrame(nodeElement, false)\n          .forEach(ele => {\n            if (isTopLevelBlock(ele)) {\n              blocksInsideFrame.push(ele as BlockSuite.EdgelessBlockModelType);\n            } else {\n              canvasElements.push(ele as BlockSuite.SurfaceModelType);\n            }\n          });\n\n        for (let i = 0; i < blocksInsideFrame.length; i++) {\n          const element = blocksInsideFrame[i];\n          await _drawTopLevelBlock(element, true);\n        }\n      }\n\n      this._checkCanContinueToCanvas(host, pathname, editorMode);\n    }\n\n    const surfaceCanvas = edgeless.surface.renderer.getCanvasByBound(\n      bound,\n      canvasElements\n    );\n    ctx.drawImage(surfaceCanvas, padding, padding, bound.w, bound.h);\n\n    return canvas;\n  }\n\n  private _checkCanContinueToCanvas(\n    host: EditorHost,\n    pathName: string,\n    editorMode: boolean\n  ) {\n    if (\n      location.pathname !== pathName ||\n      isInsidePageEditor(host) !== editorMode\n    ) {\n      throw new Error('Unable to export content to canvas');\n    }\n  }\n\n  override hostConnected() {\n    if (this._disposables.disposed) {\n      this._disposables = new DisposableGroup();\n    }\n    this._init();\n    this._initEdgelessClipboard();\n  }\n\n  copy() {\n    document.dispatchEvent(\n      new Event('copy', {\n        bubbles: true,\n        cancelable: true,\n      })\n    );\n  }\n\n  async createElementsFromClipboardData(\n    elementsRawData: (SerializedElement | BlockSnapshot)[],\n    pasteCenter?: IVec\n  ) {\n    const originalIndexes = new Map<string, string>();\n    const blockRawData: BlockSnapshot[] = [];\n    const surfaceRawData: SerializedElement[] = [];\n\n    elementsRawData.forEach(data => {\n      const { data: blockSnapshot } = BlockSnapshotSchema.safeParse(data);\n      if (blockSnapshot) {\n        const props = blockSnapshot.props as EdgelessSelectableProps;\n        originalIndexes.set(blockSnapshot.id, props.index);\n\n        blockRawData.push(blockSnapshot);\n      } else {\n        const serializedElement = data as SerializedElement;\n        originalIndexes.set(serializedElement.id, serializedElement.index);\n\n        surfaceRawData.push(serializedElement);\n      }\n    });\n\n    const noteSnapshots = blockRawData.filter(\n      data => data.flavour === 'affine:note'\n    );\n    const edgelessTextSnapshots = blockRawData.filter(\n      data => data.flavour === 'affine:edgeless-text'\n    );\n    const imageSnapshots = blockRawData.filter(\n      data => data.flavour === 'affine:image'\n    );\n    const frameSnapshots = blockRawData.filter(\n      data => data.flavour === 'affine:frame'\n    );\n    const attachmentSnapshots = blockRawData.filter(\n      data => data.flavour === 'affine:attachment'\n    );\n    const bookmarkSnapshots = blockRawData.filter(\n      data => data.flavour === 'affine:bookmark'\n    );\n    const embedGithubSnapshots = blockRawData.filter(\n      data => data.flavour === 'affine:embed-github'\n    );\n    const embedYoutubeSnapshots = blockRawData.filter(\n      data => data.flavour === 'affine:embed-youtube'\n    );\n    const embedFigmaSnapshots = blockRawData.filter(\n      data => data.flavour === 'affine:embed-figma'\n    );\n    const embedLinkedDocSnapshots = blockRawData.filter(\n      data => data.flavour === 'affine:embed-linked-doc'\n    );\n    const embedSyncedDocSnapshots = blockRawData.filter(\n      data => data.flavour === 'affine:embed-synced-doc'\n    );\n    const embedHtmlSnapshots = blockRawData.filter(\n      data => data.flavour === 'affine:embed-html'\n    );\n    const embedLoomSnapshots = blockRawData.filter(\n      data => data.flavour === 'affine:embed-loom'\n    );\n\n    // map old id to new id to rebuild connector's source and target\n    const oldIdToNewIdMap = new Map<string, string>();\n\n    const noteIds = this._createNoteBlocks(noteSnapshots, oldIdToNewIdMap);\n    const edgelessTextIds = this._createEdgelessTextBlocks(\n      edgelessTextSnapshots,\n      oldIdToNewIdMap\n    );\n    const imageIds = await this._createImageBlocks(\n      imageSnapshots,\n      oldIdToNewIdMap\n    );\n    const frameIds = this._createFrameBlocks(frameSnapshots);\n    const attachmentIds =\n      await this._createAttachmentBlocks(attachmentSnapshots);\n    const bookmarkIds = this._createBookmarkBlocks(bookmarkSnapshots);\n    const embedGithubIds = this._createGithubEmbedBlocks(embedGithubSnapshots);\n    const embedYoutubeIds = this._createYoutubeEmbedBlocks(\n      embedYoutubeSnapshots\n    );\n    const embedFigmaIds = this._createFigmaEmbedBlocks(embedFigmaSnapshots);\n    const embedLinkedDocIds = this._createLinkedDocEmbedBlocks(\n      embedLinkedDocSnapshots\n    );\n    const embedSyncedDocIds = this._createSyncedDocEmbedBlocks(\n      embedSyncedDocSnapshots\n    );\n    const embedHtmlIds = this._createHtmlEmbedBlocks(embedHtmlSnapshots);\n    const embedLoomIds = this._createLoomEmbedBlocks(embedLoomSnapshots);\n\n    const blockModels = [\n      ...noteIds,\n      ...edgelessTextIds,\n      ...frameIds,\n      ...imageIds,\n      ...attachmentIds,\n      ...bookmarkIds,\n      ...embedGithubIds,\n      ...embedYoutubeIds,\n      ...embedFigmaIds,\n      ...embedLinkedDocIds,\n      ...embedSyncedDocIds,\n      ...embedHtmlIds,\n      ...embedLoomIds,\n    ].flatMap(\n      id => this.host.doc.getBlock(id)?.model ?? []\n    ) as BlockSuite.EdgelessBlockModelType[];\n    const canvasElements = this._createCanvasElements(\n      surfaceRawData,\n      oldIdToNewIdMap\n    );\n    const allElements = [...blockModels, ...canvasElements];\n\n    const { lastMousePos } = this.toolManager;\n    pasteCenter =\n      pasteCenter ??\n      this.host.service.viewport.toModelCoord(lastMousePos.x, lastMousePos.y);\n    const [modelX, modelY] = pasteCenter;\n    const oldCommonBound = edgelessElementsBound(allElements);\n    const pasteX = modelX - oldCommonBound.w / 2;\n    const pasteY = modelY - oldCommonBound.h / 2;\n\n    blockModels.forEach(block => {\n      const bound = Bound.deserialize(block.xywh);\n\n      bound.x += pasteX - oldCommonBound.x;\n      bound.y += pasteY - oldCommonBound.y;\n      this.edgeless.service.updateElement(block.id, {\n        xywh: bound.serialize(),\n      });\n    });\n\n    canvasElements.forEach(ele => {\n      const newBound = new Bound(\n        pasteX + ele.x - oldCommonBound.x,\n        pasteY + ele.y - oldCommonBound.y,\n        ele.w,\n        ele.h\n      );\n      if (ele instanceof ConnectorElementModel) {\n        ele.moveTo(newBound);\n      } else {\n        this.host.service.updateElement(ele.id, {\n          xywh: newBound.serialize(),\n        });\n      }\n    });\n\n    originalIndexes.forEach((index, id) => {\n      const newId = oldIdToNewIdMap.get(id);\n      if (newId) {\n        originalIndexes.set(newId, index);\n      }\n    });\n\n    this._updatePastedElementsIndex(allElements, originalIndexes);\n\n    return {\n      canvasElements,\n      blockModels,\n    };\n  }\n\n  async toCanvas(\n    blocks: BlockSuite.EdgelessBlockModelType[],\n    shapes: BlockSuite.SurfaceModelType[],\n    options?: CanvasExportOptions\n  ) {\n    blocks.sort(compare);\n    shapes.sort(compare);\n\n    const bounds: IBound[] = [];\n    blocks.forEach(block => {\n      bounds.push(Bound.deserialize(block.xywh));\n    });\n    shapes.forEach(shape => {\n      bounds.push(getBoundsWithRotation(shape.elementBound));\n    });\n    const bound = getCommonBound(bounds);\n    assertExists(bound, 'bound not exist');\n\n    const canvas = await this._edgelessToCanvas(\n      this.host,\n      bound,\n      blocks,\n      shapes,\n      options\n    );\n    return canvas;\n  }\n\n  async copyAsPng(\n    blocks: BlockSuite.EdgelessBlockModelType[],\n    shapes: BlockSuite.SurfaceModelType[]\n  ) {\n    const blocksLen = blocks.length;\n    const shapesLen = shapes.length;\n\n    if (blocksLen + shapesLen === 0) return;\n    const canvas = await this.toCanvas(blocks, shapes);\n    assertExists(canvas);\n    // @ts-ignore\n    if (window.apis?.clipboard?.copyAsImageFromString) {\n      // @ts-ignore\n      await window.apis.clipboard?.copyAsImageFromString(\n        canvas.toDataURL(IMAGE_PNG)\n      );\n    } else {\n      const blob: Blob = await new Promise((resolve, reject) =>\n        canvas.toBlob(\n          blob => (blob ? resolve(blob) : reject('Canvas can not export blob')),\n          IMAGE_PNG\n        )\n      );\n      assertExists(blob);\n\n      this.std.clipboard\n        .writeToClipboard(_items => {\n          return {\n            ..._items,\n            [IMAGE_PNG]: blob,\n          };\n        })\n        .catch(console.error);\n    }\n  }\n}\n\nexport async function prepareClipboardData(\n  selectedAll: BlockSuite.EdgelessModelType[],\n  std: BlockStdScope\n) {\n  const job = new Job({\n    collection: std.collection,\n  });\n  const selected = await Promise.all(\n    selectedAll.map(async selected => {\n      const data = await serializeElement(selected, selectedAll, job);\n      if (isAttachmentBlock(selected) || isImageBlock(selected)) {\n        await job.assetsManager.readFromBlob(data.props.sourceId as string);\n      }\n      return data;\n    })\n  );\n  const blobs = await encodeClipboardBlobs(job.assetsManager.getAssets());\n  return {\n    snapshot: selected.filter(d => !!d),\n    blobs,\n  };\n}\n\nfunction isPureFileInClipboard(clipboardData: DataTransfer) {\n  const types = clipboardData.types;\n  return (\n    (types.length === 1 && types[0] === 'Files') ||\n    (types.length === 2 &&\n      (types.includes('text/plain') || types.includes('text/html')) &&\n      types.includes('Files'))\n  );\n}\n\nfunction tryGetSvgFromClipboard(clipboardData: DataTransfer) {\n  const types = clipboardData.types;\n\n  if (types.length === 1 && types[0] !== 'text/plain') {\n    return null;\n  }\n\n  const parser = new DOMParser();\n  const svgDoc = parser.parseFromString(\n    clipboardData.getData('text/plain'),\n    'image/svg+xml'\n  );\n  const svg = svgDoc.documentElement;\n\n  if (svg.tagName !== 'svg' || !svg.hasAttribute('xmlns')) {\n    return null;\n  }\n  const svgContent = DOMPurify.sanitize(svgDoc.documentElement, {\n    USE_PROFILES: { svg: true },\n  });\n  const blob = new Blob([svgContent], { type: 'image/svg+xml' });\n  const file = new File([blob], 'pasted-image.svg', { type: 'image/svg+xml' });\n  return file;\n}\n"]}