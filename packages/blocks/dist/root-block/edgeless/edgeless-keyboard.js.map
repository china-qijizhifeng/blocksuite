{"version":3,"file":"edgeless-keyboard.js","sourceRoot":"","sources":["../../../src/root-block/edgeless/edgeless-keyboard.ts"],"names":[],"mappings":"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","sourcesContent":["import { IS_MAC } from '@blocksuite/global/env';\n\nimport {\n  getNearestTranslation,\n  isElementOutsideViewport,\n  isSelectSingleMindMap,\n} from '../../_common/edgeless/mindmap/index.js';\nimport { LassoMode } from '../../_common/types.js';\nimport { matchFlavours } from '../../_common/utils/model.js';\nimport { EdgelessTextBlockComponent } from '../../edgeless-text/edgeless-text-block.js';\nimport { EdgelessTextBlockModel } from '../../edgeless-text/edgeless-text-model.js';\nimport { MindmapElementModel } from '../../surface-block/element-model/mindmap.js';\nimport { LayoutType } from '../../surface-block/element-model/utils/mindmap/layout.js';\nimport type { ShapeElementModel } from '../../surface-block/index.js';\nimport {\n  Bound,\n  ConnectorElementModel,\n  ConnectorMode,\n  GroupElementModel,\n  ShapeType,\n} from '../../surface-block/index.js';\nimport { PageKeyboardManager } from '../keyboard/keyboard-manager.js';\nimport { CopilotSelectionController } from './controllers/tools/copilot-tool.js';\nimport { LassoToolController } from './controllers/tools/lasso-tool.js';\nimport { ShapeToolController } from './controllers/tools/shape-tool.js';\nimport { EdgelessBlockModel } from './edgeless-block-model.js';\nimport type { EdgelessRootBlockComponent } from './edgeless-root-block.js';\nimport type { EdgelessTool } from './types.js';\nimport {\n  DEFAULT_NOTE_CHILD_FLAVOUR,\n  DEFAULT_NOTE_CHILD_TYPE,\n  DEFAULT_NOTE_TIP,\n} from './utils/consts.js';\nimport { deleteElements } from './utils/crud.js';\nimport { getNextShapeType, updateShapeProps } from './utils/hotkey-utils.js';\nimport { isCanvasElement, isNoteBlock } from './utils/query.js';\nimport {\n  mountConnectorLabelEditor,\n  mountShapeTextEditor,\n} from './utils/text.js';\n\nexport class EdgelessPageKeyboardManager extends PageKeyboardManager {\n  constructor(override rootElement: EdgelessRootBlockComponent) {\n    super(rootElement);\n    this.rootElement.bindHotKey(\n      {\n        v: () => {\n          this._setEdgelessTool(rootElement, {\n            type: 'default',\n          });\n        },\n        t: () => {\n          this._setEdgelessTool(rootElement, {\n            type: 'text',\n          });\n        },\n        c: () => {\n          const mode = ConnectorMode.Curve;\n          rootElement.service.editPropsStore.record('connector', { mode });\n          this._setEdgelessTool(rootElement, { type: 'connector', mode });\n        },\n        l: () => {\n          if (!rootElement.doc.awarenessStore.getFlag('enable_lasso_tool')) {\n            return;\n          }\n          // select the current lasso mode\n          const edgeless = rootElement;\n          const lassoController = edgeless.tools.controllers['lasso'];\n          const tool: EdgelessTool = {\n            type: 'lasso',\n            mode: LassoMode.Polygonal,\n          };\n\n          if (lassoController instanceof LassoToolController)\n            tool.mode = lassoController.tool.mode;\n\n          this._setEdgelessTool(edgeless, tool);\n        },\n        'Shift-l': () => {\n          if (!rootElement.doc.awarenessStore.getFlag('enable_lasso_tool')) {\n            return;\n          }\n          // toggle between lasso modes\n          const edgeless = rootElement;\n          const cur = edgeless.edgelessTool;\n          const tool: EdgelessTool = {\n            type: 'lasso',\n            mode:\n              cur.type === 'lasso'\n                ? cur.mode === LassoMode.FreeHand\n                  ? LassoMode.Polygonal\n                  : LassoMode.FreeHand\n                : LassoMode.FreeHand,\n          };\n          this._setEdgelessTool(edgeless, tool);\n        },\n        h: () => {\n          this._setEdgelessTool(rootElement, {\n            type: 'pan',\n            panning: false,\n          });\n        },\n        n: () => {\n          this._setEdgelessTool(rootElement, {\n            type: 'affine:note',\n            childFlavour: DEFAULT_NOTE_CHILD_FLAVOUR,\n            childType: DEFAULT_NOTE_CHILD_TYPE,\n            tip: DEFAULT_NOTE_TIP,\n          });\n        },\n        p: () => {\n          this._setEdgelessTool(rootElement, {\n            type: 'brush',\n          });\n        },\n        e: () => {\n          this._setEdgelessTool(rootElement, {\n            type: 'eraser',\n          });\n        },\n        k: () => {\n          if (this.rootElement.service.locked) return;\n          const { selection } = rootElement.service;\n\n          if (\n            selection.selectedElements.length === 1 &&\n            selection.firstElement instanceof EdgelessBlockModel &&\n            matchFlavours(selection.firstElement as EdgelessBlockModel, [\n              'affine:note',\n            ])\n          ) {\n            rootElement.slots.toggleNoteSlicer.emit();\n          }\n        },\n        f: () => {\n          if (this.rootElement.service.locked) return;\n          if (\n            this.rootElement.service.selection.selectedElements.length !== 0 &&\n            !this.rootElement.service.selection.editing\n          ) {\n            const frame = rootElement.service.frame.createFrameOnSelected();\n            if (!frame) return;\n            rootElement.service.telemetryService?.track('CanvasElementAdded', {\n              control: 'shortcut',\n              page: 'whiteboard editor',\n              module: 'toolbar',\n              segment: 'toolbar',\n              type: 'frame',\n            });\n            rootElement.surface.fitToViewport(Bound.deserialize(frame.xywh));\n          } else if (!this.rootElement.service.selection.editing) {\n            this._setEdgelessTool(rootElement, { type: 'frame' });\n          }\n        },\n        '-': () => {\n          if (this.rootElement.service.locked) return;\n          const { selectedElements: elements } = rootElement.service.selection;\n          if (\n            !rootElement.service.selection.editing &&\n            elements.length === 1 &&\n            isNoteBlock(elements[0])\n          ) {\n            rootElement.slots.toggleNoteSlicer.emit();\n          }\n        },\n        '@': () => {\n          const std = this.rootElement.std;\n          if (\n            std.selection.getGroup('note').length > 0 ||\n            // eslint-disable-next-line unicorn/prefer-array-some\n            std.selection.find('text') ||\n            // eslint-disable-next-line unicorn/prefer-array-some\n            Boolean(std.selection.find('surface')?.editing)\n          ) {\n            return;\n          }\n          const { insertedLinkType } = std.command.exec(\n            'insertLinkByQuickSearch'\n          );\n\n          insertedLinkType\n            ?.then(type => {\n              if (type) {\n                rootElement.service.telemetryService?.track(\n                  'CanvasElementAdded',\n                  {\n                    control: 'shortcut',\n                    page: 'whiteboard editor',\n                    module: 'toolbar',\n                    segment: 'toolbar',\n                    type: type.flavour.split(':')[1],\n                  }\n                );\n                if (type.isNewDoc) {\n                  rootElement.service.telemetryService?.track('DocCreated', {\n                    control: 'shortcut',\n                    page: 'whiteboard editor',\n                    segment: 'whiteboard',\n                    type: type.flavour.split(':')[1],\n                  });\n                }\n              }\n            })\n            .catch(console.error);\n        },\n        'Shift-s': () => {\n          if (this.rootElement.service.locked) return;\n          if (\n            this.rootElement.service.selection.editing ||\n            !(\n              rootElement.tools.currentController instanceof ShapeToolController\n            )\n          ) {\n            return;\n          }\n\n          const attr = rootElement.service.editPropsStore.getLastProps('shape');\n\n          const nextShapeType = getNextShapeType(\n            attr.radius > 0 && attr.shapeType === ShapeType.Rect\n              ? 'roundedRect'\n              : attr.shapeType\n          );\n          this._setEdgelessTool(rootElement, {\n            type: 'shape',\n            shapeType:\n              nextShapeType === 'roundedRect' ? ShapeType.Rect : nextShapeType,\n          });\n\n          updateShapeProps(nextShapeType, rootElement);\n\n          const controller = rootElement.tools\n            .currentController as ShapeToolController;\n          controller.createOverlay();\n        },\n        'Mod-g': ctx => {\n          if (this.rootElement.service.locked) return;\n          if (\n            this.rootElement.service.selection.selectedElements.length > 1 &&\n            !this.rootElement.service.selection.editing\n          ) {\n            ctx.get('keyboardState').event.preventDefault();\n            rootElement.service.createGroupFromSelected();\n          }\n        },\n        'Shift-Mod-g': ctx => {\n          if (this.rootElement.service.locked) return;\n          const { selection } = this.rootElement.service;\n          if (\n            selection.selectedElements.length === 1 &&\n            selection.firstElement instanceof GroupElementModel\n          ) {\n            ctx.get('keyboardState').event.preventDefault();\n            rootElement.service.ungroup(selection.firstElement);\n          }\n        },\n        'Mod-a': ctx => {\n          if (this.rootElement.service.locked) return;\n          if (this.rootElement.service.selection.editing) {\n            return;\n          }\n\n          ctx.get('defaultState').event.preventDefault();\n          const { service } = this.rootElement;\n          this.rootElement.service.selection.set({\n            elements: [\n              ...service.blocks\n                .filter(block => block.group === null)\n                .map(block => block.id),\n              ...service.elements\n                .filter(el => el.group === null)\n                .map(el => el.id),\n            ],\n            editing: false,\n          });\n        },\n        'Mod-1': ctx => {\n          ctx.get('defaultState').event.preventDefault();\n          this.rootElement.service.setZoomByAction('fit');\n        },\n        'Mod--': ctx => {\n          ctx.get('defaultState').event.preventDefault();\n          this.rootElement.service.setZoomByAction('out');\n        },\n        'Mod-0': ctx => {\n          ctx.get('defaultState').event.preventDefault();\n          this.rootElement.service.setZoomByAction('reset');\n        },\n        'Mod-=': ctx => {\n          ctx.get('defaultState').event.preventDefault();\n          this.rootElement.service.setZoomByAction('in');\n        },\n        Backspace: () => {\n          this._delete();\n        },\n        Delete: () => {\n          this._delete();\n        },\n        'Control-d': () => {\n          if (!IS_MAC) return;\n          this._delete();\n        },\n        Escape: () => {\n          const { currentController } = this.rootElement.tools;\n          if (\n            currentController instanceof LassoToolController &&\n            currentController.isSelecting\n          ) {\n            currentController.abort();\n          }\n          if (currentController instanceof CopilotSelectionController) {\n            currentController.abort();\n          }\n\n          if (!this.rootElement.service.selection.empty) {\n            rootElement.selection.clear();\n          }\n        },\n\n        ArrowUp: () => {\n          this._move('ArrowUp');\n        },\n\n        ArrowDown: () => {\n          this._move('ArrowDown');\n        },\n\n        ArrowLeft: () => {\n          this._move('ArrowLeft');\n        },\n\n        ArrowRight: () => {\n          this._move('ArrowRight');\n        },\n\n        'Shift-ArrowUp': () => {\n          this._move('ArrowUp', true);\n        },\n\n        'Shift-ArrowDown': () => {\n          this._move('ArrowDown', true);\n        },\n\n        'Shift-ArrowLeft': () => {\n          this._move('ArrowLeft', true);\n        },\n\n        'Shift-ArrowRight': () => {\n          this._move('ArrowRight', true);\n        },\n\n        Enter: () => {\n          const { service } = rootElement;\n          const selection = service.selection;\n          const elements = selection.selectedElements;\n          const onlyOne = elements.length === 1;\n\n          if (onlyOne) {\n            const element = elements[0];\n            const id = element.id;\n\n            if (element instanceof ConnectorElementModel) {\n              selection.set({\n                elements: [id],\n                editing: true,\n              });\n              requestAnimationFrame(() => {\n                mountConnectorLabelEditor(element, rootElement);\n              });\n              return;\n            }\n\n            if (element instanceof EdgelessTextBlockModel) {\n              selection.set({\n                elements: [id],\n                editing: true,\n              });\n              const textBlock = rootElement.host.view.getBlock(id);\n              if (textBlock instanceof EdgelessTextBlockComponent) {\n                textBlock.tryFocusEnd();\n              }\n\n              return;\n            }\n          }\n\n          if (!isSelectSingleMindMap(elements)) {\n            return;\n          }\n\n          const mindmap = elements[0].group as MindmapElementModel;\n          const node = mindmap.getNode(elements[0].id)!;\n          const parent = mindmap.getParentNode(node.id) ?? node;\n          const id = mindmap.addNode(parent.id);\n          const target = service.getElementById(id) as ShapeElementModel;\n\n          requestAnimationFrame(() => {\n            mountShapeTextEditor(target, rootElement);\n\n            if (isElementOutsideViewport(service.viewport, target, [20, 20])) {\n              const { elementBound } = target;\n\n              service.viewport.smoothTranslate(\n                elementBound.x + elementBound.w / 2,\n                elementBound.y + elementBound.h / 2\n              );\n            }\n          });\n        },\n        Tab: () => {\n          const { service } = rootElement;\n          const selection = service.selection;\n          const elements = selection.selectedElements;\n\n          if (!isSelectSingleMindMap(elements)) {\n            return;\n          }\n\n          const mindmap = elements[0].group as MindmapElementModel;\n          const node = mindmap.getNode(elements[0].id)!;\n          const id = mindmap.addNode(node.id);\n          const target = service.getElementById(id) as ShapeElementModel;\n\n          requestAnimationFrame(() => {\n            mountShapeTextEditor(target, rootElement);\n\n            if (isElementOutsideViewport(service.viewport, target, [20, 20])) {\n              const { elementBound } = target;\n\n              service.viewport.smoothTranslate(\n                elementBound.x + elementBound.w / 2,\n                elementBound.y + elementBound.h / 2\n              );\n            }\n          });\n        },\n      },\n      {\n        global: true,\n      }\n    );\n\n    this._bindShiftKey();\n    this._bindToggleHand();\n  }\n\n  private _bindShiftKey() {\n    this.rootElement.handleEvent(\n      'keyDown',\n      ctx => {\n        const event = ctx.get('defaultState').event;\n        if (event instanceof KeyboardEvent) {\n          this._shift(event);\n        }\n      },\n      { global: true }\n    );\n    this.rootElement.handleEvent(\n      'keyUp',\n      ctx => {\n        const event = ctx.get('defaultState').event;\n        if (event instanceof KeyboardEvent) {\n          this._shift(event);\n        }\n      },\n      {\n        global: true,\n      }\n    );\n  }\n\n  private _bindToggleHand() {\n    this.rootElement.handleEvent(\n      'keyDown',\n      ctx => {\n        const event = ctx.get('keyboardState').raw;\n        if (event.code === 'Space' && !event.repeat) {\n          this._space(event);\n        }\n      },\n      { global: true }\n    );\n    this.rootElement.handleEvent(\n      'keyUp',\n      ctx => {\n        const event = ctx.get('keyboardState').raw;\n        if (event.code === 'Space' && !event.repeat) {\n          this._space(event);\n        }\n      },\n      { global: true }\n    );\n  }\n\n  private _space(event: KeyboardEvent) {\n    /*\n    Call this function with a check for !event.repeat to consider only the first keydown (not repeat). This way, you can use onPressSpaceBar in a tool to determine if the space bar is pressed or not.\n  */\n\n    const edgeless = this.rootElement;\n    const selection = edgeless.service.selection;\n    const currentTool = edgeless.edgelessTool;\n    const type = currentTool.type;\n\n    const isKeyDown = event.type === 'keydown';\n\n    if (isKeyDown) {\n      edgeless.tools.spaceBar = true;\n    } else {\n      edgeless.tools.spaceBar = false;\n    }\n\n    if (edgeless.service.tool.dragging) {\n      return; // Don't do anything if currently dragging\n    }\n\n    const revertToPrevTool = (ev: KeyboardEvent) => {\n      if (ev.code === 'Space') {\n        this._setEdgelessTool(edgeless, currentTool);\n        document.removeEventListener('keyup', revertToPrevTool, false);\n      }\n    };\n\n    if (isKeyDown) {\n      if (type === 'pan' || (type === 'default' && selection.editing)) {\n        return;\n      }\n      this._setEdgelessTool(edgeless, { type: 'pan', panning: false });\n\n      edgeless.dispatcher.disposables.addFromEvent(\n        document,\n        'keyup',\n        revertToPrevTool\n      );\n    }\n  }\n\n  private _shift(event: KeyboardEvent) {\n    const edgeless = this.rootElement;\n\n    if (event.repeat) return;\n\n    const shiftKeyPressed =\n      event.key.toLowerCase() === 'shift' && event.shiftKey;\n\n    if (shiftKeyPressed) {\n      edgeless.slots.pressShiftKeyUpdated.emit(true);\n    } else {\n      edgeless.slots.pressShiftKeyUpdated.emit(false);\n    }\n  }\n\n  private _delete() {\n    const edgeless = this.rootElement;\n\n    if (edgeless.service.locked) return;\n    if (edgeless.service.selection.editing) {\n      return;\n    }\n\n    deleteElements(\n      edgeless.surface,\n      edgeless.service.selection.selectedElements\n    );\n\n    edgeless.service.selection.clear();\n    edgeless.service.selection.set(\n      edgeless.service.selection.surfaceSelections\n    );\n  }\n\n  private _setEdgelessTool(\n    edgeless: EdgelessRootBlockComponent,\n    edgelessTool: EdgelessTool,\n    ignoreActiveState = false\n  ) {\n    // when editing, should not update mouse mode by shortcut\n    if (!ignoreActiveState && edgeless.service.selection.editing) {\n      return;\n    }\n    edgeless.tools.setEdgelessTool(edgelessTool);\n  }\n\n  private _move(key: string, shift = false) {\n    const edgeless = this.rootElement;\n\n    if (edgeless.service.locked) return;\n    if (edgeless.service.selection.editing) return;\n\n    const { selectedElements } = edgeless.service.selection;\n    const inc = shift ? 10 : 1;\n    const mindmapNodes = selectedElements.filter(\n      el => el.group instanceof MindmapElementModel\n    );\n\n    if (mindmapNodes.length > 0) {\n      const node = mindmapNodes[0];\n      const mindmap = node.group as MindmapElementModel;\n      const nodeDirection = mindmap.getLayoutDir(node.id);\n      let targetNode: BlockSuite.SurfaceElementModelType | null = null;\n\n      switch (key) {\n        case 'ArrowUp':\n        case 'ArrowDown':\n          targetNode =\n            mindmap.getSiblingNode(\n              node.id,\n              key === 'ArrowDown' ? 'next' : 'prev',\n              nodeDirection === LayoutType.RIGHT\n                ? 'right'\n                : nodeDirection === LayoutType.LEFT\n                  ? 'left'\n                  : undefined\n            )?.element ?? null;\n          break;\n        case 'ArrowLeft':\n          targetNode =\n            nodeDirection === LayoutType.RIGHT\n              ? mindmap.getParentNode(node.id)?.element ?? null\n              : mindmap.getChildNodes(node.id, 'left')[0]?.element ?? null;\n\n          break;\n        case 'ArrowRight':\n          targetNode =\n            nodeDirection === LayoutType.RIGHT ||\n            nodeDirection === LayoutType.BALANCE\n              ? mindmap.getChildNodes(node.id, 'right')[0]?.element ?? null\n              : mindmap.getParentNode(node.id)?.element ?? null;\n          break;\n      }\n\n      if (targetNode) {\n        edgeless.service.selection.set({\n          elements: [targetNode.id],\n          editing: false,\n        });\n\n        if (\n          isElementOutsideViewport(\n            edgeless.service.viewport,\n            targetNode,\n            [90, 20]\n          )\n        ) {\n          const [dx, dy] = getNearestTranslation(\n            edgeless.service.viewport,\n            targetNode,\n            [100, 20]\n          );\n\n          edgeless.service.viewport.smoothTranslate(\n            edgeless.service.viewport.centerX - dx,\n            edgeless.service.viewport.centerY + dy\n          );\n        }\n      }\n\n      return;\n    }\n\n    selectedElements.forEach(element => {\n      const bound = Bound.deserialize(element.xywh).clone();\n\n      switch (key) {\n        case 'ArrowUp':\n          bound.y -= inc;\n          break;\n        case 'ArrowLeft':\n          bound.x -= inc;\n          break;\n        case 'ArrowRight':\n          bound.x += inc;\n          break;\n        case 'ArrowDown':\n          bound.y += inc;\n          break;\n      }\n\n      if (isCanvasElement(element)) {\n        if (element instanceof ConnectorElementModel) {\n          element.moveTo(bound);\n        }\n        element['xywh'] = bound.serialize();\n      } else {\n        element['xywh'] = bound.serialize();\n      }\n    });\n  }\n}\n"]}