{"version":3,"file":"observe-last-props.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/common/observe-last-props.ts"],"names":[],"mappings":"AAGA,MAAM,CAAC,MAAM,gBAAgB,GAAG,CAC9B,eAAoC,EACpC,QAAW,EACX,MAAiC,EACjC,UAAmC,EACnC,QAGS,EACT,EAAE;IACF,MAAM,WAAW,GAAG,EAAE,GAAG,UAAU,EAAE,CAAC;IACtC,OAAO,eAAe,CAAC,cAAc,CAAC,KAAK,CAAC,gBAAgB,CAAC,EAAE,CAC7D,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,EAAE;QAClB,IAAI,IAAI,KAAK,QAAQ;YAAE,OAAO;QAC9B,MAAM,OAAO,GAAG,MAAM;aACnB,MAAM,CAAC,IAAI,CAAC,EAAE;YACb,MAAM,GAAG,GAAG,IAAc,CAAC;YAC3B,OAAO,KAAK,CAAC,GAAG,CAAC,KAAK,WAAW,CAAC,GAAG,CAAC,IAAI,KAAK,CAAC,GAAG,CAAC,IAAI,SAAS,CAAC;QACpE,CAAC,CAAC;aACD,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC,EAAE,GAAG,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,KAAK,CAAC,GAAa,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;QAEvE,MAAM,CAAC,MAAM,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;QACpC,QAAQ,EAAE,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;IAC7B,CAAC,CACF,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,cAAc,GAAG,CAC5B,OAA4B,EAC5B,QAAW,EACX,MAAiC,EACjC,UAAmC,EACnC,EAAE;IACF,MAAM,KAAK,GAAG,OAAO,CAAC,cAAc,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;IAC5D,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAC1B,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC,EAAE,GAAG,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,EAC7C,UAAU,CACX,CAAC;IACF,MAAM,CAAC,MAAM,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;IAClC,OAAO,MAAM,CAAC;AAChB,CAAC,CAAC","sourcesContent":["import type { LastProps } from '../../../../../surface-block/managers/edit-session.js';\nimport type { EdgelessRootService } from '../../../edgeless-root-service.js';\n\nexport const observeLastProps = <T extends keyof LastProps>(\n  edgelessService: EdgelessRootService,\n  toolType: T,\n  fields: Array<keyof LastProps[T]>,\n  initStates: Record<string, unknown>,\n  onChange?: (\n    updates: Partial<LastProps[T]>,\n    originalProps: Record<string, unknown>\n  ) => void\n) => {\n  const _prevStates = { ...initStates };\n  return edgelessService.editPropsStore.slots.lastPropsUpdated.on(\n    ({ type, props }) => {\n      if (type !== toolType) return;\n      const updates = fields\n        .filter(_key => {\n          const key = _key as string;\n          return props[key] !== _prevStates[key] && props[key] != undefined;\n        })\n        .reduce((acc, key) => ({ ...acc, [key]: props[key as string] }), {});\n\n      Object.assign(_prevStates, updates);\n      onChange?.(updates, props);\n    }\n  );\n};\n\nexport const applyLastProps = <T extends keyof LastProps>(\n  service: EdgelessRootService,\n  toolType: T,\n  fields: Array<keyof LastProps[T]>,\n  initStates: Record<string, unknown>\n) => {\n  const attrs = service.editPropsStore.getLastProps(toolType);\n  const object = fields.reduce(\n    (acc, key) => ({ ...acc, [key]: attrs[key] }),\n    initStates\n  );\n  Object.assign(initStates, object);\n  return object;\n};\n"]}