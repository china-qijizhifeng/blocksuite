{"version":3,"file":"mindmap-menu.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/mindmap/mindmap-menu.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, LitElement, nothing, type TemplateResult } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { MindmapStyle } from '../../../../../surface-block/index.js';\nimport { getTooltipWithShortcut } from '../../utils.js';\nimport { EdgelessDraggableElementController } from '../common/draggable/draggable-element.controller.js';\nimport { EdgelessToolbarToolMixin } from '../mixins/tool.mixin.js';\nimport { getMindMaps, type ToolbarMindmapItem } from './assets.js';\nimport { textRender } from './basket-elements.js';\nimport { textIcon } from './icons.js';\n\ntype TextItem = {\n  type: 'text';\n  icon: TemplateResult;\n  render: typeof textRender;\n};\nconst textItem: TextItem = { type: 'text', icon: textIcon, render: textRender };\n\n@customElement('edgeless-mindmap-menu')\nexport class EdgelessMindmapMenu extends EdgelessToolbarToolMixin(LitElement) {\n  get mindMaps() {\n    return getMindMaps(this.theme);\n  }\n\n  static override styles = css`\n    :host {\n      display: flex;\n      z-index: -1;\n      justify-content: flex-end;\n    }\n    .text-and-mindmap {\n      display: flex;\n      gap: 10px;\n      padding: 8px 0px;\n      box-sizing: border-box;\n    }\n    .thin-divider {\n      width: 1px;\n      transform: scaleX(0.5);\n      height: 48px;\n      background: var(--affine-border-color);\n    }\n    .text-item {\n      width: 60px;\n    }\n    .mindmap-item {\n      width: 64px;\n    }\n\n    .text-item,\n    .mindmap-item {\n      border-radius: 4px;\n      height: 48px;\n      position: relative;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    .text-item > button,\n    .mindmap-item > button {\n      position: absolute;\n      border-radius: inherit;\n      border: none;\n      background: none;\n      cursor: grab;\n      padding: 0;\n    }\n    .text-item:hover,\n    .mindmap-item:hover {\n      background: var(--affine-hover-color);\n    }\n    .text-item > button.next,\n    .mindmap-item > button.next {\n      transition: transform 0.3s ease-in-out;\n    }\n  `;\n\n  override type = 'mindmap' as const;\n\n  draggableController!: EdgelessDraggableElementController<\n    ToolbarMindmapItem | TextItem\n  >;\n\n  @property({ attribute: false })\n  accessor activeStyle!: MindmapStyle;\n\n  @property({ attribute: false })\n  accessor onActiveStyleChange!: (style: MindmapStyle) => void;\n\n  initDragController() {\n    if (this.draggableController || !this.edgeless) return;\n    this.draggableController = new EdgelessDraggableElementController(this, {\n      service: this.edgeless.service,\n      edgeless: this.edgeless,\n      scopeElement: this,\n      clickToDrag: true,\n      onOverlayCreated: () => {\n        // a workaround to active mindmap, so that menu cannot be closed by `Escape`\n        this.setEdgelessTool({ type: 'mindmap' });\n      },\n      onDrop: (element, bound) => {\n        const id = element.data.render(\n          bound,\n          this.edgeless.service,\n          this.edgeless\n        );\n        if (element.data.type === 'mindmap') {\n          this.onActiveStyleChange?.(element.data.style);\n          this.setEdgelessTool(\n            { type: 'default' },\n            { elements: [id], editing: false }\n          );\n        }\n      },\n    });\n  }\n\n  override updated(changedProperties: Map<PropertyKey, unknown>) {\n    if (!changedProperties.has('edgeless')) return;\n    this.initDragController();\n  }\n\n  override render() {\n    const { cancelled, draggingElement, dragOut } =\n      this.draggableController?.states || {};\n\n    const isDraggingText = draggingElement?.data?.type === 'text';\n    const showNextText = dragOut && !cancelled;\n    return html`<edgeless-slide-menu .height=${'64px'}>\n      <div class=\"text-and-mindmap\">\n        <div class=\"text-item\">\n          ${isDraggingText\n            ? html`<button\n                class=\"next\"\n                style=\"transform: translateY(${showNextText ? 0 : 64}px)\"\n              >\n                ${textItem.icon}\n              </button>`\n            : nothing}\n          <button\n            style=\"opacity: ${isDraggingText ? 0 : 1}\"\n            @mousedown=${(e: MouseEvent) =>\n              this.draggableController.onMouseDown(e, {\n                preview: textItem.icon,\n                data: textItem,\n              })}\n            @touchstart=${(e: TouchEvent) =>\n              this.draggableController.onTouchStart(e, {\n                preview: textItem.icon,\n                data: textItem,\n              })}\n          >\n            ${textItem.icon}\n          </button>\n          <affine-tooltip tip-position=\"top\" .offset=${12}>\n            ${getTooltipWithShortcut('Edgeless Text', 'T')}\n          </affine-tooltip>\n        </div>\n        <div class=\"thin-divider\"></div>\n        <!-- mind map -->\n        ${repeat(this.mindMaps, mindMap => {\n          const isDraggingMindMap = draggingElement?.data?.type !== 'text';\n          const draggingEle = draggingElement?.data as ToolbarMindmapItem;\n          const isBeingDragged =\n            isDraggingMindMap && draggingEle?.style === mindMap.style;\n          const showNext = dragOut && !cancelled;\n          return html`\n            <div class=\"mindmap-item\">\n              ${isBeingDragged\n                ? html`<button\n                    style=\"transform: translateY(${showNext ? 0 : 64}px)\"\n                    class=\"next\"\n                  >\n                    ${mindMap.icon}\n                  </button>`\n                : nothing}\n              <button\n                style=\"opacity: ${isBeingDragged ? 0 : 1}\"\n                @mousedown=${(e: MouseEvent) => {\n                  this.draggableController.onMouseDown(e, {\n                    preview: mindMap.icon,\n                    data: mindMap,\n                    standardWidth: 350,\n                  });\n                }}\n                @touchstart=${(e: TouchEvent) => {\n                  this.draggableController.onTouchStart(e, {\n                    preview: mindMap.icon,\n                    data: mindMap,\n                    standardWidth: 350,\n                  });\n                }}\n                @click=${() => this.onActiveStyleChange?.(mindMap.style)}\n              >\n                ${mindMap.icon}\n              </button>\n              <affine-tooltip tip-position=\"top\" .offset=${12}>\n                ${getTooltipWithShortcut('Mind Map', 'M')}\n              </affine-tooltip>\n            </div>\n          `;\n        })}\n      </div>\n    </edgeless-slide-menu>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-mindmap-menu': EdgelessMindmapMenu;\n  }\n}\n"]}