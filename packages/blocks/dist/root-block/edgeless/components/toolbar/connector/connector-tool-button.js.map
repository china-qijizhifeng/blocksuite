{"version":3,"file":"connector-tool-button.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/connector/connector-tool-button.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../buttons/toolbar-button.js';\nimport './connector-menu.js';\n\nimport { css, html, LitElement } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport {\n  ArrowUpIcon,\n  ConnectorIcon,\n} from '../../../../../_common/icons/index.js';\nimport { LineWidth } from '../../../../../_common/utils/index.js';\nimport { getConnectorModeName } from '../../../../../surface-block/element-model/connector.js';\nimport { ConnectorMode } from '../../../../../surface-block/index.js';\nimport type { LastProps } from '../../../../../surface-block/managers/edit-session.js';\nimport { DEFAULT_CONNECTOR_COLOR } from '../../panel/color-panel.js';\nimport { getTooltipWithShortcut } from '../../utils.js';\nimport {\n  applyLastProps,\n  observeLastProps,\n} from '../common/observe-last-props.js';\nimport { QuickToolMixin } from '../mixins/quick-tool.mixin.js';\n\n@customElement('edgeless-connector-tool-button')\nexport class EdgelessConnectorToolButton extends QuickToolMixin(LitElement) {\n  static override styles = css`\n    :host {\n      display: flex;\n    }\n    .edgeless-connector-button {\n      display: flex;\n      position: relative;\n    }\n    .arrow-up-icon {\n      position: absolute;\n      top: 4px;\n      right: 2px;\n      font-size: 0;\n    }\n  `;\n\n  override type = 'connector' as const;\n\n  @state()\n  accessor states: Partial<LastProps['connector']> = {\n    mode: ConnectorMode.Curve,\n    stroke: DEFAULT_CONNECTOR_COLOR,\n    strokeWidth: LineWidth.Two,\n  };\n\n  get stateKeys() {\n    return Object.keys(this.states) as Array<keyof typeof this.states>;\n  }\n\n  private _toggleMenu() {\n    if (this.tryDisposePopper()) return;\n    const menu = this.createPopper('edgeless-connector-menu', this);\n    menu.element.edgeless = this.edgeless;\n    menu.element.onChange = (props: Record<string, unknown>) => {\n      this.edgeless.service.editPropsStore.record(this.type, props);\n      this.updateMenu();\n      this.setEdgelessTool({\n        type: this.type,\n        mode: this.states.mode!,\n      });\n    };\n    this.updateMenu();\n  }\n\n  updateMenu() {\n    if (!this.popper) return;\n    Object.assign(this.popper.element, this.states);\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    const { edgeless, states, stateKeys, type } = this;\n\n    applyLastProps(edgeless.service, type, stateKeys, states);\n\n    this.disposables.add(\n      observeLastProps(\n        edgeless.service,\n        type,\n        stateKeys,\n        states,\n        updates => (this.states = { ...this.states, ...updates })\n      )\n    );\n  }\n\n  override render() {\n    const { active } = this;\n    const arrowColor = active ? 'currentColor' : 'var(--affine-icon-secondary)';\n    return html`\n      <edgeless-tool-icon-button\n        .tooltip=${this.popper\n          ? ''\n          : getTooltipWithShortcut(\n              getConnectorModeName(this.states.mode!),\n              'C'\n            )}\n        .tooltipOffset=${17}\n        .active=${active}\n        .iconContainerPadding=${6}\n        class=\"edgeless-connector-button\"\n        @click=${() => {\n          // don't update tool before toggling menu\n          this._toggleMenu();\n          this.edgeless.tools.setEdgelessTool({\n            type: 'connector',\n            mode: this.states.mode!,\n          });\n        }}\n      >\n        ${ConnectorIcon}\n        <span class=\"arrow-up-icon\" style=${styleMap({ color: arrowColor })}>\n          ${ArrowUpIcon}\n        </span>\n      </edgeless-tool-icon-button>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-connector-tool-button': EdgelessConnectorToolButton;\n  }\n}\n"]}