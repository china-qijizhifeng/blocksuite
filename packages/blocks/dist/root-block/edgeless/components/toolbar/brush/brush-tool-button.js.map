{"version":3,"file":"brush-tool-button.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/brush/brush-tool-button.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../buttons/toolbar-button.js';\nimport './brush-menu.js';\n\nimport { css, html, LitElement } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport {\n  EdgelessPenDarkIcon,\n  EdgelessPenLightIcon,\n} from '../../../../../_common/icons/edgeless.js';\nimport { LineWidth } from '../../../../../_common/utils/index.js';\nimport type { LastProps } from '../../../../../surface-block/managers/edit-session.js';\nimport { DEFAULT_BRUSH_COLOR } from '../../panel/color-panel.js';\nimport { getTooltipWithShortcut } from '../../utils.js';\nimport {\n  applyLastProps,\n  observeLastProps,\n} from '../common/observe-last-props.js';\nimport { EdgelessToolbarToolMixin } from '../mixins/tool.mixin.js';\n\n@customElement('edgeless-brush-tool-button')\nexport class EdgelessBrushToolButton extends EdgelessToolbarToolMixin(\n  LitElement\n) {\n  static override styles = css`\n    :host {\n      display: flex;\n      height: 100%;\n      overflow-y: hidden;\n    }\n    .edgeless-brush-button {\n      height: 100%;\n    }\n    .pen-wrapper {\n      width: 35px;\n      height: 64px;\n      display: flex;\n      align-items: flex-end;\n      justify-content: center;\n    }\n    #edgeless-pen-icon {\n      transition: transform 0.3s ease-in-out;\n      transform: translateY(8px);\n    }\n    .edgeless-brush-button:hover #edgeless-pen-icon,\n    .pen-wrapper.active #edgeless-pen-icon {\n      transform: translateY(0);\n    }\n  `;\n\n  override type = 'brush' as const;\n\n  override enableActiveBackground = true;\n\n  @state()\n  accessor states: LastProps['brush'] = {\n    color: DEFAULT_BRUSH_COLOR,\n    lineWidth: LineWidth.Four,\n  };\n\n  get statesKeys() {\n    return Object.keys(this.states) as (keyof LastProps['brush'])[];\n  }\n\n  private _toggleBrushMenu() {\n    if (this.tryDisposePopper()) return;\n    !this.active && this.setEdgelessTool({ type: this.type });\n    const menu = this.createPopper('edgeless-brush-menu', this);\n    Object.assign(menu.element, {\n      edgeless: this.edgeless,\n      onChange: (props: Record<string, unknown>) => {\n        this.edgeless.service.editPropsStore.record('brush', props);\n        this.setEdgelessTool({ type: 'brush' });\n      },\n    });\n    this.updateMenu();\n  }\n\n  updateMenu() {\n    const { popper } = this;\n    if (!popper) return;\n    Object.assign(popper.element, this.states);\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    const { edgeless, states, statesKeys } = this;\n    applyLastProps(edgeless.service, 'brush', statesKeys, states);\n\n    this.disposables.add(\n      observeLastProps(\n        edgeless.service,\n        'brush',\n        statesKeys,\n        states,\n        updates => {\n          this.states = { ...this.states, ...updates };\n        }\n      )\n    );\n  }\n\n  override updated(changedProperties: Map<string, unknown>) {\n    if (changedProperties.has('states') && this.popper) {\n      this.updateMenu();\n    }\n  }\n\n  override render() {\n    const { active, theme } = this;\n    const icon = theme === 'dark' ? EdgelessPenDarkIcon : EdgelessPenLightIcon;\n\n    return html`\n      <edgeless-toolbar-button\n        class=\"edgeless-brush-button\"\n        .tooltip=${this.popper ? '' : getTooltipWithShortcut('Pen', 'P')}\n        .tooltipOffset=${4}\n        .active=${active}\n        .withHover=${true}\n        @click=${() => {\n          this._toggleBrushMenu();\n        }}\n      >\n        <div\n          style=${styleMap({ color: `var(${this.states.color})` })}\n          class=\"pen-wrapper\"\n        >\n          ${icon}\n        </div>\n      </edgeless-toolbar-button>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-brush-tool-button': EdgelessBrushToolButton;\n  }\n}\n"]}