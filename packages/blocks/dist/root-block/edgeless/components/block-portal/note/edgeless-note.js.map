{"version":3,"file":"edgeless-note.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/block-portal/note/edgeless-note.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../note-slicer/index.js';\n\nimport type { BlockElement } from '@blocksuite/block-std';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport type { BlockModel } from '@blocksuite/store';\nimport { css, html, nothing } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { EDGELESS_BLOCK_CHILD_PADDING } from '../../../../../_common/consts.js';\nimport { DEFAULT_NOTE_BACKGROUND_COLOR } from '../../../../../_common/edgeless/note/consts.js';\nimport { MoreIndicatorIcon } from '../../../../../_common/icons/edgeless.js';\nimport { NoteDisplayMode } from '../../../../../_common/types.js';\nimport { almostEqual, clamp } from '../../../../../_common/utils/math.js';\nimport { matchFlavours } from '../../../../../_common/utils/model.js';\nimport { getClosestBlockElementByPoint } from '../../../../../_common/utils/query.js';\nimport { Point } from '../../../../../_common/utils/rect.js';\nimport { handleNativeRangeAtPoint } from '../../../../../_common/utils/selection.js';\nimport type { NoteBlockModel } from '../../../../../note-block/note-model.js';\nimport { Bound, StrokeStyle } from '../../../../../surface-block/index.js';\nimport type { SurfaceBlockComponent } from '../../../../../surface-block/surface-block.js';\nimport type { EdgelessBlockModel } from '../../../edgeless-block-model.js';\nimport { EdgelessPortalBase } from '../edgeless-portal-base.js';\n\nconst ACTIVE_NOTE_EXTRA_PADDING = 20;\n\n@customElement('edgeless-note-mask')\nexport class EdgelessNoteMask extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    .affine-note-mask:hover {\n      background-color: var(--affine-hover-color);\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor surface!: SurfaceBlockComponent;\n\n  @property({ attribute: false })\n  accessor model!: NoteBlockModel;\n\n  @property({ attribute: false })\n  accessor display!: boolean;\n\n  get edgeless() {\n    return this.surface.edgeless;\n  }\n\n  protected override firstUpdated() {\n    const maskDOM = this.renderRoot!.querySelector('.affine-note-mask');\n    const observer = new ResizeObserver(entries => {\n      for (const entry of entries) {\n        if (!this.model.edgeless.collapse) {\n          const bound = Bound.deserialize(this.model.xywh);\n          const scale = this.model.edgeless.scale ?? 1;\n          const height = entry.contentRect.height * scale;\n\n          if (!height || almostEqual(bound.h, height)) {\n            return;\n          }\n\n          bound.h = height;\n          this.model.stash('xywh');\n          this.model.xywh = bound.serialize();\n        }\n      }\n    });\n\n    observer.observe(maskDOM!);\n\n    this._disposables.add(() => {\n      // check if model still exist\n      if (this.model.doc.getBlockById(this.model.id)) {\n        this.model.pop('xywh');\n      }\n      observer.disconnect();\n    });\n  }\n\n  override render() {\n    return html`\n      <div\n        class=\"affine-note-mask\"\n        style=${styleMap({\n          position: 'absolute',\n          top: '0',\n          left: '0',\n          bottom: '0',\n          right: '0',\n          zIndex: '1',\n          pointerEvents: this.display ? 'auto' : 'none',\n          borderRadius: `${\n            this.model.edgeless.style.borderRadius *\n            this.edgeless.service.viewport.zoom\n          }px`,\n        })}\n      ></div>\n    `;\n  }\n}\n\n@customElement('edgeless-block-portal-note')\nexport class EdgelessBlockPortalNote extends EdgelessPortalBase<NoteBlockModel> {\n  static override styles = css`\n    .edgeless-note-collapse-button {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 28px;\n      height: 28px;\n      z-index: 2;\n      position: absolute;\n      bottom: 0;\n      left: 50%;\n      transform: translateX(-50%);\n      opacity: 0.2;\n      transition: opacity 0.3s;\n    }\n    .edgeless-note-collapse-button:hover {\n      opacity: 1;\n    }\n    .edgeless-note-collapse-button.flip {\n      transform: translateX(-50%) rotate(180deg);\n    }\n    .edgeless-note-collapse-button.hide {\n      display: none;\n    }\n\n    .edgeless-block-portal-note:has(.edgeless-note-collapse-button:hover) {\n      .affine-note-mask {\n        background-color: var(--affine-hover-color);\n      }\n    }\n\n    .edgeless-block-portal-note:has(.affine-embed-synced-doc-container.editing)\n      > .note-background {\n      left: ${-ACTIVE_NOTE_EXTRA_PADDING}px !important;\n      top: ${-ACTIVE_NOTE_EXTRA_PADDING}px !important;\n      width: calc(100% + ${ACTIVE_NOTE_EXTRA_PADDING * 2}px) !important;\n      height: calc(100% + ${ACTIVE_NOTE_EXTRA_PADDING * 2}px) !important;\n    }\n\n    .edgeless-block-portal-note:has(.affine-embed-synced-doc-container.editing)\n      > edgeless-note-mask {\n      display: none;\n    }\n  `;\n\n  @state()\n  private accessor _isSelected = false;\n\n  @state()\n  private accessor _editing = false;\n\n  @state()\n  private accessor _isResizing = false;\n\n  @state()\n  private accessor _isHover = false;\n\n  @state()\n  private accessor _noteFullHeight = 0;\n\n  @query('affine-note')\n  private accessor _affineNote!: HTMLDivElement;\n\n  get _zoom() {\n    return this.edgeless.service.viewport.zoom;\n  }\n\n  private get _isShowCollapsedContent() {\n    return this.model.edgeless.collapse && (this._isResizing || this._isHover);\n  }\n\n  private _hovered() {\n    if (!this._isHover && this.edgeless.service.selection.has(this.model.id)) {\n      this._isHover = true;\n    }\n  }\n\n  private _leaved() {\n    if (this._isHover) {\n      this._isHover = false;\n    }\n  }\n\n  private _handleClickAtBackground(e: MouseEvent) {\n    e.stopPropagation();\n    if (!this._affineNote || !this._editing) return;\n\n    const rect = this._affineNote.getBoundingClientRect();\n    const offsetY = 16 * this._zoom;\n    const offsetX = 2 * this._zoom;\n    const x = clamp(e.x, rect.left + offsetX, rect.right - offsetX);\n    const y = clamp(e.y, rect.top + offsetY, rect.bottom - offsetY);\n    handleNativeRangeAtPoint(x, y);\n\n    if (this.surface.doc.readonly) return;\n    this._tryAddParagraph(x, y);\n  }\n\n  private _tryAddParagraph(x: number, y: number) {\n    const nearest = getClosestBlockElementByPoint(\n      new Point(x, y)\n    ) as BlockElement | null;\n    if (!nearest) return;\n\n    const nearestBBox = nearest.getBoundingClientRect();\n    const yRel = y - nearestBBox.top;\n\n    const insertPos: 'before' | 'after' =\n      yRel < nearestBBox.height / 2 ? 'before' : 'after';\n\n    const nearestModel = nearest.model as BlockModel;\n    const nearestModelIdx = this.model.children.indexOf(nearestModel);\n\n    const children = this.model.children;\n    const siblingModel =\n      children[\n        clamp(\n          nearestModelIdx + (insertPos === 'before' ? -1 : 1),\n          0,\n          children.length\n        )\n      ];\n\n    if (\n      (!nearestModel.text ||\n        !matchFlavours(nearestModel, ['affine:paragraph', 'affine:list'])) &&\n      (!siblingModel ||\n        !siblingModel.text ||\n        !matchFlavours(siblingModel, ['affine:paragraph', 'affine:list']))\n    ) {\n      const [pId] = this.surface.doc.addSiblingBlocks(\n        nearestModel,\n        [{ flavour: 'affine:paragraph' }],\n        insertPos\n      );\n\n      this.updateComplete\n        .then(() => {\n          this.surface.selection.setGroup('note', [\n            this.surface.selection.create('text', {\n              from: {\n                blockId: pId,\n                index: 0,\n                length: 0,\n              },\n              to: null,\n            }),\n          ]);\n        })\n        .catch(console.error);\n    }\n  }\n\n  private _setCollapse(event: MouseEvent) {\n    event.stopImmediatePropagation();\n\n    const { collapse, collapsedHeight } = this.model.edgeless;\n\n    if (collapse) {\n      this.model.doc.updateBlock(this.model, () => {\n        this.model.edgeless.collapse = false;\n      });\n    } else if (collapsedHeight) {\n      const { xywh, edgeless } = this.model;\n      const bound = Bound.deserialize(xywh);\n      bound.h = collapsedHeight * (edgeless.scale ?? 1);\n      this.model.doc.updateBlock(this.model, () => {\n        this.model.edgeless.collapse = true;\n        this.model.xywh = bound.serialize();\n      });\n    }\n\n    this.edgeless.service.selection.clear();\n  }\n\n  private _collapsedContent() {\n    if (!this._isShowCollapsedContent || !this._affineNote) {\n      return nothing;\n    }\n\n    const { xywh, edgeless } = this.model;\n\n    const bound = Bound.deserialize(xywh);\n    const scale = edgeless.scale ?? 1;\n    const width = bound.w / scale;\n    const height = bound.h / scale;\n\n    const rect = this._affineNote.getBoundingClientRect();\n    const zoom = this.edgeless.service.viewport.zoom;\n    this._noteFullHeight =\n      rect.height / scale / zoom + 2 * EDGELESS_BLOCK_CHILD_PADDING;\n\n    if (height >= this._noteFullHeight) {\n      return nothing;\n    }\n\n    return html`\n      <div\n        style=${styleMap({\n          width: `${width}px`,\n          height: `${this._noteFullHeight - height}px`,\n          position: 'absolute',\n          left: '0px',\n          top: `${height}px`,\n          background: 'var(--affine-white)',\n          opacity: 0.5,\n          pointerEvents: 'none',\n          borderLeft: '2px var(--affine-blue) solid',\n          borderBottom: '2px var(--affine-blue) solid',\n          borderRight: '2px var(--affine-blue) solid',\n          borderRadius: '0 0 8px 8px',\n        })}\n      ></div>\n    `;\n  }\n\n  override firstUpdated() {\n    const { _disposables, edgeless } = this;\n    const selection = this.edgeless.service.selection;\n\n    _disposables.add(\n      edgeless.slots.elementResizeStart.on(() => {\n        if (\n          selection.selectedElements.includes(this.model as EdgelessBlockModel)\n        ) {\n          this._isResizing = true;\n        }\n      })\n    );\n\n    _disposables.add(\n      edgeless.slots.elementResizeEnd.on(() => {\n        this._isResizing = false;\n      })\n    );\n\n    const observer = new MutationObserver(() => {\n      const affineNote = this._affineNote;\n      if (!this._affineNote) return;\n      const rect = affineNote.getBoundingClientRect();\n      const zoom = this.edgeless.service.viewport.zoom;\n      const scale = this.model.edgeless.scale ?? 1;\n      this._noteFullHeight =\n        rect.height / scale / zoom + 2 * EDGELESS_BLOCK_CHILD_PADDING;\n    });\n    observer.observe(this, { childList: true, subtree: true });\n    _disposables.add(() => observer.disconnect());\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n\n    const selection = this.edgeless.service.selection;\n\n    this._editing = selection.has(this.model.id) && selection.editing;\n    this._disposables.add(\n      selection.slots.updated.on(() => {\n        if (selection.has(this.model.id) && selection.editing) {\n          this._editing = true;\n        } else {\n          this._editing = false;\n        }\n      })\n    );\n  }\n\n  override render() {\n    const { model, surface, index } = this;\n    const { displayMode } = model;\n    if (!!displayMode && displayMode === NoteDisplayMode.DocOnly)\n      return nothing;\n\n    const { xywh, background, edgeless } = model;\n    const { borderRadius, borderSize, borderStyle, shadowType } =\n      edgeless.style;\n    const { collapse, collapsedHeight, scale = 1 } = edgeless;\n\n    const bound = Bound.deserialize(xywh);\n    const width = bound.w / scale;\n    const height = bound.h / scale;\n\n    const style = {\n      position: 'absolute',\n      zIndex: `${index}`,\n      width: `${width}px`,\n      height: collapse ? `${height}px` : 'inherit',\n      left: `${bound.x}px`,\n      top: `${bound.y}px`,\n      padding: `${EDGELESS_BLOCK_CHILD_PADDING}px`,\n      boxSizing: 'border-box',\n      borderRadius: borderRadius + 'px',\n      pointerEvents: 'all',\n      transformOrigin: '0 0',\n      transform: `scale(${scale})`,\n    };\n\n    const extra = this._editing ? ACTIVE_NOTE_EXTRA_PADDING : 0;\n\n    const backgroundStyle = {\n      position: 'absolute',\n      left: `${-extra}px`,\n      top: `${-extra}px`,\n      width: `${width + extra * 2}px`,\n      height: `calc(100% + ${extra * 2}px)`,\n      borderRadius: borderRadius + 'px',\n      transition: this._editing\n        ? 'left 0.3s, top 0.3s, width 0.3s, height 0.3s'\n        : 'none',\n      background: `var(${background ?? DEFAULT_NOTE_BACKGROUND_COLOR})`,\n      border: `${borderSize}px ${\n        borderStyle === StrokeStyle.Dash ? 'dashed' : borderStyle\n      } var(--affine-black-10)`,\n      boxShadow: this._editing\n        ? 'var(--affine-active-shadow)'\n        : !shadowType\n          ? 'none'\n          : `var(${shadowType})`,\n    };\n\n    const isCollapsable =\n      collapse != null &&\n      collapsedHeight != null &&\n      collapsedHeight !== this._noteFullHeight;\n\n    const isCollapseArrowUp = collapse\n      ? this._noteFullHeight < height\n      : !!collapsedHeight && collapsedHeight < height;\n\n    return html`\n      <div\n        class=\"edgeless-block-portal-note\"\n        style=${styleMap(style)}\n        data-model-height=\"${bound.h}\"\n        @mouseleave=${this._leaved}\n        @mousemove=${this._hovered}\n        data-scale=\"${scale}\"\n      >\n        <div\n          class=\"note-background\"\n          style=${styleMap(backgroundStyle)}\n          @pointerdown=${(e: MouseEvent) => e.stopPropagation()}\n          @click=${this._handleClickAtBackground}\n        ></div>\n\n        <div\n          style=${styleMap({\n            width: '100%',\n            height: '100%',\n            'overflow-y': this._isShowCollapsedContent ? 'initial' : 'clip',\n          })}\n        >\n          ${surface.host.renderModel(model)}\n        </div>\n\n        ${isCollapsable\n          ? html`<div\n              class=\"${classMap({\n                'edgeless-note-collapse-button': true,\n                flip: isCollapseArrowUp,\n                hide: this._isSelected,\n              })}\"\n              @mousedown=${(e: MouseEvent) => e.stopPropagation()}\n              @mouseup=${(e: MouseEvent) => e.stopPropagation()}\n              @click=${this._setCollapse}\n            >\n              ${MoreIndicatorIcon}\n            </div>`\n          : nothing}\n        ${this._collapsedContent()}\n\n        <edgeless-note-mask\n          .display=${!this._editing}\n          .surface=${surface}\n          .model=${this.model}\n        ></edgeless-note-mask>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-block-portal-note': EdgelessBlockPortalNote;\n    'edgeless-note-mask': EdgelessNoteMask;\n  }\n}\n"]}