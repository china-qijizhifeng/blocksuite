{"version":3,"file":"edgeless-portal-base.js","sourceRoot":"","sources":["../../../../../src/root-block/edgeless/components/block-portal/edgeless-portal-base.ts"],"names":[],"mappings":"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","sourcesContent":["import { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport type { BlockModel } from '@blocksuite/store';\nimport { property } from 'lit/decorators.js';\n\nimport { requestConnectedFrame } from '../../../../_common/utils/event.js';\nimport type { SurfaceBlockComponent } from '../../../../surface-block/surface-block.js';\nimport type { EdgelessRootBlockComponent } from '../../edgeless-root-block.js';\nimport type { EdgelessBlockPortalContainer } from './edgeless-block-portal.js';\n\nexport class EdgelessPortalBase<T extends BlockModel> extends WithDisposable(\n  ShadowlessElement\n) {\n  @property({ attribute: false })\n  accessor index!: number;\n\n  @property({ attribute: false })\n  accessor model!: T;\n\n  @property({ attribute: false })\n  accessor surface!: SurfaceBlockComponent;\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  @property({ attribute: false })\n  accessor updatingSet!: Set<string>;\n\n  @property({ attribute: false })\n  accessor concurrentUpdatingCount!: number;\n\n  @property({ attribute: false })\n  accessor portalContainer!: EdgelessBlockPortalContainer;\n\n  protected renderModel(model: T) {\n    return this.surface.host.renderModel(model);\n  }\n\n  protected override scheduleUpdate(): void | Promise<unknown> {\n    const { promise, resolve } = Promise.withResolvers<void>();\n    const detect = () => {\n      if (this.updatingSet.size < this.concurrentUpdatingCount) {\n        this.updatingSet.add(this.model.id);\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        super.scheduleUpdate();\n\n        requestConnectedFrame(() => {\n          this.updatingSet.delete(this.model.id);\n        }, this);\n        resolve();\n      } else {\n        requestConnectedFrame(detect, this);\n      }\n    };\n\n    detect();\n\n    return promise;\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n\n    this._disposables.add(\n      this.model.propsUpdated.on(() => {\n        if (this.hasUpdated) this.requestUpdate();\n      })\n    );\n  }\n}\n"]}