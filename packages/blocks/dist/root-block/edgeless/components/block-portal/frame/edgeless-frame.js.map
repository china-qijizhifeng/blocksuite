{"version":3,"file":"edgeless-frame.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/block-portal/frame/edgeless-frame.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,EAAE,iBAAiB,EAAE,cAAc,EAAE,MAAM,uBAAuB,CAAC;AAC1E,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AACzC,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AAC1E,OAAO,EAAE,MAAM,EAAE,MAAM,0BAA0B,CAAC;AAClD,OAAO,EAAE,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AAEvD,OAAO,EAAE,eAAe,EAAE,MAAM,qCAAqC,CAAC;AACtE,OAAO,EACL,KAAK,GAEN,MAAM,uCAAuC,CAAC;AAE/C,OAAO,EAAE,kBAAkB,EAAE,MAAM,4BAA4B,CAAC;AAEhE,MAAM,mBAAmB,GAAG,CAAC,CAAC;IAGjB,kBAAkB;4BAD9B,aAAa,CAAC,sBAAsB,CAAC;;;;sBACE,cAAc,CAAC,iBAAiB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;kCAAzC,SAAQ,WAAiC;;;;oCAoBtE,KAAK,EAAE;wCAGP,KAAK,EAAE;yCAGP,KAAK,CAAC,qBAAqB,CAAC;wCAG5B,KAAK,EAAE;uCAGP,KAAK,EAAE;iCAGP,KAAK,EAAE;iCAOP,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;oCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;gCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;YA3B/B,6KAAiB,QAAQ,6BAAR,QAAQ,2FAAS;YAGlC,yLAAiB,YAAY,6BAAZ,YAAY,mGAAS;YAGtC,4LAAiB,aAAa,6BAAb,aAAa,qGAAkB;YAGhD,yLAAiB,YAAY,6BAAZ,YAAY,mGAAS;YAGtC,sLAAiB,WAAW,6BAAX,WAAW,iGAAM;YAGlC,oKAAiB,KAAK,6BAAL,KAAK,qFAA+B;YAOrD,oKAAS,KAAK,6BAAL,KAAK,qFAAmB;YAGjC,6KAAS,QAAQ,6BAAR,QAAQ,2FAA8B;YAG/C,iKAAS,IAAI,6BAAJ,IAAI,mFAAU;YAjDzB,6KA4MC;;;;iBA3MiB,WAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;GAiB3B,AAjBqB,CAiBpB;QAGF,2BAAkC;QAAlC,IAAiB,QAAQ,8CAAS;QAAlC,IAAiB,QAAQ,oDAAS;QAGlC,+BAAsC;QAAtC,IAAiB,YAAY,kDAAS;QAAtC,IAAiB,YAAY,wDAAS;QAGtC,gCAAgD;QAAhD,IAAiB,aAAa,mDAAkB;QAAhD,IAAiB,aAAa,yDAAkB;QAGhD,+BAAsC;QAAtC,IAAiB,YAAY,kDAAS;QAAtC,IAAiB,YAAY,wDAAS;QAGtC,8BAAkC;QAAlC,IAAiB,WAAW,iDAAM;QAAlC,IAAiB,WAAW,uDAAM;QAGlC,wBAAqD;QAArD,IAAiB,KAAK,2CAA+B;QAArD,IAAiB,KAAK,iDAA+B;QAOrD,wBAAiC;QAAjC,IAAS,KAAK,2CAAmB;QAAjC,IAAS,KAAK,iDAAmB;QAGjC,2BAA+C;QAA/C,IAAS,QAAQ,8CAA8B;QAA/C,IAAS,QAAQ,oDAA8B;QAG/C,uBAAuB;QAAvB,IAAS,IAAI,0CAAU;QAAvB,IAAS,IAAI,gDAAU;QAEf,qBAAqB;YAC3B,MAAM,EAAE,YAAY,EAAE,IAAI,EAAE,GAAG,IAAI,CAAC;YACpC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;YACpC,MAAM,KAAK,GAAG,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;YACvC,MAAM,MAAM,GAAG,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;YAEzC,IAAI,KAAK,IAAI,MAAM,EAAE,CAAC;gBACpB,IAAI,CAAC,KAAK,CAAC,YAAY,GAAG,IACxB,YAAY,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC,mBAAmB,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CACjE,IACE,YAAY,CAAC,CAAC;oBACd,CAAC,YAAY;wBACX,CAAC,CAAC,mBAAmB,GAAG,IAAI;wBAC5B,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,mBAAmB,GAAG,IAAI,CAAC,CAC5C,IAAI,KAAK,IAAI,MAAM,GAAG,CAAC;YACzB,CAAC;QACH,CAAC;QAEO,cAAc;YACpB,OAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,GAAG,CAC/C,IAAI,CAAC,KAAK,CAAC,YAAY,EACvB,IAAI,EACJ,IAAI,EACJ,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CACtB,CAAC;QACJ,CAAC;QAEQ,iBAAiB;YACxB,KAAK,CAAC,iBAAiB,EAAE,CAAC;YAE1B,MAAM,EAAE,YAAY,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC;YACxC,MAAM,EAAE,OAAO,EAAE,GAAG,QAAQ,CAAC;YAE7B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;YAE1C,YAAY,CAAC,GAAG,CACd,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC,OAAO,CAAC,EAAE;gBAC3C,IACE,CAAC,OAAO,CAAC,IAAI,KAAK,QAAQ;oBACxB,OAAO,CAAC,KAAK,CAAC,GAAG,KAAK,MAAM;oBAC5B,QAAQ,CAAC,GAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC,EAAE,KAAK;wBACtC,eAAe,CAAC;oBACpB,CAAC,OAAO,CAAC,IAAI,KAAK,KAAK,IAAI,OAAO,CAAC,OAAO,KAAK,cAAc,CAAC,EAC9D,CAAC;oBACD,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;gBAC5C,CAAC;YACH,CAAC,CAAC,CACH,CAAC;YAEF,YAAY,CAAC,GAAG,CACd,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC,GAAG,EAAE;gBAC9B,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;gBAC7B,IAAI,CAAC,aAAa,EAAE,CAAC;YACvB,CAAC,CAAC,CACH,CAAC;YAEF,YAAY,CAAC,GAAG,CACd,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,CAAC,GAAG,EAAE;gBAC/C,IAAI,CAAC,QAAQ;oBACX,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,EAAE;wBAC3D,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC;YACvC,CAAC,CAAC,CACH,CAAC;YAEF,YAAY,CAAC,GAAG,CAAC,GAAG,EAAE;gBACpB,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,mBAAmB,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE;oBACnD,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,IAAI,KAAK,gBAAgB,CAAC;gBACrD,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;YAEH,MAAM,WAAW,GAAG,GAAG,EAAE;gBACvB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;YACjD,CAAC,CAAC;YACF,YAAY,CAAC,GAAG,CAAC,GAAG,EAAE;gBACpB,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;YAChD,CAAC,CAAC,CAAC;YACH,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;YAE5C,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;YAC/C,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;QAC/B,CAAC;QAEQ,OAAO,CAAC,kBAAwC;YACvD,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,KAAK,OAAO,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;gBAC1D,OAAO;YACT,CAAC;YAED,IAAI,WAAW,GAAG,KAAK,CAAC;YACxB,IACE,IAAI,CAAC,YAAY,KAAK,CAAC;gBACvB,IAAI,CAAC,aAAa,KAAK,CAAC;gBACxB,kBAAkB,CAAC,GAAG,CAAC,aAAa,CAAC;gBACrC,kBAAkB,CAAC,GAAG,CAAC,cAAc,CAAC;gBACtC,kBAAkB,CAAC,GAAG,CAAC,OAAO,CAAC,EAC/B,CAAC;gBACD,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC;gBACnD,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC;gBACrD,WAAW,GAAG,IAAI,CAAC;YACrB,CAAC;YAED,IAAI,WAAW,IAAI,kBAAkB,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC;gBAClD,IAAI,CAAC,qBAAqB,EAAE,CAAC;YAC/B,CAAC;QACH,CAAC;QAEQ,MAAM;YACb,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;YACzB,MAAM,KAAK,GAAG,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YAE5C,MAAM,EAAE,YAAY,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,IAAI,CAAC;YAE9C,MAAM,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC;YACtC,MAAM,QAAQ,GAAG,WAAW;gBAC1B,CAAC,CAAC,KAAK,CAAC,CAAC,GAAG,IAAI,GAAG,mBAAmB,GAAG,IAAI;gBAC7C,CAAC,CAAC,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC;YACnB,8CAA8C;YAC9C,MAAM,MAAM,GAAG,EAAE,GAAG,IAAI,IAAI,KAAK,CAAC,CAAC,IAAI,WAAW,CAAC;YACnD,MAAM,kBAAkB,GAAG;gBACzB,aAAa,KAAK,CAAC,CAAC,OAAO,KAAK,CAAC,CAAC,KAAK;gBACvC,iBAAiB,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI;gBAC3C,SAAS,CAAC,GAAG,IAAI,GAAG;gBACpB,aAAa,WAAW,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,OAChD,WAAW,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,mBACvC,KAAK;aACN,CAAC;YAEF,OAAO,IAAI,CAAA;QACP,IAAI,CAAC,WAAW,IAAI,CAAC,YAAY,IAAI,CAAC,QAAQ;gBAC9C,CAAC,CAAC,IAAI,CAAA;;sBAEQ,QAAQ,CAAC;oBACf,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS;oBACpC,SAAS,EAAE,kBAAkB,CAAC,IAAI,CAAC,GAAG,CAAC;oBACvC,QAAQ,EAAE,QAAQ,GAAG,IAAI;oBACzB,eAAe,EAAE,WAAW,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,aAAa;oBACzD,UAAU,EAAE,WAAW;wBACrB,CAAC,CAAC,qBAAqB;wBACvB,CAAC,CAAC,kCAAkC;oBACtC,KAAK,EAAE,WAAW;wBAChB,CAAC,CAAC,oCAAoC;wBACtC,CAAC,CAAC,qBAAqB;oBACzB,MAAM,EAAE,WAAW;wBACjB,CAAC,CAAC,sCAAsC;wBACxC,CAAC,CAAC,MAAM;iBACX,CAAC;;;gBAGA,IAAI,CAAC,WAAW;;WAErB;gBACH,CAAC,CAAC,OAAO;KACZ,CAAC;QACJ,CAAC;;;YAtLgB,kFAAW,KAAK,EAAC;YAGjB,iJAAe,KAAK,GAAC;YAGrB,gKAA+B;YAG/B,sJAAe,KAAK,GAAC;YAGrB,mJAAc,EAAE,GAAC;YAGjB,sIAA+B,IAAI,GAAC;YAE7C,iBAAY,uDAAG,CAAC,EAAC;YAEjB,kBAAa,GAAG,CAAC,CAAC;YAGjB,oFAAwB;YAGxB,+IAAsC;YAGtC,0IAAc;;;;YAjDZ,uDAAkB;;;;;SAAlB,kBAAkB;IA+MzB,wBAAwB;4BAD7B,aAAa,CAAC,6BAA6B,CAAC;;;;sBACN,kBAAkB;wCAA1B,SAAQ,WAAmC;;;;YAA1E,6KAkBC;;;YAlBK,uDAAwB;;QACnB,MAAM;YACb,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC;YAC9B,MAAM,KAAK,GAAG,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YAC5C,MAAM,KAAK,GAAG,QAAQ,CAAC;gBACrB,QAAQ,EAAE,UAAU;gBACpB,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,IAAI,EAAE,GAAG,KAAK,CAAC,CAAC,IAAI;gBACpB,GAAG,EAAE,GAAG,KAAK,CAAC,CAAC,IAAI;gBACnB,eAAe,EAAE,SAAS;aAC3B,CAAC,CAAC;YAEH,OAAO,IAAI,CAAA;uDACwC,KAAK;UAClD,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC;;KAE5B,CAAC;QACJ,CAAC;;;;IAIU,uBAAuB;4BADnC,aAAa,CAAC,2BAA2B,CAAC;;;;sBACE,cAAc,CAAC,iBAAiB,CAAC;;;;;;;;;;;;;uCAAzC,SAAQ,WAAiC;;;;oCAY3E,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;kCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;sCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;yCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;YAR/B,6KAAS,QAAQ,6BAAR,QAAQ,2FAA8B;YAG/C,uKAAS,MAAM,6BAAN,MAAM,uFAAqB;YAGpC,mLAAS,UAAU,6BAAV,UAAU,+FAAU;YAG7B,4LAAS,aAAa,6BAAb,aAAa,qGAAwB;YAtBhD,6KAkEC;;;;iBAjEiB,WAAM,GAAG,GAAG,CAAA;;;;;;;;;GAS3B,AATqB,CASpB;QAGF,qFAA+C;QAA/C,IAAS,QAAQ,8CAA8B;QAA/C,IAAS,QAAQ,oDAA8B;QAG/C,yIAAoC;QAApC,IAAS,MAAM,4CAAqB;QAApC,IAAS,MAAM,kDAAqB;QAGpC,+IAA6B;QAA7B,IAAS,UAAU,gDAAU;QAA7B,IAAS,UAAU,sDAAU;QAG7B,yJAA8C;QAA9C,IAAS,aAAa,mDAAwB;QAA9C,IAAS,aAAa,yDAAwB;QAE3B,MAAM;YACvB,MAAM,EAAE,aAAa,EAAE,QAAQ,EAAE,UAAU,EAAE,GAAG,IAAI,CAAC;YACrD,MAAM,IAAI,GAAG,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC;YAE5C,OAAO,MAAM,CACX,IAAI,CAAC,MAAM,EACX,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,EACjB,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE,CAAC,IAAI,CAAA;;gCAEI,KAAK,CAAC,EAAE;kBACtB,YAAY,UAAU,GAAG,KAAK,IAAI,aAAa,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,EAAE,EAAE;mBAClF,KAAK;sBACF,IAAI,CAAC,QAAQ;kBACjB,IAAI;;;;iCAIW,KAAK,CAAC,EAAE;mBACtB,CAAC;mBACD,KAAK;qBACH,IAAI,CAAC,QAAQ,CAAC,OAAO;sBACpB,IAAI,CAAC,QAAQ;yBACV,IAAI,CAAC,QAAQ,CAAC,oBAAoB,CAAC,YAAY;qCACnC,IAAI,CAAC,QAAQ,CAAC,oBAAoB;iBAC1D,mBAAmB;kBACd,kCAAkC,UAAU,GAAG,KAAK,IAAI,aAAa,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,EAAE,EAAE;;;OAGpH,CACF,CAAC;QACJ,CAAC;QAEQ,iBAAiB;YACxB,KAAK,CAAC,iBAAiB,EAAE,CAAC;YAE1B,IAAI,CAAC,YAAY,CAAC,GAAG,CACnB,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,eAAe,CAAC,EAAE,CAAC,GAAG,EAAE;gBACrD,wDAAwD;gBACxD,IAAI,CAAC,aAAa,EAAE,CAAC;YACvB,CAAC,CAAC,CACH,CAAC;QACJ,CAAC;;;;;;YAjEU,uDAAuB;;;;;SAAvB,uBAAuB","sourcesContent":["import { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { css, html, nothing } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { FrameBlockModel } from '../../../../../frame-block/index.js';\nimport {\n  Bound,\n  type SerializedXYWH,\n} from '../../../../../surface-block/index.js';\nimport type { EdgelessRootBlockComponent } from '../../../edgeless-root-block.js';\nimport { EdgelessPortalBase } from '../edgeless-portal-base.js';\n\nconst NESTED_FRAME_OFFSET = 4;\n\n@customElement('edgeless-frame-title')\nexport class EdgelessFrameTitle extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    .affine-frame-title {\n      position: absolute;\n      z-index: 1;\n      left: 0px;\n      top: 0px;\n      border-radius: 4px;\n      width: fit-content;\n      padding: 8px 10px;\n      font-size: 14px;\n      cursor: default;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      transform-origin: left bottom;\n      line-height: normal;\n    }\n  `;\n\n  @state()\n  private accessor _editing = false;\n\n  @state()\n  private accessor _isNavigator = false;\n\n  @query('.affine-frame-title')\n  private accessor _frameTitleEl!: HTMLDivElement;\n\n  @state()\n  private accessor _nestedFrame = false;\n\n  @state()\n  private accessor _frameTitle = '';\n\n  @state()\n  private accessor _xywh: SerializedXYWH | null = null;\n\n  private _cachedWidth = 0;\n\n  private _cachedHeight = 0;\n\n  @property({ attribute: false })\n  accessor frame!: FrameBlockModel;\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  @property({ attribute: false })\n  accessor zoom!: number;\n\n  private _updateFrameTitleSize() {\n    const { _nestedFrame, zoom } = this;\n    const { elementBound } = this.frame;\n    const width = this._cachedWidth / zoom;\n    const height = this._cachedHeight / zoom;\n\n    if (width && height) {\n      this.frame.externalXYWH = `[${\n        elementBound.x + (_nestedFrame ? NESTED_FRAME_OFFSET / zoom : 0)\n      },${\n        elementBound.y +\n        (_nestedFrame\n          ? NESTED_FRAME_OFFSET / zoom\n          : -(height + NESTED_FRAME_OFFSET / zoom))\n      },${width},${height}]`;\n    }\n  }\n\n  private _isInsideFrame() {\n    return this.edgeless.service.layer.framesGrid.has(\n      this.frame.elementBound,\n      true,\n      true,\n      new Set([this.frame])\n    );\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    const { _disposables, edgeless } = this;\n    const { surface } = edgeless;\n\n    this._nestedFrame = this._isInsideFrame();\n\n    _disposables.add(\n      edgeless.doc.slots.blockUpdated.on(payload => {\n        if (\n          (payload.type === 'update' &&\n            payload.props.key === 'xywh' &&\n            edgeless.doc.getBlock(payload.id)?.model instanceof\n              FrameBlockModel) ||\n          (payload.type === 'add' && payload.flavour === 'affine:frame')\n        ) {\n          this._nestedFrame = this._isInsideFrame();\n        }\n      })\n    );\n\n    _disposables.add(\n      this.frame.propsUpdated.on(() => {\n        this._xywh = this.frame.xywh;\n        this.requestUpdate();\n      })\n    );\n\n    _disposables.add(\n      edgeless.service.selection.slots.updated.on(() => {\n        this._editing =\n          edgeless.service.selection.selectedIds[0] === this.frame.id &&\n          edgeless.service.selection.editing;\n      })\n    );\n\n    _disposables.add(() => {\n      surface.edgeless.slots.edgelessToolUpdated.on(tool => {\n        this._isNavigator = tool.type === 'frameNavigator';\n      });\n    });\n\n    const updateTitle = () => {\n      this._frameTitle = this.frame.title.toString();\n    };\n    _disposables.add(() => {\n      this.frame.title.yText.unobserve(updateTitle);\n    });\n    this.frame.title.yText.observe(updateTitle);\n\n    this._frameTitle = this.frame.title.toString();\n    this._xywh = this.frame.xywh;\n  }\n\n  override updated(_changedProperties: Map<string, unknown>) {\n    if (this.style.display !== 'block' || !this._frameTitleEl) {\n      return;\n    }\n\n    let sizeChanged = false;\n    if (\n      this._cachedWidth === 0 ||\n      this._cachedHeight === 0 ||\n      _changedProperties.has('_frameTitle') ||\n      _changedProperties.has('_nestedFrame') ||\n      _changedProperties.has('_xywh')\n    ) {\n      this._cachedWidth = this._frameTitleEl.clientWidth;\n      this._cachedHeight = this._frameTitleEl.clientHeight;\n      sizeChanged = true;\n    }\n\n    if (sizeChanged || _changedProperties.has('zoom')) {\n      this._updateFrameTitleSize();\n    }\n  }\n\n  override render() {\n    const model = this.frame;\n    const bound = Bound.deserialize(model.xywh);\n\n    const { _isNavigator, _editing, zoom } = this;\n\n    const nestedFrame = this._nestedFrame;\n    const maxWidth = nestedFrame\n      ? bound.w * zoom - NESTED_FRAME_OFFSET / zoom\n      : bound.w * zoom;\n    // 32 is the estimated height of title element\n    const hidden = 32 / zoom >= bound.h && nestedFrame;\n    const transformOperation = [\n      `translate(${bound.x}px, ${bound.y}px)`,\n      `translate(0%, ${nestedFrame ? 0 : -100}%)`,\n      `scale(${1 / zoom})`,\n      `translate(${nestedFrame ? NESTED_FRAME_OFFSET : 0}px, ${\n        nestedFrame ? NESTED_FRAME_OFFSET : -NESTED_FRAME_OFFSET\n      }px)`,\n    ];\n\n    return html`\n      ${this._frameTitle && !_isNavigator && !_editing\n        ? html`\n            <div\n              style=${styleMap({\n                display: hidden ? 'none' : 'initial',\n                transform: transformOperation.join(' '),\n                maxWidth: maxWidth + 'px',\n                transformOrigin: nestedFrame ? 'top left' : 'bottom left',\n                background: nestedFrame\n                  ? 'var(--affine-white)'\n                  : 'var(--affine-text-primary-color)',\n                color: nestedFrame\n                  ? 'var(--affine-text-secondary-color)'\n                  : 'var(--affine-white)',\n                border: nestedFrame\n                  ? '1px solid var(--affine-border-color)'\n                  : 'none',\n              })}\n              class=\"affine-frame-title\"\n            >\n              ${this._frameTitle}\n            </div>\n          `\n        : nothing}\n    `;\n  }\n}\n\n@customElement('edgeless-block-portal-frame')\nclass EdgelessBlockPortalFrame extends EdgelessPortalBase<FrameBlockModel> {\n  override render() {\n    const { model, index } = this;\n    const bound = Bound.deserialize(model.xywh);\n    const style = styleMap({\n      position: 'absolute',\n      zIndex: `${index}`,\n      left: `${bound.x}px`,\n      top: `${bound.y}px`,\n      transformOrigin: '0px 0px',\n    });\n\n    return html`\n      <div class=\"edgeless-block-portal-frame\" style=${style}>\n        ${this.renderModel(model)}\n      </div>\n    `;\n  }\n}\n\n@customElement('edgeless-frames-container')\nexport class EdgelessFramesContainer extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    edgeless-frames-container {\n      display: block;\n    }\n\n    edgeless-frames-container > [data-portal-block-id],\n    edgeless-frames-container > [data-frame-title-id] {\n      position: relative;\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  @property({ attribute: false })\n  accessor frames!: FrameBlockModel[];\n\n  @property({ attribute: false })\n  accessor startIndex!: number;\n\n  @property({ attribute: false })\n  accessor visibleFrames!: Set<FrameBlockModel>;\n\n  protected override render() {\n    const { visibleFrames, edgeless, startIndex } = this;\n    const zoom = edgeless.service.viewport.zoom;\n\n    return repeat(\n      this.frames,\n      frame => frame.id,\n      (frame, index) => html`\n        <edgeless-frame-title\n          data-frame-title-id=${frame.id}\n          style=${`z-index: ${startIndex + index};${visibleFrames.has(frame) ? 'display:block' : ''}`}\n          .frame=${frame}\n          .edgeless=${this.edgeless}\n          .zoom=${zoom}\n        >\n        </edgeless-frame-title>\n        <edgeless-block-portal-frame\n          data-portal-block-id=${frame.id}\n          .index=${1}\n          .model=${frame}\n          .surface=${this.edgeless.surface}\n          .edgeless=${this.edgeless}\n          .updatingSet=${this.edgeless.rootElementContainer.renderingSet}\n          .concurrentUpdatingCount=${this.edgeless.rootElementContainer\n            .concurrentRendering}\n          style=${`pointer-events: none; z-index: ${startIndex + index};${visibleFrames.has(frame) ? 'display:block' : ''}`}\n        >\n        </edgeless-block-portal-frame>\n      `\n    );\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n\n    this._disposables.add(\n      this.edgeless.service.viewport.viewportUpdated.on(() => {\n        // if zoom changed we need to re-render the frame titles\n        this.requestUpdate();\n      })\n    );\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-frames-container': EdgelessFramesContainer;\n    'edgeless-block-portal-frame': EdgelessBlockPortalFrame;\n    'edgeless-frame-title': EdgelessFrameTitle;\n  }\n}\n"]}