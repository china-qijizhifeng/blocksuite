{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/root-block/edgeless/components/note-slicer/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { WithDisposable } from '@blocksuite/block-std';\nimport { DisposableGroup } from '@blocksuite/global/utils';\nimport { css, html, LitElement, nothing, type PropertyValues } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { SmallScissorsIcon } from '../../../../_common/icons/edgeless.js';\nimport {\n  buildPath,\n  getRectByBlockElement,\n  Point,\n} from '../../../../_common/utils/index.js';\nimport type {\n  EdgelessRootBlockComponent,\n  NoteBlockComponent,\n  NoteBlockModel,\n} from '../../../../index.js';\nimport {\n  deserializeXYWH,\n  serializeXYWH,\n} from '../../../../surface-block/utils/xywh.js';\nimport { DEFAULT_NOTE_HEIGHT } from '../../utils/consts.js';\n\nconst DIVIDING_LINE_OFFSET = 4;\nconst NEW_NOTE_GAP = 40;\n\nconst styles = css`\n  :host {\n    display: flex;\n  }\n\n  .note-slicer-container {\n    display: flex;\n  }\n\n  .note-slicer-button {\n    position: absolute;\n    top: 0;\n    right: 0;\n    display: flex;\n    box-sizing: border-box;\n    border-radius: 4px;\n    justify-content: center;\n    align-items: center;\n    color: var(--affine-icon-color);\n    border: 1px solid var(--affine-border-color);\n    background-color: var(--affine-background-overlay-panel-color);\n    box-shadow: var(--affine-menu-shadow);\n    cursor: pointer;\n    width: 24px;\n    height: 24px;\n    transform-origin: left top;\n    z-index: var(--affine-z-index-popover);\n    opacity: 0;\n    transition: opacity 150ms cubic-bezier(0.25, 0.1, 0.25, 1);\n  }\n\n  .note-slicer-dividing-line-container {\n    display: flex;\n    align-items: center;\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 4px;\n    cursor: pointer;\n  }\n\n  .note-slicer-dividing-line {\n    display: block;\n    height: 1px;\n    width: 100%;\n    z-index: var(--affine-z-index-popover);\n    background-image: linear-gradient(\n      to right,\n      var(--affine-black-10) 50%,\n      transparent 50%\n    );\n    background-size: 4px 100%;\n  }\n  .note-slicer-dividing-line-container.active .note-slicer-dividing-line {\n    background-image: linear-gradient(\n      to right,\n      var(--affine-black-60) 50%,\n      transparent 50%\n    );\n    animation: slide 0.3s linear infinite;\n  }\n  @keyframes slide {\n    0% {\n      background-position: 0 0;\n    }\n    100% {\n      background-position: -4px 0;\n    }\n  }\n`;\n@customElement('note-slicer')\nexport class NoteSlicer extends WithDisposable(LitElement) {\n  get _editorHost() {\n    return this.edgeless.host;\n  }\n\n  get _noteBlockElement() {\n    if (!this._editorHost) return null;\n    const noteBlock = this._editorHost.view.viewFromPath(\n      'block',\n      buildPath(this.anchorNote)\n    );\n    return noteBlock ? (noteBlock as NoteBlockComponent) : null;\n  }\n\n  get _notePortalElement() {\n    return this._noteBlockElement?.closest('.edgeless-block-portal-note');\n  }\n\n  get _viewportOffset() {\n    const { viewport } = this.edgeless;\n    return {\n      left: viewport.left ?? 0,\n      top: viewport.top ?? 0,\n    };\n  }\n\n  get _selection() {\n    return this.edgeless.service.selection;\n  }\n\n  get _zoom() {\n    return this.edgeless.service.viewport.zoom;\n  }\n\n  static override styles = styles;\n\n  @state()\n  private accessor _activeSlicerIndex = 0;\n\n  private _hidden = false;\n\n  private _divingLinePositions: Point[] = [];\n\n  private _noteBlockIds: string[] = [];\n\n  private _noteDisposables: DisposableGroup | null = null;\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  @property({ attribute: false })\n  accessor anchorNote: NoteBlockModel | null = null;\n\n  private _updateDivingLineAndBlockIds() {\n    if (!this.anchorNote || !this._notePortalElement) {\n      this._divingLinePositions = [];\n      this._noteBlockIds = [];\n      return;\n    }\n\n    const divingLinePositions: Point[] = [];\n    const noteBlockIds: string[] = [];\n    const notePortalRect = this._notePortalElement.getBoundingClientRect();\n    const notePortalTop = notePortalRect.top;\n    const notePortalBottom = notePortalRect.bottom;\n\n    for (let i = 0; i < this.anchorNote.children.length - 1; i++) {\n      const child = this.anchorNote.children[i];\n      const rect = this.edgeless.host.view\n        .viewFromPath('block', buildPath(child))\n        ?.getBoundingClientRect();\n\n      if (\n        rect &&\n        rect.bottom > notePortalTop &&\n        rect.bottom < notePortalBottom\n      ) {\n        const x = rect.x - this._viewportOffset.left;\n        const y =\n          rect.bottom +\n          DIVIDING_LINE_OFFSET * this._zoom -\n          this._viewportOffset.top;\n        divingLinePositions.push(new Point(x, y));\n        noteBlockIds.push(child.id);\n      }\n    }\n\n    this._divingLinePositions = divingLinePositions;\n    this._noteBlockIds = noteBlockIds;\n  }\n\n  private _updateActiveSlicerIndex(pos: Point) {\n    const { _divingLinePositions } = this;\n    const curY = pos.y + DIVIDING_LINE_OFFSET * this._zoom;\n    let index = -1;\n    for (let i = 0; i < _divingLinePositions.length; i++) {\n      const currentY = _divingLinePositions[i].y;\n      const previousY = i > 0 ? _divingLinePositions[i - 1].y : 0;\n      const midY = (currentY + previousY) / 2;\n      if (curY < midY) {\n        break;\n      }\n      index++;\n    }\n\n    if (index < 0) index = 0;\n    this._activeSlicerIndex = index;\n  }\n\n  private _sliceNote() {\n    if (!this.anchorNote || !this._noteBlockIds.length) return;\n    const doc = this.edgeless.doc;\n\n    const {\n      index: originIndex,\n      xywh,\n      background,\n      children,\n      displayMode,\n    } = this.anchorNote;\n    const {\n      collapse: _,\n      collapsedHeight: __,\n      ...restOfEdgeless\n    } = this.anchorNote.edgeless;\n    const anchorBlockId = this._noteBlockIds[this._activeSlicerIndex];\n    if (!anchorBlockId) return;\n    const sliceIndex = children.findIndex(block => block.id === anchorBlockId);\n    const resetBlocks = children.slice(sliceIndex + 1);\n    const [x, , width] = deserializeXYWH(xywh);\n    const sliceVerticalPos =\n      this._divingLinePositions[this._activeSlicerIndex].y;\n    const newY = this.edgeless.service.viewport.toModelCoord(\n      x,\n      sliceVerticalPos\n    )[1];\n    const newNoteId = this.edgeless.service.addBlock(\n      'affine:note',\n      {\n        background,\n        displayMode,\n        xywh: serializeXYWH(x, newY + NEW_NOTE_GAP, width, DEFAULT_NOTE_HEIGHT),\n        index: originIndex + 1,\n        edgeless: restOfEdgeless,\n      },\n      doc.root?.id\n    );\n\n    doc.moveBlocks(resetBlocks, doc.getBlockById(newNoteId) as NoteBlockModel);\n\n    this._activeSlicerIndex = 0;\n    this._selection.set({\n      elements: [newNoteId],\n      editing: false,\n    });\n  }\n\n  protected override updated(_changedProperties: PropertyValues) {\n    super.updated(_changedProperties);\n    if (_changedProperties.has('anchorNote')) {\n      this._noteDisposables?.dispose();\n      this._noteDisposables = null;\n      if (this.anchorNote) {\n        this._noteDisposables = new DisposableGroup();\n        this._noteDisposables.add(\n          this.anchorNote.propsUpdated.on(({ key }) => {\n            if (key === 'children' || key === 'xywh') {\n              this.requestUpdate();\n            }\n          })\n        );\n      }\n    }\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.edgeless.service) return;\n    this._updateDivingLineAndBlockIds();\n    const { disposables } = this;\n\n    disposables.add(\n      this.edgeless.service.uiEventDispatcher.add('pointerMove', ctx => {\n        if (this._hidden) this._hidden = false;\n\n        const state = ctx.get('pointerState');\n        const pos = new Point(state.x, state.y);\n        this._updateActiveSlicerIndex(pos);\n      })\n    );\n\n    disposables.add(\n      this.edgeless.service.viewport.viewportUpdated.on(() => {\n        this._hidden = true;\n        this.requestUpdate();\n      })\n    );\n\n    const { surface } = this.edgeless;\n    requestAnimationFrame(() => {\n      if (surface.isConnected && surface.edgeless.dispatcher) {\n        disposables.add(\n          surface.edgeless.dispatcher.add('click', ctx => {\n            const event = ctx.get('pointerState');\n            const { raw } = event;\n            const target = raw.target as HTMLElement;\n            if (!target) return false;\n            if (target.closest('note-slicer')) {\n              this._sliceNote();\n              return true;\n            }\n            return false;\n          })\n        );\n      }\n    });\n  }\n\n  override firstUpdated() {\n    if (!this.edgeless.service) return;\n    this.disposables.add(\n      this.edgeless.service.uiEventDispatcher.add('wheel', () => {\n        this._hidden = true;\n        this.requestUpdate();\n      })\n    );\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this.disposables.dispose();\n    this._noteDisposables?.dispose();\n    this._noteDisposables = null;\n  }\n\n  override render() {\n    if (!this.anchorNote || this._hidden) return nothing;\n    this._updateDivingLineAndBlockIds();\n\n    const noteBlockElement = this._noteBlockElement;\n    if (!noteBlockElement || !this._divingLinePositions.length) return nothing;\n\n    const rect = getRectByBlockElement(noteBlockElement);\n    const width = rect.width;\n    const buttonPosition = this._divingLinePositions[this._activeSlicerIndex];\n\n    return html`<div class=\"note-slicer-container\">\n      <div\n        class=\"note-slicer-button\"\n        style=${styleMap({\n          left: `${buttonPosition.x - 66 * this._zoom}px`,\n          top: `${buttonPosition.y}px`,\n          opacity: 1,\n          scale: `${this._zoom}`,\n          transform: 'translateY(-50%)',\n        })}\n      >\n        ${SmallScissorsIcon}\n      </div>\n      ${this._divingLinePositions.map((pos, idx) => {\n        const dividingLineClasses = classMap({\n          'note-slicer-dividing-line-container': true,\n          active: idx === this._activeSlicerIndex,\n        });\n        return html`<div\n          class=${dividingLineClasses}\n          style=${styleMap({\n            left: `${pos.x}px`,\n            top: `${pos.y}px`,\n            width: `${width}px`,\n          })}\n        >\n          <span class=\"note-slicer-dividing-line\"></span>\n        </div>`;\n      })}\n    </div> `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'note-slicer': NoteSlicer;\n  }\n}\n"]}