{"version":3,"file":"drag-handle.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/drag-handle/drag-handle.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BlockElement } from '@blocksuite/block-std';\nimport {\n  PathFinder,\n  type PointerEventState,\n  type UIEventHandler,\n  WidgetElement,\n} from '@blocksuite/block-std';\nimport {\n  assertExists,\n  DisposableGroup,\n  throttle,\n} from '@blocksuite/global/utils';\nimport {\n  type BlockModel,\n  type BlockSelector,\n  BlockViewType,\n} from '@blocksuite/store';\nimport { html } from 'lit';\nimport { customElement, query, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport {\n  getBlockElementsExcludeSubtrees,\n  getCurrentNativeRange,\n  getModelByBlockComponent,\n  isInsideEdgelessEditor,\n  isInsidePageEditor,\n  matchFlavours,\n  Point,\n  Rect,\n} from '../../../_common/utils/index.js';\nimport { getScrollContainer } from '../../../_common/utils/scroll-container.js';\nimport type {\n  NoteBlockComponent,\n  NoteBlockModel,\n} from '../../../note-block/index.js';\nimport type { EdgelessRootBlockComponent } from '../../../root-block/edgeless/edgeless-root-block.js';\nimport {\n  getSelectedRect,\n  isTopLevelBlock,\n} from '../../../root-block/edgeless/utils/query.js';\nimport { PageRootBlockComponent } from '../../../root-block/page/page-root-block.js';\nimport type { RootBlockModel } from '../../../root-block/root-model.js';\nimport { autoScroll } from '../../../root-block/text-selection/utils.js';\nimport { SpecProvider } from '../../../specs/utils/spec-provider.js';\nimport { Bound, type IVec } from '../../../surface-block/index.js';\nimport type { EdgelessBlockModel } from '../../edgeless/edgeless-block-model.js';\nimport type { EdgelessTool } from '../../edgeless/types.js';\nimport { DragPreview } from './components/drag-preview.js';\nimport { DropIndicator } from './components/drop-indicator.js';\nimport type { DragHandleOption, DropResult, DropType } from './config.js';\nimport {\n  DRAG_HANDLE_CONTAINER_OFFSET_LEFT_TOP_LEVEL,\n  DRAG_HANDLE_CONTAINER_PADDING,\n  DRAG_HANDLE_CONTAINER_WIDTH,\n  DRAG_HANDLE_CONTAINER_WIDTH_TOP_LEVEL,\n  DRAG_HANDLE_GRABBER_BORDER_RADIUS,\n  DRAG_HANDLE_GRABBER_HEIGHT,\n  DRAG_HANDLE_GRABBER_WIDTH,\n  DRAG_HANDLE_GRABBER_WIDTH_HOVERED,\n  DRAG_HOVER_RECT_PADDING,\n  DragHandleOptionsRunner,\n  HOVER_AREA_RECT_PADDING_TOP_LEVEL,\n} from './config.js';\nimport { styles } from './styles.js';\nimport {\n  calcDropTarget,\n  captureEventTarget,\n  containBlock,\n  containChildBlock,\n  getClosestBlockByPoint,\n  getClosestNoteBlock,\n  getDragHandleContainerHeight,\n  getDragHandleLeftPadding,\n  getDuplicateBlocks,\n  getNoteId,\n  includeTextSelection,\n  insideDatabaseTable,\n  isBlockPathEqual,\n  isOutOfNoteBlock,\n  updateDragHandleClassName,\n} from './utils.js';\n\nexport const AFFINE_DRAG_HANDLE_WIDGET = 'affine-drag-handle-widget';\n\n@customElement(AFFINE_DRAG_HANDLE_WIDGET)\nexport class AffineDragHandleWidget extends WidgetElement<\n  RootBlockModel,\n  EdgelessRootBlockComponent | PageRootBlockComponent\n> {\n  get optionRunner() {\n    return AffineDragHandleWidget.staticOptionRunner;\n  }\n\n  get rootElement() {\n    return this.blockElement as\n      | PageRootBlockComponent\n      | EdgelessRootBlockComponent;\n  }\n\n  get selectedBlocks() {\n    // eslint-disable-next-line unicorn/prefer-array-some\n    return this.host.selection.find('text')\n      ? this.host.selection.filter('text')\n      : this.host.selection.filter('block');\n  }\n\n  get anchorBlockElement(): BlockElement | null {\n    if (!this._anchorBlockPath) return null;\n    return this._getBlockElementFromViewStore(this._anchorBlockPath);\n  }\n\n  get anchorEdgelessElement(): EdgelessBlockModel | null {\n    if (isInsidePageEditor(this.host) || !this._anchorBlockId) return null;\n    const { service } = this.rootElement as EdgelessRootBlockComponent;\n    const edgelessElement = service.getElementById(this._anchorBlockId);\n    return isTopLevelBlock(edgelessElement) ? edgelessElement : null;\n  }\n\n  private get _rangeManager() {\n    assertExists(this.host.rangeManager);\n    return this.host.rangeManager;\n  }\n\n  static override styles = styles;\n\n  static staticOptionRunner = new DragHandleOptionsRunner();\n\n  @query('.affine-drag-handle-container')\n  private accessor _dragHandleContainer!: HTMLDivElement;\n\n  @query('.affine-drag-handle-grabber')\n  private accessor _dragHandleGrabber!: HTMLDivElement;\n\n  @state()\n  private accessor _dragHoverRect: {\n    width: number;\n    height: number;\n    left: number;\n    top: number;\n  } | null = null;\n\n  private _lastHoveredBlockPath: string | null = null;\n\n  private _lastShowedBlock: { path: string; el: BlockElement } | null = null;\n\n  private _isHoverDragHandleVisible = false;\n\n  private _isDragHandleHovered = false;\n\n  private _isTopLevelDragHandleVisible = false;\n\n  private _anchorBlockId = '';\n\n  private _anchorBlockPath: string | null = null;\n\n  private _anchorModelDisposables: DisposableGroup | null = null;\n\n  private _throttledPointerMoveHandler = throttle<UIEventHandler>(ctx => {\n    if (this.doc.readonly || this.dragging || !this.isConnected) {\n      this._hide();\n      return;\n    }\n    if (this._isTopLevelDragHandleVisible) return;\n\n    const state = ctx.get('pointerState');\n    const { target } = state.raw;\n    const element = captureEventTarget(target);\n    // When pointer not on block or on dragging, should do nothing\n    if (!element) return;\n\n    // When pointer on drag handle, should do nothing\n    if (element.closest('.affine-drag-handle-container')) return;\n\n    // TODO: need to optimize\n    // When pointer out of note block hover area or inside database, should hide drag handle\n    const point = new Point(state.raw.x, state.raw.y);\n\n    const closestNoteBlock = getClosestNoteBlock(\n      this.host,\n      this.rootElement,\n      point\n    ) as NoteBlockComponent | null;\n\n    this.noteScale = isInsidePageEditor(this.host)\n      ? 1\n      : closestNoteBlock?.model.edgeless.scale ?? 1;\n\n    if (\n      closestNoteBlock &&\n      this._canEditing(closestNoteBlock) &&\n      !isOutOfNoteBlock(\n        this.host,\n        closestNoteBlock,\n        point,\n        this.scale * this.noteScale\n      )\n    ) {\n      this._pointerMoveOnBlock(state);\n      return true;\n    }\n\n    this._hide();\n    return false;\n  }, 1000 / 60);\n\n  draggingElements: BlockElement[] = [];\n\n  dropBlockId = '';\n\n  dropType: DropType | null = null;\n\n  dragging = false;\n\n  dragPreview: DragPreview | null = null;\n\n  dropIndicator: DropIndicator | null = null;\n\n  lastDragPointerState: PointerEventState | null = null;\n\n  scale = 1;\n\n  noteScale = 1;\n\n  cumulativeParentScale = 1;\n\n  center: IVec = [0, 0];\n\n  rafID = 0;\n\n  private get dragHandleContainerOffsetParent() {\n    return this._dragHandleContainer.parentElement!;\n  }\n\n  private get scrollContainer() {\n    return getScrollContainer(this.rootElement!);\n  }\n\n  private _clearRaf() {\n    if (this.rafID) {\n      cancelAnimationFrame(this.rafID);\n      this.rafID = 0;\n    }\n  }\n\n  /**\n   * When dragging, should update indicator position and target drop block id\n   */\n  private _getDropResult = (state: PointerEventState): DropResult | null => {\n    const point = new Point(state.raw.x, state.raw.y);\n    const closestBlockElement = getClosestBlockByPoint(\n      this.host,\n      this.rootElement,\n      point\n    );\n    if (!closestBlockElement) {\n      return null;\n    }\n\n    const blockId = closestBlockElement.model.id;\n    const blockPath = closestBlockElement.path;\n    const model = closestBlockElement.model;\n\n    const isDatabase = matchFlavours(model, ['affine:database']);\n    if (isDatabase) {\n      return null;\n    }\n\n    // note block can only be dropped into another note block\n    // prevent note block from being dropped into other blocks\n    const isDraggedElementNote =\n      this.draggingElements.length === 1 &&\n      matchFlavours(this.draggingElements[0].model, ['affine:note']);\n\n    if (isDraggedElementNote) {\n      const parent = this.std.doc.getParent(closestBlockElement.model);\n      if (!parent) return null;\n      const parentElement = this._getBlockElementFromViewStore(parent.id);\n      if (!parentElement) return null;\n      if (!matchFlavours(parentElement.model, ['affine:note'])) return null;\n    }\n\n    // Should make sure that target drop block is\n    // neither within the dragging elements\n    // nor a child-block of any dragging elements\n    if (\n      containBlock(\n        this.draggingElements.map(blockElement => blockElement.model.id),\n        blockId\n      ) ||\n      containChildBlock(this.draggingElements, blockPath)\n    ) {\n      return null;\n    }\n\n    let rect = null;\n    let dropType: DropType = 'before';\n\n    const result = calcDropTarget(\n      point,\n      model,\n      closestBlockElement,\n      this.draggingElements,\n      this.scale * this.cumulativeParentScale,\n      isDraggedElementNote === false\n    );\n\n    if (result) {\n      rect = result.rect;\n      dropType = result.dropType;\n    }\n\n    if (isDraggedElementNote && dropType === 'in') return null;\n\n    const dropIndicator = {\n      rect,\n      dropBlockId: blockId,\n      dropType,\n    };\n\n    return dropIndicator;\n  };\n\n  private _updateDropResult = (dropResult: DropResult | null) => {\n    assertExists(this.dropIndicator);\n    this.dropBlockId = dropResult?.dropBlockId ?? '';\n    this.dropType = dropResult?.dropType ?? null;\n    if (dropResult?.rect) {\n      const offsetParentRect =\n        this.dragHandleContainerOffsetParent.getBoundingClientRect();\n      let { left, top } = dropResult.rect;\n      left -= offsetParentRect.left;\n      top -= offsetParentRect.top;\n\n      left /= this.cumulativeParentScale;\n      top /= this.cumulativeParentScale;\n\n      let { width, height } = dropResult.rect;\n      width /= this.cumulativeParentScale;\n      height /= this.cumulativeParentScale;\n\n      const rect = Rect.fromLWTH(left, width, top, height);\n      this.dropIndicator.rect = rect;\n    } else {\n      this.dropIndicator.rect = dropResult?.rect ?? null;\n    }\n  };\n\n  private _resetDropResult = () => {\n    this.dropBlockId = '';\n    this.dropType = null;\n    if (this.dropIndicator) this.dropIndicator.rect = null;\n  };\n\n  private _createDropIndicator = () => {\n    if (!this.dropIndicator) {\n      this.dropIndicator = new DropIndicator();\n      this.rootElement.append(this.dropIndicator);\n    }\n  };\n\n  private _updateDropIndicator = (\n    state: PointerEventState,\n    shouldAutoScroll: boolean = false\n  ) => {\n    const point = new Point(state.raw.x, state.raw.y);\n    const closestNoteBlock = getClosestNoteBlock(\n      this.host,\n      this.rootElement,\n      point\n    );\n    if (\n      !closestNoteBlock ||\n      isOutOfNoteBlock(this.host, closestNoteBlock, point, this.scale)\n    ) {\n      this._resetDropResult();\n    } else {\n      const dropResult = this._getDropResult(state);\n      this._updateDropResult(dropResult);\n    }\n\n    this.lastDragPointerState = state;\n    if (this.rootElement instanceof PageRootBlockComponent) {\n      if (!shouldAutoScroll) return;\n\n      const result = autoScroll(this.scrollContainer, state.raw.y);\n      if (!result) {\n        this._clearRaf();\n        return;\n      }\n      this.rafID = requestAnimationFrame(() =>\n        this._updateDropIndicator(state, true)\n      );\n    } else {\n      this._clearRaf();\n    }\n  };\n\n  private _updateDropIndicatorOnScroll = () => {\n    if (\n      !this.dragging ||\n      this.draggingElements.length === 0 ||\n      !this.lastDragPointerState\n    )\n      return;\n\n    const state = this.lastDragPointerState;\n    this.rafID = requestAnimationFrame(() =>\n      this._updateDropIndicator(state, false)\n    );\n  };\n\n  private _removeDropIndicator = () => {\n    if (this.dropIndicator) {\n      this.dropIndicator.remove();\n      this.dropIndicator = null;\n    }\n  };\n\n  private _calculatePreviewOffset = (\n    blockElements: BlockElement[],\n    state: PointerEventState\n  ) => {\n    const { top, left } = blockElements[0].getBoundingClientRect();\n    const previewOffset = new Point(state.raw.x - left, state.raw.y - top);\n    return previewOffset;\n  };\n\n  private _calculateSelector = (selectedIds: string[]): BlockSelector => {\n    const ids: Array<{ id: string; type: BlockViewType }> = selectedIds.map(\n      id => ({\n        id,\n        type: BlockViewType.Display,\n      })\n    );\n\n    // The ancestors of the selected blocks should be rendered as Bypass\n    selectedIds.map(block => {\n      let parent: string | null = block;\n      do {\n        if (!selectedIds.includes(parent)) {\n          ids.push({ type: BlockViewType.Bypass, id: parent });\n        }\n        parent = this.doc.blockCollection.crud.getParent(parent);\n      } while (parent && !ids.map(({ id }) => id).includes(parent));\n    });\n\n    // The children of the selected blocks should be rendered as Display\n    const addChildren = (id: string) => {\n      const children = this.doc.getBlock(id)?.model.children ?? [];\n      children.forEach(child => {\n        ids.push({ type: BlockViewType.Display, id: child.id });\n        addChildren(child.id);\n      });\n    };\n    selectedIds.forEach(addChildren);\n\n    const selector: BlockSelector = block => {\n      const includes = ids.find(({ id }) => id === block.id);\n      if (includes) {\n        return includes.type;\n      }\n      return BlockViewType.Hidden;\n    };\n\n    return selector;\n  };\n\n  private _createDragPreview = (\n    blockElements: BlockElement[],\n    state: PointerEventState,\n    dragPreviewEl?: HTMLElement,\n    dragPreviewOffset?: Point\n  ): DragPreview => {\n    let dragPreview: DragPreview;\n    if (dragPreviewEl) {\n      dragPreview = new DragPreview(dragPreviewOffset);\n      dragPreview.append(dragPreviewEl);\n    } else {\n      let width = 0;\n      blockElements.forEach(element => {\n        width = Math.max(width, element.getBoundingClientRect().width);\n      });\n\n      const selectedIds = blockElements.map(\n        blockElement => blockElement.model.id\n      );\n\n      const selector = this._calculateSelector(selectedIds);\n\n      const doc = this.doc.blockCollection.getDoc({ selector });\n\n      const previewSpec = SpecProvider.getInstance().getSpec('page:preview');\n      const previewTemplate = this.host.renderSpecPortal(\n        doc,\n        previewSpec.value\n      );\n\n      const offset = this._calculatePreviewOffset(blockElements, state);\n      const posX = state.raw.x - offset.x;\n      const posY = state.raw.y - offset.y;\n      const altKey = state.raw.altKey;\n\n      dragPreview = new DragPreview(offset);\n      dragPreview.template = previewTemplate;\n      dragPreview.onRemove = () => {\n        this.doc.blockCollection.clearSelector(selector);\n      };\n      dragPreview.style.width = `${width / this.scale / this.noteScale / this.cumulativeParentScale}px`;\n      dragPreview.style.transform = `translate(${posX}px, ${posY}px) scale(${\n        this.scale * this.noteScale\n      })`;\n\n      dragPreview.style.opacity = altKey ? '1' : '0.5';\n    }\n    this.rootElement.append(dragPreview);\n    return dragPreview;\n  };\n\n  private _updateDragPreviewPosition = (state: PointerEventState) => {\n    if (!this.dragPreview) return;\n\n    const offsetParentRect =\n      this.dragHandleContainerOffsetParent.getBoundingClientRect();\n\n    const dragPreviewOffset = this.dragPreview.offset;\n\n    let posX = state.raw.x - dragPreviewOffset.x - offsetParentRect.left;\n    posX /= this.cumulativeParentScale;\n\n    let posY = state.raw.y - dragPreviewOffset.y - offsetParentRect.top;\n    posY /= this.cumulativeParentScale;\n\n    this.dragPreview.style.transform = `translate(${posX}px, ${posY}px) scale(${\n      this.scale * this.noteScale\n    })`;\n\n    const altKey = state.raw.altKey;\n    this.dragPreview.style.opacity = altKey ? '1' : '0.5';\n  };\n\n  private _updateDragPreviewOnViewportUpdate = () => {\n    if (this.dragPreview && this.lastDragPointerState) {\n      this._updateDragPreviewPosition(this.lastDragPointerState);\n    }\n  };\n\n  private _removeDragPreview = () => {\n    if (this.dragPreview) {\n      this.dragPreview.remove();\n      this.dragPreview = null;\n    }\n  };\n\n  private _changeCursorToGrabbing = () => {\n    document.documentElement.classList.add('affine-drag-preview-grabbing');\n  };\n\n  private _resetCursor = () => {\n    document.documentElement.classList.remove('affine-drag-preview-grabbing');\n  };\n\n  private _startDragging = (\n    blockElements: BlockElement[],\n    state: PointerEventState,\n    dragPreviewEl?: HTMLElement,\n    dragPreviewOffset?: Point\n  ) => {\n    if (!blockElements.length) {\n      return;\n    }\n\n    this.draggingElements = blockElements;\n\n    if (this.dragPreview) {\n      this._removeDragPreview();\n    }\n\n    this.dragPreview = this._createDragPreview(\n      blockElements,\n      state,\n      dragPreviewEl,\n      dragPreviewOffset\n    );\n\n    this.dragging = true;\n    this._changeCursorToGrabbing();\n    this._createDropIndicator();\n    this._hide();\n  };\n\n  private _hide = (force = false) => {\n    updateDragHandleClassName();\n\n    this._isHoverDragHandleVisible = false;\n    this._isTopLevelDragHandleVisible = false;\n    this._isDragHandleHovered = false;\n\n    this._anchorBlockId = '';\n    this._anchorBlockPath = null;\n\n    if (this._dragHandleContainer) {\n      this._dragHandleContainer.style.display = 'none';\n    }\n\n    if (force) {\n      this._reset();\n    }\n  };\n\n  private _reset = () => {\n    this.draggingElements = [];\n    this.dropBlockId = '';\n    this.dropType = null;\n    this.lastDragPointerState = null;\n    this.rafID = 0;\n    this.dragging = false;\n\n    this._dragHoverRect = null;\n    this._lastHoveredBlockPath = null;\n    this._lastShowedBlock = null;\n    this._anchorBlockId = '';\n    this._anchorBlockPath = null;\n    this._isHoverDragHandleVisible = false;\n    this._isDragHandleHovered = false;\n    this._isTopLevelDragHandleVisible = false;\n\n    this._removeDragPreview();\n    this._removeDropIndicator();\n    this._resetCursor();\n  };\n\n  private _handleAnchorModelDisposables = (blockModel: BlockModel) => {\n    if (this._anchorModelDisposables) {\n      this._anchorModelDisposables.dispose();\n      this._anchorModelDisposables = null;\n    }\n\n    this._anchorModelDisposables = new DisposableGroup();\n    this._anchorModelDisposables.add(\n      blockModel.propsUpdated.on(() => this._hide())\n    );\n\n    this._anchorModelDisposables.add(blockModel.deleted.on(() => this._hide()));\n  };\n\n  private _getBlockElementFromViewStore = (path: string) => {\n    return this.host.view.getBlock(path);\n  };\n\n  // Need to consider block padding and scale\n  private _getTopWithBlockElement = (blockElement: BlockElement) => {\n    const computedStyle = getComputedStyle(blockElement);\n    const { top } = blockElement.getBoundingClientRect();\n    const paddingTop = parseInt(computedStyle.paddingTop) * this.scale;\n    return (\n      (top +\n        paddingTop +\n        this.dragHandleContainerOffsetParent.getBoundingClientRect().top) /\n      this.cumulativeParentScale\n    );\n  };\n\n  /** Check if given blockElement is selected */\n  private _isBlockSelected = (block?: BlockElement) => {\n    if (!block) return false;\n    return this.selectedBlocks.some(\n      selection => selection.blockId === block.model.id\n    );\n  };\n\n  // Single block: drag handle should show on the vertical middle of the first line of element\n  // Multiple blocks: drag handle should show on the vertical middle of all blocks\n  private _showDragHandleOnHoverBlock = (blockPath: string) => {\n    const blockElement = this._getBlockElementFromViewStore(blockPath);\n    if (!blockElement) return;\n\n    const container = this._dragHandleContainer;\n    const grabber = this._dragHandleGrabber;\n    if (!container || !grabber) return;\n\n    this._isHoverDragHandleVisible = true;\n\n    const draggingAreaRect = this._getDraggingAreaRect(blockElement);\n\n    // Some blocks have padding, should consider padding when calculating position\n\n    const containerHeight = getDragHandleContainerHeight(blockElement.model);\n\n    // Ad-hoc solution for list with toggle icon\n    updateDragHandleClassName([blockElement]);\n    // End of ad-hoc solution\n\n    const posTop = this._getTopWithBlockElement(blockElement);\n\n    const rowPaddingY =\n      ((containerHeight - DRAG_HANDLE_GRABBER_HEIGHT) / 2) *\n      this.scale *\n      this.noteScale;\n\n    // use padding to control grabber's height\n    const paddingTop = rowPaddingY + posTop - draggingAreaRect.top;\n    const paddingBottom =\n      draggingAreaRect.height -\n      paddingTop -\n      DRAG_HANDLE_GRABBER_HEIGHT * this.scale * this.noteScale;\n\n    const applyStyle = (transition?: boolean) => {\n      container.style.transition = transition ? 'padding 0.25s ease' : 'none';\n      container.style.paddingTop = `${paddingTop}px`;\n      container.style.paddingBottom = `${paddingBottom}px`;\n      container.style.width = `${\n        DRAG_HANDLE_CONTAINER_WIDTH * this.scale * this.noteScale\n      }px`;\n      container.style.left = `${draggingAreaRect.left}px`;\n      container.style.top = `${draggingAreaRect.top}px`;\n      container.style.display = 'flex';\n      container.style.height = `${draggingAreaRect.height}px`;\n    };\n\n    if (isBlockPathEqual(blockElement.blockId, this._lastShowedBlock?.path)) {\n      applyStyle(true);\n    } else if (this.selectedBlocks.length) {\n      if (this._isBlockSelected(blockElement))\n        applyStyle(\n          this._isDragHandleHovered &&\n            this._isBlockSelected(this._lastShowedBlock?.el)\n        );\n      else applyStyle(false);\n    } else {\n      applyStyle(false);\n    }\n\n    grabber.style.width = `${\n      DRAG_HANDLE_GRABBER_WIDTH * this.scale * this.noteScale\n    }px`;\n    grabber.style.borderRadius = `${\n      DRAG_HANDLE_GRABBER_BORDER_RADIUS * this.scale * this.noteScale\n    }px`;\n\n    this._handleAnchorModelDisposables(blockElement.model);\n    if (!isBlockPathEqual(blockElement.blockId, this._lastShowedBlock?.path)) {\n      this._lastShowedBlock = {\n        path: blockElement.blockId,\n        el: blockElement,\n      };\n    }\n  };\n\n  private _showDragHandleOnTopLevelBlocks = async () => {\n    if (isInsidePageEditor(this.host)) return;\n    const edgelessRoot = this.rootElement as EdgelessRootBlockComponent;\n    await edgelessRoot.surface.updateComplete;\n\n    if (!this._anchorBlockPath) return;\n    const blockElement = this.anchorBlockElement;\n    assertExists(blockElement);\n\n    const edgelessElement = edgelessRoot.service.getElementById(\n      blockElement.model.id\n    );\n    assertExists(edgelessElement);\n\n    const container = this._dragHandleContainer;\n    const grabber = this._dragHandleGrabber;\n    if (!container || !grabber) return;\n\n    const rect = getSelectedRect([edgelessElement]);\n    const [left, top] = edgelessRoot.service.viewport.toViewCoord(\n      rect.left,\n      rect.top\n    );\n    const height = rect.height * this.scale;\n\n    const posLeft =\n      left -\n      (DRAG_HANDLE_CONTAINER_WIDTH_TOP_LEVEL +\n        DRAG_HANDLE_CONTAINER_OFFSET_LEFT_TOP_LEVEL) *\n        this.scale;\n\n    const posTop = top;\n\n    container.style.transition = 'none';\n    container.style.paddingTop = `0px`;\n    container.style.paddingBottom = `0px`;\n    container.style.width = `${\n      DRAG_HANDLE_CONTAINER_WIDTH_TOP_LEVEL * this.scale\n    }px`;\n    container.style.left = `${posLeft}px`;\n    container.style.top = `${posTop}px`;\n    container.style.display = 'flex';\n    container.style.height = `${height}px`;\n\n    grabber.style.width = `${DRAG_HANDLE_GRABBER_WIDTH_HOVERED * this.scale}px`;\n    grabber.style.borderRadius = `${\n      DRAG_HANDLE_GRABBER_BORDER_RADIUS * this.scale\n    }px`;\n\n    this._handleAnchorModelDisposables(blockElement.model);\n\n    this._isTopLevelDragHandleVisible = true;\n  };\n\n  private _getHoveredBlocks = (): BlockElement[] => {\n    if (!this._isHoverDragHandleVisible || !this._anchorBlockPath) return [];\n\n    const hoverBlock = this.anchorBlockElement;\n    assertExists(hoverBlock);\n\n    const selections = this.selectedBlocks;\n    let blockElements: BlockElement[] = [];\n\n    // When current selection is TextSelection, should cover all the blocks in native range\n    if (selections.length > 0 && includeTextSelection(selections)) {\n      const range = getCurrentNativeRange();\n      if (!range) return [];\n      blockElements = this._rangeManager.getSelectedBlockElementsByRange(\n        range,\n        {\n          match: el => el.model.role === 'content',\n          mode: 'highest',\n        }\n      );\n    } else {\n      blockElements = this.selectedBlocks\n        .map(block => this._getBlockElementFromViewStore(block.blockId))\n        .filter((block): block is BlockElement => !!block);\n    }\n\n    if (\n      containBlock(\n        blockElements.map(block => PathFinder.id(block.path)),\n        this._anchorBlockPath\n      )\n    ) {\n      return blockElements;\n    }\n\n    return [hoverBlock];\n  };\n\n  private _getDraggingAreaRect = (blockElement: BlockElement): Rect => {\n    // When hover block is in selected blocks, should show hover rect on the selected blocks\n    // Top: the top of the first selected block\n    // Left: the left of the first selected block\n    // Right: the largest right of the selected blocks\n    // Bottom: the bottom of the last selected block\n    let { left, top, right, bottom } = blockElement.getBoundingClientRect();\n\n    const blockElements = this._getHoveredBlocks();\n\n    blockElements.forEach(blockElement => {\n      left = Math.min(left, blockElement.getBoundingClientRect().left);\n      top = Math.min(top, blockElement.getBoundingClientRect().top);\n      right = Math.max(right, blockElement.getBoundingClientRect().right);\n      bottom = Math.max(bottom, blockElement.getBoundingClientRect().bottom);\n    });\n\n    const offsetLeft = getDragHandleLeftPadding(blockElements);\n\n    const offsetParentRect =\n      this.dragHandleContainerOffsetParent.getBoundingClientRect();\n    assertExists(offsetParentRect);\n\n    left -= offsetParentRect.left;\n    right -= offsetParentRect.left;\n    top -= offsetParentRect.top;\n    bottom -= offsetParentRect.top;\n\n    left /= this.cumulativeParentScale;\n    right /= this.cumulativeParentScale;\n    top /= this.cumulativeParentScale;\n    bottom /= this.cumulativeParentScale;\n\n    // Add padding to hover rect\n    left -=\n      (DRAG_HANDLE_CONTAINER_WIDTH + offsetLeft) * this.scale * this.noteScale;\n    top -= DRAG_HOVER_RECT_PADDING * this.scale;\n    right += DRAG_HOVER_RECT_PADDING * this.scale;\n    bottom += DRAG_HOVER_RECT_PADDING * this.scale;\n\n    return new Rect(left, top, right, bottom);\n  };\n\n  private _getHoverAreaRectTopLevelBlock(\n    edgelessElement: EdgelessBlockModel\n  ): Rect | null {\n    if (isInsidePageEditor(this.host)) return null;\n    const edgelessRoot = this.rootElement as EdgelessRootBlockComponent;\n\n    const rect = getSelectedRect([edgelessElement]);\n    let [left, top] = edgelessRoot.service.viewport.toViewCoord(\n      rect.left,\n      rect.top\n    );\n    const width = rect.width * this.scale;\n    const height = rect.height * this.scale;\n\n    let [right, bottom] = [left + width, top + height];\n\n    const offsetLeft = DRAG_HANDLE_CONTAINER_OFFSET_LEFT_TOP_LEVEL * this.scale;\n    const padding = HOVER_AREA_RECT_PADDING_TOP_LEVEL * this.scale;\n\n    left -= DRAG_HANDLE_CONTAINER_WIDTH_TOP_LEVEL * this.scale + offsetLeft;\n    top -= padding;\n    right += padding;\n    bottom += padding;\n\n    return new Rect(left, top, right, bottom);\n  }\n\n  private _updateDragHoverRectTopLevelBlock = () => {\n    if (!this._dragHoverRect) return;\n\n    const edgelessElement = this.anchorEdgelessElement;\n\n    if (edgelessElement) {\n      this._dragHoverRect =\n        this._getHoverAreaRectTopLevelBlock(edgelessElement);\n    }\n  };\n\n  private _setSelectedBlocks = (\n    blockElements: BlockElement[],\n    noteId?: string\n  ) => {\n    const { selection } = this.host;\n    const selections = blockElements.map(blockElement =>\n      selection.create('block', {\n        blockId: blockElement.blockId,\n      })\n    );\n\n    // When current page is edgeless page\n    // We need to remain surface selection and set editing as true\n    if (isInsideEdgelessEditor(this.host)) {\n      const surfaceElementId = noteId ? noteId : getNoteId(blockElements[0]);\n      const surfaceSelection = selection.create(\n        'surface',\n        blockElements[0]!.blockId,\n        [surfaceElementId],\n        true\n      );\n\n      selections.push(surfaceSelection);\n    }\n\n    selection.set(selections);\n  };\n\n  private _canEditing = (noteBlock: BlockElement) => {\n    if (noteBlock.doc.id !== this.doc.id) return false;\n\n    if (isInsidePageEditor(this.host)) return true;\n    const edgelessRoot = this.rootElement as EdgelessRootBlockComponent;\n\n    const noteBlockId = noteBlock.path[noteBlock.path.length - 1];\n    return (\n      edgelessRoot.service.selection.editing &&\n      edgelessRoot.service.selection.selectedIds[0] === noteBlockId\n    );\n  };\n\n  private _checkTopLevelBlockSelection = () => {\n    if (!this.isConnected) {\n      return;\n    }\n\n    if (this.doc.readonly || isInsidePageEditor(this.host)) {\n      this._hide();\n      return;\n    }\n\n    const edgelessRoot = this.rootElement as EdgelessRootBlockComponent;\n    const editing = edgelessRoot.service.selection.editing;\n    const selectedElements = edgelessRoot.service.selection.selectedElements;\n    if (editing || selectedElements.length !== 1) {\n      this._hide();\n      return;\n    }\n\n    const selectedElement = selectedElements[0];\n    if (!isTopLevelBlock(selectedElement)) {\n      this._hide();\n      return;\n    }\n\n    const flavour = selectedElement.flavour;\n    const dragHandleOptions = this.optionRunner.getOption(flavour);\n    if (!dragHandleOptions || !dragHandleOptions.edgeless) {\n      this._hide();\n      return;\n    }\n\n    const selections = edgelessRoot.service.selection.surfaceSelections;\n\n    this._anchorBlockId = selectedElement.id;\n    this._anchorBlockPath = selections[0].blockId;\n\n    this._showDragHandleOnTopLevelBlocks().catch(console.error);\n  };\n\n  /**\n   * When pointer move on block, should show drag handle\n   * And update hover block id and path\n   */\n  private _pointerMoveOnBlock = (state: PointerEventState) => {\n    if (this._isTopLevelDragHandleVisible) return;\n\n    const point = new Point(state.raw.x, state.raw.y);\n    const closestBlockElement = getClosestBlockByPoint(\n      this.host,\n      this.rootElement,\n      point\n    );\n    if (!closestBlockElement) {\n      this._anchorBlockId = '';\n      this._anchorBlockPath = null;\n      return;\n    }\n\n    const blockId = closestBlockElement.getAttribute(this.host.blockIdAttr);\n    assertExists(blockId);\n\n    this._anchorBlockId = blockId;\n    this._anchorBlockPath = closestBlockElement.blockId;\n\n    if (insideDatabaseTable(closestBlockElement) || this.doc.readonly) {\n      this._hide();\n      return;\n    }\n\n    // If current block is not the last hovered block, show drag handle beside the hovered block\n    if (\n      (!this._lastHoveredBlockPath ||\n        !isBlockPathEqual(this._anchorBlockPath, this._lastHoveredBlockPath) ||\n        !this._isHoverDragHandleVisible) &&\n      !this._isDragHandleHovered\n    ) {\n      this._showDragHandleOnHoverBlock(this._anchorBlockPath);\n      this._lastHoveredBlockPath = this._anchorBlockPath;\n    }\n  };\n\n  /**\n   * When click on drag handle\n   * Should select the block and show slash menu if current block is not selected\n   * Should clear selection if current block is the first selected block\n   */\n  private _clickHandler: UIEventHandler = ctx => {\n    if (!this._isHoverDragHandleVisible) return;\n\n    const state = ctx.get('pointerState');\n    const { target } = state.raw;\n    const element = captureEventTarget(target);\n    const insideDragHandle = !!element?.closest(AFFINE_DRAG_HANDLE_WIDGET);\n    if (!insideDragHandle) return;\n\n    if (!this._anchorBlockId || !this._anchorBlockPath) return;\n\n    const { selection } = this.host;\n    const selectedBlocks = this.selectedBlocks;\n\n    // Should clear selection if current block is the first selected block\n    if (\n      selectedBlocks.length > 0 &&\n      !includeTextSelection(selectedBlocks) &&\n      selectedBlocks[0].blockId === this._anchorBlockId\n    ) {\n      selection.clear(['block']);\n      this._dragHoverRect = null;\n      this._showDragHandleOnHoverBlock(this._anchorBlockPath);\n      return;\n    }\n\n    // Should select the block if current block is not selected\n    const blockElement = this.anchorBlockElement;\n    assertExists(blockElement);\n\n    if (selectedBlocks.length > 1) {\n      this._showDragHandleOnHoverBlock(this._anchorBlockPath);\n    }\n\n    this._setSelectedBlocks([blockElement]);\n\n    return true;\n  };\n\n  private _onDragStart = (state: PointerEventState) => {\n    const event = state.raw;\n    const { target } = event;\n    const element = captureEventTarget(target);\n    const insideDragHandle = !!element?.closest(AFFINE_DRAG_HANDLE_WIDGET);\n    // Should only start dragging when pointer down on drag handle\n    // And current mouse button is left button\n    if (!insideDragHandle) {\n      this._hide();\n      return false;\n    }\n\n    if (!this._isHoverDragHandleVisible) return;\n    // Get current hover block element by path\n    assertExists(this._anchorBlockId);\n    assertExists(this._anchorBlockPath);\n    const hoverBlockElement = this.anchorBlockElement;\n    if (!hoverBlockElement) return false;\n\n    let selections = this.selectedBlocks;\n\n    // When current selection is TextSelection\n    // Should set BlockSelection for the blocks in native range\n    if (selections.length > 0 && includeTextSelection(selections)) {\n      const nativeSelection = document.getSelection();\n      if (nativeSelection && nativeSelection.rangeCount > 0) {\n        const range = nativeSelection.getRangeAt(0);\n        const blockElements =\n          this._rangeManager.getSelectedBlockElementsByRange(range, {\n            match: el => el.model.role === 'content',\n            mode: 'highest',\n          });\n        this._setSelectedBlocks(blockElements);\n        selections = this.selectedBlocks;\n      }\n    }\n\n    // When there is no selected blocks\n    // Or selected blocks not including current hover block\n    // Set current hover block as selected\n    if (\n      selections.length === 0 ||\n      !containBlock(\n        selections.map(selection => selection.blockId),\n        this._anchorBlockId\n      )\n    ) {\n      const blockElement = this.anchorBlockElement;\n      assertExists(blockElement);\n      this._setSelectedBlocks([blockElement]);\n    }\n\n    const blockElements = this.selectedBlocks\n      .map(selection => {\n        return this._getBlockElementFromViewStore(selection.blockId);\n      })\n      .filter((element): element is BlockElement<BlockModel> => !!element);\n\n    // This could be skip if we can ensure that all selected blocks are on the same level\n    // Which means not selecting parent block and child block at the same time\n    const blockElementsExcludingChildren = getBlockElementsExcludeSubtrees(\n      blockElements\n    ) as BlockElement[];\n\n    if (blockElementsExcludingChildren.length === 0) return false;\n\n    this._startDragging(blockElementsExcludingChildren, state);\n    this._hide();\n    return true;\n  };\n\n  private _onDragMove = (state: PointerEventState) => {\n    this._clearRaf();\n\n    this.rafID = requestAnimationFrame(() => {\n      this._updateDragPreviewPosition(state);\n      this._updateDropIndicator(state, true);\n    });\n    return true;\n  };\n\n  private _onDragEnd = (state: PointerEventState) => {\n    const targetBlockId = this.dropBlockId;\n    const dropType = this.dropType;\n    const draggingElements = this.draggingElements;\n    this._hide(true);\n\n    // handle drop of blocks from note onto edgeless container\n    if (!targetBlockId) {\n      const target = captureEventTarget(state.raw.target);\n      if (!target) return false;\n\n      const isTargetEdgelessContainer =\n        target.classList.contains('edgeless') &&\n        target.classList.contains('affine-block-children-container');\n      if (!isTargetEdgelessContainer) return false;\n\n      const selectedBlocks = getBlockElementsExcludeSubtrees(draggingElements)\n        .map(element => getModelByBlockComponent(element))\n        .filter((x): x is BlockModel => !!x);\n      if (selectedBlocks.length === 0) return false;\n\n      const isSurfaceComponent = selectedBlocks.some(block => {\n        const parent = this.doc.getParent(block.id);\n        return matchFlavours(parent, ['affine:surface']);\n      });\n      if (isSurfaceComponent) return true;\n\n      const edgelessRoot = this.rootElement as EdgelessRootBlockComponent;\n\n      const { left: viewportLeft, top: viewportTop } = edgelessRoot.viewport;\n\n      const newNoteId = edgelessRoot.addNoteWithPoint(\n        new Point(state.raw.x - viewportLeft, state.raw.y - viewportTop),\n        {\n          scale: this.noteScale,\n        }\n      );\n      const newNoteBlock = this.doc.getBlockById(newNoteId) as NoteBlockModel;\n      assertExists(newNoteBlock);\n\n      const bound = Bound.deserialize(newNoteBlock.xywh);\n      bound.h *= this.noteScale;\n      bound.w *= this.noteScale;\n      this.doc.updateBlock(newNoteBlock, {\n        xywh: bound.serialize(),\n        edgeless: {\n          ...newNoteBlock.edgeless,\n          scale: this.noteScale,\n        },\n      });\n\n      const altKey = state.raw.altKey;\n      if (altKey) {\n        const duplicateBlocks = getDuplicateBlocks(selectedBlocks);\n\n        this.doc.addBlocks(duplicateBlocks, newNoteBlock);\n      } else {\n        this.doc.moveBlocks(selectedBlocks, newNoteBlock);\n      }\n\n      edgelessRoot.service.selection.set({\n        elements: [newNoteBlock.id],\n        editing: true,\n      });\n\n      return true;\n    }\n\n    // Should make sure drop block id is not in selected blocks\n    if (\n      containBlock(\n        this.selectedBlocks.map(selection => selection.blockId),\n        targetBlockId\n      )\n    ) {\n      return false;\n    }\n\n    const selectedBlocks = getBlockElementsExcludeSubtrees(draggingElements)\n      .map(element => getModelByBlockComponent(element))\n      .filter((x): x is BlockModel => !!x);\n    if (!selectedBlocks.length) {\n      return false;\n    }\n\n    const targetBlock = this.doc.getBlockById(targetBlockId);\n    assertExists(targetBlock);\n\n    const shouldInsertIn = dropType === 'in';\n\n    const parent = shouldInsertIn\n      ? targetBlock\n      : this.doc.getParent(targetBlockId);\n    assertExists(parent);\n\n    const altKey = state.raw.altKey;\n\n    if (shouldInsertIn) {\n      if (altKey) {\n        const duplicateBlocks = getDuplicateBlocks(selectedBlocks);\n\n        this.doc.addBlocks(duplicateBlocks, targetBlock);\n      } else {\n        this.doc.moveBlocks(selectedBlocks, targetBlock);\n      }\n    } else {\n      if (altKey) {\n        const duplicateBlocks = getDuplicateBlocks(selectedBlocks);\n\n        const parentIndex =\n          parent.children.indexOf(targetBlock) + (dropType === 'after' ? 1 : 0);\n\n        this.doc.addBlocks(duplicateBlocks, parent, parentIndex);\n      } else {\n        this.doc.moveBlocks(\n          selectedBlocks,\n          parent,\n          targetBlock,\n          dropType === 'before'\n        );\n      }\n    }\n\n    // TODO: need a better way to update selection\n    // Should update selection after moving blocks\n    // In doc page mode, update selected blocks\n    // In edgeless mode, focus on the first block\n    setTimeout(() => {\n      assertExists(parent);\n      // Need to update selection when moving blocks successfully\n      // Because the block path may be changed after moving\n      const parentElement = this._getBlockElementFromViewStore(parent.id);\n      if (parentElement) {\n        const newSelectedBlocks = selectedBlocks.map(block => {\n          return this.std.view.getBlock(block.id);\n        });\n        if (!newSelectedBlocks) return;\n\n        const noteId = getNoteId(parentElement);\n        this._setSelectedBlocks(newSelectedBlocks as BlockElement[], noteId);\n      }\n    }, 0);\n\n    return true;\n  };\n\n  /**\n   * When start dragging, should set dragging elements and create drag preview\n   */\n  private _dragStartHandler: UIEventHandler = ctx => {\n    const state = ctx.get('pointerState');\n    // If not click left button to start dragging, should do nothing\n    const { button } = state.raw;\n    if (button !== 0) {\n      return false;\n    }\n\n    // call default drag start handler if no option return true\n    for (const option of this.optionRunner.options) {\n      if (\n        option.onDragStart?.({\n          state,\n          startDragging: this._startDragging,\n          anchorBlockId: this._anchorBlockId,\n          anchorBlockPath: this._anchorBlockPath,\n          editorHost: this.host,\n        })\n      ) {\n        return true;\n      }\n    }\n    return this._onDragStart(state);\n  };\n\n  /**\n   * When dragging, should:\n   * Update drag preview position\n   * Update indicator position\n   * Update drop block id\n   */\n  private _dragMoveHandler: UIEventHandler = ctx => {\n    if (this._isHoverDragHandleVisible || this._isTopLevelDragHandleVisible) {\n      this._hide();\n    }\n\n    if (!this.dragging || this.draggingElements.length === 0) {\n      return false;\n    }\n\n    ctx.get('defaultState').event.preventDefault();\n    const state = ctx.get('pointerState');\n\n    for (const option of this.optionRunner.options) {\n      if (option.onDragMove?.(state, this.draggingElements)) {\n        return true;\n      }\n    }\n\n    // call default drag move handler if no option return true\n    return this._onDragMove(state);\n  };\n\n  /**\n   * When drag end, should move blocks to drop position\n   * @returns\n   */\n  private _dragEndHandler: UIEventHandler = ctx => {\n    this._clearRaf();\n    if (!this.dragging || !this.dragPreview) return false;\n    if (this.draggingElements.length === 0 || this.doc.readonly) {\n      this._hide(true);\n      return false;\n    }\n\n    const state = ctx.get('pointerState');\n    const { target } = state.raw;\n    if (!this.host.contains(target as Node)) {\n      this._hide(true);\n      return true;\n    }\n\n    for (const option of this.optionRunner.options) {\n      if (\n        option.onDragEnd?.({\n          state,\n          draggingElements: this.draggingElements,\n          dropBlockId: this.dropBlockId,\n          dropType: this.dropType,\n          dragPreview: this.dragPreview,\n          noteScale: this.noteScale,\n          editorHost: this.host,\n        })\n      ) {\n        this._hide(true);\n        if (isInsideEdgelessEditor(this.host)) {\n          this._checkTopLevelBlockSelection();\n        }\n        return true;\n      }\n    }\n\n    // call default drag end handler if no option return true\n    this._onDragEnd(state);\n\n    if (isInsideEdgelessEditor(this.host)) {\n      this._checkTopLevelBlockSelection();\n    }\n\n    return true;\n  };\n\n  private _pointerOutHandler: UIEventHandler = ctx => {\n    const state = ctx.get('pointerState');\n    state.raw.preventDefault();\n\n    const { target } = state.raw;\n    const element = captureEventTarget(target);\n    if (!element) return;\n\n    const { relatedTarget } = state.raw;\n    // TODO: when pointer out of page viewport, should hide drag handle\n    // But the pointer out event is not as expected\n    // Need to be optimized\n    const relatedElement = captureEventTarget(relatedTarget);\n    const outOfPageViewPort = element.classList.contains(\n      'affine-page-viewport'\n    );\n    const inPage = !!relatedElement?.closest('.affine-page-viewport');\n\n    const inDragHandle = !!relatedElement?.closest(AFFINE_DRAG_HANDLE_WIDGET);\n    if (outOfPageViewPort && !inDragHandle && !inPage) {\n      this._hide();\n    }\n  };\n\n  private _keyboardHandler: UIEventHandler = ctx => {\n    if (!this.dragging || !this.dragPreview) {\n      return;\n    }\n\n    const state = ctx.get('defaultState');\n    const event = state.event as KeyboardEvent;\n    event.preventDefault();\n    event.stopPropagation();\n\n    const altKey = event.key === 'Alt' && event.altKey;\n    this.dragPreview.style.opacity = altKey ? '1' : '0.5';\n  };\n\n  private _onDragHandlePointerEnter = () => {\n    const container = this._dragHandleContainer;\n    const grabber = this._dragHandleGrabber;\n    if (!container || !grabber) return;\n\n    if (this._isHoverDragHandleVisible) {\n      assertExists(this._anchorBlockPath);\n      const blockElement = this.anchorBlockElement;\n      if (!blockElement) return;\n\n      const padding = DRAG_HANDLE_CONTAINER_PADDING * this.scale;\n      container.style.paddingTop = `${padding}px`;\n      container.style.paddingBottom = `${padding}px`;\n      container.style.transition = `padding 0.25s ease`;\n\n      grabber.style.width = `${\n        DRAG_HANDLE_GRABBER_WIDTH_HOVERED * this.scale * this.noteScale\n      }px`;\n      grabber.style.borderRadius = `${\n        DRAG_HANDLE_GRABBER_BORDER_RADIUS * this.scale * this.noteScale\n      }px`;\n\n      this._isDragHandleHovered = true;\n    } else if (this._isTopLevelDragHandleVisible) {\n      const edgelessElement = this.anchorEdgelessElement;\n      if (!edgelessElement) return;\n\n      this._dragHoverRect =\n        this._getHoverAreaRectTopLevelBlock(edgelessElement);\n      this._isDragHandleHovered = true;\n    }\n  };\n\n  private _onDragHandlePointerDown = () => {\n    if (!this._isHoverDragHandleVisible || !this._anchorBlockPath) return;\n\n    const blockElement = this.anchorBlockElement;\n    if (!blockElement) return;\n\n    this._dragHoverRect = this._getDraggingAreaRect(blockElement) ?? null;\n  };\n\n  private _onDragHandlePointerUp = () => {\n    if (!this._isHoverDragHandleVisible) return;\n    this._dragHoverRect = null;\n  };\n\n  private _onDragHandlePointerLeave = () => {\n    this._isDragHandleHovered = false;\n    this._dragHoverRect = null;\n\n    if (this._isTopLevelDragHandleVisible) return;\n\n    if (this.dragging) return;\n\n    if (!this._anchorBlockPath) return;\n    this._showDragHandleOnHoverBlock(this._anchorBlockPath);\n  };\n\n  private _handleEdgelessToolUpdated = (newTool: EdgelessTool) => {\n    if (newTool.type === 'default') {\n      this._checkTopLevelBlockSelection();\n    } else {\n      this._hide();\n    }\n  };\n\n  private _handleEdgelessViewPortUpdated = ({\n    zoom,\n    center,\n  }: {\n    zoom: number;\n    center: IVec;\n  }) => {\n    if (this.scale !== zoom) {\n      this.scale = zoom;\n      this._updateDragPreviewOnViewportUpdate();\n    }\n\n    if (this.center[0] !== center[0] && this.center[1] !== center[1]) {\n      this.center = [...center];\n      this._updateDropIndicatorOnScroll();\n    }\n\n    if (this._isTopLevelDragHandleVisible) {\n      this._showDragHandleOnTopLevelBlocks().catch(console.error);\n      this._updateDragHoverRectTopLevelBlock();\n    } else {\n      this._hide();\n    }\n  };\n\n  override firstUpdated() {\n    this._hide(true);\n\n    // When pointer enter drag handle grabber\n    // Extend drag handle grabber to the height of the hovered block\n    this._disposables.addFromEvent(\n      this._dragHandleContainer,\n      'pointerenter',\n      this._onDragHandlePointerEnter\n    );\n\n    this._disposables.addFromEvent(\n      this._dragHandleContainer,\n      'pointerdown',\n      this._onDragHandlePointerDown\n    );\n\n    this._disposables.addFromEvent(\n      this._dragHandleContainer,\n      'pointerup',\n      this._onDragHandlePointerUp\n    );\n\n    // When pointer leave drag handle grabber, should reset drag handle grabber style\n    this._disposables.addFromEvent(\n      this._dragHandleContainer,\n      'pointerleave',\n      this._onDragHandlePointerLeave\n    );\n\n    this._disposables.addFromEvent(this.host, 'pointerleave', () => {\n      this._hide();\n    });\n\n    if (isInsidePageEditor(this.host)) {\n      this._disposables.add(this.doc.slots.blockUpdated.on(() => this._hide()));\n\n      const pageRoot = this.rootElement as PageRootBlockComponent;\n      this._disposables.add(\n        pageRoot.slots.viewportUpdated.on(() => {\n          this._hide();\n          if (this.dropIndicator) {\n            this.dropIndicator.rect = null;\n          }\n        })\n      );\n\n      this._disposables.addFromEvent(\n        this.scrollContainer,\n        'scrollend',\n        this._updateDropIndicatorOnScroll\n      );\n    } else if (isInsideEdgelessEditor(this.host)) {\n      const edgelessRoot = this.rootElement as EdgelessRootBlockComponent;\n\n      this._disposables.add(\n        edgelessRoot.slots.edgelessToolUpdated.on(\n          this._handleEdgelessToolUpdated\n        )\n      );\n\n      this._disposables.add(\n        edgelessRoot.service.viewport.viewportUpdated.on(\n          this._handleEdgelessViewPortUpdated\n        )\n      );\n\n      this._disposables.add(\n        edgelessRoot.service.selection.slots.updated.on(() => {\n          this._checkTopLevelBlockSelection();\n        })\n      );\n\n      this._disposables.add(\n        edgelessRoot.slots.readonlyUpdated.on(() => {\n          this._checkTopLevelBlockSelection();\n        })\n      );\n\n      this._disposables.add(\n        edgelessRoot.slots.draggingAreaUpdated.on(() => {\n          this._checkTopLevelBlockSelection();\n        })\n      );\n\n      this._disposables.add(\n        edgelessRoot.slots.elementResizeStart.on(() => {\n          this._hide();\n        })\n      );\n\n      this._disposables.add(\n        edgelessRoot.slots.elementResizeEnd.on(() => {\n          this._checkTopLevelBlockSelection();\n        })\n      );\n    }\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this.disposables.addFromEvent(this, 'pointerdown', e => {\n      e.preventDefault();\n    });\n\n    this.handleEvent('pointerMove', this._throttledPointerMoveHandler);\n    this.handleEvent('click', this._clickHandler);\n    this.handleEvent('dragStart', this._dragStartHandler);\n    this.handleEvent('dragMove', this._dragMoveHandler);\n    this.handleEvent('dragEnd', this._dragEndHandler, { global: true });\n    this.handleEvent('pointerOut', this._pointerOutHandler);\n    this.handleEvent('beforeInput', () => this._hide());\n    this.handleEvent('keyDown', this._keyboardHandler, { global: true });\n    this.handleEvent('keyUp', this._keyboardHandler, { global: true });\n  }\n\n  override disconnectedCallback() {\n    this._hide(true);\n    this._disposables.dispose();\n    this._anchorModelDisposables?.dispose();\n    super.disconnectedCallback();\n  }\n\n  override render() {\n    const hoverRectStyle = styleMap(\n      this._dragHoverRect\n        ? {\n            width: `${this._dragHoverRect.width}px`,\n            height: `${this._dragHoverRect.height}px`,\n            top: `${this._dragHoverRect.top}px`,\n            left: `${this._dragHoverRect.left}px`,\n          }\n        : {\n            display: 'none',\n          }\n    );\n\n    return html`\n      <div class=\"affine-drag-handle-widget\">\n        <div class=\"affine-drag-handle-container\">\n          <div class=\"affine-drag-handle-grabber\"></div>\n        </div>\n        <div class=\"affine-drag-hover-rect\" style=${hoverRectStyle}></div>\n      </div>\n    `;\n  }\n\n  static registerOption(option: DragHandleOption) {\n    return AffineDragHandleWidget.staticOptionRunner.register(option);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [AFFINE_DRAG_HANDLE_WIDGET]: AffineDragHandleWidget;\n  }\n}\n"]}