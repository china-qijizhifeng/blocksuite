{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/code-toolbar/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, type TemplateResult } from 'lit';\n\nimport type {\n  CodeBlockComponent,\n  CodeBlockModel,\n} from '../../../code-block/index.js';\nimport type {\n  CodeToolbarItem,\n  CodeToolbarMoreItem,\n  MoreItem,\n} from './types.js';\n\nexport const duplicateCodeBlock = (model: CodeBlockModel) => {\n  const keys = model.keys as (keyof typeof model)[];\n  const values = keys.map(key => model[key]);\n  const blockProps = Object.fromEntries(keys.map((key, i) => [key, values[i]]));\n  const { text, ...duplicateProps } = blockProps;\n\n  const newProps = {\n    flavour: model.flavour,\n    text: model.text.clone(),\n    ...duplicateProps,\n  };\n\n  return model.doc.addSiblingBlocks(model, [newProps])[0];\n};\n\nexport function CodeToolbarItemRenderer(\n  items: CodeToolbarItem[],\n  codeBlock: CodeBlockComponent,\n  onClick?: () => void\n) {\n  return items\n    .filter(item => item.showWhen(codeBlock))\n    .map(item => {\n      switch (item.type) {\n        case 'action':\n          return html`\n            <icon-button\n              class=\"code-toolbar-button ${item.name}\"\n              data-testid=${item.name}\n              size=\"24px\"\n              @click=${() => item.action(codeBlock, onClick)}\n            >\n              ${item.icon}\n              <affine-tooltip tip-position=\"top\" .offset=${5}\n                >${item.tooltip}</affine-tooltip\n              >\n            </icon-button>\n          `;\n        case 'custom':\n          return item.render(codeBlock, onClick);\n        default:\n          return null;\n      }\n    })\n    .filter(item => item !== null);\n}\n\nexport function MoreMenuRenderer(\n  blockElement: CodeBlockComponent,\n  abortController: AbortController,\n  config: CodeToolbarMoreItem[]\n) {\n  return config\n    .filter(item => {\n      return item.type === 'divider' || item.showWhen(blockElement);\n    })\n    .map(item => {\n      let template: TemplateResult | null = null;\n      switch (item.type) {\n        case 'more': {\n          const moreItem = item as MoreItem;\n          const name =\n            moreItem.name instanceof Function\n              ? moreItem.name(blockElement)\n              : moreItem.name;\n          const icon =\n            moreItem.icon instanceof Function\n              ? moreItem.icon(blockElement)\n              : moreItem.icon;\n          const buttonClass = `menu-item ${name.toLocaleLowerCase().split(' ').join('-')}`;\n          template = html`<div class=${buttonClass}>\n            <icon-button\n              width=\"183px\"\n              height=\"30px\"\n              text=${name}\n              @click=${(e: MouseEvent) => {\n                e.stopPropagation();\n                moreItem.action(blockElement, abortController);\n              }}\n            >\n              ${icon}\n            </icon-button>\n          </div>`;\n          break;\n        }\n        case 'divider': {\n          template = html`<div class=\"divider\"></div>`;\n          break;\n        }\n        default:\n          template = null;\n      }\n\n      return template;\n    })\n    .filter((template): template is TemplateResult => template !== null)\n    .map(template => template);\n}\n"]}