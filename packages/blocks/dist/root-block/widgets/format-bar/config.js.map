{"version":3,"file":"config.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/format-bar/config.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Chain, InitCommandCtx } from '@blocksuite/block-std';\nimport { html, type TemplateResult } from 'lit';\n\nimport { toast } from '../../../_common/components/index.js';\nimport {\n  BoldIcon,\n  BulletedListIcon,\n  CheckBoxIcon,\n  CodeIcon,\n  CopyIcon,\n  Heading1Icon,\n  Heading2Icon,\n  Heading3Icon,\n  Heading4Icon,\n  Heading5Icon,\n  Heading6Icon,\n  ItalicIcon,\n  LinkIcon,\n  NumberedListIcon,\n  QuoteIcon,\n  StrikethroughIcon,\n  TextIcon,\n  UnderlineIcon,\n} from '../../../_common/icons/index.js';\nimport type { AffineFormatBarWidget } from './format-bar.js';\n\nexport type DividerConfigItem = {\n  type: 'divider';\n};\nexport type HighlighterDropdownConfigItem = {\n  type: 'highlighter-dropdown';\n};\nexport type ParagraphDropdownConfigItem = {\n  type: 'paragraph-dropdown';\n};\nexport type InlineActionConfigItem = {\n  id: string;\n  name: string;\n  type: 'inline-action';\n  action: (\n    chain: Chain<InitCommandCtx>,\n    formatBar: AffineFormatBarWidget\n  ) => void;\n  icon: TemplateResult | (() => HTMLElement);\n  isActive: (\n    chain: Chain<InitCommandCtx>,\n    formatBar: AffineFormatBarWidget\n  ) => boolean;\n  showWhen: (\n    chain: Chain<InitCommandCtx>,\n    formatBar: AffineFormatBarWidget\n  ) => boolean;\n};\nexport type ParagraphActionConfigItem = {\n  id: string;\n  type: 'paragraph-action';\n  name: string;\n  action: (\n    chain: Chain<InitCommandCtx>,\n    formatBar: AffineFormatBarWidget\n  ) => void;\n  icon: TemplateResult | (() => HTMLElement);\n  flavour: string;\n};\n\nexport type CustomConfigItem = {\n  type: 'custom';\n  render: (formatBar: AffineFormatBarWidget) => TemplateResult | null;\n};\n\nexport type FormatBarConfigItem =\n  | DividerConfigItem\n  | HighlighterDropdownConfigItem\n  | ParagraphDropdownConfigItem\n  | ParagraphActionConfigItem\n  | InlineActionConfigItem\n  | CustomConfigItem;\n\nexport function toolbarDefaultConfig(toolbar: AffineFormatBarWidget) {\n  toolbar\n    .clearConfig()\n    .addParagraphDropdown()\n    .addDivider()\n    .addTextStyleToggle({\n      key: 'bold',\n      action: chain => chain.toggleBold().run(),\n      icon: BoldIcon,\n    })\n    .addTextStyleToggle({\n      key: 'italic',\n      action: chain => chain.toggleItalic().run(),\n      icon: ItalicIcon,\n    })\n    .addTextStyleToggle({\n      key: 'underline',\n      action: chain => chain.toggleUnderline().run(),\n      icon: UnderlineIcon,\n    })\n    .addTextStyleToggle({\n      key: 'strike',\n      action: chain => chain.toggleStrike().run(),\n      icon: StrikethroughIcon,\n    })\n    .addTextStyleToggle({\n      key: 'code',\n      action: chain => chain.toggleCode().run(),\n      icon: CodeIcon,\n    })\n    .addTextStyleToggle({\n      key: 'link',\n      action: chain => chain.toggleLink().run(),\n      icon: LinkIcon,\n    })\n    .addDivider()\n    .addHighlighterDropdown()\n    .addDivider()\n    .addInlineAction({\n      id: 'copy',\n      name: 'Copy',\n      icon: CopyIcon,\n      isActive: () => false,\n      action: chain => {\n        chain\n          .getSelectedModels()\n          .with({\n            onCopy: () => {\n              toast(toolbar.host, 'Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');\n            },\n          })\n          .copySelectedModels()\n          .run();\n      },\n      showWhen: () => true,\n    })\n    // „ÄêÂ∑≤ÁßªÈô§„ÄëËΩ¨‰∏∫Êï∞ÊçÆÂ∫ì„ÄÅÂàõÂª∫ÂÖ≥ËÅîÊñáÊ°£Á≠âÂ§çÊùÇÂäüËÉΩ\n    .addBlockTypeSwitch({\n      flavour: 'affine:paragraph',\n      type: 'text',\n      name: 'ÊñáÊú¨',\n      icon: TextIcon,\n    })\n    .addBlockTypeSwitch({\n      flavour: 'affine:paragraph',\n      type: 'h1',\n      name: 'Ê†áÈ¢ò 1',\n      icon: Heading1Icon,\n    })\n    .addBlockTypeSwitch({\n      flavour: 'affine:paragraph',\n      type: 'h2',\n      name: 'Ê†áÈ¢ò 2',\n      icon: Heading2Icon,\n    })\n    .addBlockTypeSwitch({\n      flavour: 'affine:paragraph',\n      type: 'h3',\n      name: 'Ê†áÈ¢ò 3',\n      icon: Heading3Icon,\n    })\n    .addBlockTypeSwitch({\n      flavour: 'affine:paragraph',\n      type: 'h4',\n      name: 'Ê†áÈ¢ò 4',\n      icon: Heading4Icon,\n    })\n    .addBlockTypeSwitch({\n      flavour: 'affine:paragraph',\n      type: 'h5',\n      name: 'Ê†áÈ¢ò 5',\n      icon: Heading5Icon,\n    })\n    .addBlockTypeSwitch({\n      flavour: 'affine:paragraph',\n      type: 'h6',\n      name: 'Ê†áÈ¢ò 6',\n      icon: Heading6Icon,\n    })\n    .addBlockTypeSwitch({\n      flavour: 'affine:list',\n      type: 'bulleted',\n      name: 'Êó†Â∫èÂàóË°®',\n      icon: BulletedListIcon,\n    })\n    .addBlockTypeSwitch({\n      flavour: 'affine:list',\n      type: 'numbered',\n      name: 'ÊúâÂ∫èÂàóË°®',\n      icon: NumberedListIcon,\n    })\n    .addBlockTypeSwitch({\n      flavour: 'affine:list',\n      type: 'todo',\n      name: 'ÂæÖÂäûÊ∏ÖÂçï',\n      icon: CheckBoxIcon,\n    })\n    .addBlockTypeSwitch({\n      flavour: 'affine:code',\n      name: '‰ª£Á†ÅÂùó',\n      icon: CodeIcon,\n    })\n    .addBlockTypeSwitch({\n      flavour: 'affine:paragraph',\n      type: 'quote',\n      name: 'ÂºïÁî®',\n      icon: QuoteIcon,\n    })\n    // ---------------------------------------------------------\n    // ÊâπÊ≥®ÊåâÈíÆÔºàËá™ÂÆö‰πâÂäüËÉΩÔºâ\n    // =====================\n    // ÂÖ≥ÈîÆ‰øÆÂ§çÔºö‰ΩøÁî® formatText ÂÜôÂÖ• comment Â±ûÊÄßÂà∞ Y.Text\n    // ËøôÊ†∑ÊâπÊ≥®Êï∞ÊçÆ‰ºöË¢´ Yjs ÊåÅ‰πÖÂåñÔºå‰∏ç‰ºö‰∏¢Â§±\n    // =====================\n    // ---------------------------------------------------------\n    .addDivider()\n    .addInlineAction({\n      id: 'add-comment',\n      name: 'ÊâπÊ≥®',\n      icon: html`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"#f59e0b\" stroke=\"#f59e0b\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path></svg>`,\n      isActive: chain => {\n        // Ê£ÄÊü•ÈÄâ‰∏≠ÊñáÊú¨ÊòØÂê¶Â∑≤ÊúâÊâπÊ≥®\n        const [result] = chain.isTextStyleActive({ key: 'comment' }).run();\n        return result;\n      },\n      action: chain => {\n        // =====================\n        // „Äêv6.5 ‰øÆÂ§ç„ÄëÊâπÊ≥®ÂäüËÉΩ - Á´ãÂç≥ÂÜôÂÖ• comment Âà∞ delta\n        // =====================\n        // \n        // ÊâπÊ≥®ÂøÖÈ°ªÁ´ãÂç≥ÂÜôÂÖ• deltaÔºåÂê¶ÂàôÈÄâÂå∫‰∏¢Â§±ÂêéÊó†Ê≥ïÂÜôÂÖ•\n        // Áî®Êà∑ËæìÂÖ•ÂÜÖÂÆπÂêéÊõ¥Êñ∞ content Â≠óÊÆµ\n        // =====================\n        \n        // Ê≠•È™§ 1ÔºöËé∑ÂèñÈÄâ‰∏≠ÊñáÊú¨Âíå‰ΩçÁΩÆ\n        const selection = window.getSelection();\n        if (!selection || selection.rangeCount === 0) return;\n        \n        const range = selection.getRangeAt(0);\n        const rect = range.getBoundingClientRect();\n        const selectedText = selection.toString().trim();\n        \n        if (!selectedText) return;\n        \n        // Ê≠•È™§ 2ÔºöÁîüÊàêÂîØ‰∏ÄÁöÑÊâπÊ≥® ID\n        const commentId = `comment-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n        \n        // Ê≠•È™§ 3Ôºö„ÄêÂÖ≥ÈîÆ„ÄëÁ´ãÂç≥ÂÜôÂÖ• comment Âà∞ delta\n        // content ÂÖàËÆæ‰∏∫Á©∫ÔºåÁî®Êà∑ËæìÂÖ•ÂêéÂÜçÊõ¥Êñ∞\n        const commentData = { \n          id: commentId,\n          content: '',  // Á≠âÂæÖÁî®Êà∑ËæìÂÖ•\n          selectedText: selectedText\n        };\n        chain\n          .getTextSelection()\n          .formatText({\n            styles: {\n              comment: commentData\n            }\n          })\n          .run();\n        \n        console.log('[BlockSuite] ‚úÖ ÊâπÊ≥®Ê†áËÆ∞Â∑≤ÂÜôÂÖ• delta:', { commentId, selectedText });\n        \n        // Ê≠•È™§ 4ÔºöËß¶Âèë‰∫ã‰ª∂ÔºåÊòæÁ§∫ÊâπÊ≥®ËæìÂÖ•Ê°Ü\n        setTimeout(() => {\n          window.dispatchEvent(new CustomEvent('blocksuite-add-comment', {\n            detail: { \n              commentId,\n              selectedText, \n              position: { x: rect.left + rect.width / 2, y: rect.bottom },\n              rect: { top: rect.top, left: rect.left, width: rect.width, height: rect.height },\n            }\n          }));\n        }, 50);\n      },\n      showWhen: chain => {\n        // ÂΩìÊúâÊñáÊú¨ÈÄâ‰∏≠Êó∂ÊòæÁ§∫ÊâπÊ≥®ÊåâÈíÆ\n        const [_, ctx] = chain\n          .getTextSelection()\n          .getSelectedBlocks({ types: ['text'] })\n          .run();\n        const textSelection = ctx.currentTextSelection;\n        return !!textSelection && !textSelection.isCollapsed();\n      },\n    })\n    // ---------------------------------------------------------\n    // „Äêv6.4„ÄëÊ∑ªÂä†Âà∞ÂØπËØùÊ°ÜÊåâÈíÆ\n    // =====================\n    // Â∞ÜÈÄâ‰∏≠ÊñáÊú¨‰Ωú‰∏∫ÂºïÁî®ÂèëÈÄÅÂà∞ÂÆø‰∏ªÂØπËØùÊ°Ü\n    // =====================\n    // ---------------------------------------------------------\n    .addInlineAction({\n      id: 'add-to-chat',\n      name: 'ÂºïÁî®',\n      icon: html`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#6366f1\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path><path d=\"M8 10h.01\"></path><path d=\"M12 10h.01\"></path><path d=\"M16 10h.01\"></path></svg>`,\n      isActive: () => false,\n      action: () => {\n        // Ëé∑ÂèñÈÄâ‰∏≠ÊñáÊú¨\n        const selection = window.getSelection();\n        if (!selection || selection.rangeCount === 0) return;\n        \n        const selectedText = selection.toString().trim();\n        if (!selectedText) return;\n        \n        // Ëß¶Âèë‰∫ã‰ª∂ÔºåÁî±ÂâçÁ´ØÂ§ÑÁêÜÂèëÈÄÅÂà∞ÂØπËØùÊ°Ü\n        console.log('[BlockSuite] üìù Ê∑ªÂä†Âà∞ÂØπËØùÊ°Ü:', selectedText.substring(0, 50));\n        window.dispatchEvent(new CustomEvent('blocksuite-add-to-chat', {\n          detail: { selectedText }\n        }));\n      },\n      showWhen: chain => {\n        // ÂΩìÊúâÊñáÊú¨ÈÄâ‰∏≠Êó∂ÊòæÁ§∫\n        const [_, ctx] = chain\n          .getTextSelection()\n          .getSelectedBlocks({ types: ['text'] })\n          .run();\n        const textSelection = ctx.currentTextSelection;\n        return !!textSelection && !textSelection.isCollapsed();\n      },\n    });\n}\n"]}