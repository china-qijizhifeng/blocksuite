{"version":3,"file":"lang-button.js","sourceRoot":"","sources":["../../../../../src/root-block/widgets/code-language-list/components/lang-button.ts"],"names":[],"mappings":"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","sourcesContent":["import { noop } from '@blocksuite/global/utils';\nimport { css, LitElement, nothing } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { html } from 'lit/static-html.js';\nimport { type BundledLanguage, bundledLanguagesInfo } from 'shiki';\n\nimport {\n  type FilterableListOptions,\n  showPopFilterableList,\n} from '../../../../_common/components/filterable-list/index.js';\nimport { ArrowDownIcon } from '../../../../_common/icons/text.js';\nimport type { CodeBlockComponent } from '../../../../code-block/code-block.js';\nimport {\n  getLanguagePriority,\n  getStandardLanguage,\n} from '../../../../code-block/utils/code-languages.js';\nimport {\n  PLAIN_TEXT_LANG_INFO,\n  type StrictLanguageInfo,\n} from '../../../../code-block/utils/consts.js';\n\n@customElement('language-list-button')\nexport class LanguageListButton extends LitElement {\n  static override styles = css`\n    :host {\n      position: absolute;\n      top: 0;\n      left: 0;\n      z-index: 1;\n    }\n\n    .lang-button {\n      background-color: var(--affine-background-primary-color);\n      box-shadow: var(--affine-shadow-1);\n      display: flex;\n      gap: 4px;\n      padding: 2px 4px;\n    }\n\n    .lang-button:hover {\n      background: var(--affine-hover-color-filled);\n    }\n\n    .lang-button[hover] {\n      background: var(--affine-hover-color-filled);\n    }\n  `;\n\n  @state()\n  private accessor _currentLanguage: StrictLanguageInfo = PLAIN_TEXT_LANG_INFO;\n\n  @query('.lang-button')\n  private accessor _langButton!: HTMLElement;\n\n  private _abortController?: AbortController;\n\n  @property({ attribute: false })\n  accessor blockElement!: CodeBlockComponent;\n\n  @property({ attribute: false })\n  accessor onActiveStatusChange: (active: boolean) => void = noop;\n\n  private _updateLanguage() {\n    this._currentLanguage =\n      getStandardLanguage(this.blockElement.model.language) ??\n      PLAIN_TEXT_LANG_INFO;\n  }\n\n  private _clickLangBtn = () => {\n    if (this.blockElement.doc.readonly) return;\n    if (this._abortController) {\n      // Close the language list if it's already opened.\n      this._abortController.abort();\n      return;\n    }\n    this._abortController = new AbortController();\n    this._abortController.signal.addEventListener('abort', () => {\n      this.onActiveStatusChange(false);\n      this._abortController = undefined;\n    });\n    this.onActiveStatusChange(true);\n\n    const languages = (\n      [...bundledLanguagesInfo, PLAIN_TEXT_LANG_INFO] as StrictLanguageInfo[]\n    ).map(lang => ({\n      label: lang.name,\n      name: lang.id,\n      aliases: lang.aliases,\n    }));\n\n    const options: FilterableListOptions = {\n      placeholder: 'Search for a language',\n      onSelect: item => {\n        this.blockElement.setLang(item.name);\n        this._updateLanguage();\n      },\n      active: item => item.name === this._currentLanguage.id,\n      items: languages,\n    };\n\n    showPopFilterableList({\n      options,\n      filter: (a, b) =>\n        getLanguagePriority(a.name as BundledLanguage) -\n        getLanguagePriority(b.name as BundledLanguage),\n      referenceElement: this._langButton,\n      container: this.blockElement.host,\n      abortController: this._abortController,\n      // stacking-context(editor-host)\n      portalStyles: {\n        zIndex: 'var(--affine-z-index-popover)',\n      },\n    });\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._updateLanguage();\n  }\n\n  override render() {\n    return html`<icon-button\n      class=\"lang-button\"\n      data-testid=\"lang-button\"\n      width=\"auto\"\n      text=${this._currentLanguage.name ?? this._currentLanguage.id}\n      height=\"24px\"\n      @click=${this._clickLangBtn}\n      ?disabled=${this.blockElement.doc.readonly}\n    >\n      <span slot=\"suffix\">\n        ${!this.blockElement.doc.readonly ? ArrowDownIcon : nothing}\n      </span>\n    </icon-button> `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'language-list-button': LanguageListButton;\n  }\n}\n"]}