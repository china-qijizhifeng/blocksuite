{"version":3,"file":"slash-menu-popover.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/slash-menu/slash-menu-popover.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,EAAE,cAAc,EAAE,MAAM,uBAAuB,CAAC;AACvD,OAAO,EAAE,YAAY,EAAE,MAAM,0BAA0B,CAAC;AACxD,OAAO,EAAE,aAAa,EAAE,MAAM,EAAE,MAAM,kBAAkB,CAAC;AACzD,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE,OAAO,EAAuB,MAAM,KAAK,CAAC;AACrE,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AAC1E,OAAO,EAAE,SAAS,EAAE,MAAM,8BAA8B,CAAC;AACzD,OAAO,EAAE,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AAEvD,OAAO,EAAE,eAAe,EAAE,MAAM,uCAAuC,CAAC;AACxE,OAAO,EACL,kBAAkB,EAClB,qBAAqB,GACtB,MAAM,sCAAsC,CAAC;AAC9C,OAAO,EAAE,aAAa,EAAE,MAAM,iCAAiC,CAAC;AAChE,OAAO,EACL,sBAAsB,EACtB,yBAAyB,GAC1B,MAAM,iCAAiC,CAAC;AACzC,OAAO,EAAE,YAAY,EAAE,MAAM,kCAAkC,CAAC;AAUhE,OAAO,EAAE,qBAAqB,EAAE,MAAM,EAAE,MAAM,aAAa,CAAC;AAC5D,OAAO,EACL,sBAAsB,EACtB,YAAY,EACZ,cAAc,EACd,aAAa,EACb,eAAe,EACf,kBAAkB,GACnB,MAAM,YAAY,CAAC;IAQP,SAAS;4BADrB,aAAa,CAAC,mBAAmB,CAAC;;;;sBACJ,cAAc,CAAC,UAAU,CAAC;;;;;;;;;;;;;;;;;;;yBAAlC,SAAQ,WAA0B;;;;YAQtC,8FAAyD,EAAE,EAAC;YAG5D,iJAIN,IAAI,GAAC;YAER,2BAAsB,yDAAyB;YAE/C,iBAAY,GAAG,IAAI,GAAG,EAA2B,CAAC;YAElD,WAAM,GAAG,EAAE,CAAC;YAEZ,gBAAW,GAA+B,KAAK,CAAC;YAG/C,wFAA2B;YAG3B,6IAA+B;YAG/B,oJAAoB;YAGpB,oKAA+B;YAExC,oBAAe,kEAAG,IAAI,eAAe,EAAE,EAAC;YAEhC,qBAAgB,GAAG,GAAG,EAAE;gBAC9B,MAAM,QAAQ,GAAG,CAAC,IAAyB,EAAE,IAAc,EAAE,EAAE;oBAC7D,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC;oBACvC,IAAI,aAAa,CAAC,IAAI,CAAC,EAAE,CAAC;wBACxB,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,OAAO,EAAE,KAAK,EAAE,EAAE,CACtC,QAAQ,CAAC,OAAO,EAAE,CAAC,GAAG,IAAI,EAAE,KAAK,CAAC,CAAC,CACpC,CAAC;oBACJ,CAAC;gBACH,CAAC,CAAC;gBAEF,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACtE,CAAC,CAAC;YAEM,yBAAoB,GAAG,CAAC,KAAa,EAAE,EAAE;gBAC/C,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;gBAEzB,MAAM,SAAS,GAAG,KAAK,CAAC,WAAW,EAAE,CAAC;gBACtC,IAAI,SAAS,KAAK,EAAE,IAAI,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC;oBAChD,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC;oBACxB,IAAI,CAAC,WAAW,GAAG,SAAS,KAAK,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,WAAW,CAAC;oBAC1D,OAAO;gBACT,CAAC;gBAED,wBAAwB;gBACxB,IAAI,KAAK,GAAG,CAAC,CAAC;gBACd,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;gBACtD,OAAO,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;oBAC1B,0DAA0D;oBAC1D,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,CAC9C,IAAI,CAAC,EAAE,CAAC,CAAC,aAAa,CAAC,IAAI,CAAC,CAC7B,CAAC;oBAEF,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,CAC9C,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,GAAG,EAAE,EAAE,EAAE,EAAE,CACpC,CAAC,IAAI,EAAE,GAAG,KAAK,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,YAAY,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC,CAC3D,CACF,CAAC;oBAEF,mCAAmC;oBACnC,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,KAAK,CAAC,IAAI,KAAK,IAAI,CAAC;wBAAE,MAAM;oBAE1D,KAAK,GAAG,KAAK;yBACV,GAAG,CAAe,IAAI,CAAC,EAAE;wBACxB,IAAI,aAAa,CAAC,IAAI,CAAC,EAAE,CAAC;4BACxB,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;wBAC9C,CAAC;6BAAM,CAAC;4BACN,OAAO,EAAE,CAAC;wBACZ,CAAC;oBACH,CAAC,CAAC;yBACD,IAAI,EAAE,CAAC;oBAEV,KAAK,EAAE,CAAC;gBACV,CAAC;gBAED,wCAAwC;gBACxC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;oBACtD,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,SAAS;wBAAE,OAAO,CAAC,CAAC,CAAC;oBAClD,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,SAAS;wBAAE,OAAO,CAAC,CAAC;oBAEjD,MAAM,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;oBACvC,MAAM,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;oBAEvC,YAAY,CAAC,KAAK,CAAC,CAAC;oBACpB,YAAY,CAAC,KAAK,CAAC,CAAC;oBAEpB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;wBAC9D,IAAI,KAAK,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;4BAAE,OAAO,CAAC,CAAC,CAAC;wBACnC,IAAI,KAAK,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;4BAAE,OAAO,CAAC,CAAC;oBACpC,CAAC;oBACD,OAAO,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;gBACrC,CAAC,CAAC,CAAC;gBAEH,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;gBACpB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC;YAC3E,CAAC,CAAC;YAEM,qBAAgB,GAAG,CAAC,IAAyB,EAAE,EAAE;gBACvD,mCAAmC;gBACnC,+DAA+D;gBAC/D,sFAAsF;gBACtF,kBAAkB,CAChB,IAAI,CAAC,IAAI,EACT,IAAI,CAAC,OAAO,CAAC,KAAK,EAClB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,MAAM,CAC9B,CAAC;gBACF,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;gBAChD,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;YAC/B,CAAC,CAAC;YAuEF,mBAAc,GAAG,CAAC,QAAkD,EAAE,EAAE;gBACtE,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;YAC5B,CAAC,CAAC;QA6BJ,CAAC;;;0CA7NE,KAAK,EAAE;qCAGP,KAAK,EAAE;mCAeP,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;kCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;sCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;4CAG9B,KAAK,CAAC,kBAAkB,CAAC;YA1B1B,+LAAiB,cAAc,6BAAd,cAAc,uGAA8C;YAG7E,gLAAiB,SAAS,6BAAT,SAAS,6FAIV;YAWhB,0KAAS,OAAO,6BAAP,OAAO,yFAAoB;YAGpC,uKAAS,MAAM,6BAAN,MAAM,uFAAyB;YAGxC,mLAAS,UAAU,6BAAV,UAAU,+FAAU;YAG7B,qMAAS,gBAAgB,6BAAhB,gBAAgB,2GAAe;YAnC1C,6KAoOC;;;;QAnOC,IAAI,IAAI;YACN,OAAO,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC;QACvC,CAAC;iBAEe,WAAM,GAAG,MAAM,AAAT,CAAU;QAGhC,iCAA6E;QAA7E,IAAiB,cAAc,oDAA8C;QAA7E,IAAiB,cAAc,0DAA8C;QAG7E,4BAIgB;QAJhB,IAAiB,SAAS,+CAIV;QAJhB,IAAiB,SAAS,qDAIV;QAWhB,0BAAoC;QAApC,IAAS,OAAO,6CAAoB;QAApC,IAAS,OAAO,mDAAoB;QAGpC,yBAAwC;QAAxC,IAAS,MAAM,4CAAyB;QAAxC,IAAS,MAAM,kDAAyB;QAGxC,6BAA6B;QAA7B,IAAS,UAAU,gDAAU;QAA7B,IAAS,UAAU,sDAAU;QAG7B,mCAAwC;QAAxC,IAAS,gBAAgB,sDAAe;QAAxC,IAAS,gBAAgB,4DAAe;QA6F/B,iBAAiB;YACxB,KAAK,CAAC,iBAAiB,EAAE,CAAC;YAE1B,IAAI,CAAC,sBAAsB,GAAG;gBAC5B,GAAG,IAAI,CAAC,OAAO;gBACf,WAAW,EAAE,IAAI,CAAC,gBAAgB;gBAClC,cAAc,EAAE,IAAI,CAAC,MAAM,CAAC,cAAc;aAC3C,CAAC;YAEF,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAExB,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,IAAI,EAAE,WAAW,EAAE,CAAC,CAAC,EAAE;gBACpD,kCAAkC;gBAClC,CAAC,CAAC,cAAc,EAAE,CAAC;YACrB,CAAC,CAAC,CAAC;YAEH,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC;YAE/B,MAAM,YAAY,GAAG,sBAAsB,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;YAC9D,YAAY,CAAC,YAAY,EAAE,iCAAiC,CAAC,CAAC;YAE9D;;;;;;;;;eASG;YACH,qBAAqB,CAAC;gBACpB,MAAM,EAAE,YAAY,CAAC,WAAW;gBAChC,YAAY;gBACZ,eAAe,EAAE,IAAI,CAAC,eAAe;gBACrC,WAAW,EAAE,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE;oBAC3B,MAAM,EAAE,GAAG,EAAE,WAAW,EAAE,IAAI,EAAE,GAAG,KAAK,CAAC;oBACzC,IAAI,GAAG,KAAK,IAAI,CAAC,UAAU,EAAE,CAAC;wBAC5B,gCAAgC;wBAChC,2EAA2E;wBAC3E,OAAO;oBACT,CAAC;oBAED,IAAI,GAAG,KAAK,SAAS,IAAI,CAAC,WAAW,IAAI,IAAI,KAAK,OAAO,EAAE,CAAC;wBAC1D,wBAAwB;wBACxB,OAAO;oBACT,CAAC;oBAED,IAAI,GAAG,KAAK,WAAW,IAAI,IAAI,CAAC,WAAW,KAAK,WAAW,EAAE,CAAC;wBAC5D,iDAAiD;wBACjD,gCAAgC;wBAChC,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;wBAC7B,OAAO;oBACT,CAAC;oBAED,IAAI,GAAG,KAAK,YAAY,IAAI,GAAG,KAAK,WAAW,IAAI,GAAG,KAAK,QAAQ,EAAE,CAAC;wBACpE,OAAO;oBACT,CAAC;oBAED,IAAI,EAAE,CAAC;gBACT,CAAC;gBACD,aAAa,EAAE,KAAK,CAAC,EAAE;oBACrB,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,CAAC;gBACnC,CAAC;gBACD,MAAM,EAAE,GAAG,EAAE,GAAE,CAAC;gBAChB,SAAS,EAAE,GAAG,EAAE,GAAE,CAAC;aACpB,CAAC,CAAC;QACL,CAAC;QAMQ,MAAM;YACb,MAAM,eAAe,GAAG,IAAI,CAAC,SAAS;gBACpC,CAAC,CAAC;oBACE,SAAS,EAAE,aAAa,IAAI,CAAC,SAAS,CAAC,CAAC,KAAK,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG;oBAChE,SAAS,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI;iBACzE;gBACH,CAAC,CAAC;oBACE,UAAU,EAAE,QAAQ;iBACrB,CAAC;YAEN,OAAO,IAAI,CAAA,GAAG,IAAI,CAAC,WAAW,KAAK,WAAW;gBAC1C,CAAC,CAAC,IAAI,CAAA;;sBAEQ,GAAG,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE;kBACtC;gBACV,CAAC,CAAC,OAAO;;mBAEE,IAAI,CAAC,sBAAsB;gBAC9B,IAAI,CAAC,WAAW,KAAK,KAAK;gBAChC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK;gBACnB,CAAC,CAAC,IAAI,CAAC,cAAc;uBACR,IAAI,CAAC,gBAAgB;yBACnB,eAAe;2BACb,IAAI,CAAC,eAAe;;0BAErB,CAAC;QACzB,CAAC;;YAnOU,uDAAS;;;;;SAAT,SAAS;IAuOT,cAAc;4BAD1B,aAAa,CAAC,kBAAkB,CAAC;;;;sBACE,cAAc,CAAC,UAAU,CAAC;;;;;;;;;;;;;;;;;;;8BAAlC,SAAQ,WAA0B;;;;YAI3C,gGAAiD;YAE1D,oBAAe,6DAAwB,IAAI,EAAC;YAE5C,4BAAuB,GAA2B,IAAI,CAAC;YAGtD,wFAAgC;YAGhC,yIAA6B;YAG7B,+HAAgB,CAAC,GAAC;YAGlB,6JAAkC;YAGlC,0JAAuD,IAAI,GAAC;YAmB7D,iBAAY,+DAAG,CAAC,IAAkB,EAAE,EAAE;gBAC5C,IAAI,IAAI,KAAK,IAAI,CAAC,eAAe;oBAAE,OAAO;gBAE1C,MAAM,WAAW,GAAG,IAAI,CAAC,UAAU,EAAE,aAAa,CAChD,IAAI,kBAAkB,CAAC,IAAI,CAAC,EAAE,CAC/B,CAAC;gBACF,IAAI,CAAC,WAAW;oBAAE,OAAO;gBAEzB,IAAI,CAAC,aAAa,EAAE,CAAC;gBACrB,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;gBAC5B,IAAI,CAAC,uBAAuB,GAAG,IAAI,eAAe,EAAE,CAAC;gBACrD,IAAI,CAAC,uBAAuB,CAAC,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,EAAE;oBACjE,IAAI,CAAC,aAAa,EAAE,CAAC;gBACvB,CAAC,CAAC,CAAC;gBAEH,MAAM,cAAc,GAAG,eAAe,CAAC;oBACrC,SAAS,EAAE,KAAK;oBAChB,QAAQ,EAAE,IAAI,CAAA;mBACD,IAAI,CAAC,OAAO;gBACf,IAAI,CAAC,OAAO;iBACX,IAAI,CAAC,KAAK,GAAG,CAAC;2BACJ,IAAI,CAAC,uBAAuB;;UAE7C,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC;0BAClB;oBACpB,eAAe,EAAE;wBACf,gBAAgB,EAAE,WAAW;wBAC7B,UAAU,EAAE,IAAI;wBAChB,UAAU,EAAE;4BACV,MAAM,CAAC,EAAE,CAAC;4BACV,aAAa,CAAC;gCACZ,iBAAiB,EAAE,CAAC,aAAa,EAAE,WAAW,CAAC;6BAChD,CAAC;yBACH;qBACF;oBACD,eAAe,EAAE,IAAI,CAAC,uBAAuB;iBAC9C,CAAC,CAAC;gBAEH,cAAc,CAAC,KAAK,CAAC,MAAM,GAAG,wCAAwC,IAAI,CAAC,KAAK,GAAG,CAAC;gBACpF,cAAc,CAAC,KAAK,EAAE,CAAC;YACzB,CAAC,EAAC;YAEM,kBAAa,GAAG,GAAG,EAAE;gBAC3B,IAAI,CAAC,uBAAuB,EAAE,KAAK,EAAE,CAAC;gBACtC,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC;gBACpC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;YAC9B,CAAC,CAAC;YAEM,qBAAgB,GAAG,CAAC,IAA2B,EAAE,EAAE;gBACzD,OAAO,IAAI,CAAA,sCAAsC,IAAI,CAAC,SAAS,QAAQ,CAAC;YAC1E,CAAC,CAAC;YAEM,sBAAiB,GAAG,CAAC,IAAyB,EAAE,EAAE;gBACxD,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,WAAW,EAAE,OAAO,EAAE,cAAc,EAAE,GAAG,IAAI,CAAC;gBAElE,MAAM,KAAK,GAAG,IAAI,KAAK,IAAI,CAAC,WAAW,CAAC;gBAExC,OAAO,IAAI,CAAA;+BACgB,kBAAkB,CAAC,IAAI,CAAC;;;aAG1C,cAAc,IAAI,IAAI;gBACnB,SAAS,CAAC,WAAW,CAAC;qBACjB,IAAI;cACX,KAAK;mBACA,GAAG,EAAE;oBAChB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;oBACxB,IAAI,CAAC,aAAa,EAAE,CAAC;gBACvB,CAAC;eACQ,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC;;QAE3C,IAAI,IAAI,IAAI,CAAA,qCAAqC,IAAI,QAAQ;QAC7D,OAAO;oBACT,IAAI,CAAA;;kBAEQ,EAAE;wBACI,qBAAqB;wBACrB;wBACd,UAAU,EAAE,IAAI,CAAC,OAAO,CAAC,cAAc;wBACvC,aAAa,EAAE,KAAK;qBACrB;;sCAE6B,OAAO,CAAC,MAAM;uCACb,OAAO,CAAC,OAAO;wBAC9B;mBACL,CAAC;YAClB,CAAC,CAAC;YAEM,uBAAkB,GAAG,CAAC,IAAkB,EAAE,EAAE;gBAClD,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,WAAW,EAAE,GAAG,IAAI,CAAC;gBAEzC,MAAM,KAAK,GAAG,IAAI,KAAK,IAAI,CAAC,WAAW,CAAC;gBAExC,OAAO,IAAI,CAAA;+BACgB,kBAAkB,CAAC,IAAI,CAAC;;;aAG1C,IAAI;gBACD,SAAS,CAAC,WAAW,CAAC;qBACjB,IAAI;cACX,KAAK;mBACA,GAAG,EAAE;oBAChB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;oBACxB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;gBAC1B,CAAC;oBACa,GAAG,EAAE;oBACjB,aAAa,CAAC,IAAI,CAAC;wBACjB,CAAC,IAAI,CAAC,eAAe,KAAK,IAAI;4BAC5B,CAAC,CAAC,IAAI,CAAC,aAAa,EAAE;4BACtB,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC;gBACjC,CAAC;;QAEC,IAAI,IAAI,IAAI,CAAA,qCAAqC,IAAI,QAAQ;;UAE3D,aAAa;;mBAEJ,CAAC;YAClB,CAAC,CAAC;YAEM,gBAAW,GAAG,CAAC,IAAyB,EAAE,EAAE;gBAClD,IAAI,cAAc,CAAC,IAAI,CAAC;oBAAE,OAAO,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;qBACxD,IAAI,YAAY,CAAC,IAAI,CAAC;oBAAE,OAAO,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;qBAC5D,IAAI,aAAa,CAAC,IAAI,CAAC;oBAAE,OAAO,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC;;oBAC9D,MAAM,IAAI,KAAK,CAAC,aAAa,CAAC,CAAC;YACtC,CAAC,CAAC;QAgIJ,CAAC;;;uCAnSE,KAAK,EAAE;mCAOP,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;gCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;iCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;2CAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;yCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;YAlB/B,sLAAiB,WAAW,6BAAX,WAAW,iGAAsC;YAOlE,0KAAS,OAAO,6BAAP,OAAO,yFAAyB;YAGzC,iKAAS,IAAI,6BAAJ,IAAI,mFAAyB;YAGtC,oKAAS,KAAK,6BAAL,KAAK,qFAAa;YAG3B,kMAAS,eAAe,6BAAf,eAAe,yGAAmB;YAG3C,4LAAS,aAAa,6BAAb,aAAa,qGAA+C;YAvBvE,6KAsSC;;;;iBArSiB,WAAM,GAAG,MAAM,AAAT,CAAU;QAGhC,8BAAkE;QAAlE,IAAiB,WAAW,iDAAsC;QAAlE,IAAiB,WAAW,uDAAsC;QAOlE,0BAAyC;QAAzC,IAAS,OAAO,6CAAyB;QAAzC,IAAS,OAAO,mDAAyB;QAGzC,uBAAsC;QAAtC,IAAS,IAAI,0CAAyB;QAAtC,IAAS,IAAI,gDAAyB;QAGtC,wBAA2B;QAA3B,IAAS,KAAK,2CAAa;QAA3B,IAAS,KAAK,iDAAa;QAG3B,kCAA2C;QAA3C,IAAS,eAAe,qDAAmB;QAA3C,IAAS,eAAe,2DAAmB;QAG3C,gCAAqE;QAArE,IAAS,aAAa,mDAA+C;QAArE,IAAS,aAAa,yDAA+C;QAE7D,aAAa,CAAC,IAAyB;YAC7C,MAAM,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;YACnC,IAAI,CAAC,UAAU,EAAE,CAAC;gBAChB,OAAO;YACT,CAAC;YAED,MAAM,IAAI,GAAG,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC;YAE/D,MAAM,GAAG,GAAG,UAAU,CAAC,aAAa,CAAC,qBAAqB,IAAI,IAAI,CAAC,CAAC;YACpE,IAAI,CAAC,GAAG,EAAE,CAAC;gBACT,OAAO;YACT,CAAC;YACD,GAAG,CAAC,cAAc,CAAC;gBACjB,KAAK,EAAE,SAAS;aACjB,CAAC,CAAC;QACL,CAAC;QAgIQ,iBAAiB;YACxB,KAAK,CAAC,iBAAiB,EAAE,CAAC;YAE1B,sBAAsB;YACtB,IAAI,CAAC,eAAe,EAAE,MAAM,EAAE,gBAAgB,CAAC,OAAO,EAAE,GAAG,EAAE;gBAC3D,IAAI,CAAC,uBAAuB,EAAE,KAAK,EAAE,CAAC;YACxC,CAAC,CAAC,CAAC;YACH,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,KAAK,CAAC,EAAE;gBACrC,IAAI,IAAI,CAAC,eAAe,EAAE,CAAC;oBACzB,KAAK,CAAC,cAAc,EAAE,CAAC;gBACzB,CAAC;YACH,CAAC,CAAC,CAAC;YAEH,MAAM,YAAY,GAAG,sBAAsB,CACzC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,EAC7B,IAAI,CAAC,OAAO,CAAC,KAAK,CACnB,CAAC;YACF,YAAY,CAAC,YAAY,EAAE,iCAAiC,CAAC,CAAC;YAE9D,YAAY,CAAC,WAAW,CAAC,gBAAgB,CACvC,SAAS,EACT,KAAK,CAAC,EAAE;gBACN,IAAI,IAAI,CAAC,eAAe;oBAAE,OAAO;gBACjC,IAAI,KAAK,CAAC,WAAW;oBAAE,OAAO;gBAE9B,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG,KAAK,CAAC;gBAE1D,MAAM,OAAO,GAAG,CAAC,OAAO,IAAI,OAAO,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,QAAQ,CAAC;gBAC7D,MAAM,SAAS,GAAG,QAAQ,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,CAAC;gBAChE,MAAM,eAAe,GAAG,CAAC,CAAC,OAAO,IAAI,OAAO,IAAI,MAAM,IAAI,QAAQ,CAAC,CAAC;gBAEpE,IAAI,QAAQ,GAAG,CAAC,CAAC;gBACjB,IACE,CAAC,GAAG,KAAK,SAAS,IAAI,eAAe,CAAC;oBACtC,CAAC,GAAG,KAAK,KAAK,IAAI,SAAS,CAAC;oBAC5B,CAAC,GAAG,KAAK,GAAG,IAAI,OAAO,CAAC;oBACxB,CAAC,GAAG,KAAK,GAAG,IAAI,OAAO,CAAC,EACxB,CAAC;oBACD,QAAQ,GAAG,CAAC,CAAC,CAAC;gBAChB,CAAC;gBAED,IACE,CAAC,GAAG,KAAK,WAAW,IAAI,eAAe,CAAC;oBACxC,CAAC,GAAG,KAAK,KAAK,IAAI,eAAe,CAAC;oBAClC,CAAC,GAAG,KAAK,GAAG,IAAI,OAAO,CAAC;oBACxB,CAAC,GAAG,KAAK,GAAG,IAAI,OAAO,CAAC,EACxB,CAAC;oBACD,QAAQ,GAAG,CAAC,CAAC;gBACf,CAAC;gBAED,IAAI,QAAQ,KAAK,CAAC,EAAE,CAAC;oBACnB,IAAI,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;oBACpD,GAAG,CAAC;wBACF,SAAS;4BACP,CAAC,SAAS,GAAG,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;oBACjE,CAAC,QAAQ,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE;oBAE/C,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAA4B,CAAC;oBACnE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;oBAErC,KAAK,CAAC,cAAc,EAAE,CAAC;oBACvB,KAAK,CAAC,eAAe,EAAE,CAAC;gBAC1B,CAAC;gBAED,IAAI,GAAG,KAAK,YAAY,IAAI,eAAe,EAAE,CAAC;oBAC5C,IAAI,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;wBACpC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;oBACtC,CAAC;oBAED,KAAK,CAAC,cAAc,EAAE,CAAC;oBACvB,KAAK,CAAC,eAAe,EAAE,CAAC;gBAC1B,CAAC;gBAED,IAAI,CAAC,GAAG,KAAK,WAAW,IAAI,GAAG,KAAK,QAAQ,CAAC,IAAI,eAAe,EAAE,CAAC;oBACjE,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;oBAE7B,KAAK,CAAC,cAAc,EAAE,CAAC;oBACvB,KAAK,CAAC,eAAe,EAAE,CAAC;gBAC1B,CAAC;gBAED,IAAI,GAAG,KAAK,OAAO,IAAI,eAAe,EAAE,CAAC;oBACvC,IAAI,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;wBACpC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;oBACtC,CAAC;yBAAM,IAAI,YAAY,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;wBAC1C,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;oBAC7C,CAAC;oBAED,KAAK,CAAC,cAAc,EAAE,CAAC;oBACvB,KAAK,CAAC,eAAe,EAAE,CAAC;gBAC1B,CAAC;YACH,CAAC,EACD;gBACE,OAAO,EAAE,IAAI;gBACb,MAAM,EAAE,IAAI,CAAC,eAAe,CAAC,MAAM;aACpC,CACF,CAAC;QACJ,CAAC;QAEQ,oBAAoB;YAC3B,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;QAC/B,CAAC;QAEQ,UAAU,CAAC,iBAAuC;YACzD,IAAI,iBAAiB,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;gBAC5D,MAAM,SAAS,GAAG,sBAAsB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACpD,YAAY,CAAC,SAAS,CAAC,CAAC;gBACxB,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;gBAE7B,oCAAoC;gBACpC,IAAI,CAAC,uBAAuB,EAAE,KAAK,EAAE,CAAC;YACxC,CAAC;QACH,CAAC;QAEQ,MAAM;YACb,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC;gBAAE,OAAO,OAAO,CAAC;YAE3C,MAAM,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,aAAa,IAAI,EAAE,QAAQ,EAAE,UAAU,EAAE,CAAC,CAAC;YAEvE,OAAO,IAAI,CAAA;;cAED,KAAK;oBACC,YAAY,IAAI,CAAC,KAAK,EAAE;;QAEpC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC;WAC5B,CAAC;QACV,CAAC;;YArSU,uDAAc;;;;;SAAd,cAAc","sourcesContent":["import { WithDisposable } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { autoPlacement, offset } from '@floating-ui/dom';\nimport { html, LitElement, nothing, type PropertyValues } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { createLitPortal } from '../../../_common/components/portal.js';\nimport {\n  cleanSpecifiedTail,\n  createKeydownObserver,\n} from '../../../_common/components/utils.js';\nimport { ArrowDownIcon } from '../../../_common/icons/index.js';\nimport {\n  getInlineEditorByModel,\n  isControlledKeyboardEvent,\n} from '../../../_common/utils/index.js';\nimport { isFuzzyMatch } from '../../../_common/utils/string.js';\nimport type {\n  SlashMenuActionItem,\n  SlashMenuContext,\n  SlashMenuGroupDivider,\n  SlashMenuItem,\n  SlashMenuStaticConfig,\n  SlashMenuStaticItem,\n  SlashSubMenu,\n} from './config.js';\nimport { slashItemToolTipStyle, styles } from './styles.js';\nimport {\n  getFirstNotDividerItem,\n  isActionItem,\n  isGroupDivider,\n  isSubMenuItem,\n  notGroupDivider,\n  slashItemClassName,\n} from './utils.js';\n\ntype InnerSlashMenuContext = SlashMenuContext & {\n  tooltipTimeout: number;\n  onClickItem: (item: SlashMenuActionItem) => void;\n};\n\n@customElement('affine-slash-menu')\nexport class SlashMenu extends WithDisposable(LitElement) {\n  get host() {\n    return this.context.rootElement.host;\n  }\n\n  static override styles = styles;\n\n  @state()\n  private accessor _filteredItems: (SlashMenuActionItem | SlashSubMenu)[] = [];\n\n  @state()\n  private accessor _position: {\n    x: string;\n    y: string;\n    height: number;\n  } | null = null;\n\n  private _innerSlashMenuContext!: InnerSlashMenuContext;\n\n  private _itemPathMap = new Map<SlashMenuItem, number[]>();\n\n  private _query = '';\n\n  private _queryState: 'off' | 'on' | 'no_result' = 'off';\n\n  @property({ attribute: false })\n  accessor context!: SlashMenuContext;\n\n  @property({ attribute: false })\n  accessor config!: SlashMenuStaticConfig;\n\n  @property({ attribute: false })\n  accessor triggerKey!: string;\n\n  @query('inner-slash-menu')\n  accessor slashMenuElement!: HTMLElement;\n\n  abortController = new AbortController();\n\n  private _initItemPathMap = () => {\n    const traverse = (item: SlashMenuStaticItem, path: number[]) => {\n      this._itemPathMap.set(item, [...path]);\n      if (isSubMenuItem(item)) {\n        item.subMenu.forEach((subItem, index) =>\n          traverse(subItem, [...path, index])\n        );\n      }\n    };\n\n    this.config.items.forEach((item, index) => traverse(item, [index]));\n  };\n\n  private _updateFilteredItems = (query: string) => {\n    this._filteredItems = [];\n\n    const searchStr = query.toLowerCase();\n    if (searchStr === '' || searchStr.endsWith(' ')) {\n      this._query = searchStr;\n      this._queryState = searchStr === '' ? 'off' : 'no_result';\n      return;\n    }\n\n    // Layer order traversal\n    let depth = 0;\n    let queue = this.config.items.filter(notGroupDivider);\n    while (queue.length !== 0) {\n      // remove the sub menu item from the previous layer result\n      this._filteredItems = this._filteredItems.filter(\n        item => !isSubMenuItem(item)\n      );\n\n      this._filteredItems = this._filteredItems.concat(\n        queue.filter(({ name, alias = [] }) =>\n          [name, ...alias].some(str => isFuzzyMatch(str, searchStr))\n        )\n      );\n\n      // We search first and second layer\n      if (this._filteredItems.length !== 0 && depth >= 1) break;\n\n      queue = queue\n        .map<typeof queue>(item => {\n          if (isSubMenuItem(item)) {\n            return item.subMenu.filter(notGroupDivider);\n          } else {\n            return [];\n          }\n        })\n        .flat();\n\n      depth++;\n    }\n\n    // make items in the same group in order\n    this._filteredItems = this._filteredItems.sort((a, b) => {\n      if (a.name.toLowerCase() === searchStr) return -1;\n      if (b.name.toLowerCase() === searchStr) return 1;\n\n      const aPath = this._itemPathMap.get(a);\n      const bPath = this._itemPathMap.get(b);\n\n      assertExists(aPath);\n      assertExists(bPath);\n\n      for (let i = 0; i < Math.min(aPath.length, bPath.length); i++) {\n        if (aPath[i] < bPath[i]) return -1;\n        if (aPath[i] > bPath[i]) return 1;\n      }\n      return aPath.length - bPath.length;\n    });\n\n    this._query = query;\n    this._queryState = this._filteredItems.length === 0 ? 'no_result' : 'on';\n  };\n\n  private _handleClickItem = (item: SlashMenuActionItem) => {\n    // Need to remove the search string\n    // We must to do clean the slash string before we do the action\n    // Otherwise, the action may change the model and cause the slash string to be changed\n    cleanSpecifiedTail(\n      this.host,\n      this.context.model,\n      this.triggerKey + this._query\n    );\n    item.action(this.context)?.catch(console.error);\n    this.abortController.abort();\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this._innerSlashMenuContext = {\n      ...this.context,\n      onClickItem: this._handleClickItem,\n      tooltipTimeout: this.config.tooltipTimeout,\n    };\n\n    this._initItemPathMap();\n\n    this._disposables.addFromEvent(this, 'mousedown', e => {\n      // Prevent input from losing focus\n      e.preventDefault();\n    });\n\n    const { model } = this.context;\n\n    const inlineEditor = getInlineEditorByModel(this.host, model);\n    assertExists(inlineEditor, 'RichText InlineEditor not found');\n\n    /**\n     * Handle arrow key\n     *\n     * The slash menu will be closed in the following keyboard cases:\n     * - Press the space key\n     * - Press the backspace key and the search string is empty\n     * - Press the escape key\n     * - When the search item is empty, the slash menu will be hidden temporarily,\n     *   and if the following key is not the backspace key, the slash menu will be closed\n     */\n    createKeydownObserver({\n      target: inlineEditor.eventSource,\n      inlineEditor,\n      abortController: this.abortController,\n      interceptor: (event, next) => {\n        const { key, isComposing, code } = event;\n        if (key === this.triggerKey) {\n          // Can not stopPropagation here,\n          // otherwise the rich text will not be able to trigger a new the slash menu\n          return;\n        }\n\n        if (key === 'Process' && !isComposing && code === 'Slash') {\n          // The IME case of above\n          return;\n        }\n\n        if (key !== 'Backspace' && this._queryState === 'no_result') {\n          // if the following key is not the backspace key,\n          // the slash menu will be closed\n          this.abortController.abort();\n          return;\n        }\n\n        if (key === 'ArrowRight' || key === 'ArrowLeft' || key === 'Escape') {\n          return;\n        }\n\n        next();\n      },\n      onUpdateQuery: query => {\n        this._updateFilteredItems(query);\n      },\n      onMove: () => {},\n      onConfirm: () => {},\n    });\n  }\n\n  updatePosition = (position: { x: string; y: string; height: number }) => {\n    this._position = position;\n  };\n\n  override render() {\n    const slashMenuStyles = this._position\n      ? {\n          transform: `translate(${this._position.x}, ${this._position.y})`,\n          maxHeight: `${Math.min(this._position.height, this.config.maxHeight)}px`,\n        }\n      : {\n          visibility: 'hidden',\n        };\n\n    return html`${this._queryState !== 'no_result'\n        ? html` <div\n            class=\"overlay-mask\"\n            @click=\"${() => this.abortController.abort()}\"\n          ></div>`\n        : nothing}\n      <inner-slash-menu\n        .context=${this._innerSlashMenuContext}\n        .menu=${this._queryState === 'off'\n          ? this.config.items\n          : this._filteredItems}\n        .onClickItem=${this._handleClickItem}\n        .mainMenuStyle=${slashMenuStyles}\n        .abortController=${this.abortController}\n      >\n      </inner-slash-menu>`;\n  }\n}\n\n@customElement('inner-slash-menu')\nexport class InnerSlashMenu extends WithDisposable(LitElement) {\n  static override styles = styles;\n\n  @state()\n  private accessor _activeItem!: SlashMenuActionItem | SlashSubMenu;\n\n  private _currentSubMenu: SlashSubMenu | null = null;\n\n  private _subMenuAbortController: AbortController | null = null;\n\n  @property({ attribute: false })\n  accessor context!: InnerSlashMenuContext;\n\n  @property({ attribute: false })\n  accessor menu!: SlashMenuStaticItem[];\n\n  @property({ attribute: false })\n  accessor depth: number = 0;\n\n  @property({ attribute: false })\n  accessor abortController!: AbortController;\n\n  @property({ attribute: false })\n  accessor mainMenuStyle: Parameters<typeof styleMap>[0] | null = null;\n\n  private _scrollToItem(item: SlashMenuStaticItem) {\n    const shadowRoot = this.shadowRoot;\n    if (!shadowRoot) {\n      return;\n    }\n\n    const text = isGroupDivider(item) ? item.groupName : item.name;\n\n    const ele = shadowRoot.querySelector(`icon-button[text=\"${text}\"]`);\n    if (!ele) {\n      return;\n    }\n    ele.scrollIntoView({\n      block: 'nearest',\n    });\n  }\n\n  private _openSubMenu = (item: SlashSubMenu) => {\n    if (item === this._currentSubMenu) return;\n\n    const itemElement = this.shadowRoot?.querySelector(\n      `.${slashItemClassName(item)}`\n    );\n    if (!itemElement) return;\n\n    this._closeSubMenu();\n    this._currentSubMenu = item;\n    this._subMenuAbortController = new AbortController();\n    this._subMenuAbortController.signal.addEventListener('abort', () => {\n      this._closeSubMenu();\n    });\n\n    const subMenuElement = createLitPortal({\n      shadowDom: false,\n      template: html`<inner-slash-menu\n        .context=${this.context}\n        .menu=${item.subMenu}\n        .depth=${this.depth + 1}\n        .abortController=${this._subMenuAbortController}\n      >\n        ${item.subMenu.map(this._renderItem)}\n      </inner-slash-menu>`,\n      computePosition: {\n        referenceElement: itemElement,\n        autoUpdate: true,\n        middleware: [\n          offset(12),\n          autoPlacement({\n            allowedPlacements: ['right-start', 'right-end'],\n          }),\n        ],\n      },\n      abortController: this._subMenuAbortController,\n    });\n\n    subMenuElement.style.zIndex = `calc(var(--affine-z-index-popover) + ${this.depth})`;\n    subMenuElement.focus();\n  };\n\n  private _closeSubMenu = () => {\n    this._subMenuAbortController?.abort();\n    this._subMenuAbortController = null;\n    this._currentSubMenu = null;\n  };\n\n  private _renderGroupItem = (item: SlashMenuGroupDivider) => {\n    return html`<div class=\"slash-menu-group-name\">${item.groupName}</div>`;\n  };\n\n  private _renderActionItem = (item: SlashMenuActionItem) => {\n    const { name, icon, description, tooltip, customTemplate } = item;\n\n    const hover = item === this._activeItem;\n\n    return html`<icon-button\n      class=\"slash-menu-item ${slashItemClassName(item)}\"\n      width=\"100%\"\n      height=\"44px\"\n      text=${customTemplate ?? name}\n      subText=${ifDefined(description)}\n      data-testid=\"${name}\"\n      hover=${hover}\n      @mousemove=${() => {\n        this._activeItem = item;\n        this._closeSubMenu();\n      }}\n      @click=${() => this.context.onClickItem(item)}\n    >\n      ${icon && html`<div class=\"slash-menu-item-icon\">${icon}</div>`}\n      ${tooltip &&\n      html`<affine-tooltip\n        tip-position=\"right\"\n        .offset=${22}\n        .tooltipStyle=${slashItemToolTipStyle}\n        .hoverOptions=${{\n          enterDelay: this.context.tooltipTimeout,\n          allowMultiple: false,\n        }}\n      >\n        <div class=\"tooltip-figure\">${tooltip.figure}</div>\n        <div class=\"tooltip-caption\">${tooltip.caption}</div>\n      </affine-tooltip>`}\n    </icon-button>`;\n  };\n\n  private _renderSubMenuItem = (item: SlashSubMenu) => {\n    const { name, icon, description } = item;\n\n    const hover = item === this._activeItem;\n\n    return html`<icon-button\n      class=\"slash-menu-item ${slashItemClassName(item)}\"\n      width=\"100%\"\n      height=\"44px\"\n      text=${name}\n      subText=${ifDefined(description)}\n      data-testid=\"${name}\"\n      hover=${hover}\n      @mousemove=${() => {\n        this._activeItem = item;\n        this._openSubMenu(item);\n      }}\n      @touchstart=${() => {\n        isSubMenuItem(item) &&\n          (this._currentSubMenu === item\n            ? this._closeSubMenu()\n            : this._openSubMenu(item));\n      }}\n    >\n      ${icon && html`<div class=\"slash-menu-item-icon\">${icon}</div>`}\n      <div slot=\"suffix\" style=\"transform: rotate(-90deg);\">\n        ${ArrowDownIcon}\n      </div>\n    </icon-button>`;\n  };\n\n  private _renderItem = (item: SlashMenuStaticItem) => {\n    if (isGroupDivider(item)) return this._renderGroupItem(item);\n    else if (isActionItem(item)) return this._renderActionItem(item);\n    else if (isSubMenuItem(item)) return this._renderSubMenuItem(item);\n    else throw new Error('Unreachable');\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    // close all sub menus\n    this.abortController?.signal?.addEventListener('abort', () => {\n      this._subMenuAbortController?.abort();\n    });\n    this.addEventListener('wheel', event => {\n      if (this._currentSubMenu) {\n        event.preventDefault();\n      }\n    });\n\n    const inlineEditor = getInlineEditorByModel(\n      this.context.rootElement.host,\n      this.context.model\n    );\n    assertExists(inlineEditor, 'RichText InlineEditor not found');\n\n    inlineEditor.eventSource.addEventListener(\n      'keydown',\n      event => {\n        if (this._currentSubMenu) return;\n        if (event.isComposing) return;\n\n        const { key, ctrlKey, metaKey, altKey, shiftKey } = event;\n\n        const onlyCmd = (ctrlKey || metaKey) && !altKey && !shiftKey;\n        const onlyShift = shiftKey && !isControlledKeyboardEvent(event);\n        const notControlShift = !(ctrlKey || metaKey || altKey || shiftKey);\n\n        let moveStep = 0;\n        if (\n          (key === 'ArrowUp' && notControlShift) ||\n          (key === 'Tab' && onlyShift) ||\n          (key === 'P' && onlyCmd) ||\n          (key === 'p' && onlyCmd)\n        ) {\n          moveStep = -1;\n        }\n\n        if (\n          (key === 'ArrowDown' && notControlShift) ||\n          (key === 'Tab' && notControlShift) ||\n          (key === 'n' && onlyCmd) ||\n          (key === 'N' && onlyCmd)\n        ) {\n          moveStep = 1;\n        }\n\n        if (moveStep !== 0) {\n          let itemIndex = this.menu.indexOf(this._activeItem);\n          do {\n            itemIndex =\n              (itemIndex + moveStep + this.menu.length) % this.menu.length;\n          } while (isGroupDivider(this.menu[itemIndex]));\n\n          this._activeItem = this.menu[itemIndex] as typeof this._activeItem;\n          this._scrollToItem(this._activeItem);\n\n          event.preventDefault();\n          event.stopPropagation();\n        }\n\n        if (key === 'ArrowRight' && notControlShift) {\n          if (isSubMenuItem(this._activeItem)) {\n            this._openSubMenu(this._activeItem);\n          }\n\n          event.preventDefault();\n          event.stopPropagation();\n        }\n\n        if ((key === 'ArrowLeft' || key === 'Escape') && notControlShift) {\n          this.abortController.abort();\n\n          event.preventDefault();\n          event.stopPropagation();\n        }\n\n        if (key === 'Enter' && notControlShift) {\n          if (isSubMenuItem(this._activeItem)) {\n            this._openSubMenu(this._activeItem);\n          } else if (isActionItem(this._activeItem)) {\n            this.context.onClickItem(this._activeItem);\n          }\n\n          event.preventDefault();\n          event.stopPropagation();\n        }\n      },\n      {\n        capture: true,\n        signal: this.abortController.signal,\n      }\n    );\n  }\n\n  override disconnectedCallback() {\n    this.abortController.abort();\n  }\n\n  override willUpdate(changedProperties: PropertyValues<this>) {\n    if (changedProperties.has('menu') && this.menu.length !== 0) {\n      const firstItem = getFirstNotDividerItem(this.menu);\n      assertExists(firstItem);\n      this._activeItem = firstItem;\n\n      // this case happen on query updated\n      this._subMenuAbortController?.abort();\n    }\n  }\n\n  override render() {\n    if (this.menu.length === 0) return nothing;\n\n    const style = styleMap(this.mainMenuStyle ?? { position: 'relative' });\n\n    return html`<div\n      class=\"slash-menu\"\n      style=${style}\n      data-testid=${`sub-menu-${this.depth}`}\n    >\n      ${this.menu.map(this._renderItem)}\n    </div>`;\n  }\n}\n"]}