{"version":3,"file":"change-note-button.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/element-toolbar/change-note-button.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../edgeless/components/buttons/tool-icon-button.js';\nimport '../../edgeless/components/buttons/menu-button.js';\nimport '../../edgeless/components/panel/color-panel.js';\nimport '../../edgeless/components/panel/note-shadow-panel.js';\nimport '../../edgeless/components/panel/note-display-mode-panel.js';\nimport '../../edgeless/components/panel/scale-panel.js';\nimport '../../edgeless/components/panel/size-panel.js';\n\nimport { WithDisposable } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { html, LitElement, nothing, type TemplateResult } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { join } from 'lit/directives/join.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\n\nimport { NOTE_BACKGROUND_COLORS } from '../../../_common/edgeless/note/consts.js';\nimport {\n  ExpandIcon,\n  LineStyleIcon,\n  NoteCornerIcon,\n  NoteShadowIcon,\n  ScissorsIcon,\n  ShrinkIcon,\n  SmallArrowDownIcon,\n} from '../../../_common/icons/index.js';\nimport type { CssVariableName } from '../../../_common/theme/css-variables.js';\nimport { NoteDisplayMode } from '../../../_common/types.js';\nimport { matchFlavours } from '../../../_common/utils/model.js';\nimport type { NoteBlockModel } from '../../../note-block/note-model.js';\nimport type { StrokeStyle } from '../../../surface-block/index.js';\nimport { Bound } from '../../../surface-block/index.js';\nimport {\n  type EdgelessMenuButton,\n  renderMenuDivider,\n} from '../../edgeless/components/buttons/menu-button.js';\nimport type { ColorEvent } from '../../edgeless/components/panel/color-panel.js';\nimport {\n  type LineStyleEvent,\n  LineStylesPanel,\n} from '../../edgeless/components/panel/line-styles-panel.js';\nimport { getTooltipWithShortcut } from '../../edgeless/components/utils.js';\nimport type { EdgelessRootBlockComponent } from '../../edgeless/edgeless-root-block.js';\n\nconst SIZE_LIST = [\n  {\n    name: 'None',\n    value: 0,\n  },\n  {\n    name: 'Small',\n    value: 8,\n  },\n  {\n    name: 'Medium',\n    value: 16,\n  },\n  {\n    name: 'Large',\n    value: 24,\n  },\n  {\n    name: 'Huge',\n    value: 32,\n  },\n] as const;\n\nconst DisplayModeMap = {\n  [NoteDisplayMode.DocAndEdgeless]: 'Both',\n  [NoteDisplayMode.EdgelessOnly]: 'Edgeless',\n  [NoteDisplayMode.DocOnly]: 'Page',\n} as const satisfies Record<NoteDisplayMode, string>;\n\n@customElement('edgeless-change-note-button')\nexport class EdgelessChangeNoteButton extends WithDisposable(LitElement) {\n  private get doc() {\n    return this.edgeless.doc;\n  }\n\n  private accessor _scalePanelRef: Ref<EdgelessMenuButton> = createRef();\n\n  private accessor _cornersPanelRef: Ref<EdgelessMenuButton> = createRef();\n\n  @property({ attribute: false })\n  accessor notes: NoteBlockModel[] = [];\n\n  @property({ attribute: false })\n  accessor enableNoteSlicer!: boolean;\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  @property({ attribute: false })\n  accessor quickConnectButton!: TemplateResult<1>;\n\n  private _setBackground(background: CssVariableName) {\n    this.notes.forEach(note => {\n      this.doc.updateBlock(note, { background });\n    });\n    this.edgeless.service.editPropsStore.record('affine:note', {\n      background,\n    } as Record<string, unknown>);\n  }\n\n  private _setShadowType(shadowType: string) {\n    this.notes.forEach(note => {\n      this.doc.updateBlock(note, () => {\n        note.edgeless.style.shadowType = shadowType;\n      });\n    });\n  }\n\n  private _setDisplayMode(note: NoteBlockModel, newMode: NoteDisplayMode) {\n    const { displayMode: currentMode } = note;\n    if (newMode === currentMode) {\n      return;\n    }\n\n    this.doc.updateBlock(note, { displayMode: newMode });\n\n    const noteParent = this.doc.getParent(note);\n    assertExists(noteParent);\n    const noteParentChildNotes = noteParent.children.filter(block =>\n      matchFlavours(block, ['affine:note'])\n    ) as NoteBlockModel[];\n    const noteParentLastNote =\n      noteParentChildNotes[noteParentChildNotes.length - 1];\n\n    if (\n      currentMode === NoteDisplayMode.EdgelessOnly &&\n      newMode !== NoteDisplayMode.EdgelessOnly &&\n      note !== noteParentLastNote\n    ) {\n      // move to the end\n      this.doc.moveBlocks([note], noteParent, noteParentLastNote, false);\n    }\n\n    // if change note to page only, should clear the selection\n    if (newMode === NoteDisplayMode.DocOnly) {\n      this.edgeless.service.selection.clear();\n    }\n  }\n\n  private _setStrokeWidth(borderSize: number) {\n    this.notes.forEach(note => {\n      this.doc.updateBlock(note, () => {\n        note.edgeless.style.borderSize = borderSize;\n      });\n    });\n  }\n\n  private _setStrokeStyle(borderStyle: StrokeStyle) {\n    this.notes.forEach(note => {\n      this.doc.updateBlock(note, () => {\n        note.edgeless.style.borderStyle = borderStyle;\n      });\n    });\n  }\n\n  private _setStyles({ type, value }: LineStyleEvent) {\n    if (type === 'size') {\n      this._setStrokeWidth(value);\n      return;\n    }\n    if (type === 'lineStyle') {\n      this._setStrokeStyle(value);\n    }\n  }\n\n  private _setBorderRadius = (size: number) => {\n    this.notes.forEach(note => {\n      this.doc.updateBlock(note, () => {\n        note.edgeless.style.borderRadius = size;\n      });\n    });\n  };\n\n  private _setNoteScale = (scale: number) => {\n    this.notes.forEach(note => {\n      this.doc.updateBlock(note, () => {\n        const bound = Bound.deserialize(note.xywh);\n        const oldScale = note.edgeless.scale ?? 1;\n        const ratio = scale / oldScale;\n        bound.w *= ratio;\n        bound.h *= ratio;\n        const xywh = bound.serialize();\n        note.xywh = xywh;\n        note.edgeless.scale = scale;\n      });\n    });\n  };\n\n  private _setCollapse() {\n    this.notes.forEach(note => {\n      const { collapse, collapsedHeight } = note.edgeless;\n\n      if (collapse) {\n        this.doc.updateBlock(note, () => {\n          note.edgeless.collapse = false;\n        });\n      } else if (collapsedHeight) {\n        const { xywh, edgeless } = note;\n        const bound = Bound.deserialize(xywh);\n        bound.h = collapsedHeight * (edgeless.scale ?? 1);\n        this.doc.updateBlock(note, () => {\n          note.edgeless.collapse = true;\n          note.xywh = bound.serialize();\n        });\n      }\n    });\n    this.requestUpdate();\n  }\n\n  private _handleNoteSlicerButtonClick() {\n    const surfaceService = this.edgeless.service;\n    if (!surfaceService) return;\n\n    this.edgeless.slots.toggleNoteSlicer.emit();\n  }\n\n  private _getScaleLabel(scale: number) {\n    return Math.round(scale * 100) + '%';\n  }\n\n  override render() {\n    const length = this.notes.length;\n    const note = this.notes[0];\n    const { background, edgeless, displayMode } = note;\n    const { shadowType, borderRadius, borderSize, borderStyle } =\n      edgeless.style;\n\n    const { collapse } = edgeless;\n    const scale = edgeless.scale ?? 1;\n    const currentMode = DisplayModeMap[displayMode];\n    const onlyOne = length === 1;\n    const isDocOnly = displayMode === NoteDisplayMode.DocOnly;\n\n    const buttons = [\n      onlyOne\n        ? html`\n            <span class=\"display-mode-button-label\">Show in</span>\n            <edgeless-menu-button\n              .contentPadding=${'8px'}\n              .button=${html`\n                <edgeless-tool-icon-button\n                  aria-label=\"Mode\"\n                  .tooltip=${'Display mode'}\n                  .justify=${'space-between'}\n                  .withHover=${true}\n                  .labelHeight=${'20px'}\n                >\n                  <span class=\"label\">${currentMode}</span>\n                  ${SmallArrowDownIcon}\n                </edgeless-tool-icon-button>\n              `}\n            >\n              <note-display-mode-panel\n                slot\n                .displayMode=${displayMode}\n                .onSelect=${(newMode: NoteDisplayMode) =>\n                  this._setDisplayMode(note, newMode)}\n              >\n              </note-display-mode-panel>\n            </edgeless-menu-button>\n          `\n        : nothing,\n\n      isDocOnly\n        ? nothing\n        : html`\n            <edgeless-menu-button\n              .contentPadding=${'8px'}\n              .button=${html`\n                <edgeless-tool-icon-button\n                  aria-label=\"Background\"\n                  .tooltip=${'Background'}\n                >\n                  <edgeless-color-button\n                    .color=${background}\n                  ></edgeless-color-button>\n                </edgeless-tool-icon-button>\n              `}\n            >\n              <edgeless-color-panel\n                slot\n                .value=${background}\n                .options=${NOTE_BACKGROUND_COLORS}\n                @select=${(e: ColorEvent) => this._setBackground(e.detail)}\n              >\n              </edgeless-color-panel>\n            </edgeless-menu-button>\n          `,\n\n      isDocOnly\n        ? nothing\n        : html`\n            <edgeless-menu-button\n              .contentPadding=${'6px'}\n              .button=${html`\n                <edgeless-tool-icon-button\n                  aria-label=\"Shadow style\"\n                  .tooltip=${'Shadow style'}\n                >\n                  ${NoteShadowIcon}${SmallArrowDownIcon}\n                </edgeless-tool-icon-button>\n              `}\n            >\n              <edgeless-note-shadow-panel\n                slot\n                .value=${shadowType}\n                .background=${background}\n                .onSelect=${(value: string) => this._setShadowType(value)}\n              >\n              </edgeless-note-shadow-panel>\n            </edgeless-menu-button>\n\n            <edgeless-menu-button\n              .button=${html`\n                <edgeless-tool-icon-button\n                  aria-label=\"Border style\"\n                  .tooltip=${'Border style'}\n                >\n                  ${LineStyleIcon}${SmallArrowDownIcon}\n                </edgeless-tool-icon-button>\n              `}\n            >\n              <div slot data-orientation=\"horizontal\">\n                ${LineStylesPanel({\n                  selectedLineSize: borderSize,\n                  selectedLineStyle: borderStyle,\n                  onClick: event => this._setStyles(event),\n                })}\n              </div>\n            </edgeless-menu-button>\n\n            <edgeless-menu-button\n              ${ref(this._cornersPanelRef)}\n              .contentPadding=${'8px'}\n              .button=${html`\n                <edgeless-tool-icon-button\n                  aria-label=\"Corners\"\n                  .tooltip=${'Corners'}\n                >\n                  ${NoteCornerIcon}${SmallArrowDownIcon}\n                </edgeless-tool-icon-button>\n              `}\n            >\n              <edgeless-size-panel\n                slot\n                .size=${borderRadius}\n                .sizeList=${SIZE_LIST}\n                .minSize=${0}\n                .onSelect=${(size: number) => this._setBorderRadius(size)}\n                .onPopperCose=${() => this._cornersPanelRef.value?.close()}\n              >\n              </edgeless-size-panel>\n            </edgeless-menu-button>\n          `,\n\n      onlyOne\n        ? html`\n            <edgeless-tool-icon-button\n              aria-label=\"Slicer\"\n              .tooltip=${getTooltipWithShortcut('Cutting mode', '-')}\n              .active=${this.enableNoteSlicer}\n              @click=${() => this._handleNoteSlicerButtonClick()}\n            >\n              ${ScissorsIcon}\n            </edgeless-tool-icon-button>\n          `\n        : nothing,\n\n      onlyOne ? this.quickConnectButton : nothing,\n\n      html`\n        <edgeless-tool-icon-button\n          aria-label=\"Size\"\n          .tooltip=${collapse ? 'Auto height' : 'Customized height'}\n          @click=${() => this._setCollapse()}\n        >\n          ${collapse ? ExpandIcon : ShrinkIcon}\n        </edgeless-tool-icon-button>\n\n        <edgeless-menu-button\n          ${ref(this._scalePanelRef)}\n          .contentPadding=${'8px'}\n          .button=${html`\n            <edgeless-tool-icon-button\n              aria-label=\"Scale\"\n              .tooltip=${'Scale'}\n              .justify=${'space-between'}\n              .labelHeight=${'20px'}\n              .iconContainerWidth=${'65px'}\n            >\n              <span class=\"label\">${this._getScaleLabel(scale)}</span\n              >${SmallArrowDownIcon}\n            </edgeless-tool-icon-button>\n          `}\n        >\n          <edgeless-scale-panel\n            slot\n            .scale=${Math.round(scale * 100)}\n            .onSelect=${(scale: number) => this._setNoteScale(scale)}\n            .onPopperCose=${() => this._scalePanelRef.value?.close()}\n          ></edgeless-scale-panel>\n        </edgeless-menu-button>\n      `,\n    ];\n\n    return join(\n      buttons.filter(button => button !== nothing),\n      renderMenuDivider\n    );\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-change-note-button': EdgelessChangeNoteButton;\n  }\n}\n\nexport function renderNoteButton(\n  edgeless: EdgelessRootBlockComponent,\n  notes?: NoteBlockModel[],\n  quickConnectButton?: TemplateResult<1>[]\n) {\n  if (!notes?.length) return nothing;\n\n  return html`\n    <edgeless-change-note-button\n      .notes=${notes}\n      .edgeless=${edgeless}\n      .enableNoteSlicer=${false}\n      .quickConnectButton=${quickConnectButton?.pop() ?? nothing}\n    >\n    </edgeless-change-note-button>\n  `;\n}\n"]}