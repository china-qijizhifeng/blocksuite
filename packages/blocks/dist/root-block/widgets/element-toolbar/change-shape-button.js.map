{"version":3,"file":"change-shape-button.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/element-toolbar/change-shape-button.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../edgeless/components/buttons/tool-icon-button.js';\nimport '../../edgeless/components/buttons/menu-button.js';\nimport '../../edgeless/components/panel/stroke-style-panel.js';\nimport '../../edgeless/components/panel/color-panel.js';\nimport '../../edgeless/components/panel/shape-style-panel.js';\nimport '../../edgeless/components/panel/shape-panel.js';\nimport './change-text-menu.js';\n\nimport { WithDisposable } from '@blocksuite/block-std';\nimport { html, LitElement, nothing, type TemplateResult } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { cache } from 'lit/directives/cache.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { join } from 'lit/directives/join.js';\n\nimport {\n  AddTextIcon,\n  ChangeShapeIcon,\n  GeneralStyleIcon,\n  ScribbledStyleIcon,\n  SmallArrowDownIcon,\n} from '../../../_common/icons/index.js';\nimport type { CssVariableName } from '../../../_common/theme/css-variables.js';\nimport { LineWidth } from '../../../_common/types.js';\nimport { countBy, maxBy } from '../../../_common/utils/iterable.js';\nimport { FontFamily } from '../../../surface-block/consts.js';\nimport {\n  FILL_COLORS,\n  ShapeType,\n  STROKE_COLORS,\n} from '../../../surface-block/elements/shape/consts.js';\nimport {\n  type ShapeElementModel,\n  ShapeStyle,\n  StrokeStyle,\n} from '../../../surface-block/index.js';\nimport { lineSizeButtonStyles } from '../../edgeless/components/buttons/line-size-button.js';\nimport { renderMenuDivider } from '../../edgeless/components/buttons/menu-button.js';\nimport type { ColorEvent } from '../../edgeless/components/panel/color-panel.js';\nimport {\n  GET_DEFAULT_LINE_COLOR,\n  isTransparent,\n} from '../../edgeless/components/panel/color-panel.js';\nimport type { LineStyleEvent } from '../../edgeless/components/panel/line-styles-panel.js';\nimport type { EdgelessShapePanel } from '../../edgeless/components/panel/shape-panel.js';\nimport type { ShapeTool } from '../../edgeless/controllers/tools/shape-tool.js';\nimport type { EdgelessRootBlockComponent } from '../../edgeless/edgeless-root-block.js';\nimport {\n  SHAPE_FILL_COLOR_BLACK,\n  SHAPE_TEXT_COLOR_PURE_BLACK,\n  SHAPE_TEXT_COLOR_PURE_WHITE,\n} from '../../edgeless/utils/consts.js';\nimport { mountShapeTextEditor } from '../../edgeless/utils/text.js';\n\nfunction getMostCommonShape(\n  elements: ShapeElementModel[]\n): ShapeTool['shapeType'] | null {\n  const shapeTypes = countBy(elements, (ele: ShapeElementModel) => {\n    return ele.shapeType === 'rect' && ele.radius\n      ? 'roundedRect'\n      : ele.shapeType;\n  });\n  const max = maxBy(Object.entries(shapeTypes), ([_k, count]) => count);\n  return max ? (max[0] as ShapeTool['shapeType']) : null;\n}\n\nfunction getMostCommonFillColor(elements: ShapeElementModel[]): string | null {\n  const colors = countBy(elements, (ele: ShapeElementModel) => {\n    return ele.filled ? ele.fillColor : '--affine-palette-transparent';\n  });\n  const max = maxBy(Object.entries(colors), ([_k, count]) => count);\n  return max ? (max[0] as string) : null;\n}\n\nfunction getMostCommonStrokeColor(\n  elements: ShapeElementModel[]\n): string | null {\n  const colors = countBy(elements, (ele: ShapeElementModel) => {\n    return ele.strokeColor;\n  });\n  const max = maxBy(Object.entries(colors), ([_k, count]) => count);\n  return max ? (max[0] as string) : null;\n}\n\nfunction getMostCommonLineSize(elements: ShapeElementModel[]): LineWidth {\n  const sizes = countBy(elements, (ele: ShapeElementModel) => {\n    return ele.strokeWidth;\n  });\n  const max = maxBy(Object.entries(sizes), ([_k, count]) => count);\n  return max ? (Number(max[0]) as LineWidth) : LineWidth.Four;\n}\n\nfunction getMostCommonLineStyle(\n  elements: ShapeElementModel[]\n): StrokeStyle | null {\n  const sizes = countBy(elements, (ele: ShapeElementModel) => ele.strokeStyle);\n  const max = maxBy(Object.entries(sizes), ([_k, count]) => count);\n  return max ? (max[0] as StrokeStyle) : null;\n}\n\nfunction getMostCommonShapeStyle(elements: ShapeElementModel[]): ShapeStyle {\n  const roughnesses = countBy(elements, (ele: ShapeElementModel) => {\n    return ele.shapeStyle;\n  });\n  const max = maxBy(Object.entries(roughnesses), ([_k, count]) => count);\n  return max ? (max[0] as ShapeStyle) : ShapeStyle.Scribbled;\n}\n\n@customElement('edgeless-change-shape-button')\nexport class EdgelessChangeShapeButton extends WithDisposable(LitElement) {\n  get service() {\n    return this.edgeless.service;\n  }\n\n  static override styles = [lineSizeButtonStyles];\n\n  @query('edgeless-shape-panel')\n  private accessor _shapePanel!: EdgelessShapePanel;\n\n  @property({ attribute: false })\n  accessor elements: ShapeElementModel[] = [];\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  private _getTextColor(fillColor: CssVariableName) {\n    // When the shape is filled with black color, the text color should be white.\n    // When the shape is transparent, the text color should be set according to the theme.\n    // Otherwise, the text color should be black.\n    const textColor = isTransparent(fillColor)\n      ? GET_DEFAULT_LINE_COLOR()\n      : fillColor === SHAPE_FILL_COLOR_BLACK\n        ? SHAPE_TEXT_COLOR_PURE_WHITE\n        : SHAPE_TEXT_COLOR_PURE_BLACK;\n\n    return textColor;\n  }\n\n  private _setShapeFillColor(fillColor: CssVariableName) {\n    const filled = !isTransparent(fillColor);\n    const color = this._getTextColor(fillColor);\n    this.elements.forEach(ele =>\n      this.service.updateElement(ele.id, { filled, fillColor, color })\n    );\n  }\n\n  private _setShapeStrokeColor(strokeColor: CssVariableName) {\n    this.elements.forEach(ele =>\n      this.service.updateElement(ele.id, { strokeColor })\n    );\n  }\n\n  private _setShapeStrokeWidth(strokeWidth: number) {\n    this.elements.forEach(ele =>\n      this.service.updateElement(ele.id, { strokeWidth })\n    );\n  }\n\n  private _setShapeStrokeStyle(strokeStyle: StrokeStyle) {\n    this.elements.forEach(ele =>\n      this.service.updateElement(ele.id, { strokeStyle })\n    );\n  }\n\n  private _setShapeStyles({ type, value }: LineStyleEvent) {\n    if (type === 'size') {\n      this._setShapeStrokeWidth(value);\n      return;\n    }\n    if (type === 'lineStyle') {\n      this._setShapeStrokeStyle(value);\n    }\n  }\n\n  private _setShapeStyle(shapeStyle: ShapeStyle) {\n    const fontFamily =\n      shapeStyle === ShapeStyle.General ? FontFamily.Inter : FontFamily.Kalam;\n\n    this.elements.forEach(ele => {\n      this.service.updateElement(ele.id, { shapeStyle, fontFamily });\n    });\n  }\n\n  private _addText() {\n    mountShapeTextEditor(this.elements[0], this.edgeless);\n  }\n\n  private _showAddButtonOrTextMenu() {\n    if (this.elements.length === 1 && !this.elements[0].text) {\n      return 'button';\n    }\n    if (!this.elements.some(e => !e.text)) {\n      return 'menu';\n    }\n    return 'nothing';\n  }\n\n  override firstUpdated(changedProperties: Map<string, unknown>) {\n    const _disposables = this._disposables;\n\n    _disposables.add(\n      this._shapePanel.slots.select.on(shapeType => {\n        const updatedProps =\n          shapeType === 'roundedRect'\n            ? ({ shapeType: ShapeType.Rect, radius: 0.1 } as const)\n            : { shapeType, radius: 0 };\n\n        this.edgeless.doc.captureSync();\n        this.elements.forEach(element => {\n          this.service.updateElement(element.id, updatedProps);\n        });\n      })\n    );\n\n    super.firstUpdated(changedProperties);\n  }\n\n  override render() {\n    const elements = this.elements;\n    const selectedShape = getMostCommonShape(elements);\n    const selectedFillColor =\n      getMostCommonFillColor(elements) ?? FILL_COLORS[0];\n    const selectedStrokeColor =\n      getMostCommonStrokeColor(elements) ?? STROKE_COLORS[0];\n    const selectedLineSize = getMostCommonLineSize(elements) ?? LineWidth.Four;\n    const selectedLineStyle =\n      getMostCommonLineStyle(elements) ?? StrokeStyle.Solid;\n    const selectedShapeStyle =\n      getMostCommonShapeStyle(elements) ?? ShapeStyle.Scribbled;\n\n    return join(\n      [\n        html`\n          <edgeless-menu-button\n            .button=${html`\n              <edgeless-tool-icon-button\n                aria-label=\"Switch type\"\n                .tooltip=${'Switch type'}\n              >\n                ${ChangeShapeIcon}${SmallArrowDownIcon}\n              </edgeless-tool-icon-button>\n            `}\n          >\n            <edgeless-shape-panel\n              slot\n              .selectedShape=${selectedShape}\n              .shapeStyle=${selectedShapeStyle}\n            >\n            </edgeless-shape-panel>\n          </edgeless-menu-button>\n        `,\n\n        html`\n          <edgeless-menu-button\n            .button=${html`\n              <edgeless-tool-icon-button aria-label=\"Style\" .tooltip=${'Style'}>\n                ${cache(\n                  selectedShapeStyle === ShapeStyle.General\n                    ? GeneralStyleIcon\n                    : ScribbledStyleIcon\n                )}\n                ${SmallArrowDownIcon}\n              </edgeless-tool-icon-button>\n            `}\n          >\n            <edgeless-shape-style-panel\n              slot\n              .value=${selectedShapeStyle}\n              .onSelect=${(value: ShapeStyle) => this._setShapeStyle(value)}\n            >\n            </edgeless-shape-style-panel>\n          </edgeless-menu-button>\n        `,\n\n        html`\n          <edgeless-menu-button\n            .contentPadding=${'8px'}\n            .button=${html`\n              <edgeless-tool-icon-button\n                aria-label=\"Fill color\"\n                .tooltip=${'Fill color'}\n              >\n                <edgeless-color-button\n                  .color=${selectedFillColor}\n                ></edgeless-color-button>\n              </edgeless-tool-icon-button>\n            `}\n          >\n            <edgeless-color-panel\n              slot\n              role=\"listbox\"\n              aria-label=\"Fill colors\"\n              .value=${selectedFillColor}\n              .options=${FILL_COLORS}\n              @select=${(e: ColorEvent) => this._setShapeFillColor(e.detail)}\n            >\n            </edgeless-color-panel>\n          </edgeless-menu-button>\n        `,\n\n        html`\n          <edgeless-menu-button\n            .contentPadding=${'8px'}\n            .button=${html`\n              <edgeless-tool-icon-button\n                aria-label=\"Border style\"\n                .tooltip=${'Border style'}\n              >\n                <edgeless-color-button\n                  .color=${selectedStrokeColor}\n                  .hollowCircle=${true}\n                ></edgeless-color-button>\n              </edgeless-tool-icon-button>\n            `}\n          >\n            <stroke-style-panel\n              slot\n              .hollowCircle=${true}\n              .strokeWidth=${selectedLineSize}\n              .strokeStyle=${selectedLineStyle}\n              .strokeColor=${selectedStrokeColor}\n              .setStrokeStyle=${(e: LineStyleEvent) => this._setShapeStyles(e)}\n              .setStrokeColor=${(e: ColorEvent) =>\n                this._setShapeStrokeColor(e.detail)}\n            >\n            </stroke-style-panel>\n          </edgeless-menu-button>\n        `,\n\n        choose<string, TemplateResult<1> | typeof nothing>(\n          this._showAddButtonOrTextMenu(),\n          [\n            [\n              'button',\n              () => html`\n                <edgeless-tool-icon-button\n                  aria-label=\"Add text\"\n                  .tooltip=${'Add text'}\n                  @click=${this._addText}\n                >\n                  ${AddTextIcon}\n                </edgeless-tool-icon-button>\n              `,\n            ],\n            [\n              'menu',\n              () => html`\n                <edgeless-change-text-menu\n                  .elementType=${'shape'}\n                  .elements=${elements}\n                  .edgeless=${this.edgeless}\n                ></edgeless-change-text-menu>\n              `,\n            ],\n            ['nothing', () => nothing],\n          ]\n        ),\n      ].filter(button => button !== nothing),\n      renderMenuDivider\n    );\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-change-shape-button': EdgelessChangeShapeButton;\n  }\n}\n\nexport function renderChangeShapeButton(\n  edgeless: EdgelessRootBlockComponent,\n  elements?: ShapeElementModel[]\n) {\n  if (!elements?.length) return nothing;\n  if (elements.some(e => edgeless.service.surface.isInMindmap(e.id)))\n    return nothing;\n\n  return html`\n    <edgeless-change-shape-button .elements=${elements} .edgeless=${edgeless}>\n    </edgeless-change-shape-button>\n  `;\n}\n"]}