{"version":3,"file":"change-frame-button.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/element-toolbar/change-frame-button.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../edgeless/components/buttons/tool-icon-button.js';\nimport '../../edgeless/components/buttons/menu-button.js';\n\nimport { WithDisposable } from '@blocksuite/block-std';\nimport { html, LitElement, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { join } from 'lit/directives/join.js';\n\nimport { toast } from '../../../_common/components/toast.js';\nimport { NoteIcon, RenameIcon } from '../../../_common/icons/index.js';\nimport type { CssVariableName } from '../../../_common/theme/css-variables.js';\nimport { NoteDisplayMode } from '../../../_common/types.js';\nimport { matchFlavours } from '../../../_common/utils/model.js';\nimport type { FrameBlockModel } from '../../../frame-block/index.js';\nimport {\n  deserializeXYWH,\n  serializeXYWH,\n} from '../../../surface-block/index.js';\nimport { renderMenuDivider } from '../../edgeless/components/buttons/menu-button.js';\nimport type { ColorEvent } from '../../edgeless/components/panel/color-panel.js';\nimport type { EdgelessRootBlockComponent } from '../../edgeless/edgeless-root-block.js';\nimport { DEFAULT_NOTE_HEIGHT } from '../../edgeless/utils/consts.js';\nimport { mountFrameTitleEditor } from '../../edgeless/utils/text.js';\n\nconst FRAME_BACKGROUND: CssVariableName[] = [\n  '--affine-tag-gray',\n  '--affine-tag-red',\n  '--affine-tag-orange',\n  '--affine-tag-yellow',\n  '--affine-tag-green',\n  '--affine-tag-teal',\n  '--affine-tag-blue',\n  '--affine-tag-purple',\n  '--affine-tag-pink',\n  '--affine-palette-transparent',\n] as const;\n\n@customElement('edgeless-change-frame-button')\nexport class EdgelessChangeFrameButton extends WithDisposable(LitElement) {\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  @property({ attribute: false })\n  accessor frames: FrameBlockModel[] = [];\n\n  get service() {\n    return this.edgeless.service;\n  }\n\n  private _setFrameBackground(color: CssVariableName) {\n    this.frames.forEach(frame => {\n      this.service.updateElement(frame.id, { background: color });\n    });\n  }\n\n  private _insertIntoPage() {\n    if (!this.edgeless.doc.root) return;\n\n    const rootModel = this.edgeless.doc.root;\n    const notes = rootModel.children.filter(\n      model =>\n        matchFlavours(model, ['affine:note']) &&\n        model.displayMode !== NoteDisplayMode.EdgelessOnly\n    );\n    const lastNote = notes[notes.length - 1];\n    const referenceFrame = this.frames[0];\n\n    let targetParent = lastNote?.id;\n\n    if (!lastNote) {\n      const targetXYWH = deserializeXYWH(referenceFrame.xywh);\n\n      targetXYWH[1] = targetXYWH[1] + targetXYWH[3];\n      targetXYWH[3] = DEFAULT_NOTE_HEIGHT;\n\n      const newAddedNote = this.edgeless.doc.addBlock(\n        'affine:note',\n        {\n          xywh: serializeXYWH(...targetXYWH),\n        },\n        rootModel.id\n      );\n\n      targetParent = newAddedNote;\n    }\n\n    this.edgeless.doc.addBlock(\n      'affine:surface-ref',\n      {\n        reference: this.frames[0].id,\n        refFlavour: 'affine:frame',\n      },\n      targetParent\n    );\n\n    toast(this.edgeless.host, 'Frame has been inserted into doc');\n  }\n\n  protected override render() {\n    const { frames } = this;\n    const onlyOne = frames.length === 1;\n    const background = frames[0].background;\n\n    return join(\n      [\n        onlyOne\n          ? html`\n              <edgeless-tool-icon-button\n                arai-label=${'Insert into Page'}\n                .tooltip=${'Insert into Page'}\n                .iconSize=${'20px'}\n                .labelHeight=${'20px'}\n                @click=${this._insertIntoPage}\n              >\n                ${NoteIcon}\n                <span class=\"label\">Insert into Page</span>\n              </edgeless-tool-icon-button>\n            `\n          : nothing,\n\n        onlyOne\n          ? html`\n              <edgeless-tool-icon-button\n                aria-label=\"Rename\"\n                .tooltip=${'Rename'}\n                .iconSize=${'20px'}\n                @click=${() =>\n                  mountFrameTitleEditor(this.frames[0], this.edgeless)}\n              >\n                ${RenameIcon}\n              </edgeless-tool-icon-button>\n            `\n          : nothing,\n\n        html`\n          <edgeless-menu-button\n            .contentPadding=${'8px'}\n            .button=${html`\n              <edgeless-tool-icon-button\n                aria-label=\"Background\"\n                .tooltip=${'Background'}\n              >\n                <edgeless-color-button\n                  .color=${background}\n                ></edgeless-color-button>\n              </edgeless-tool-icon-button>\n            `}\n          >\n            <edgeless-color-panel\n              slot\n              .value=${background}\n              .options=${FRAME_BACKGROUND}\n              @select=${(e: ColorEvent) => this._setFrameBackground(e.detail)}\n            >\n            </edgeless-color-panel>\n          </edgeless-menu-button>\n        `,\n      ].filter(button => button !== nothing),\n      renderMenuDivider\n    );\n  }\n}\n\nexport function renderFrameButton(\n  edgeless: EdgelessRootBlockComponent,\n  frames?: FrameBlockModel[]\n) {\n  if (!frames?.length) return nothing;\n\n  return html`\n    <edgeless-change-frame-button\n      .edgeless=${edgeless}\n      .frames=${frames}\n    ></edgeless-change-frame-button>\n  `;\n}\n"]}