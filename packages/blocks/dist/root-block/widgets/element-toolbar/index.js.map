{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/element-toolbar/index.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../edgeless/components/buttons/tool-icon-button.js';\nimport '../../edgeless/components/buttons/menu-button.js';\nimport './more-button.js';\n\nimport { WidgetElement } from '@blocksuite/block-std';\nimport { baseTheme } from '@toeverything/theme';\nimport { css, html, nothing, type TemplateResult, unsafeCSS } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { join } from 'lit/directives/join.js';\n\nimport { ConnectorCWithArrowIcon } from '../../../_common/icons/edgeless.js';\nimport { stopPropagation } from '../../../_common/utils/event.js';\nimport {\n  atLeastNMatches,\n  groupBy,\n  pickValues,\n} from '../../../_common/utils/iterable.js';\nimport type { AttachmentBlockModel } from '../../../attachment-block/attachment-model.js';\nimport type { BookmarkBlockModel } from '../../../bookmark-block/bookmark-model.js';\nimport type { EdgelessTextBlockModel } from '../../../edgeless-text/edgeless-text-model.js';\nimport type { EmbedFigmaModel } from '../../../embed-figma-block/embed-figma-model.js';\nimport type { EmbedGithubModel } from '../../../embed-github-block/embed-github-model.js';\nimport type { EmbedHtmlModel } from '../../../embed-html-block/embed-html-model.js';\nimport type { EmbedLinkedDocModel } from '../../../embed-linked-doc-block/embed-linked-doc-model.js';\nimport type { EmbedLoomModel } from '../../../embed-loom-block/embed-loom-model.js';\nimport type { EmbedSyncedDocModel } from '../../../embed-synced-doc-block/embed-synced-doc-model.js';\nimport type { EmbedYoutubeModel } from '../../../embed-youtube-block/embed-youtube-model.js';\nimport type { FrameBlockModel } from '../../../frame-block/frame-model.js';\nimport type { ImageBlockModel } from '../../../image-block/image-model.js';\nimport type { NoteBlockModel } from '../../../note-block/note-model.js';\nimport type { MindmapElementModel } from '../../../surface-block/element-model/mindmap.js';\nimport {\n  ConnectorMode,\n  GroupElementModel,\n} from '../../../surface-block/index.js';\nimport {\n  type BrushElementModel,\n  clamp,\n  type ConnectorElementModel,\n  type ShapeElementModel,\n  type TextElementModel,\n} from '../../../surface-block/index.js';\nimport { renderMenuDivider } from '../../edgeless/components/buttons/menu-button.js';\nimport type { ConnectorToolController } from '../../edgeless/controllers/tools/connector-tool.js';\nimport type { EdgelessRootBlockComponent } from '../../edgeless/edgeless-root-block.js';\nimport { edgelessElementsBound } from '../../edgeless/utils/bound-utils.js';\nimport {\n  isAttachmentBlock,\n  isBookmarkBlock,\n  isEdgelessTextBlock,\n  isEmbeddedBlock,\n  isFrameBlock,\n  isImageBlock,\n  isNoteBlock,\n} from '../../edgeless/utils/query.js';\nimport type { RootBlockModel } from '../../root-model.js';\nimport { renderAddFrameButton } from './add-frame-button.js';\nimport { renderAddGroupButton } from './add-group-button.js';\nimport { renderAlignButton } from './align-button.js';\nimport { renderAttachmentButton } from './change-attachment-button.js';\nimport { renderChangeBrushButton } from './change-brush-button.js';\nimport { renderConnectorButton } from './change-connector-button.js';\nimport { renderChangeEdgelessTextButton } from './change-edgeless-text-button.js';\nimport { renderEmbedButton } from './change-embed-card-button.js';\nimport { renderFrameButton } from './change-frame-button.js';\nimport { renderGroupButton } from './change-group-button.js';\nimport { renderChangeImageButton } from './change-image-button.js';\nimport { renderMindmapButton } from './change-mindmap-button.js';\nimport { renderNoteButton } from './change-note-button.js';\nimport { renderChangeShapeButton } from './change-shape-button.js';\nimport { renderChangeTextButton } from './change-text-button.js';\nimport { renderReleaseFromGroupButton } from './release-from-group-button.js';\n\ntype CategorizedElements = {\n  shape?: ShapeElementModel[];\n  brush?: BrushElementModel[];\n  text?: TextElementModel[];\n  group?: GroupElementModel[];\n  connector?: ConnectorElementModel[];\n  note?: NoteBlockModel[];\n  frame?: FrameBlockModel[];\n  image?: ImageBlockModel[];\n  attachment?: AttachmentBlockModel[];\n  mindmap?: MindmapElementModel[];\n  embedCard?: BookmarkBlockModel[] &\n    EmbedGithubModel[] &\n    EmbedYoutubeModel[] &\n    EmbedFigmaModel[] &\n    EmbedLinkedDocModel[] &\n    EmbedSyncedDocModel[] &\n    EmbedHtmlModel[] &\n    EmbedLoomModel[];\n  edgelessText?: EdgelessTextBlockModel[];\n};\n\ntype CustomEntry = {\n  render: (edgeless: EdgelessRootBlockComponent) => TemplateResult | null;\n  when: (model: BlockSuite.EdgelessModelType[]) => boolean;\n};\n\nexport const EDGELESS_ELEMENT_TOOLBAR_WIDGET =\n  'edgeless-element-toolbar-widget';\n\n@customElement(EDGELESS_ELEMENT_TOOLBAR_WIDGET)\nexport class EdgelessElementToolbarWidget extends WidgetElement<\n  RootBlockModel,\n  EdgelessRootBlockComponent\n> {\n  get edgeless() {\n    return this.blockElement as EdgelessRootBlockComponent;\n  }\n\n  get selection() {\n    return this.edgeless.service.selection;\n  }\n\n  get slots() {\n    return this.edgeless.slots;\n  }\n\n  get surface() {\n    return this.edgeless.surface;\n  }\n\n  static override styles = css`\n    :host {\n      position: absolute;\n      z-index: 3;\n      transform: translateZ(0);\n      will-change: transform;\n      -webkit-user-select: none;\n      user-select: none;\n    }\n\n    .edgeless-component-toolbar-container {\n      display: flex;\n      height: 36px;\n      width: max-content;\n      padding: 0 6px;\n      align-items: center;\n      gap: 8px;\n      background: var(--affine-background-overlay-panel-color);\n      border: 0.5px solid var(--affine-border-color);\n      box-shadow: var(--affine-shadow-4);\n      border-radius: 4px;\n      box-sizing: content-box;\n\n      text-align: justify;\n      font-feature-settings:\n        'clig' off,\n        'liga' off;\n      font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n      font-size: var(--affine-font-sm);\n      font-style: normal;\n      font-weight: 400;\n      line-height: 22px; /* 157.143% */\n    }\n\n    .edgeless-component-toolbar-container > * {\n      height: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      gap: 8px;\n      color: var(--affine-text-primary-color);\n      fill: currentColor;\n    }\n  `;\n\n  @state()\n  private accessor _dragging = false;\n\n  @state()\n  private accessor _registeredEntries: {\n    render: (edgeless: EdgelessRootBlockComponent) => TemplateResult | null;\n    when: (model: BlockSuite.EdgelessModelType[]) => boolean;\n  }[] = [];\n\n  @property({ attribute: false })\n  accessor enableNoteSlicer!: boolean;\n\n  @state()\n  accessor toolbarVisible = false;\n\n  @state({\n    hasChanged: (value: string[], oldValue: string[]) => {\n      if (value.length !== oldValue?.length) {\n        return true;\n      }\n\n      return value.some((id, index) => id !== oldValue[index]);\n    },\n  })\n  accessor selectedIds: string[] = [];\n\n  private _groupSelected(): CategorizedElements {\n    const result = groupBy(this.selection.selectedElements, model => {\n      if (isNoteBlock(model)) {\n        return 'note';\n      } else if (isFrameBlock(model)) {\n        return 'frame';\n      } else if (isImageBlock(model)) {\n        return 'image';\n      } else if (isAttachmentBlock(model)) {\n        return 'attachment';\n      } else if (isBookmarkBlock(model) || isEmbeddedBlock(model)) {\n        return 'embedCard';\n      } else if (isEdgelessTextBlock(model)) {\n        return 'edgelessText';\n      }\n\n      return (model as BlockSuite.SurfaceElementModelType).type;\n    });\n    return result as CategorizedElements;\n  }\n\n  private _updateOnSelectedChange = (element: string | { id: string }) => {\n    const id = typeof element === 'string' ? element : element.id;\n\n    if (this.isConnected && !this._dragging && this.selection.has(id)) {\n      this._recalculatePosition();\n      this.requestUpdate();\n    }\n  };\n\n  private _recalculatePosition() {\n    const { selection, viewport } = this.edgeless.service;\n    const elements = selection.selectedElements;\n\n    if (elements.length === 0) {\n      this.style.transform = 'translate3d(0, 0, 0)';\n      return;\n    }\n\n    const bound = edgelessElementsBound(selection.selectedElements);\n\n    const { width, height } = viewport;\n    const [x, y] = viewport.toViewCoord(bound.x, bound.y);\n    const [right, bottom] = viewport.toViewCoord(bound.maxX, bound.maxY);\n\n    let left, top;\n    if (x >= width || right <= 0 || y >= height || bottom <= 0) {\n      left = x;\n      top = y;\n\n      this.style.transform = `translate3d(${left}px, ${top}px, 0)`;\n      return;\n    }\n\n    let offset = 70;\n    if (this.selection.selectedElements.some(ele => isFrameBlock(ele))) {\n      offset += 10;\n    }\n\n    top = y - offset;\n    top < 0 && (top = y + bound.h * viewport.zoom + offset);\n\n    left = clamp(x, 10, width - 10);\n    top = clamp(top, 10, height - 150);\n\n    this.style.transform = `translate3d(${left}px, ${top}px, 0)`;\n    this.selectedIds = selection.selectedIds;\n  }\n\n  private _quickConnect = ({ x, y }: MouseEvent) => {\n    const element = this.selection.selectedElements[0];\n    const point = this.edgeless.service.viewport.toViewCoordFromClientCoord([\n      x,\n      y,\n    ]);\n    this.edgeless.doc.captureSync();\n    this.edgeless.tools.setEdgelessTool({\n      type: 'connector',\n      mode: ConnectorMode.Curve,\n    });\n\n    const ctc = this.edgeless.tools.controllers[\n      'connector'\n    ] as ConnectorToolController;\n    ctc.quickConnect(point, element);\n  };\n\n  private _renderQuickConnectButton() {\n    return [\n      html`\n        <edgeless-tool-icon-button\n          aria-label=\"Draw connector\"\n          .tooltip=${'Draw connector'}\n          .activeMode=${'background'}\n          @click=${this._quickConnect}\n        >\n          ${ConnectorCWithArrowIcon}\n        </edgeless-tool-icon-button>\n      `,\n    ];\n  }\n\n  protected override firstUpdated() {\n    const { _disposables, edgeless } = this;\n\n    _disposables.add(\n      edgeless.service.viewport.viewportUpdated.on(() => {\n        this._recalculatePosition();\n      })\n    );\n\n    _disposables.add(\n      this.selection.slots.updated.on(() => {\n        if (\n          this.selection.selectedIds.length === 0 ||\n          this.selection.editing ||\n          this.selection.inoperable\n        ) {\n          this.toolbarVisible = false;\n        } else {\n          this.toolbarVisible = true;\n          this._recalculatePosition();\n        }\n      })\n    );\n\n    pickValues(this.edgeless.service.surface, [\n      'elementAdded',\n      'elementUpdated',\n    ]).forEach(slot => _disposables.add(slot.on(this._updateOnSelectedChange)));\n\n    _disposables.add(\n      this.doc.slots.blockUpdated.on(this._updateOnSelectedChange)\n    );\n\n    _disposables.add(\n      edgeless.dispatcher.add('dragStart', () => {\n        this._dragging = true;\n      })\n    );\n    _disposables.add(\n      edgeless.dispatcher.add('dragEnd', () => {\n        this._dragging = false;\n        this._recalculatePosition();\n      })\n    );\n\n    _disposables.add(\n      edgeless.slots.elementResizeStart.on(() => {\n        this._dragging = true;\n      })\n    );\n    _disposables.add(\n      edgeless.slots.elementResizeEnd.on(() => {\n        this._dragging = false;\n        this._recalculatePosition();\n      })\n    );\n  }\n\n  registerEntry(entry: CustomEntry) {\n    this._registeredEntries.push(entry);\n  }\n\n  override render() {\n    if (this.doc.readonly || this._dragging || !this.toolbarVisible) {\n      return nothing;\n    }\n\n    const groupedSelected = this._groupSelected();\n    const { edgeless, selection } = this;\n    const {\n      shape,\n      brush,\n      connector,\n      note,\n      text,\n      frame,\n      group,\n      embedCard,\n      attachment,\n      image,\n      edgelessText,\n      mindmap: mindmaps,\n    } = groupedSelected;\n    const { selectedElements } = this.selection;\n    const selectedAtLeastTwoTypes = atLeastNMatches(\n      Object.values(groupedSelected),\n      e => !!e.length,\n      2\n    );\n\n    const quickConnectButton =\n      selectedElements.length === 1 && !connector?.length\n        ? this._renderQuickConnectButton()\n        : undefined;\n\n    const generalButtons =\n      selectedElements.length !== connector?.length\n        ? [\n            renderAddFrameButton(edgeless, selectedElements),\n            renderAddGroupButton(edgeless, selectedElements),\n            renderAlignButton(edgeless, selectedElements),\n          ]\n        : [];\n\n    const buttons: (symbol | TemplateResult)[] = selectedAtLeastTwoTypes\n      ? generalButtons\n      : [\n          ...generalButtons,\n          renderMindmapButton(edgeless, mindmaps),\n          renderMindmapButton(edgeless, shape),\n          renderChangeShapeButton(edgeless, shape),\n          renderChangeBrushButton(edgeless, brush),\n          renderConnectorButton(edgeless, connector),\n          renderNoteButton(edgeless, note, quickConnectButton),\n          renderChangeTextButton(edgeless, text),\n          renderChangeEdgelessTextButton(edgeless, edgelessText),\n          renderFrameButton(edgeless, frame),\n          renderGroupButton(edgeless, group),\n          renderEmbedButton(edgeless, embedCard, quickConnectButton),\n          renderAttachmentButton(edgeless, attachment),\n          renderChangeImageButton(edgeless, image),\n        ];\n\n    if (selectedElements.length === 1) {\n      if (selection.firstElement.group instanceof GroupElementModel) {\n        buttons.unshift(renderReleaseFromGroupButton(this.edgeless));\n      }\n\n      if (!connector?.length) {\n        buttons.push(quickConnectButton?.pop() ?? nothing);\n      }\n    }\n\n    this._registeredEntries\n      .filter(entry => entry.when(selectedElements))\n      .map(entry => entry.render(this.edgeless))\n      .forEach(entry => entry && buttons.unshift(entry));\n\n    buttons.push(html`\n      <edgeless-more-button\n        .elements=${selectedElements}\n        .edgeless=${edgeless}\n        .vertical=${true}\n      ></edgeless-more-button>\n    `);\n\n    return html`\n      <div\n        class=\"edgeless-component-toolbar-container\"\n        @pointerdown=${stopPropagation}\n      >\n        ${join(\n          buttons.filter(b => b !== nothing),\n          renderMenuDivider\n        )}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-element-toolbar-widget': EdgelessElementToolbarWidget;\n  }\n}\n"]}