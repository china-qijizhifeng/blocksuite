{"version":3,"file":"change-brush-button.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/element-toolbar/change-brush-button.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../edgeless/components/buttons/tool-icon-button.js';\nimport '../../edgeless/components/buttons/menu-button.js';\nimport '../../edgeless/components/panel/color-panel.js';\nimport '../../edgeless/components/panel/line-width-panel.js';\n\nimport { WithDisposable } from '@blocksuite/block-std';\nimport { html, LitElement, nothing } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\n\nimport type { CssVariableName } from '../../../_common/theme/css-variables.js';\nimport { LineWidth } from '../../../_common/types.js';\nimport { countBy, maxBy } from '../../../_common/utils/iterable.js';\nimport type { BrushProps } from '../../../surface-block/element-model/brush.js';\nimport type { BrushElementModel } from '../../../surface-block/index.js';\nimport {\n  type ColorEvent,\n  GET_DEFAULT_LINE_COLOR,\n} from '../../edgeless/components/panel/color-panel.js';\nimport type { LineWidthEvent } from '../../edgeless/components/panel/line-width-panel.js';\nimport type { EdgelessRootBlockComponent } from '../../edgeless/edgeless-root-block.js';\n\nfunction getMostCommonColor(\n  elements: BrushElementModel[]\n): CssVariableName | null {\n  const colors = countBy(elements, ele => ele.color);\n  const max = maxBy(Object.entries(colors), ([_k, count]) => count);\n  return max ? (max[0] as CssVariableName) : GET_DEFAULT_LINE_COLOR();\n}\n\nfunction getMostCommonSize(elements: BrushElementModel[]): LineWidth {\n  const sizes = countBy(elements, ele => ele.lineWidth);\n  const max = maxBy(Object.entries(sizes), ([_k, count]) => count);\n  return max ? (Number(max[0]) as LineWidth) : LineWidth.Four;\n}\n\nfunction notEqual<K extends keyof BrushProps>(key: K, value: BrushProps[K]) {\n  return (element: BrushElementModel) => element[key] !== value;\n}\n\n@customElement('edgeless-change-brush-button')\nexport class EdgelessChangeBrushButton extends WithDisposable(LitElement) {\n  get surface() {\n    return this.edgeless.surface;\n  }\n\n  get doc() {\n    return this.edgeless.doc;\n  }\n\n  get service() {\n    return this.surface.edgeless.service;\n  }\n\n  get selectedColor() {\n    return this._selectedColor ?? getMostCommonColor(this.elements);\n  }\n\n  get selectedSize() {\n    return this._selectedSize ?? getMostCommonSize(this.elements);\n  }\n\n  @state()\n  private accessor _selectedColor: string | null = null;\n\n  @state()\n  private accessor _selectedSize: LineWidth | null = null;\n\n  @property({ attribute: false })\n  accessor elements: BrushElementModel[] = [];\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  private _setBrushProp<K extends keyof BrushProps>(\n    key: K,\n    value: BrushProps[K]\n  ) {\n    this.doc.captureSync();\n    this.elements\n      .filter(notEqual(key, value))\n      .forEach(element =>\n        this.service.updateElement(element.id, { [key]: value })\n      );\n  }\n\n  private _setLineWidth = ({ detail: lineWidth }: LineWidthEvent) => {\n    this._setBrushProp('lineWidth', lineWidth);\n    this._selectedSize = lineWidth;\n  };\n\n  private _setBrushColor = ({ detail: color }: ColorEvent) => {\n    this._setBrushProp('color', color);\n    this._selectedColor = color;\n  };\n\n  override render() {\n    const { selectedSize, selectedColor } = this;\n\n    return html`\n      <edgeless-line-width-panel\n        .selectedSize=${selectedSize}\n        @select=${this._setLineWidth}\n      >\n      </edgeless-line-width-panel>\n\n      <edgeless-menu-divider></edgeless-menu-divider>\n\n      <edgeless-menu-button\n        .contentPadding=${'8px'}\n        .button=${html`\n          <edgeless-tool-icon-button aria-label=\"Color\" .tooltip=${'Color'}>\n            <edgeless-color-button\n              .color=${selectedColor}\n            ></edgeless-color-button>\n          </edgeless-tool-icon-button>\n        `}\n      >\n        <edgeless-color-panel\n          slot\n          .value=${selectedColor}\n          @select=${this._setBrushColor}\n        >\n        </edgeless-color-panel>\n      </edgeless-menu-button>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-change-brush-button': EdgelessChangeBrushButton;\n  }\n}\n\nexport function renderChangeBrushButton(\n  edgeless: EdgelessRootBlockComponent,\n  elements?: BrushElementModel[]\n) {\n  if (!elements?.length) return nothing;\n\n  return html`\n    <edgeless-change-brush-button .elements=${elements} .edgeless=${edgeless}>\n    </edgeless-change-brush-button>\n  `;\n}\n"]}