{"version":3,"file":"change-text-menu.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/element-toolbar/change-text-menu.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../edgeless/components/buttons/menu-button.js';\nimport '../../edgeless/components/panel/font-family-panel.js';\nimport '../../edgeless/components/panel/size-panel.js';\nimport '../../edgeless/components/panel/font-weight-and-style-panel.js';\nimport '../../edgeless/components/panel/align-panel.js';\n\nimport { WithDisposable } from '@blocksuite/block-std';\nimport { css, html, LitElement, nothing, type TemplateResult } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { join } from 'lit/directives/join.js';\n\nimport {\n  SmallArrowDownIcon,\n  TextAlignCenterIcon,\n  TextAlignLeftIcon,\n  TextAlignRightIcon,\n} from '../../../_common/icons/index.js';\nimport { countBy, maxBy } from '../../../_common/utils/iterable.js';\nimport { EdgelessTextBlockModel } from '../../../edgeless-text/edgeless-text-model.js';\nimport {\n  isFontStyleSupported,\n  isFontWeightSupported,\n} from '../../../surface-block/canvas-renderer/element-renderer/text/utils.js';\nimport { normalizeTextBound } from '../../../surface-block/canvas-renderer/element-renderer/text/utils.js';\nimport {\n  FontFamily,\n  FontStyle,\n  FontWeight,\n  TextAlign,\n  type TextStyleProps,\n} from '../../../surface-block/consts.js';\nimport { isConnectorWithLabel } from '../../../surface-block/element-model/connector.js';\nimport { TextElementModel } from '../../../surface-block/element-model/text.js';\nimport {\n  ConnectorElementModel,\n  ShapeElementModel,\n} from '../../../surface-block/index.js';\nimport { Bound, normalizeShapeBound } from '../../../surface-block/index.js';\nimport {\n  getFontFacesByFontFamily,\n  wrapFontFamily,\n} from '../../../surface-block/utils/font.js';\nimport { renderMenuDivider } from '../../edgeless/components/buttons/menu-button.js';\nimport {\n  type ColorEvent,\n  GET_DEFAULT_LINE_COLOR,\n  LINE_COLORS,\n} from '../../edgeless/components/panel/color-panel.js';\nimport type { EdgelessRootBlockComponent } from '../../edgeless/edgeless-root-block.js';\n\nconst FONT_SIZE_LIST = [\n  {\n    value: 16,\n  },\n  {\n    value: 24,\n  },\n  {\n    value: 32,\n  },\n  {\n    value: 40,\n  },\n  {\n    value: 64,\n  },\n  {\n    value: 128,\n  },\n] as const;\n\nconst FONT_WEIGHT_CHOOSE: [FontWeight, () => string][] = [\n  [FontWeight.Light, () => 'Light'],\n  [FontWeight.Regular, () => 'Regular'],\n  [FontWeight.SemiBold, () => 'Semibold'],\n] as const;\n\nconst FONT_STYLE_CHOOSE: [FontStyle, () => string | typeof nothing][] = [\n  [FontStyle.Normal, () => nothing],\n  [FontStyle.Italic, () => 'Italic'],\n] as const;\n\nconst TEXT_ALIGN_CHOOSE: [TextAlign, () => TemplateResult<1>][] = [\n  [TextAlign.Left, () => TextAlignLeftIcon],\n  [TextAlign.Center, () => TextAlignCenterIcon],\n  [TextAlign.Right, () => TextAlignRightIcon],\n] as const;\n\nfunction countByField<K extends keyof TextStyleProps>(\n  elements: BlockSuite.EdgelessTextModelType[],\n  field: K\n) {\n  return countBy(elements, element => extractField(element, field));\n}\n\nfunction extractField<K extends keyof TextStyleProps>(\n  element: BlockSuite.EdgelessTextModelType,\n  field: K\n) {\n  //TODO: It's not a very good handling method.\n  //      The edgeless-change-text-menu should be refactored into a widget to allow external registration of its own logic.\n  if (element instanceof EdgelessTextBlockModel) {\n    return field === 'fontSize'\n      ? null\n      : (element[field as keyof EdgelessTextBlockModel] as TextStyleProps[K]);\n  }\n  return (\n    element instanceof ConnectorElementModel\n      ? element.labelStyle[field]\n      : element[field]\n  ) as TextStyleProps[K];\n}\n\nfunction getMostCommonValue<K extends keyof TextStyleProps>(\n  elements: BlockSuite.EdgelessTextModelType[],\n  field: K\n) {\n  const values = countByField(elements, field);\n  return maxBy(Object.entries(values), ([_k, count]) => count);\n}\n\nfunction getMostCommonAlign(elements: BlockSuite.EdgelessTextModelType[]) {\n  const max = getMostCommonValue(elements, 'textAlign');\n  return max ? (max[0] as TextAlign) : TextAlign.Left;\n}\n\nfunction getMostCommonColor(elements: BlockSuite.EdgelessTextModelType[]) {\n  const max = getMostCommonValue(elements, 'color');\n  return max ? max[0] : GET_DEFAULT_LINE_COLOR();\n}\n\nfunction getMostCommonFontFamily(elements: BlockSuite.EdgelessTextModelType[]) {\n  const max = getMostCommonValue(elements, 'fontFamily');\n  return max ? (max[0] as FontFamily) : FontFamily.Inter;\n}\n\nfunction getMostCommonFontSize(elements: BlockSuite.EdgelessTextModelType[]) {\n  const max = getMostCommonValue(elements, 'fontSize');\n  return max ? Number(max[0]) : FONT_SIZE_LIST[0].value;\n}\n\nfunction getMostCommonFontStyle(elements: BlockSuite.EdgelessTextModelType[]) {\n  const max = getMostCommonValue(elements, 'fontStyle');\n  return max ? (max[0] as FontStyle) : FontStyle.Normal;\n}\n\nfunction getMostCommonFontWeight(elements: BlockSuite.EdgelessTextModelType[]) {\n  const max = getMostCommonValue(elements, 'fontWeight');\n  return max ? (max[0] as FontWeight) : FontWeight.Regular;\n}\n\nfunction buildProps(\n  element: BlockSuite.EdgelessTextModelType,\n  props: { [K in keyof TextStyleProps]?: TextStyleProps[K] }\n) {\n  if (element instanceof ConnectorElementModel) {\n    return {\n      labelStyle: {\n        ...element.labelStyle,\n        ...props,\n      },\n    };\n  }\n\n  return { ...props };\n}\n\n@customElement('edgeless-change-text-menu')\nexport class EdgelessChangeTextMenu extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      display: inherit;\n      align-items: inherit;\n      justify-content: inherit;\n      gap: inherit;\n      height: 100%;\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor elements!: BlockSuite.EdgelessTextModelType[];\n\n  @property({ attribute: false })\n  accessor elementType!: BlockSuite.EdgelessTextModelKeyType;\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  get service() {\n    return this.edgeless.service;\n  }\n\n  private _updateElementBound = (element: BlockSuite.EdgelessTextModelType) => {\n    const elementType = this.elementType;\n    if (elementType === 'text' && element instanceof TextElementModel) {\n      // the change of font family will change the bound of the text\n      const {\n        text: yText,\n        fontFamily,\n        fontStyle,\n        fontSize,\n        fontWeight,\n        hasMaxWidth,\n      } = element;\n      const newBound = normalizeTextBound(\n        {\n          yText,\n          fontFamily,\n          fontStyle,\n          fontSize,\n          fontWeight,\n          hasMaxWidth,\n        },\n        Bound.fromXYWH(element.deserializedXYWH)\n      );\n      this.service.updateElement(element.id, {\n        xywh: newBound.serialize(),\n      });\n    } else if (elementType === 'connector' && isConnectorWithLabel(element)) {\n      const {\n        text,\n        labelXYWH,\n        labelStyle: { fontFamily, fontStyle, fontSize, fontWeight },\n        labelConstraints: { hasMaxWidth, maxWidth },\n      } = element as ConnectorElementModel;\n      const prevBounds = Bound.fromXYWH(labelXYWH || [0, 0, 16, 16]);\n      const center = prevBounds.center;\n      const bounds = normalizeTextBound(\n        {\n          yText: text!,\n          fontFamily,\n          fontStyle,\n          fontSize,\n          fontWeight,\n          hasMaxWidth,\n          maxWidth,\n        },\n        prevBounds\n      );\n      bounds.center = center;\n      this.service.updateElement(element.id, {\n        labelXYWH: bounds.toXYWH(),\n      });\n    } else if (\n      elementType === 'shape' &&\n      element instanceof ShapeElementModel\n    ) {\n      const newBound = normalizeShapeBound(\n        element,\n        Bound.fromXYWH(element.deserializedXYWH)\n      );\n      this.service.updateElement(element.id, {\n        xywh: newBound.serialize(),\n      });\n    }\n    // no need to update the bound of edgeless text block, which updates itself using ResizeObserver\n  };\n\n  private _setTextColor = ({ detail: color }: ColorEvent) => {\n    const props = { color };\n    this.elements.forEach(element => {\n      this.service.updateElement(element.id, buildProps(element, props));\n    });\n  };\n\n  private _setTextAlign = (textAlign: TextAlign) => {\n    const props = { textAlign };\n    this.elements.forEach(element => {\n      this.service.updateElement(element.id, buildProps(element, props));\n    });\n  };\n\n  private _setFontFamily = (fontFamily: FontFamily) => {\n    const currentFontWeight = getMostCommonFontWeight(this.elements);\n    const fontWeight = isFontWeightSupported(fontFamily, currentFontWeight)\n      ? currentFontWeight\n      : FontWeight.Regular;\n    const currentFontStyle = getMostCommonFontStyle(this.elements);\n    const fontStyle = isFontStyleSupported(fontFamily, currentFontStyle)\n      ? currentFontStyle\n      : FontStyle.Normal;\n\n    const props = { fontFamily, fontWeight, fontStyle };\n    this.elements.forEach(element => {\n      this.service.updateElement(element.id, buildProps(element, props));\n      this._updateElementBound(element);\n    });\n  };\n\n  private _setFontSize = (fontSize: number) => {\n    const props = { fontSize };\n    this.elements.forEach(element => {\n      this.service.updateElement(element.id, buildProps(element, props));\n      this._updateElementBound(element);\n    });\n  };\n\n  private _setFontWeightAndStyle = (\n    fontWeight: FontWeight,\n    fontStyle: FontStyle\n  ) => {\n    const props = { fontWeight, fontStyle };\n    this.elements.forEach(element => {\n      this.service.updateElement(element.id, buildProps(element, props));\n      this._updateElementBound(element);\n    });\n  };\n\n  override render() {\n    const elements = this.elements;\n    const selectedAlign = getMostCommonAlign(elements);\n    const selectedColor = getMostCommonColor(elements);\n    const selectedFontFamily = getMostCommonFontFamily(elements);\n    const selectedFontSize = Math.trunc(getMostCommonFontSize(elements));\n    const selectedFontStyle = getMostCommonFontStyle(elements);\n    const selectedFontWeight = getMostCommonFontWeight(elements);\n    const matchFontFaces = getFontFacesByFontFamily(selectedFontFamily);\n    const fontStyleBtnDisabled =\n      matchFontFaces.length === 1 &&\n      matchFontFaces[0].style === selectedFontStyle &&\n      matchFontFaces[0].weight === selectedFontWeight;\n\n    return join(\n      [\n        html`\n          <edgeless-menu-button\n            .contentPadding=${'8px'}\n            .button=${html`\n              <edgeless-tool-icon-button\n                aria-label=\"Font\"\n                .tooltip=${'Font'}\n                .justify=${'space-between'}\n                .labelHeight=${'20px'}\n                .iconContainerWidth=${'40px'}\n              >\n                <span\n                  class=\"label padding0\"\n                  style=${`font-family: ${wrapFontFamily(selectedFontFamily)}`}\n                  >Aa</span\n                >${SmallArrowDownIcon}\n              </edgeless-tool-icon-button>\n            `}\n          >\n            <edgeless-font-family-panel\n              slot\n              .value=${selectedFontFamily}\n              .onSelect=${this._setFontFamily}\n            ></edgeless-font-family-panel>\n          </edgeless-menu-button>\n        `,\n\n        html`\n          <edgeless-menu-button\n            .contentPadding=${'8px'}\n            .button=${html`\n              <edgeless-tool-icon-button\n                aria-label=\"Text color\"\n                .tooltip=${'Text color'}\n              >\n                <edgeless-text-color-icon\n                  .color=${selectedColor}\n                ></edgeless-text-color-icon>\n              </edgeless-tool-icon-button>\n            `}\n          >\n            <edgeless-color-panel\n              slot\n              .value=${selectedColor}\n              .options=${LINE_COLORS}\n              @select=${this._setTextColor}\n            ></edgeless-color-panel>\n          </edgeless-menu-button>\n        `,\n\n        html`\n          <edgeless-menu-button\n            .contentPadding=${'8px'}\n            .button=${html`\n              <edgeless-tool-icon-button\n                aria-label=\"Font style\"\n                .tooltip=${'Font style'}\n                .justify=${'space-between'}\n                .labelHeight=${'20px'}\n                .iconContainerWidth=${'90px'}\n                .disabled=${fontStyleBtnDisabled}\n              >\n                <span class=\"label ellipsis\">\n                  ${choose(selectedFontWeight, FONT_WEIGHT_CHOOSE)}\n                  ${choose(selectedFontStyle, FONT_STYLE_CHOOSE)}\n                </span>\n                ${SmallArrowDownIcon}\n              </edgeless-tool-icon-button>\n            `}\n          >\n            <edgeless-font-weight-and-style-panel\n              slot\n              .fontFamily=${selectedFontFamily}\n              .fontWeight=${selectedFontWeight}\n              .fontStyle=${selectedFontStyle}\n              .onSelect=${this._setFontWeightAndStyle}\n            ></edgeless-font-weight-and-style-panel>\n          </edgeless-menu-button>\n        `,\n\n        this.elementType === 'edgeless-text'\n          ? nothing\n          : html`\n              <edgeless-menu-button\n                .contentPadding=${'8px'}\n                .button=${html`\n                  <edgeless-tool-icon-button\n                    aria-label=\"Font size\"\n                    .tooltip=${'Font size'}\n                    .justify=${'space-between'}\n                    .labelHeight=${'20px'}\n                    .iconContainerWidth=${'60px'}\n                  >\n                    <span class=\"label\">${selectedFontSize}</span>\n                    ${SmallArrowDownIcon}\n                  </edgeless-tool-icon-button>\n                `}\n              >\n                <edgeless-size-panel\n                  slot\n                  data-type=\"check\"\n                  .size=${selectedFontSize}\n                  .sizeList=${FONT_SIZE_LIST}\n                  .onSelect=${this._setFontSize}\n                ></edgeless-size-panel>\n              </edgeless-menu-button>\n            `,\n\n        html`\n          <edgeless-menu-button\n            .button=${html`\n              <edgeless-tool-icon-button\n                aria-label=\"Alignment\"\n                .tooltip=${'Alignment'}\n              >\n                ${choose(selectedAlign, TEXT_ALIGN_CHOOSE)}${SmallArrowDownIcon}\n              </edgeless-tool-icon-button>\n            `}\n          >\n            <edgeless-align-panel\n              slot\n              .value=${selectedAlign}\n              .onSelect=${this._setTextAlign}\n            ></edgeless-align-panel>\n          </edgeless-menu-button>\n        `,\n      ].filter(b => b !== nothing),\n      renderMenuDivider\n    );\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-change-text-menu': EdgelessChangeTextMenu;\n  }\n}\n"]}