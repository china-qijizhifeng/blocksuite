{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/image-toolbar/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../../_common/components/button.js';\nimport '../../../_common/components/tooltip/tooltip.js';\n\nimport { assertExists } from '@blocksuite/global/utils';\nimport { html, type TemplateResult } from 'lit';\n\nimport { getBlockProps } from '../../../_common/utils/block-props.js';\nimport { isInsidePageEditor } from '../../../_common/utils/query.js';\nimport type { ImageBlockComponent } from '../../../image-block/image-block.js';\nimport type {\n  CommonItem,\n  CustomItem,\n  ImageConfigItem,\n  MoreItem,\n  MoreMenuConfigItem,\n} from './type.js';\n\nexport function ConfigRenderer(\n  blockElement: ImageBlockComponent,\n  abortController: AbortController,\n  config: ImageConfigItem[],\n  onClick?: () => void\n) {\n  return config\n    .filter(item => {\n      return item.showWhen(blockElement);\n    })\n    .map(item => {\n      let template: TemplateResult | null = null;\n      switch (item.type) {\n        case 'common': {\n          const defaultItem = item as CommonItem;\n          const buttonClass = `image-toolbar-button ${defaultItem.name.toLocaleLowerCase()}`;\n          template = html`<div class=${buttonClass}>\n            <icon-button\n              size=\"24px\"\n              @click=${() => defaultItem.action(blockElement, abortController)}\n            >\n              ${defaultItem.icon}\n              <affine-tooltip>${defaultItem.tooltip}</affine-tooltip>\n            </icon-button>\n          </div>`;\n          break;\n        }\n        case 'custom': {\n          const customItem = item as CustomItem;\n          template = customItem.render(blockElement, onClick);\n          break;\n        }\n        default:\n          template = null;\n      }\n\n      return [template] as const;\n    })\n    .filter(([template]) => template !== null && template !== undefined)\n    .map(([template]) => template);\n}\n\nexport function MoreMenuRenderer(\n  blockElement: ImageBlockComponent,\n  abortController: AbortController,\n  config: MoreMenuConfigItem[]\n) {\n  return config\n    .filter(item => {\n      return item.type === 'divider' || item.showWhen(blockElement);\n    })\n    .map(item => {\n      let template: TemplateResult | null = null;\n      switch (item.type) {\n        case 'more': {\n          const moreItem = item as MoreItem;\n          const buttonClass = `menu-item ${moreItem.name.toLocaleLowerCase()}`;\n          template = html`<div class=${buttonClass}>\n            <icon-button\n              width=\"183px\"\n              height=\"30px\"\n              text=${moreItem.name}\n              @click=${(e: MouseEvent) => {\n                e.stopPropagation();\n                moreItem.action(blockElement, abortController);\n              }}\n            >\n              ${moreItem.icon}\n            </icon-button>\n          </div>`;\n          break;\n        }\n        case 'divider': {\n          template = html`<div class=\"divider\"></div>`;\n          break;\n        }\n        default:\n          template = null;\n      }\n\n      return template;\n    })\n    .filter((template): template is TemplateResult => template !== null)\n    .map(template => template);\n}\n\nexport function duplicate(\n  blockElement: ImageBlockComponent,\n  abortController?: AbortController\n) {\n  const model = blockElement.model;\n  const blockProps = getBlockProps(model);\n  const { width, height, xywh, rotate, zIndex, ...duplicateProps } = blockProps;\n\n  const { doc } = model;\n  const parent = doc.getParent(model);\n  assertExists(parent, 'Parent not found');\n\n  const index = parent?.children.indexOf(model);\n  const duplicateId = doc.addBlock(\n    model.flavour as BlockSuite.Flavour,\n    duplicateProps,\n    parent,\n    index + 1\n  );\n  abortController?.abort();\n\n  const editorHost = blockElement.host;\n  editorHost.updateComplete\n    .then(() => {\n      const { selection } = editorHost;\n      selection.setGroup('note', [\n        selection.create('block', {\n          blockId: duplicateId,\n        }),\n      ]);\n      if (isInsidePageEditor(editorHost)) {\n        const duplicateElement = editorHost.view.getBlock(duplicateId);\n        if (duplicateElement) {\n          duplicateElement.scrollIntoView(true);\n        }\n      }\n    })\n    .catch(console.error);\n}\n"]}