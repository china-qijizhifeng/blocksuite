{"version":3,"file":"shape.js","sourceRoot":"","sources":["../../../src/surface-block/element-model/shape.ts"],"names":[],"mappings":"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","sourcesContent":["import { DocCollection, type Y } from '@blocksuite/store';\n\nimport {\n  DEFAULT_ROUGHNESS,\n  FontFamily,\n  FontStyle,\n  FontWeight,\n  StrokeStyle,\n  TextAlign,\n  TextResizing,\n  type TextStyleProps,\n  TextVerticalAlign,\n} from '../consts.js';\nimport type { IBound, SerializedXYWH } from '../index.js';\nimport type { Bound } from '../utils/bound.js';\nimport type { PointLocation } from '../utils/point-location.js';\nimport type { IVec2 } from '../utils/vec.js';\nimport {\n  type IBaseProps,\n  type IHitTestOptions,\n  SurfaceElementModel,\n} from './base.js';\nimport { local, yfield } from './decorators.js';\nimport { diamond } from './utils/shape/diamond.js';\nimport { ellipse } from './utils/shape/ellipse.js';\nimport { rect } from './utils/shape/rect.js';\nimport { triangle } from './utils/shape/triangle.js';\n\nexport const shapeMethods: {\n  [key in ShapeType]: typeof rect;\n} = {\n  rect,\n  triangle,\n  ellipse,\n  diamond,\n};\n\nexport type ShapeType = 'rect' | 'triangle' | 'ellipse' | 'diamond';\nexport type ShapeStyle = 'General' | 'Scribbled';\n\nexport enum ShapeTextFontSize {\n  SMALL = 12,\n  MEDIUM = 20,\n  LARGE = 28,\n  XLARGE = 36,\n}\n\nexport type ShapeProps = IBaseProps & {\n  shapeType: ShapeType;\n  radius: number;\n  filled: boolean;\n  fillColor: string;\n  strokeWidth: number;\n  strokeColor: string;\n  strokeStyle: StrokeStyle;\n  shapeStyle: ShapeStyle;\n  // https://github.com/rough-stuff/rough/wiki#roughness\n  roughness?: number;\n\n  text?: Y.Text;\n  textHorizontalAlign?: TextAlign;\n  textVerticalAlign?: TextVerticalAlign;\n  textResizing?: TextResizing;\n  maxWidth?: false | number;\n} & Partial<TextStyleProps>;\n\nexport const SHAPE_TEXT_PADDING = 20;\nexport const SHAPE_TEXT_VERTICAL_PADDING = 10;\n\nexport class ShapeElementModel extends SurfaceElementModel<ShapeProps> {\n  get type() {\n    return 'shape';\n  }\n\n  @local()\n  accessor textDisplay: boolean = true;\n\n  @yfield()\n  accessor xywh: SerializedXYWH = '[0,0,100,100]';\n\n  @yfield(0)\n  accessor rotate: number = 0;\n\n  @yfield()\n  accessor shapeType: ShapeType = 'rect';\n\n  @yfield()\n  accessor radius: number = 0;\n\n  @yfield()\n  accessor filled: boolean = false;\n\n  @yfield()\n  accessor fillColor: string = '--affine-palette-shape-yellow';\n\n  @yfield()\n  accessor strokeWidth: number = 4;\n\n  @yfield()\n  accessor strokeColor: string = '--affine-palette-line-yellow';\n\n  @yfield()\n  accessor strokeStyle: StrokeStyle = StrokeStyle.Solid;\n\n  @yfield('General' as ShapeStyle)\n  accessor shapeStyle: ShapeStyle = 'General';\n\n  @yfield(DEFAULT_ROUGHNESS)\n  accessor roughness: number = DEFAULT_ROUGHNESS;\n\n  @yfield()\n  accessor text: Y.Text | undefined = undefined;\n\n  @yfield('#000000')\n  accessor color!: string;\n\n  @yfield(ShapeTextFontSize.MEDIUM)\n  accessor fontSize!: number;\n\n  @yfield(FontFamily.Inter as string)\n  accessor fontFamily!: string;\n\n  @yfield(FontWeight.Regular as FontWeight)\n  accessor fontWeight!: FontWeight;\n\n  @yfield(FontStyle.Normal as FontStyle)\n  accessor fontStyle!: FontStyle;\n\n  @yfield(TextAlign.Center as TextAlign)\n  accessor textAlign!: TextAlign;\n\n  @yfield(TextAlign.Center as TextAlign)\n  accessor textHorizontalAlign!: TextAlign;\n\n  @yfield(TextVerticalAlign.Center as TextVerticalAlign)\n  accessor textVerticalAlign!: TextVerticalAlign;\n\n  @yfield(TextResizing.AUTO_HEIGHT as TextResizing)\n  accessor textResizing: TextResizing = TextResizing.AUTO_HEIGHT;\n\n  @yfield(false as false | number)\n  accessor maxWidth: false | number = false;\n\n  @yfield([SHAPE_TEXT_VERTICAL_PADDING, SHAPE_TEXT_PADDING])\n  accessor padding: [number, number] = [\n    SHAPE_TEXT_VERTICAL_PADDING,\n    SHAPE_TEXT_PADDING,\n  ];\n\n  @yfield()\n  accessor shadow: {\n    blur: number;\n    offsetX: number;\n    offsetY: number;\n    color: string;\n  } | null = null;\n\n  textBound: IBound | null = null;\n\n  override hitTest(x: number, y: number, options: IHitTestOptions) {\n    return shapeMethods[this.shapeType].hitTest.call(this, x, y, {\n      ...options,\n      ignoreTransparent: options.ignoreTransparent ?? true,\n    });\n  }\n\n  override containedByBounds(bounds: Bound) {\n    return shapeMethods[this.shapeType].containedByBounds(bounds, this);\n  }\n\n  override intersectWithLine(start: IVec2, end: IVec2) {\n    return shapeMethods[this.shapeType].intersectWithLine(start, end, this);\n  }\n\n  override getNearestPoint(point: IVec2): IVec2 {\n    return shapeMethods[this.shapeType].getNearestPoint(point, this) as IVec2;\n  }\n\n  override getRelativePointLocation(point: IVec2): PointLocation {\n    return shapeMethods[this.shapeType].getRelativePointLocation(point, this);\n  }\n\n  static override propsToY(props: ShapeProps) {\n    if (props.text && !(props.text instanceof DocCollection.Y.Text)) {\n      props.text = new DocCollection.Y.Text(props.text);\n    }\n\n    return props;\n  }\n}\n\ndeclare global {\n  namespace BlockSuite {\n    interface SurfaceElementModelMap {\n      shape: ShapeElementModel;\n    }\n\n    interface EdgelessTextModelMap {\n      shape: ShapeElementModel;\n    }\n  }\n}\n"]}