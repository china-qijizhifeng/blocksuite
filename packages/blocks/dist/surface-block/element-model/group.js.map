{"version":3,"file":"group.js","sourceRoot":"","sources":["../../../src/surface-block/element-model/group.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Y } from '@blocksuite/store';\nimport { DocCollection } from '@blocksuite/store';\n\nimport { keys } from '../../_common/utils/iterable.js';\nimport { Bound } from '../utils/bound.js';\nimport { linePolygonIntersects } from '../utils/math-utils.js';\nimport type { PointLocation } from '../utils/point-location.js';\nimport type { IVec2 } from '../utils/vec.js';\nimport type { IBaseProps, SerializedElement } from './base.js';\nimport { SurfaceGroupLikeModel } from './base.js';\nimport { local, observe, yfield } from './decorators.js';\n\ntype GroupElementProps = IBaseProps & {\n  children: Y.Map<boolean>;\n  title: Y.Text;\n};\n\nexport type SerializedGroupElement = SerializedElement & {\n  title: string;\n  children: Record<string, boolean>;\n};\n\nexport class GroupElementModel extends SurfaceGroupLikeModel<GroupElementProps> {\n  get rotate() {\n    return 0;\n  }\n\n  set rotate(_: number) {}\n\n  get type() {\n    return 'group';\n  }\n\n  @observe((_, instance: GroupElementModel, transaction) => {\n    instance.setChildIds(\n      Array.from(instance.children.keys()),\n      transaction?.local ?? false\n    );\n  })\n  @yfield()\n  accessor children: Y.Map<boolean> = new DocCollection.Y.Map<boolean>();\n\n  @yfield()\n  accessor title: Y.Text = new DocCollection.Y.Text();\n\n  @local()\n  accessor showTitle: boolean = true;\n\n  override serialize() {\n    const result = super.serialize();\n    return result as SerializedGroupElement;\n  }\n\n  addChild(element: BlockSuite.EdgelessModelType | string) {\n    const id = typeof element === 'string' ? element : element.id;\n    if (!this.children) {\n      return;\n    }\n    this.surface.doc.transact(() => {\n      this.children.set(id, true);\n    });\n  }\n\n  removeChild(element: BlockSuite.EdgelessModelType | string) {\n    const id = typeof element === 'string' ? element : element.id;\n    if (!this.children) {\n      return;\n    }\n    this.surface.doc.transact(() => {\n      this.children.delete(id);\n    });\n  }\n\n  override containedByBounds(bound: Bound): boolean {\n    return bound.contains(Bound.deserialize(this.xywh));\n  }\n\n  override intersectWithLine(start: IVec2, end: IVec2): PointLocation[] | null {\n    const bound = Bound.deserialize(this.xywh);\n    return linePolygonIntersects(start, end, bound.points);\n  }\n\n  static override propsToY(props: Record<string, unknown>) {\n    if (props.title && !(props.title instanceof DocCollection.Y.Text)) {\n      props.title = new DocCollection.Y.Text(props.title as string);\n    }\n\n    if (props.children && !(props.children instanceof DocCollection.Y.Map)) {\n      const children = new DocCollection.Y.Map() as Y.Map<boolean>;\n\n      keys(props.children).forEach(key => {\n        children.set(key as string, true);\n      });\n\n      props.children = children;\n    }\n\n    return props as GroupElementProps;\n  }\n}\n\ndeclare global {\n  namespace BlockSuite {\n    interface SurfaceGroupLikeModelMap {\n      group: GroupElementModel;\n    }\n  }\n}\n"]}