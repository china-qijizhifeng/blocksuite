{"version":3,"file":"text.js","sourceRoot":"","sources":["../../../src/surface-block/element-model/text.ts"],"names":[],"mappings":"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","sourcesContent":["import { DocCollection, type Y } from '@blocksuite/store';\n\nimport {\n  FontFamily,\n  FontStyle,\n  FontWeight,\n  TextAlign,\n  type TextStyleProps,\n} from '../consts.js';\nimport type { SerializedXYWH } from '../index.js';\nimport { Bound } from '../utils/bound.js';\nimport {\n  getPointsFromBoundsWithRotation,\n  linePolygonIntersects,\n  pointInPolygon,\n  polygonNearestPoint,\n} from '../utils/math-utils.js';\nimport type { IVec2 } from '../utils/vec.js';\nimport { type IBaseProps, SurfaceElementModel } from './base.js';\nimport { yfield } from './decorators.js';\n\nexport type TextElementProps = IBaseProps & {\n  text: Y.Text;\n  hasMaxWidth?: boolean;\n} & Omit<TextStyleProps, 'fontWeight' | 'fontStyle'> &\n  Partial<Pick<TextStyleProps, 'fontWeight' | 'fontStyle'>>;\n\nexport class TextElementModel extends SurfaceElementModel<TextElementProps> {\n  get type() {\n    return 'text';\n  }\n\n  @yfield()\n  accessor xywh: SerializedXYWH = '[0,0,16,16]';\n\n  @yfield(0)\n  accessor rotate: number = 0;\n\n  @yfield()\n  accessor text: Y.Text = new DocCollection.Y.Text();\n\n  @yfield()\n  accessor color: string = '#000000';\n\n  @yfield()\n  accessor fontSize: number = 16;\n\n  @yfield()\n  accessor fontFamily: FontFamily = FontFamily.Inter;\n\n  @yfield<FontWeight, TextElementModel>(FontWeight.Regular)\n  accessor fontWeight: FontWeight = FontWeight.Regular;\n\n  @yfield<FontStyle, TextElementModel>(FontStyle.Normal)\n  accessor fontStyle: FontStyle = FontStyle.Normal;\n\n  @yfield()\n  accessor textAlign: TextAlign = TextAlign.Center;\n\n  @yfield(false)\n  accessor hasMaxWidth: boolean = false;\n\n  override getNearestPoint(point: IVec2): IVec2 {\n    return polygonNearestPoint(\n      Bound.deserialize(this.xywh).points,\n      point\n    ) as IVec2;\n  }\n\n  override containedByBounds(bounds: Bound): boolean {\n    const points = getPointsFromBoundsWithRotation(this);\n    return points.some(point => bounds.containsPoint(point));\n  }\n\n  override intersectWithLine(start: IVec2, end: IVec2) {\n    const points = getPointsFromBoundsWithRotation(this);\n    return linePolygonIntersects(start, end, points);\n  }\n\n  override hitTest(x: number, y: number): boolean {\n    const points = getPointsFromBoundsWithRotation(this);\n    return pointInPolygon([x, y], points);\n  }\n\n  static override propsToY(props: Record<string, unknown>) {\n    if (props.text && !(props.text instanceof DocCollection.Y.Text)) {\n      props.text = new DocCollection.Y.Text(props.text as string);\n    }\n\n    return props;\n  }\n}\n\ndeclare global {\n  namespace BlockSuite {\n    interface SurfaceElementModelMap {\n      text: TextElementModel;\n    }\n\n    interface EdgelessTextModelMap {\n      text: TextElementModel;\n    }\n  }\n}\n"]}