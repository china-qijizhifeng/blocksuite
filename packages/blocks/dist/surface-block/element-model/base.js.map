{"version":3,"file":"base.js","sourceRoot":"","sources":["../../../src/surface-block/element-model/base.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EditorHost } from '@blocksuite/block-std';\nimport { DisposableGroup } from '@blocksuite/global/utils';\nimport type { Y } from '@blocksuite/store';\n\nimport type { EdgelessBlockModel } from '../../root-block/edgeless/edgeless-block-model.js';\nimport { randomSeed } from '../rough/math.js';\nimport type { SurfaceBlockModel } from '../surface-model.js';\nimport { Bound } from '../utils/bound.js';\nimport {\n  getBoundsWithRotation,\n  getPointsFromBoundsWithRotation,\n  linePolygonIntersects,\n  polygonGetPointTangent,\n  polygonNearestPoint,\n  rotatePoints,\n} from '../utils/math-utils.js';\nimport { PointLocation } from '../utils/point-location.js';\nimport type { IVec } from '../utils/vec.js';\nimport {\n  deserializeXYWH,\n  type SerializedXYWH,\n  type XYWH,\n} from '../utils/xywh.js';\nimport {\n  convertProps,\n  getDeriveProperties,\n  getYFieldPropsSet,\n  local,\n  updateDerivedProp,\n  watch,\n  yfield,\n} from './decorators.js';\nimport type { OmitFunctionsAndKeysAndReadOnly } from './utility-type.js';\n\nexport type ModelToProps<\n  T extends SurfaceElementModel,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  K extends keyof any,\n> = OmitFunctionsAndKeysAndReadOnly<\n  T,\n  K | 'yMap' | 'surface' | 'display' | 'opacity' | 'externalXYWH'\n>;\n\nexport type IBaseProps = {\n  index: string;\n  seed: number;\n};\n\nexport interface IHitTestOptions {\n  expand?: number;\n\n  /**\n   * If true, the transparent area of the element will be ignored during hit test.\n   * Otherwise, the transparent area will be considered as filled area.\n   *\n   * Default is true.\n   */\n  ignoreTransparent?: boolean;\n\n  all?: boolean;\n  zoom?: number;\n}\n\nexport interface IEdgelessElement {\n  id: string;\n  xywh: SerializedXYWH;\n  /**\n   * In some cases, you need to draw something related to the element, but it does not belong to the element itself.\n   * And it is also interactive, you can select element by clicking on it. E.g. the title of the group element.\n   * In this case, we need to store this kind of external xywh in order to do hit test. This property should not be synced to the doc.\n   * This property should be updated every time it gets rendered.\n   */\n  externalXYWH: SerializedXYWH | undefined;\n  externalBound: Bound | null;\n  rotate: number;\n  connectable: boolean;\n  index: string;\n\n  /**\n   * The bound of the element after rotation.\n   * The bound without rotation should be created by `Bound.deserialize(this.xywh)`.\n   */\n  elementBound: Bound;\n  group: SurfaceGroupLikeModel<IBaseProps> | null;\n  groups: SurfaceGroupLikeModel<IBaseProps>[];\n  containedByBounds(bounds: Bound): boolean;\n  getNearestPoint(point: IVec): IVec;\n  intersectWithLine(start: IVec, end: IVec): PointLocation[] | null;\n  getRelativePointLocation(point: IVec): PointLocation;\n  hitTest(\n    x: number,\n    y: number,\n    options: IHitTestOptions,\n    host: EditorHost\n  ): boolean;\n  boxSelect(bound: Bound): boolean;\n}\n\nexport type SerializedElement = Record<string, unknown> & {\n  type: string;\n  xywh: SerializedXYWH;\n  id: string;\n  index: string;\n  props: Record<string, unknown>;\n};\n\nexport abstract class SurfaceElementModel<Props extends IBaseProps = IBaseProps>\n  implements IEdgelessElement\n{\n  abstract get type(): string;\n\n  get externalBound(): Bound | null {\n    if (!this._local.has('externalBound')) {\n      const bound = this.externalXYWH\n        ? Bound.deserialize(this.externalXYWH)\n        : null;\n\n      this._local.set('externalBound', bound);\n    }\n\n    return this._local.get('externalBound') as Bound | null;\n  }\n\n  get connectable() {\n    return true;\n  }\n\n  get deserializedXYWH() {\n    if (this.xywh !== this._lastXYWH) {\n      const xywh = this.xywh;\n      this._local.set('deserializedXYWH', deserializeXYWH(xywh));\n      this._lastXYWH = xywh;\n    }\n\n    return (this._local.get('deserializedXYWH') as XYWH) ?? [0, 0, 0, 0];\n  }\n\n  get x() {\n    return this.deserializedXYWH[0];\n  }\n\n  get y() {\n    return this.deserializedXYWH[1];\n  }\n\n  get w() {\n    return this.deserializedXYWH[2];\n  }\n\n  get h() {\n    return this.deserializedXYWH[3];\n  }\n\n  get group(): SurfaceGroupLikeModel | null {\n    return this.surface.getGroup(this.id);\n  }\n\n  get groups() {\n    return this.surface.getGroups(this.id);\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  get elementBound() {\n    if (this.rotate) {\n      return Bound.from(getBoundsWithRotation(this));\n    }\n\n    return Bound.deserialize(this.xywh);\n  }\n\n  get isConnected() {\n    return this.surface.hasElementById(this.id);\n  }\n\n  private _lastXYWH: SerializedXYWH = '[0,0,0,0]';\n\n  /**\n   * When the ymap is not connected to the doc, its value cannot be read.\n   * But we need to use those value during the creation, so the yfield decorated field's value will\n   * be stored in this map too during the creation.\n   *\n   * After the ymap is connected to the doc, this map will be cleared.\n   */\n  protected _preserved = new Map<string, unknown>();\n\n  protected _stashed: Map<keyof Props | string, unknown>;\n\n  protected _local = new Map<string | symbol, unknown>();\n\n  protected _onChange: (payload: {\n    props: Record<string, unknown>;\n    oldValues: Record<string, unknown>;\n    local: boolean;\n  }) => void;\n\n  protected _disposable = new DisposableGroup();\n\n  protected _id: string;\n\n  yMap: Y.Map<unknown>;\n\n  surface!: SurfaceBlockModel;\n\n  abstract rotate: number;\n\n  abstract xywh: SerializedXYWH;\n\n  @yfield()\n  accessor index!: string;\n\n  @yfield()\n  accessor seed!: number;\n\n  @local()\n  accessor display: boolean = true;\n\n  @local()\n  accessor opacity: number = 1;\n\n  @watch((_, instance) => {\n    instance['_local'].delete('externalBound');\n  })\n  @local()\n  accessor externalXYWH: SerializedXYWH | undefined = undefined;\n\n  constructor(options: {\n    id: string;\n    yMap: Y.Map<unknown>;\n    model: SurfaceBlockModel;\n    stashedStore: Map<unknown, unknown>;\n    onChange: (payload: {\n      props: Record<string, unknown>;\n      oldValues: Record<string, unknown>;\n      local: boolean;\n    }) => void;\n  }) {\n    const { id, yMap, model, stashedStore, onChange } = options;\n\n    this._id = id;\n    this.yMap = yMap;\n    this.surface = model;\n    this._stashed = stashedStore as Map<keyof Props, unknown>;\n    this._onChange = onChange;\n\n    // class properties is initialized before yMap has been set\n    // so we need to manually assign the default value here\n    this.index = 'a0';\n    this.seed = randomSeed();\n  }\n\n  stash(prop: keyof Props | string) {\n    if (this._stashed.has(prop)) {\n      return;\n    }\n\n    if (!getYFieldPropsSet(this).has(prop as string)) {\n      return;\n    }\n\n    const curVal = this[prop as unknown as keyof SurfaceElementModel];\n\n    this._stashed.set(prop, curVal);\n\n    Object.defineProperty(this, prop, {\n      configurable: true,\n      enumerable: true,\n      get: () => this._stashed.get(prop),\n      set: (original: unknown) => {\n        const value = convertProps(prop as string, original, this);\n        const oldValue = this._stashed.get(prop);\n        const derivedProps = getDeriveProperties(\n          prop as string,\n          original,\n          this as unknown as SurfaceElementModel\n        );\n\n        this._stashed.set(prop, value);\n        this._onChange({\n          props: {\n            [prop]: value,\n          },\n          oldValues: {\n            [prop]: oldValue,\n          },\n          local: true,\n        });\n\n        this.surface['hooks'].update.emit({\n          id: this.id,\n          props: {\n            [prop]: value,\n          },\n          oldValues: {\n            [prop]: oldValue,\n          },\n        });\n\n        updateDerivedProp(derivedProps, this as unknown as SurfaceElementModel);\n      },\n    });\n  }\n\n  pop(prop: keyof Props | string) {\n    if (!this._stashed.has(prop)) {\n      return;\n    }\n\n    const value = this._stashed.get(prop);\n    this._stashed.delete(prop);\n    // @ts-ignore\n    delete this[prop];\n\n    if (getYFieldPropsSet(this).has(prop as string)) {\n      this.surface.doc.transact(() => {\n        // directly set the value to the ymap to avoid\n        // executing derive and convert decorators again\n        this.yMap.set(prop as string, value);\n      });\n    } else {\n      console.warn('pop a prop that is not yfield or local:', prop);\n    }\n  }\n\n  containedByBounds(bounds: Bound): boolean {\n    return getPointsFromBoundsWithRotation(this).some(point =>\n      bounds.containsPoint(point)\n    );\n  }\n\n  getNearestPoint(point: IVec) {\n    const points = getPointsFromBoundsWithRotation(this);\n    return polygonNearestPoint(points, point);\n  }\n\n  intersectWithLine(start: IVec, end: IVec) {\n    const points = getPointsFromBoundsWithRotation(this);\n    return linePolygonIntersects(start, end, points);\n  }\n\n  getRelativePointLocation(relativePoint: IVec) {\n    const bound = Bound.deserialize(this.xywh);\n    const point = bound.getRelativePoint(relativePoint);\n    const rotatePoint = rotatePoints([point], bound.center, this.rotate)[0];\n    const points = rotatePoints(bound.points, bound.center, this.rotate);\n    const tangent = polygonGetPointTangent(points, rotatePoint);\n    return new PointLocation(rotatePoint, tangent);\n  }\n\n  boxSelect(bound: Bound): boolean {\n    return (\n      this.containedByBounds(bound) ||\n      bound.points.some((point, i, points) =>\n        this.intersectWithLine(point, points[(i + 1) % points.length])\n      )\n    );\n  }\n\n  hitTest(x: number, y: number, _: IHitTestOptions, __: EditorHost): boolean {\n    return this.elementBound.isPointInBound([x, y]);\n  }\n\n  serialize() {\n    return this.yMap.toJSON() as SerializedElement;\n  }\n\n  /**\n   * `onCreated` function will be executed when\n   * element is created in local rather than remote peers\n   */\n  onCreated() {}\n\n  static propsToY(props: Record<string, unknown>) {\n    return props;\n  }\n}\n\nexport abstract class SurfaceGroupLikeModel<\n  Props extends IBaseProps = IBaseProps,\n> extends SurfaceElementModel<Props> {\n  /**\n   * The ids of the children. Its role is to provide a unique way to access the children.\n   * You should update this field through `setChildIds` when the children are added or removed.\n   */\n  get childIds() {\n    return this._childIds;\n  }\n\n  get childElements() {\n    const elements: BlockSuite.EdgelessModelType[] = [];\n\n    for (const key of this.childIds) {\n      const element =\n        this.surface.getElementById(key) ||\n        (this.surface.doc.getBlockById(key) as EdgelessBlockModel);\n\n      element && elements.push(element);\n    }\n\n    return elements;\n  }\n\n  private _childIds: string[] = [];\n\n  /**\n   * The actual field that stores the children of the group.\n   * It should be a ymap decorated with `@yfield`.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  abstract children: Y.Map<any>;\n\n  @local<SerializedXYWH, SurfaceGroupLikeModel>()\n  accessor xywh: SerializedXYWH = '[0,0,0,0]';\n\n  /**\n   * Set the new value of the childIds\n   * @param value the new value of the childIds\n   * @param fromLocal if true, the change is happened in the local\n   */\n  protected setChildIds(value: string[], fromLocal: boolean) {\n    const oldChildIds = this.childIds;\n    this._childIds = value;\n\n    this._onChange({\n      props: {\n        childIds: value,\n      },\n      oldValues: {\n        childIds: oldChildIds,\n      },\n      local: fromLocal,\n    });\n\n    this.surface['hooks'].update.emit({\n      id: this.id,\n      props: {\n        childIds: value,\n      },\n      oldValues: {\n        childIds: oldChildIds,\n      },\n    });\n  }\n\n  hasChild(element: string | BlockSuite.EdgelessModelType) {\n    return (\n      (typeof element === 'string'\n        ? this.children?.has(element)\n        : this.children?.has(element.id)) ?? false\n    );\n  }\n\n  /**\n   * Check if the group has the given descendant.\n   */\n  hasDescendant(element: string | BlockSuite.EdgelessModelType) {\n    const groups = this.surface.getGroups(\n      typeof element === 'string' ? element : element.id\n    );\n\n    return groups.some(group => group.id === this.id);\n  }\n\n  /**\n   * Get all descendants of this group\n   * @param withoutGroup if true, will not include group element\n   */\n  descendants(withoutGroup = true) {\n    return this.childElements.reduce((prev, child) => {\n      if (child instanceof SurfaceGroupLikeModel) {\n        prev = prev.concat(child.descendants());\n\n        !withoutGroup && prev.push(child);\n      } else {\n        prev.push(child);\n      }\n\n      return prev;\n    }, [] as BlockSuite.EdgelessModelType[]);\n  }\n\n  /**\n   * Remove the child from the group\n   */\n  abstract removeChild(id: string): void;\n}\n\nexport abstract class SurfaceLocalModel {\n  get deserializedXYWH() {\n    if (this.xywh !== this._lastXYWH) {\n      const xywh = this.xywh;\n      this._local.set('deserializedXYWH', deserializeXYWH(xywh));\n      this._lastXYWH = xywh;\n    }\n\n    return this._local.get('deserializedXYWH') as XYWH;\n  }\n\n  get x() {\n    return this.deserializedXYWH[0];\n  }\n\n  get y() {\n    return this.deserializedXYWH[1];\n  }\n\n  get w() {\n    return this.deserializedXYWH[2];\n  }\n\n  get h() {\n    return this.deserializedXYWH[3];\n  }\n\n  private _lastXYWH: SerializedXYWH = '[0,0,-1,-1]';\n\n  protected _local = new Map<string | symbol, unknown>();\n\n  abstract rotate: number;\n\n  abstract xywh: SerializedXYWH;\n\n  opacity: number = 1;\n}\n\ndeclare global {\n  namespace BlockSuite {\n    interface SurfaceElementModelMap {}\n    type SurfaceElementModelKeyType = keyof SurfaceElementModelMap;\n    type SurfaceElementModelType =\n      | SurfaceElementModelMap[SurfaceElementModelKeyType]\n      | SurfaceElementModel;\n\n    interface SurfaceGroupLikeModelMap {}\n    type SurfaceGroupLikeModelKeyType = keyof SurfaceGroupLikeModelMap;\n    type SurfaceGroupLikeModelType =\n      | SurfaceGroupLikeModelMap[SurfaceGroupLikeModelKeyType]\n      | SurfaceGroupLikeModel;\n\n    interface SurfaceLocalModelMap {}\n    type SurfaceLocalModelKeyType = keyof SurfaceLocalModelMap;\n    type SurfaceLocalModelType =\n      | SurfaceLocalModelMap[SurfaceLocalModelKeyType]\n      | SurfaceLocalModel;\n\n    // not include local model\n    type SurfaceModelType = SurfaceElementModelType | SurfaceGroupLikeModelType;\n    type SurfaceModelKeyType =\n      | SurfaceElementModelKeyType\n      | SurfaceGroupLikeModelKeyType;\n  }\n}\n"]}