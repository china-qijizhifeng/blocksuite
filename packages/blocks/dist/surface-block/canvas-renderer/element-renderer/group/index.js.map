{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/surface-block/canvas-renderer/element-renderer/group/index.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,KAAK,EAAE,MAAM,yBAAyB,CAAC;AAEhD,OAAO,EAAE,iBAAiB,EAAE,MAAM,YAAY,CAAC;AAE/C,MAAM,UAAU,KAAK,CACnB,KAAwB,EACxB,GAA6B,EAC7B,MAAiB,EACjB,QAAkB;IAElB,MAAM,EAAE,IAAI,EAAE,GAAG,KAAK,CAAC;IACvB,MAAM,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,gBAAgB,EAAE,EAAE,IAAI,EAAE,CAAC;IAE9D,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;IAEzB,IAAI,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC;QAChC,WAAW,CAAC,KAAK,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;IACpC,CAAC;SAAM,IAAI,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC;QAC1E,MAAM,KAAK,GAAG,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;QACtC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QACxB,GAAG,CAAC,WAAW,GAAG,QAAQ,CAAC,gBAAgB,CAAC,eAAe,CAAC,CAAC;QAC7D,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC;QAClB,GAAG,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;QAEvC,WAAW,CAAC,KAAK,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;IACpC,CAAC;AACH,CAAC;AAED,SAAS,WAAW,CAClB,KAAwB,EACxB,GAA6B,EAC7B,QAAkB;IAElB,MAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;IAC3B,MAAM,EACJ,UAAU,EACV,IAAI,EACJ,UAAU,EACV,IAAI,EACJ,OAAO,EACP,MAAM,EACN,MAAM,EACN,UAAU,GACX,GAAG,iBAAiB,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;IAEnC,IAAI,CAAC,KAAK,CAAC,SAAS;QAAE,OAAO;IAE7B,KAAK,CAAC,YAAY,GAAG,UAAU,CAAC,SAAS,EAAE,CAAC;IAE5C,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;IAE1B,GAAG,CAAC,SAAS,EAAE,CAAC;IAChB,GAAG,CAAC,SAAS,CACX,CAAC,EACD,CAAC,UAAU,GAAG,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,EAC5B,UAAU,EACV,UAAU,GAAG,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,EAC3B,MAAM,CACP,CAAC;IACF,GAAG,CAAC,SAAS,GAAG,SAAS,CAAC;IAC1B,GAAG,CAAC,IAAI,EAAE,CAAC;IAEX,GAAG,CAAC,IAAI,GAAG,IAAI,CAAC;IAChB,GAAG,CAAC,SAAS,GAAG,SAAS,CAAC;IAC1B,GAAG,CAAC,SAAS,GAAG,MAAM,CAAC;IACvB,GAAG,CAAC,YAAY,GAAG,QAAQ,CAAC;IAC5B,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,UAAU,GAAG,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;AAC/D,CAAC","sourcesContent":["import type { GroupElementModel } from '../../../element-model/group.js';\nimport { Bound } from '../../../utils/bound.js';\nimport type { Renderer } from '../../renderer.js';\nimport { titleRenderParams } from './utils.js';\n\nexport function group(\n  model: GroupElementModel,\n  ctx: CanvasRenderingContext2D,\n  matrix: DOMMatrix,\n  renderer: Renderer\n) {\n  const { xywh } = model;\n  const elements = renderer.provider.selectedElements?.() || [];\n\n  ctx.setTransform(matrix);\n\n  if (elements.includes(model.id)) {\n    renderTitle(model, ctx, renderer);\n  } else if (model.childElements.some(child => elements.includes(child.id))) {\n    const bound = Bound.deserialize(xywh);\n    ctx.setLineDash([2, 2]);\n    ctx.strokeStyle = renderer.getVariableColor('--affine-blue');\n    ctx.lineWidth = 1;\n    ctx.strokeRect(0, 0, bound.w, bound.h);\n\n    renderTitle(model, ctx, renderer);\n  }\n}\n\nfunction renderTitle(\n  model: GroupElementModel,\n  ctx: CanvasRenderingContext2D,\n  renderer: Renderer\n) {\n  const zoom = renderer.zoom;\n  const {\n    titleWidth,\n    text,\n    lineHeight,\n    font,\n    padding,\n    offset,\n    radius,\n    titleBound,\n  } = titleRenderParams(model, zoom);\n\n  if (!model.showTitle) return;\n\n  model.externalXYWH = titleBound.serialize();\n\n  ctx.translate(0, -offset);\n\n  ctx.beginPath();\n  ctx.roundRect(\n    0,\n    -lineHeight - padding[1] * 2,\n    titleWidth,\n    lineHeight + padding[1] * 2,\n    radius\n  );\n  ctx.fillStyle = '#E3E2E4';\n  ctx.fill();\n\n  ctx.font = font;\n  ctx.fillStyle = '#424149';\n  ctx.textAlign = 'left';\n  ctx.textBaseline = 'middle';\n  ctx.fillText(text, padding[0], -lineHeight / 2 - padding[1]);\n}\n"]}