{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../../../src/surface-block/canvas-renderer/element-renderer/group/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import { FontFamily, FontWeight } from '../../../consts.js';\nimport type { GroupElementModel } from '../../../element-model/group.js';\nimport { Bound } from '../../../utils/bound.js';\nimport {\n  getFontString,\n  getLineHeight,\n  getLineWidth,\n  truncateTextByWidth,\n} from '../text/utils.js';\n\nconst TITLE_FONT = FontFamily.Inter;\nconst TITLE_FONT_SIZE = 16;\nconst TITLE_PADDING = [10, 4];\n\nexport function titleRenderParams(group: GroupElementModel, zoom: number) {\n  let text = group.title.toJSON();\n  const font = getGroupTitleFont(zoom);\n  const lineWidth = getLineWidth(text, font);\n  const lineHeight = getLineHeight(\n    TITLE_FONT,\n    TITLE_FONT_SIZE / zoom,\n    'normal'\n  );\n  const bound = group.elementBound;\n  const padding = [\n    Math.min(TITLE_PADDING[0] / zoom, TITLE_PADDING[0]),\n    Math.min(TITLE_PADDING[1] / zoom, TITLE_PADDING[1]),\n  ];\n  const offset = Math.max(4 / zoom, 2);\n  const radius = Math.min(4, lineHeight / 2);\n\n  let titleWidth = lineWidth + padding[0] * 2;\n  const titleHeight = lineHeight + padding[1] * 2 + offset;\n\n  if (titleWidth > bound.w) {\n    text = truncateTextByWidth(text, font, bound.w - 10);\n    text = text.slice(0, text.length - 1) + '..';\n    titleWidth = bound.w;\n  }\n\n  return {\n    radius,\n    font,\n    bound,\n    text,\n    titleWidth,\n    titleHeight,\n    lineHeight,\n    padding,\n    offset,\n    titleBound: new Bound(\n      bound.x,\n      bound.y - titleHeight,\n      titleWidth,\n      titleHeight\n    ),\n  };\n}\n\nexport function titleBound(group: GroupElementModel, zoom: number) {\n  const { titleWidth, titleHeight, bound } = titleRenderParams(group, zoom);\n\n  return new Bound(bound.x, bound.y - titleHeight, titleWidth, titleHeight);\n}\n\nfunction getGroupTitleFont(zoom: number) {\n  const fontSize = 16 / zoom;\n  const font = getFontString({\n    fontSize,\n    fontFamily: TITLE_FONT,\n    fontWeight: FontWeight.Regular,\n    fontStyle: 'normal',\n  });\n\n  return font;\n}\n"]}