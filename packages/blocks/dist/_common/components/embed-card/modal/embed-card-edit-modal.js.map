{"version":3,"file":"embed-card-edit-modal.js","sourceRoot":"","sources":["../../../../../src/_common/components/embed-card/modal/embed-card-edit-modal.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EditorHost } from '@blocksuite/block-std';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { html } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\n\nimport type { BookmarkBlockModel } from '../../../../bookmark-block/bookmark-model.js';\nimport type { EmbedFigmaModel } from '../../../../embed-figma-block/embed-figma-model.js';\nimport type { EmbedGithubModel } from '../../../../embed-github-block/embed-github-model.js';\nimport type { EmbedLoomModel } from '../../../../embed-loom-block/embed-loom-model.js';\nimport type { EmbedYoutubeModel } from '../../../../embed-youtube-block/embed-youtube-model.js';\nimport { toast } from '../../toast.js';\nimport { embedCardModalStyles } from './styles.js';\n\ntype EmbedCardModel =\n  | BookmarkBlockModel\n  | EmbedGithubModel\n  | EmbedYoutubeModel\n  | EmbedFigmaModel\n  | EmbedLoomModel;\n\n@customElement('embed-card-edit-modal')\nexport class EmbedCardEditModal extends WithDisposable(ShadowlessElement) {\n  static override styles = embedCardModalStyles;\n\n  @state()\n  private accessor _titleInputValue = '';\n\n  @property({ attribute: false })\n  accessor model!: EmbedCardModel;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @query('.embed-card-modal-input.title')\n  accessor titleInput!: HTMLInputElement;\n\n  @query('.embed-card-modal-input.description')\n  accessor descInput!: HTMLTextAreaElement;\n\n  private _handleInput(e: InputEvent) {\n    const target = e.target as HTMLInputElement;\n    this._titleInputValue = target.value;\n  }\n\n  private _onDocumentKeydown(e: KeyboardEvent) {\n    e.stopPropagation();\n    if (e.key === 'Enter' && !e.isComposing) {\n      this._onSave();\n    }\n    if (e.key === 'Escape') {\n      this.remove();\n    }\n  }\n\n  private _onSave() {\n    const title = this.titleInput.value;\n    if (title.length === 0) {\n      toast(this.host, 'Link title can not be empty');\n      return;\n    }\n\n    this.model.doc.updateBlock(this.model, {\n      title,\n      description: this.descInput.value,\n    });\n    this.remove();\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this.updateComplete\n      .then(() => {\n        this.titleInput.focus();\n        this.titleInput.setSelectionRange(0, this.titleInput.value.length);\n      })\n      .catch(console.error);\n\n    this.disposables.addFromEvent(this, 'keydown', this._onDocumentKeydown);\n\n    this._titleInputValue = this.model.title ?? '';\n  }\n\n  override render() {\n    return html`\n      <div class=\"embed-card-modal\">\n        <div class=\"embed-card-modal-mask\" @click=${() => this.remove()}></div>\n        <div class=\"embed-card-modal-wrapper\">\n          <div class=\"embed-card-modal-title\">Edit Link</div>\n\n          <div class=\"embed-card-modal-content\">\n            <input\n              class=\"embed-card-modal-input title\"\n              type=\"text\"\n              placeholder=\"Title\"\n              value=${this._titleInputValue}\n              @input=${this._handleInput}\n              tabindex=\"0\"\n            />\n\n            <textarea\n              class=\"embed-card-modal-input description\"\n              placeholder=\"Description\"\n              .value=${this.model.description ?? ''}\n              tabindex=\"0\"\n            ></textarea>\n          </div>\n\n          <div class=\"embed-card-modal-action\">\n            <div\n              class=\"embed-card-modal-button cancel\"\n              tabindex=\"0\"\n              @click=${() => this.remove()}\n            >\n              Cancel\n            </div>\n\n            <div\n              class=${classMap({\n                'embed-card-modal-button': true,\n                save: true,\n                disabled: this._titleInputValue.length === 0,\n              })}\n              tabindex=\"0\"\n              @click=${() => this._onSave()}\n            >\n              Save\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n}\n\nexport function toggleEmbedCardEditModal(\n  host: EditorHost,\n  embedCardModel: EmbedCardModel\n) {\n  host.selection.clear();\n  const embedCardEditModal = new EmbedCardEditModal();\n  embedCardEditModal.model = embedCardModel;\n  embedCardEditModal.host = host;\n  document.body.append(embedCardEditModal);\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'embed-card-edit-modal': EmbedCardEditModal;\n  }\n}\n"]}