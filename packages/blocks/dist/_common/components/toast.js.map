{"version":3,"file":"toast.js","sourceRoot":"","sources":["../../../src/_common/components/toast.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EditorHost } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { baseTheme } from '@toeverything/theme';\nimport { html, type TemplateResult } from 'lit';\n\nimport { getRootByEditorHost } from '../utils/query.js';\n\nlet ToastContainer: HTMLDivElement | null = null;\n\n/**\n * DO NOT USE FOR USER INPUT\n * See https://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro/35385518#35385518\n */\nconst htmlToElement = <T extends ChildNode>(html: string | TemplateResult) => {\n  const template = document.createElement('template');\n  if (typeof html === 'string') {\n    html = html.trim(); // Never return a text node of whitespace as the result\n    template.innerHTML = html;\n  } else {\n    const htmlString = String.raw(html.strings, ...html.values);\n    template.innerHTML = htmlString;\n  }\n  return template.content.firstChild as T;\n};\n\nconst createToastContainer = (editorHost: EditorHost) => {\n  const styles = `\n    position: fixed;\n    z-index: 9999;\n    top: 16px;\n    left: 16px;\n    right: 16px;\n    bottom: 78px;\n    pointer-events: none;\n    display: flex;\n    flex-direction: column-reverse;\n    align-items: center;\n  `;\n  const template = html`<div class=\"toast-container\" style=\"${styles}\"></div>`;\n  const element = htmlToElement<HTMLDivElement>(template);\n  const rootElement = getRootByEditorHost(editorHost);\n  assertExists(rootElement);\n  const viewportElement = rootElement.viewportElement;\n  viewportElement?.append(element);\n  return element;\n};\n\n/**\n * @example\n * ```ts\n * toast('Hello World');\n * ```\n */\nexport const toast = (\n  editorHost: EditorHost,\n  message: string,\n  duration = 2500\n) => {\n  if (!ToastContainer) {\n    ToastContainer = createToastContainer(editorHost);\n  }\n\n  const styles = `\n    max-width: 480px;\n    text-align: center;\n    font-family: ${baseTheme.fontSansFamily};\n    font-size: var(--affine-font-sm);\n    padding: 6px 12px;\n    margin: 10px 0 0 0;\n    color: var(--affine-white);\n    background: var(--affine-tooltip);\n    box-shadow: var(--affine-float-button-shadow);\n    border-radius: 10px;\n    transition: all 230ms cubic-bezier(0.21, 1.02, 0.73, 1);\n    opacity: 0;\n  `;\n\n  const template = html`<div style=\"${styles}\"></div>`;\n  const element = htmlToElement<HTMLDivElement>(template);\n  // message is not trusted\n  element.textContent = message;\n  ToastContainer.append(element);\n\n  const fadeIn = [\n    {\n      opacity: 0,\n    },\n    { opacity: 1 },\n  ];\n  const options = {\n    duration: 230,\n    easing: 'cubic-bezier(0.21, 1.02, 0.73, 1)',\n    fill: 'forwards' as const,\n  }; // satisfies KeyframeAnimationOptions;\n  element.animate(fadeIn, options);\n\n  setTimeout(() => {\n    const fadeOut = fadeIn.reverse();\n    const animation = element.animate(fadeOut, options);\n    animation.finished\n      .then(() => {\n        element.style.maxHeight = '0';\n        element.style.margin = '0';\n        element.style.padding = '0';\n        element.addEventListener(\n          'transitionend',\n          () => {\n            element.remove();\n          },\n          {\n            once: true,\n          }\n        );\n      })\n      .catch(console.error);\n  }, duration);\n  return element;\n};\n"]}