{"version":3,"file":"rich-text-operations.js","sourceRoot":"","sources":["../../../../src/_common/components/rich-text/rich-text-operations.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EditorHost } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { Doc } from '@blocksuite/store';\nimport { type BlockModel, Text } from '@blocksuite/store';\n\nimport {\n  isInsideBlockByFlavour,\n  matchFlavours,\n} from '../../../_common/utils/model.js';\nimport {\n  getBlockComponentByModel,\n  getDocTitleByEditorHost,\n  getInlineEditorByModel,\n  getNextBlock,\n  getPreviousBlock,\n} from '../../../_common/utils/query.js';\nimport {\n  asyncFocusRichText,\n  asyncSetInlineRange,\n  focusBlockByModel,\n  focusTitle,\n} from '../../../_common/utils/selection.js';\nimport type { ListBlockModel } from '../../../list-block/index.js';\nimport type { RootBlockModel } from '../../../root-block/index.js';\nimport { EMBED_BLOCK_FLAVOUR_LIST } from '../../consts.js';\nimport type { ExtendedModel } from '../../types.js';\n\n/**\n * Whether the block supports rendering its children.\n */\nfunction supportsChildren(model: BlockModel): boolean {\n  if (\n    matchFlavours(model, [\n      // 'affine:database',\n      'affine:image',\n      'affine:divider',\n      'affine:code',\n    ])\n  ) {\n    return false;\n  }\n  if (\n    matchFlavours(model, ['affine:paragraph']) &&\n    ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'quote'].includes(model.type ?? '')\n  ) {\n    return false;\n  }\n  return true;\n}\n\nexport function handleBlockEndEnter(\n  editorHost: EditorHost,\n  model: ExtendedModel\n) {\n  const doc = model.doc;\n  const parent = doc.getParent(model);\n  const nextSibling = doc.getNext(model);\n  if (!parent) {\n    return;\n  }\n\n  const getProps = ():\n    | [\n        'affine:list',\n        BlockSuite.ModelProps<BlockSuite.BlockModels['affine:list']>,\n      ]\n    | [\n        'affine:paragraph',\n        BlockSuite.ModelProps<BlockSuite.BlockModels['affine:paragraph']>,\n      ] => {\n    const shouldInheritFlavour = matchFlavours(model, ['affine:list']);\n    if (shouldInheritFlavour) {\n      return [model.flavour, { type: model.type }];\n    }\n    return ['affine:paragraph', { type: 'text' }];\n  };\n  const [flavour, blockProps] = getProps();\n\n  if (isInsideBlockByFlavour(doc, model, 'affine:database')) {\n    doc.captureSync();\n    const index = parent.children.findIndex(child => child.id === model.id);\n    let newParent: BlockModel = parent;\n    let newBlockIndex = index + 1;\n    const childrenLength = parent.children.length;\n\n    if (index === childrenLength - 1 && model.text?.yText.length === 0) {\n      if (childrenLength !== 1) {\n        doc.deleteBlock(model);\n      }\n\n      const nextModel = doc.getNext(newParent);\n      if (nextModel && matchFlavours(nextModel, ['affine:paragraph'])) {\n        asyncFocusRichText(editorHost, nextModel.id, {\n          index: nextModel.text.yText.length,\n          length: 0,\n        })?.catch(console.error);\n        return;\n      }\n\n      const prevParent = doc.getParent(parent);\n      if (!prevParent) return;\n      const prevIndex = prevParent.children.findIndex(\n        child => child.id === parent.id\n      );\n      newParent = prevParent;\n      newBlockIndex = prevIndex + 1;\n    }\n\n    const id = doc.addBlock(flavour, blockProps, newParent, newBlockIndex);\n    asyncFocusRichText(editorHost, id)?.catch(console.error);\n    return;\n  }\n  const index = parent.children.indexOf(model);\n  if (index === -1) {\n    return;\n  }\n  // make adding text block by enter a standalone operation\n  doc.captureSync();\n\n  // before press enter:\n  // aaa|\n  //   bbb\n  //\n  // after press enter:\n  // aaa\n  // |\n  //   bbb\n  const id = doc.addBlock(flavour, blockProps, parent, index + 1);\n  const newModel = doc.getBlockById(id);\n  assertExists(newModel);\n  doc.moveBlocks(model.children, newModel);\n\n  // 4. If the target block is a numbered list, update the prefix of next siblings\n  if (matchFlavours(model, ['affine:list']) && model.type === 'numbered') {\n    let next = nextSibling;\n    while (\n      next &&\n      matchFlavours(next, ['affine:list']) &&\n      model.type === 'numbered'\n    ) {\n      doc.updateBlock(next, {});\n      next = doc.getNext(next);\n    }\n  }\n\n  asyncFocusRichText(editorHost, id)?.catch(console.error);\n}\n\nexport function handleBlockSplit(\n  editorHost: EditorHost,\n  model: ExtendedModel,\n  splitIndex: number,\n  splitLength: number\n) {\n  if (!(model.text instanceof Text)) return;\n\n  // On press enter, it may convert symbols from yjs ContentString\n  // to yjs ContentFormat. Once it happens, the converted symbol will\n  // be deleted and not counted as model.text.yText.length.\n  // Example: \"`a`[enter]\" -> yText[<ContentFormat: Code>, \"a\", <ContentFormat: Code>]\n  // In this case, we should not split the block.\n  if (model.text.yText.length < splitIndex + splitLength) return;\n\n  const doc = model.doc;\n\n  const parent = doc.getParent(model);\n  if (!parent) return;\n\n  doc.captureSync();\n  const right = model.text.split(splitIndex, splitLength);\n\n  const newParent = parent;\n  const newBlockIndex = newParent.children.indexOf(model) + 1;\n  const children = [...model.children];\n  doc.updateBlock(model, { children: [] });\n  const id = doc.addBlock(\n    model.flavour as never,\n    {\n      text: right,\n      type: model.type,\n      children,\n    },\n    newParent,\n    newBlockIndex\n  );\n  return asyncFocusRichText(editorHost, id);\n}\n\n/**\n * @example\n * before unindent:\n * - aaa\n *   - bbb\n * - ccc|\n *   - ddd\n *   - eee\n *\n * after unindent:\n * - aaa\n *   - bbb\n *   - ccc|\n *     - ddd\n *     - eee\n */\nexport function handleIndent(\n  editorHost: EditorHost,\n  model: ExtendedModel,\n  offset = 0\n) {\n  const doc = model.doc;\n  const previousSibling = doc.getPrev(model);\n  if (!previousSibling || !supportsChildren(previousSibling)) {\n    // Bottom, can not indent, do nothing\n    return;\n  }\n  const nextSiblings = doc.getNexts(model);\n\n  doc.captureSync();\n  doc.moveBlocks([model], previousSibling);\n\n  // update list prefix\n  if (matchFlavours(model, ['affine:list']) && model.type === 'numbered') {\n    doc.updateBlock(model, {});\n  }\n  nextSiblings\n    .filter(\n      sibling =>\n        matchFlavours(sibling, ['affine:list']) && sibling.type === 'numbered'\n    )\n    .forEach(sibling => {\n      doc.updateBlock(sibling, {});\n    });\n\n  // update collapsed state\n  if (\n    matchFlavours(previousSibling, ['affine:list']) &&\n    previousSibling.collapsed\n  ) {\n    doc.updateBlock(previousSibling, {\n      collapsed: false,\n    } as Partial<ListBlockModel>);\n  }\n\n  asyncSetInlineRange(editorHost, model, { index: offset, length: 0 }).catch(\n    console.error\n  );\n}\n\nexport function handleMultiBlockIndent(\n  editorHost: EditorHost,\n  models: BlockModel[]\n) {\n  if (!models.length) return;\n\n  const doc = models[0].doc;\n\n  // Find the first model that can be indented\n  let firstIndentIndex = -1;\n  let previousSibling: BlockModel | null = null;\n  for (let i = 0; i < models.length; i++) {\n    previousSibling = doc.getPrev(models[i]);\n    if (previousSibling && supportsChildren(previousSibling)) {\n      firstIndentIndex = i;\n      break;\n    }\n  }\n\n  // No model can be indented\n  if (firstIndentIndex === -1) return;\n\n  doc.captureSync();\n  // Models waiting to be indented\n  const indentModels = models.slice(firstIndentIndex);\n  indentModels.forEach(model => {\n    const parent = doc.getParent(model);\n    assertExists(parent);\n    // Only indent the model which parent is not in the `indentModels`\n    // When parent is in the `indentModels`, it means the parent has been indented\n    // And the model should be indented with its parent\n    if (!indentModels.includes(parent)) {\n      handleIndent(editorHost, model);\n    }\n  });\n}\n\n/**\n * @example\n * before unindent:\n * - aaa\n *   - bbb\n *   - ccc|\n *     - ddd\n *   - eee\n *\n * after unindent:\n * - aaa\n *   - bbb\n * - ccc|\n *   - ddd\n *   - eee\n */\nexport function handleUnindent(\n  editorHost: EditorHost,\n  model: ExtendedModel,\n  offset = 0\n) {\n  const doc = model.doc;\n  const parent = doc.getParent(model);\n  if (!parent || parent.role !== 'content') {\n    // Top most, can not unindent, do nothing\n    return;\n  }\n\n  const grandParent = doc.getParent(parent);\n  if (!grandParent) return;\n  doc.captureSync();\n\n  const nextSiblings = doc.getNexts(model);\n  const parentNextSiblings = doc.getNexts(parent);\n  doc.moveBlocks(nextSiblings, model);\n  doc.moveBlocks([model], grandParent, parent, false);\n\n  // update list prefix\n  if (matchFlavours(model, ['affine:list']) && model.type === 'numbered') {\n    doc.updateBlock(model, {});\n  }\n  model.children.forEach(child => {\n    if (matchFlavours(child, ['affine:list']) && child.type === 'numbered') {\n      doc.updateBlock(child, {});\n    }\n  });\n  parentNextSiblings\n    .filter(\n      sibling =>\n        matchFlavours(sibling, ['affine:list']) && sibling.type === 'numbered'\n    )\n    .forEach(sibling => {\n      doc.updateBlock(sibling, {});\n    });\n\n  asyncSetInlineRange(editorHost, model, { index: offset, length: 0 }).catch(\n    console.error\n  );\n}\n\nexport function handleMultiBlockOutdent(\n  editorHost: EditorHost,\n  models: BlockModel[]\n) {\n  if (!models.length) return;\n  const doc = models[0].doc;\n\n  // Find the first model that can be unindented\n  let firstOutdentIndex = -1;\n  let firstParent: BlockModel | null;\n  for (let i = 0; i < models.length; i++) {\n    firstParent = doc.getParent(models[i]);\n    if (firstParent && !matchFlavours(firstParent, ['affine:note'])) {\n      firstOutdentIndex = i;\n      break;\n    }\n  }\n\n  // Find all the models that can be unindented\n  const outdentModels = models.slice(firstOutdentIndex);\n  // Form bottom to top\n  // Only outdent the models which parent is not in the outdentModels\n  // When parent is in the outdentModels\n  // It means that children will be unindented with their parent\n  for (let i = outdentModels.length - 1; i >= 0; i--) {\n    const model = outdentModels[i];\n    const parent = doc.getParent(model);\n    assertExists(parent);\n    if (!outdentModels.includes(parent)) {\n      handleUnindent(editorHost, model);\n    }\n  }\n}\n\nexport function handleRemoveAllIndent(\n  editorHost: EditorHost,\n  model: ExtendedModel,\n  offset = 0\n) {\n  const doc = model.doc;\n  let parent = doc.getParent(model);\n  while (parent && !matchFlavours(parent, ['affine:note'])) {\n    handleUnindent(editorHost, model, offset);\n    parent = doc.getParent(model);\n  }\n}\n\nexport function handleRemoveAllIndentForMultiBlocks(\n  editorHost: EditorHost,\n  models: BlockModel[]\n) {\n  if (!models.length) return;\n  const doc = models[0].doc;\n  for (let i = models.length - 1; i >= 0; i--) {\n    const model = models[i];\n    const parent = doc.getParent(model);\n    assertExists(parent);\n    if (!matchFlavours(parent, ['affine:note'])) {\n      handleRemoveAllIndent(editorHost, model);\n    }\n  }\n}\n\n// When deleting at line end of a code block,\n// do nothing\nfunction handleCodeBlockForwardDelete(model: ExtendedModel) {\n  if (!matchFlavours(model, ['affine:code'])) return false;\n  return true;\n}\n\nfunction handleDatabaseBlockForwardDelete(model: ExtendedModel) {\n  const doc = model.doc;\n  if (!isInsideBlockByFlavour(doc, model, 'affine:database')) return false;\n\n  return true;\n}\n\n// When deleting at line start of a list block,\n// switch it to normal paragraph block.\nfunction handleListBlockBackspace(\n  editorHost: EditorHost,\n  model: ExtendedModel\n) {\n  const doc = model.doc;\n  if (!matchFlavours(model, ['affine:list'])) return false;\n\n  const parent = doc.getParent(model);\n  if (!parent) return false;\n\n  const nextSiblings = doc.getNexts(model);\n  const index = parent.children.indexOf(model);\n  const blockProps = {\n    type: 'text' as const,\n    text: model.text?.clone(),\n    children: model.children,\n  };\n  doc.captureSync();\n  doc.deleteBlock(model, {\n    deleteChildren: false,\n  });\n  nextSiblings\n    .filter(\n      sibling =>\n        matchFlavours(sibling, ['affine:list']) && sibling.type === 'numbered'\n    )\n    .forEach(sibling => doc.updateBlock(sibling, {}));\n\n  const id = doc.addBlock('affine:paragraph', blockProps, parent, index);\n  asyncFocusRichText(editorHost, id)?.catch(console.error);\n  return true;\n}\n\n// When deleting at line end of a list block,\n// check current block's children and siblings\n/**\n * Example:\n- Line1  <-(cursor here)\n    - Line2\n        - Line3\n        - Line4\n    - Line5\n        - Line6\n- Line7\n    - Line8\n- Line9\n */\nfunction handleListBlockForwardDelete(\n  editorHost: EditorHost,\n  model: ExtendedModel\n) {\n  if (!matchFlavours(model, ['affine:list'])) return false;\n  const doc = model.doc;\n  const firstChild = model.firstChild();\n  if (firstChild) {\n    model.text?.join(firstChild.text as Text);\n    const grandChildren = firstChild.children;\n    if (grandChildren) {\n      doc.moveBlocks(grandChildren, model);\n      doc.deleteBlock(firstChild);\n      return true;\n    } else {\n      doc.deleteBlock(firstChild);\n      return true;\n    }\n  } else {\n    const nextSibling = doc.getNext(model);\n    if (nextSibling) {\n      model.text?.join(nextSibling.text as Text);\n      if (nextSibling.children) {\n        const parent = doc.getParent(nextSibling);\n        if (!parent) return false;\n        doc.moveBlocks(nextSibling.children, parent, model, false);\n        doc.deleteBlock(nextSibling);\n        return true;\n      } else {\n        doc.deleteBlock(nextSibling);\n        return true;\n      }\n    } else {\n      const nextBlock = getNextBlock(editorHost, model);\n      if (!nextBlock) {\n        // do nothing\n        return true;\n      }\n      model.text?.join(nextBlock.text as Text);\n      if (nextBlock.children) {\n        const parent = doc.getParent(nextBlock);\n        if (!parent) return false;\n        doc.moveBlocks(nextBlock.children, parent, doc.getParent(model), false);\n        doc.deleteBlock(nextBlock);\n        return true;\n      } else {\n        doc.deleteBlock(nextBlock);\n        return true;\n      }\n    }\n  }\n}\n\nfunction handleParagraphOrListSibling(\n  editorHost: EditorHost,\n  model: ExtendedModel,\n  previousSibling: ExtendedModel,\n  parent: ExtendedModel\n) {\n  const doc = model.doc;\n  if (!matchFlavours(previousSibling, ['affine:paragraph', 'affine:list']))\n    return false;\n\n  doc.captureSync();\n  const preTextLength = previousSibling.text?.length || 0;\n  model.text?.length && previousSibling.text?.join(model.text as Text);\n  doc.deleteBlock(model, {\n    bringChildrenTo: parent,\n  });\n  const inlineEditor = getInlineEditorByModel(editorHost, previousSibling);\n  inlineEditor?.setInlineRange({\n    index: preTextLength,\n    length: 0,\n  });\n  return true;\n}\n\nfunction handleEmbedDividerCodeSibling(\n  editorHost: EditorHost,\n  model: ExtendedModel,\n  previousSibling: ExtendedModel,\n  parent: ExtendedModel\n) {\n  const doc = model.doc;\n  if (matchFlavours(previousSibling, ['affine:divider'])) {\n    doc.deleteBlock(previousSibling);\n    return true;\n  }\n\n  if (\n    !matchFlavours(previousSibling, [\n      'affine:image',\n      'affine:code',\n      'affine:bookmark',\n      'affine:attachment',\n      'affine:surface-ref',\n    ])\n  )\n    return false;\n\n  focusBlockByModel(editorHost, previousSibling);\n  if (!model.text?.length) {\n    doc.captureSync();\n    doc.deleteBlock(model, {\n      bringChildrenTo: parent,\n    });\n  }\n  return true;\n}\n\nfunction handleNoPreviousSibling(editorHost: EditorHost, model: ExtendedModel) {\n  const doc = model.doc;\n  const text = model.text;\n  const parent = doc.getParent(model);\n  assertExists(parent);\n  const titleElement = getDocTitleByEditorHost(\n    editorHost\n  ) as HTMLTextAreaElement | null;\n  // Probably no title, e.g. in edgeless mode\n  if (!titleElement) {\n    if (\n      matchFlavours(parent, ['affine:edgeless-text']) ||\n      model.children.length > 0\n    ) {\n      doc.deleteBlock(model, {\n        bringChildrenTo: parent,\n      });\n      return true;\n    }\n    return false;\n  }\n\n  const rootModel = model.doc.root as RootBlockModel;\n  const title = rootModel.title;\n\n  doc.captureSync();\n  let textLength = 0;\n  if (text) {\n    textLength = text.length;\n    title.join(text);\n  }\n\n  // Preserve at least one block to be able to focus on container click\n  if (doc.getNext(model) || model.children.length > 0) {\n    const parent = doc.getParent(model);\n    assertExists(parent);\n    doc.deleteBlock(model, {\n      bringChildrenTo: parent,\n    });\n  } else {\n    text?.clear();\n  }\n  focusTitle(editorHost, title.length - textLength);\n  return true;\n}\n\nfunction handleParagraphDeleteActions(\n  editorHost: EditorHost,\n  model: ExtendedModel\n) {\n  const doc = model.doc;\n  const parent = doc.getParent(model);\n  if (!parent) return false;\n  const previousSibling = getPreviousBlock(editorHost, model);\n  if (!previousSibling) {\n    return handleNoPreviousSibling(editorHost, model);\n  } else if (\n    matchFlavours(previousSibling, ['affine:paragraph', 'affine:list'])\n  ) {\n    const modelIndex = parent.children.indexOf(model);\n    if (\n      (modelIndex === -1 || modelIndex === parent.children.length - 1) &&\n      parent.role === 'content'\n    )\n      return false;\n    const lengthBeforeJoin = previousSibling.text?.length ?? 0;\n    previousSibling.text?.join(model.text as Text);\n    doc.deleteBlock(model, {\n      bringChildrenTo: parent,\n    });\n    asyncSetInlineRange(editorHost, previousSibling, {\n      index: lengthBeforeJoin,\n      length: 0,\n    }).catch(console.error);\n    return true;\n  } else if (\n    matchFlavours(previousSibling, [\n      'affine:attachment',\n      'affine:bookmark',\n      'affine:code',\n      'affine:image',\n      'affine:divider',\n      ...EMBED_BLOCK_FLAVOUR_LIST,\n    ])\n  ) {\n    const previousSiblingElement = getBlockComponentByModel(\n      editorHost,\n      previousSibling\n    );\n    assertExists(previousSiblingElement);\n    const selection = editorHost.selection.create('block', {\n      blockId: previousSiblingElement.blockId,\n    });\n    editorHost.selection.setGroup('note', [selection]);\n\n    if (model.text?.length === 0) {\n      doc.deleteBlock(model, {\n        bringChildrenTo: parent,\n      });\n    }\n\n    return true;\n  } else if (matchFlavours(previousSibling, ['affine:edgeless-text'])) {\n    return true;\n  }\n\n  // TODO handle in block service\n  if (matchFlavours(parent, ['affine:database'])) {\n    doc.deleteBlock(model);\n    focusBlockByModel(editorHost, previousSibling);\n    return true;\n  } else if (matchFlavours(parent, ['affine:note'])) {\n    return (\n      handleParagraphOrListSibling(\n        editorHost,\n        model,\n        previousSibling,\n        parent\n      ) ||\n      handleEmbedDividerCodeSibling(\n        editorHost,\n        model,\n        previousSibling,\n        parent\n      ) ||\n      handleUnknownBlockBackspace(previousSibling)\n    );\n  }\n  return false;\n}\n\nfunction handleParagraphBlockBackspace(\n  editorHost: EditorHost,\n  model: ExtendedModel\n) {\n  const doc = model.doc;\n  if (!matchFlavours(model, ['affine:paragraph'])) return false;\n\n  // When deleting at line start of a paragraph block,\n  // firstly switch it to normal text, then delete this empty block.\n  if (model.type !== 'text') {\n    // Try to switch to normal text\n    doc.captureSync();\n    doc.updateBlock(model, { type: 'text' });\n    return true;\n  }\n\n  // Before press backspace\n  // - line1\n  //   - line2\n  //   - |aaa\n  //   - line3\n  //\n  // After press backspace\n  // - line1\n  //   - line2|aaa\n  //   - line3\n  const isHandled = handleParagraphDeleteActions(editorHost, model);\n  if (isHandled) return true;\n\n  // Before press backspace\n  // - line1\n  //   - line2\n  //   - |aaa\n  //\n  // After press backspace\n  // - line1\n  //   - line2\n  // - |aaa\n  handleUnindent(editorHost, model);\n  return true;\n}\n\nfunction handleParagraphBlockForwardDelete(\n  editorHost: EditorHost,\n  model: ExtendedModel\n) {\n  const doc = model.doc;\n  function handleParagraphOrList(\n    doc: Doc,\n    model: ExtendedModel,\n    nextSibling: ExtendedModel | null,\n    firstChild: ExtendedModel | null\n  ) {\n    function handleParagraphOrListSibling(\n      doc: Doc,\n      model: ExtendedModel,\n      nextSibling: ExtendedModel | null\n    ) {\n      if (\n        nextSibling &&\n        matchFlavours(nextSibling, ['affine:paragraph', 'affine:list'])\n      ) {\n        model.text?.join(nextSibling.text as Text);\n        if (nextSibling.children) {\n          const parent = doc.getParent(nextSibling);\n          if (!parent) return false;\n          doc.moveBlocks(nextSibling.children, parent, model, false);\n          doc.deleteBlock(nextSibling);\n          return true;\n        } else {\n          doc.deleteBlock(nextSibling);\n          return true;\n        }\n      } else {\n        const nextBlock = getNextBlock(editorHost, model);\n        if (\n          !nextBlock ||\n          !matchFlavours(nextBlock, ['affine:paragraph', 'affine:list'])\n        )\n          return false;\n        model.text?.join(nextBlock.text as Text);\n        if (nextBlock.children) {\n          const parent = doc.getParent(nextBlock);\n          if (!parent) return false;\n          doc.moveBlocks(\n            nextBlock.children,\n            parent,\n            doc.getParent(model),\n            false\n          );\n          doc.deleteBlock(nextBlock);\n          return true;\n        } else {\n          doc.deleteBlock(nextBlock);\n          return true;\n        }\n      }\n    }\n    function handleParagraphOrListChild(\n      doc: Doc,\n      model: ExtendedModel,\n      firstChild: ExtendedModel | null\n    ) {\n      if (\n        !firstChild ||\n        !matchFlavours(firstChild, ['affine:paragraph', 'affine:list'])\n      ) {\n        return false;\n      }\n      const grandChildren = firstChild.children;\n      model.text?.join(firstChild.text as Text);\n      if (grandChildren) {\n        doc.moveBlocks(grandChildren, model);\n      }\n      doc.deleteBlock(firstChild);\n      return true;\n    }\n    const nextBlock = getNextBlock(editorHost, model);\n    if (!firstChild && !nextBlock) return true;\n    return (\n      handleParagraphOrListChild(doc, model, firstChild) ||\n      handleParagraphOrListSibling(doc, model, nextSibling)\n    );\n  }\n  function handleEmbedDividerCode(\n    nextSibling: ExtendedModel | null,\n    firstChild: ExtendedModel | null\n  ) {\n    function handleEmbedDividerCodeChild(firstChild: ExtendedModel | null) {\n      if (\n        !firstChild ||\n        !matchFlavours(firstChild, [\n          'affine:image',\n          'affine:divider',\n          'affine:code',\n        ])\n      )\n        return false;\n      focusBlockByModel(editorHost, firstChild);\n      return true;\n    }\n    function handleEmbedDividerCodeSibling(nextSibling: ExtendedModel | null) {\n      if (matchFlavours(nextSibling, ['affine:divider'])) {\n        const nextSiblingComponent = getBlockComponentByModel(\n          editorHost,\n          nextSibling\n        );\n        assertExists(nextSiblingComponent);\n        editorHost.selection.setGroup('note', [\n          editorHost.selection.create('block', {\n            blockId: nextSiblingComponent.blockId,\n          }),\n        ]);\n        return true;\n      }\n\n      if (\n        !nextSibling ||\n        !matchFlavours(nextSibling, ['affine:image', 'affine:code'])\n      )\n        return false;\n      focusBlockByModel(editorHost, nextSibling);\n      return true;\n    }\n    return (\n      handleEmbedDividerCodeChild(firstChild) ||\n      handleEmbedDividerCodeSibling(nextSibling)\n    );\n  }\n\n  if (!matchFlavours(model, ['affine:paragraph'])) return false;\n\n  const parent = doc.getParent(model);\n  if (!parent) return false;\n  const nextSibling = doc.getNext(model);\n  const firstChild = model.firstChild();\n  if (matchFlavours(parent, ['affine:database'])) {\n    // TODO\n    return false;\n  } else {\n    const ignoreForwardDeleteFlavourList: BlockSuite.Flavour[] = [\n      'affine:database',\n      'affine:image',\n      'affine:code',\n      'affine:attachment',\n      'affine:bookmark',\n      ...EMBED_BLOCK_FLAVOUR_LIST,\n    ];\n\n    if (\n      nextSibling &&\n      matchFlavours(nextSibling, ignoreForwardDeleteFlavourList)\n    ) {\n      return true;\n    }\n\n    return (\n      handleParagraphOrList(doc, model, nextSibling, firstChild) ||\n      handleEmbedDividerCode(nextSibling, firstChild)\n    );\n  }\n}\n\nfunction handleUnknownBlockBackspace(model: ExtendedModel) {\n  throw new Error(\n    'Failed to handle backspace! Unknown block flavours! flavour:' +\n      model.flavour\n  );\n}\n\nfunction handleUnknownBlockForwardDelete(model: ExtendedModel) {\n  throw new Error(\n    'Failed to handle forwarddelete! Unknown block flavours! flavour:' +\n      model.flavour\n  );\n}\n\nexport function handleLineStartBackspace(\n  editorHost: EditorHost,\n  model: ExtendedModel\n) {\n  if (\n    handleListBlockBackspace(editorHost, model) ||\n    handleParagraphBlockBackspace(editorHost, model)\n  ) {\n    return;\n  }\n\n  handleUnknownBlockBackspace(model);\n}\n\nexport function handleLineEndForwardDelete(\n  editorHost: EditorHost,\n  model: ExtendedModel\n) {\n  if (\n    handleCodeBlockForwardDelete(model) ||\n    handleListBlockForwardDelete(editorHost, model) ||\n    handleParagraphBlockForwardDelete(editorHost, model)\n  ) {\n    handleDatabaseBlockForwardDelete(model);\n    return;\n  }\n  handleUnknownBlockForwardDelete(model);\n}\n"]}