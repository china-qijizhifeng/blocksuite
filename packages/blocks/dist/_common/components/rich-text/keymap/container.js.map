{"version":3,"file":"container.js","sourceRoot":"","sources":["../../../../../src/_common/components/rich-text/keymap/container.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BlockElement, UIEventStateContext } from '@blocksuite/block-std';\nimport { IS_MAC } from '@blocksuite/global/env';\nimport { assertExists } from '@blocksuite/global/utils';\nimport {\n  INLINE_ROOT_ATTR,\n  type InlineEditor,\n  type InlineRootElement,\n} from '@blocksuite/inline';\n\nimport { matchFlavours } from '../../../../_common/utils/model.js';\nimport type { RootBlockComponent } from '../../../../root-block/types.js';\nimport { insertLinkedNode } from '../../../../root-block/widgets/linked-doc/config.js';\nimport { textFormatConfigs } from '../../../configs/text-format/config.js';\nimport { createDefaultDoc } from '../../../utils/init.js';\nimport { buildPath } from '../../../utils/query.js';\nimport { tryConvertBlock } from '../markdown/block.js';\nimport {\n  handleIndent,\n  handleMultiBlockIndent,\n  handleMultiBlockOutdent,\n  handleRemoveAllIndent,\n  handleRemoveAllIndentForMultiBlocks,\n  handleUnindent,\n} from '../rich-text-operations.js';\nimport { bracketPairs } from './bracket-pairs.js';\nimport { hardEnter, onBackspace, onForwardDelete } from './legacy.js';\n\nexport const bindContainerHotkey = (blockElement: BlockElement) => {\n  const selection = blockElement.host.selection;\n  const model = blockElement.model;\n  const editorHost = blockElement.host;\n  const std = editorHost.std;\n  const leftBrackets = bracketPairs.map(pair => pair.left);\n\n  const _selectBlock = () => {\n    selection.update(selList => {\n      return selList.map(sel => {\n        if (sel.blockId === blockElement.blockId) {\n          return selection.create('block', { blockId: blockElement.blockId });\n        }\n        return sel;\n      });\n    });\n    return true;\n  };\n\n  const _selectText = (start: boolean) => {\n    selection.update(selList => {\n      return selList.map(sel => {\n        if (sel.blockId === blockElement.blockId) {\n          return selection.create('text', {\n            from: {\n              blockId: blockElement.blockId,\n              index: start ? 0 : blockElement.model.text?.length ?? 0,\n              length: 0,\n            },\n            to: null,\n          });\n        }\n        return sel;\n      });\n    });\n    return true;\n  };\n\n  const _getInlineEditor = () => {\n    const inlineRoot = blockElement.querySelector<InlineRootElement>(\n      `[${INLINE_ROOT_ATTR}]`\n    );\n    if (!inlineRoot) {\n      throw new Error('Inline editor root not found');\n    }\n    return inlineRoot.inlineEditor;\n  };\n\n  const _getPrefixText = (inlineEditor: InlineEditor) => {\n    const inlineRange = inlineEditor.getInlineRange();\n    assertExists(inlineRange);\n    const firstLineEnd = inlineEditor.yTextString.search(/\\n/);\n    if (firstLineEnd !== -1 && inlineRange.index > firstLineEnd) {\n      return '';\n    }\n    const [leafStart, offsetStart] = inlineEditor.getTextPoint(\n      inlineRange.index\n    );\n    return leafStart.textContent\n      ? leafStart.textContent.slice(0, offsetStart)\n      : '';\n  };\n\n  const _preventDefault = (ctx: UIEventStateContext) => {\n    const state = ctx.get('defaultState');\n    state.event.preventDefault();\n  };\n\n  const _selectAllText = () => {\n    selection.update(selList => {\n      return selList.map(sel => {\n        if (sel.blockId !== blockElement.blockId) {\n          return sel;\n        }\n        return selection.create('text', {\n          from: {\n            blockId: blockElement.blockId,\n            index: 0,\n            length: blockElement.model.text?.length ?? 0,\n          },\n          to: null,\n        });\n      });\n    });\n    return true;\n  };\n\n  blockElement.bindHotKey({\n    ArrowUp: () => {\n      if (!blockElement.selected?.is('text')) return false;\n\n      const inlineEditor = _getInlineEditor();\n      const inlineRange = inlineEditor.getInlineRange();\n      return !inlineEditor.isFirstLine(inlineRange);\n    },\n    ArrowDown: () => {\n      if (!blockElement.selected?.is('text')) return false;\n\n      const inlineEditor = _getInlineEditor();\n      const inlineRange = inlineEditor.getInlineRange();\n      return !inlineEditor.isLastLine(inlineRange);\n    },\n    Escape: () => {\n      if (blockElement.selected?.is('text')) {\n        return _selectBlock();\n      }\n      return;\n    },\n    Enter: ctx => {\n      _preventDefault(ctx);\n      if (blockElement.selected?.is('block')) return _selectText(false);\n      const target = ctx.get('defaultState').event.target as Node;\n      if (!blockElement.host.contains(target)) return;\n      if (!blockElement.selected?.is('text')) return;\n      blockElement.doc.captureSync();\n\n      const inlineEditor = _getInlineEditor();\n      const inlineRange = inlineEditor.getInlineRange();\n      assertExists(inlineRange);\n      if (\n        !tryConvertBlock(\n          blockElement,\n          inlineEditor,\n          _getPrefixText(inlineEditor),\n          inlineRange\n        )\n      ) {\n        return true;\n      }\n      const state = ctx.get('keyboardState');\n      hardEnter(editorHost, model, inlineRange, inlineEditor, state.raw);\n\n      return true;\n    },\n    'Mod-Enter': ctx => {\n      if (!blockElement.selected?.is('text')) return;\n\n      const state = ctx.get('keyboardState');\n      const inlineEditor = _getInlineEditor();\n      const inlineRange = inlineEditor.getInlineRange();\n      assertExists(inlineRange);\n      hardEnter(editorHost, model, inlineRange, inlineEditor, state.raw, true);\n      _preventDefault(ctx);\n\n      return true;\n    },\n    Space: ctx => handleMarkdown(ctx),\n    'Shift-Space': ctx => handleMarkdown(ctx),\n    'Mod-a': ctx => {\n      _preventDefault(ctx);\n      if (!blockElement.selected?.is('text')) return;\n\n      const text = blockElement.selected;\n      const inlineRoot = blockElement.querySelector<InlineRootElement>(\n        `[${INLINE_ROOT_ATTR}]`\n      );\n      if (\n        text.from.index === 0 &&\n        text.from.length === inlineRoot?.inlineEditor.yText.length\n      ) {\n        return _selectBlock();\n      }\n\n      return _selectAllText();\n    },\n    Tab: ctx => {\n      if (\n        !(\n          blockElement.selected?.is('block') ||\n          blockElement.selected?.is('text')\n        )\n      )\n        return;\n\n      {\n        const [_, context] = std.command\n          .chain()\n          .getSelectedModels({\n            types: ['text'],\n          })\n          .run();\n        const textModels = context.selectedModels;\n        if (textModels && textModels.length === 1) {\n          const inlineEditor = _getInlineEditor();\n          const inlineRange = inlineEditor.getInlineRange();\n          assertExists(inlineRange);\n          handleIndent(blockElement.host, model, inlineRange.index);\n          _preventDefault(ctx);\n\n          return true;\n        }\n      }\n\n      const [_, context] = std.command\n        .chain()\n        .getSelectedModels({\n          types: ['text', 'block'],\n        })\n        .run();\n      const models = context.selectedModels;\n      if (!models) return;\n      handleMultiBlockIndent(blockElement.host, models);\n      return true;\n    },\n    'Mod-Backspace': ctx => {\n      if (\n        !(\n          blockElement.selected?.is('block') ||\n          blockElement.selected?.is('text')\n        )\n      )\n        return;\n\n      const rootElement = blockElement.closest<RootBlockComponent>(\n        'affine-page-root,affine-edgeless-root'\n      );\n      if (!rootElement) return;\n\n      {\n        const [_, context] = std.command\n          .chain()\n          .getSelectedModels({\n            types: ['text'],\n          })\n          .run();\n        const textModels = context.selectedModels;\n        if (textModels && textModels.length === 1) {\n          const inlineEditor = _getInlineEditor();\n          const inlineRange = inlineEditor.getInlineRange();\n          assertExists(inlineRange);\n          if (inlineRange.index === 0) {\n            handleRemoveAllIndent(blockElement.host, model, inlineRange.index);\n            _preventDefault(ctx);\n          }\n\n          return true;\n        }\n      }\n\n      const [_, context] = std.command\n        .chain()\n        .getSelectedModels({\n          types: ['text', 'block'],\n        })\n        .run();\n      const models = context.selectedModels;\n      if (!models) return;\n      handleRemoveAllIndentForMultiBlocks(blockElement.host, models);\n      return true;\n    },\n    'Shift-Tab': ctx => {\n      if (\n        !(\n          blockElement.selected?.is('block') ||\n          blockElement.selected?.is('text')\n        )\n      )\n        return;\n\n      const rootElement = blockElement.closest<RootBlockComponent>(\n        'affine-page-root,affine-edgeless-root'\n      );\n      if (!rootElement) return;\n\n      {\n        const [_, context] = std.command\n          .chain()\n          .getSelectedModels({\n            types: ['text'],\n          })\n          .run();\n        const textModels = context.selectedModels;\n\n        if (textModels && textModels.length === 1) {\n          const inlineEditor = _getInlineEditor();\n          const inlineRange = inlineEditor.getInlineRange();\n          assertExists(inlineRange);\n          handleUnindent(blockElement.host, model, inlineRange.index);\n          _preventDefault(ctx);\n\n          return true;\n        }\n      }\n\n      const [_, context] = std.command\n        .chain()\n        .getSelectedModels({\n          types: ['text', 'block'],\n        })\n        .run();\n      const models = context.selectedModels;\n      if (!models) return;\n      handleMultiBlockOutdent(blockElement.host, models);\n      return true;\n    },\n    Backspace: ctx => {\n      if (!blockElement.selected?.is('text')) return;\n      const state = ctx.get('keyboardState');\n      const inlineEditor = _getInlineEditor();\n      if (!onBackspace(editorHost, model, state.raw, inlineEditor)) {\n        _preventDefault(ctx);\n      }\n\n      // Auto delete bracket right\n      if (matchFlavours(blockElement.model, ['affine:code'])) {\n        const inlineRange = inlineEditor.getInlineRange();\n        assertExists(inlineRange);\n        const left = inlineEditor.yText.toString()[inlineRange.index - 1];\n        const right = inlineEditor.yText.toString()[inlineRange.index];\n        if (bracketPairs[leftBrackets.indexOf(left)]?.right === right) {\n          const index = inlineRange.index - 1;\n          inlineEditor.deleteText({\n            index: index,\n            length: 2,\n          });\n          inlineEditor.setInlineRange({\n            index: index,\n            length: 0,\n          });\n          _preventDefault(ctx);\n        }\n      }\n      return true;\n    },\n    Delete: ctx => handleDelete(ctx),\n    'Control-d': ctx => {\n      if (IS_MAC) handleDelete(ctx);\n    },\n  });\n\n  textFormatConfigs.forEach(config => {\n    if (!config.hotkey) return;\n\n    blockElement.bindHotKey({\n      [config.hotkey]: ctx => {\n        if (blockElement.doc.readonly) return;\n\n        const textSelection = blockElement.selection.find('text');\n        if (!textSelection) return;\n\n        _preventDefault(ctx);\n\n        config.action(editorHost);\n        return true;\n      },\n    });\n  });\n\n  function handleMarkdown(ctx: UIEventStateContext) {\n    if (!blockElement.selected?.is('text')) return;\n\n    const inlineEditor = _getInlineEditor();\n    const inlineRange = inlineEditor.getInlineRange();\n    assertExists(inlineRange);\n\n    const prefixText = _getPrefixText(inlineEditor);\n\n    if (!tryConvertBlock(blockElement, inlineEditor, prefixText, inlineRange)) {\n      _preventDefault(ctx);\n      return true;\n    }\n    return;\n  }\n\n  function handleDelete(ctx: UIEventStateContext) {\n    if (!blockElement.selected?.is('text')) return;\n    const state = ctx.get('keyboardState');\n    const inlineEditor = _getInlineEditor();\n    if (!onForwardDelete(editorHost, model, state.raw, inlineEditor)) {\n      _preventDefault(ctx);\n    }\n    return true;\n  }\n\n  function tryConvertToLinkedDoc() {\n    const root = model.doc.root;\n    assertExists(root);\n    const docBlock = blockElement.host.view.viewFromPath(\n      'block',\n      buildPath(model.doc.root)\n    );\n    assertExists(docBlock);\n    const linkedDocWidgetEle = blockElement.host.view.getWidget(\n      'affine-linked-doc-widget',\n      root.id\n    );\n    if (!linkedDocWidgetEle) return false;\n\n    const inlineEditor = _getInlineEditor();\n    const inlineRange = inlineEditor.getInlineRange();\n    assertExists(inlineRange);\n    const text = inlineEditor.yText.toString();\n    const left = text[inlineRange.index - 1];\n    const right = text[inlineRange.index + inlineRange.length];\n    const needConvert = left === '[' && right === ']';\n    if (!needConvert) return false;\n\n    const docName = text.slice(\n      inlineRange.index,\n      inlineRange.index + inlineRange.length\n    );\n    inlineEditor.deleteText({\n      index: inlineRange.index - 1,\n      length: inlineRange.length + 2,\n    });\n    inlineEditor.setInlineRange({ index: inlineRange.index - 1, length: 0 });\n\n    const doc = createDefaultDoc(blockElement.doc.collection, {\n      title: docName,\n    });\n    insertLinkedNode({\n      inlineEditor,\n      docId: doc.id,\n    });\n    return true;\n  }\n\n  // Bracket auto complete\n  bracketPairs.forEach(pair => {\n    blockElement.bindHotKey({\n      [pair.left]: ctx => {\n        if (blockElement.doc.readonly) return;\n\n        const textSelection = blockElement.selection.find('text');\n        if (!textSelection) return;\n        // When selection is collapsed, only trigger auto complete in code block\n        if (\n          textSelection.isCollapsed() &&\n          !matchFlavours(blockElement.model, ['affine:code'])\n        )\n          return;\n        if (!textSelection.isInSameBlock()) return;\n\n        _preventDefault(ctx);\n\n        const inlineEditor = _getInlineEditor();\n        const inlineRange = inlineEditor.getInlineRange();\n        assertExists(inlineRange);\n        const selectedText = inlineEditor.yText\n          .toString()\n          .slice(inlineRange.index, inlineRange.index + inlineRange.length);\n        if (pair.name === 'square bracket') {\n          // [[Selected text]] should automatically be converted to a Linked doc with the title \"Selected text\".\n          // See https://github.com/toeverything/blocksuite/issues/2730\n          const success = tryConvertToLinkedDoc();\n          if (success) return true;\n        }\n        inlineEditor.insertText(\n          inlineRange,\n          pair.left + selectedText + pair.right\n        );\n\n        inlineEditor.setInlineRange({\n          index: inlineRange.index + 1,\n          length: inlineRange.length,\n        });\n\n        return true;\n      },\n    });\n  });\n\n  // Skip redundant right bracket\n  bracketPairs.forEach(pair => {\n    blockElement.bindHotKey({\n      [pair.right]: ctx => {\n        if (!matchFlavours(blockElement.model, ['affine:code'])) return;\n        const inlineEditor = _getInlineEditor();\n        const inlineRange = inlineEditor.getInlineRange();\n        assertExists(inlineRange);\n        const left = inlineEditor.yText.toString()[inlineRange.index - 1];\n        const right = inlineEditor.yText.toString()[inlineRange.index];\n        if (pair.left === left && pair.right === right) {\n          inlineEditor.setInlineRange({\n            index: inlineRange.index + 1,\n            length: 0,\n          });\n          _preventDefault(ctx);\n        }\n      },\n    });\n  });\n\n  // Convert the selected text into inline code\n  blockElement.bindHotKey({\n    '`': ctx => {\n      if (blockElement.doc.readonly) return;\n\n      const textSelection = blockElement.selection.find('text');\n      if (!textSelection || textSelection.isCollapsed()) return;\n      if (!textSelection.isInSameBlock()) return;\n\n      _preventDefault(ctx);\n      const inlineEditor = _getInlineEditor();\n      const inlineRange = inlineEditor.getInlineRange();\n      assertExists(inlineRange);\n      inlineEditor.formatText(inlineRange, { code: true });\n\n      inlineEditor.setInlineRange({\n        index: inlineRange.index,\n        length: inlineRange.length,\n      });\n\n      return true;\n    },\n  });\n};\n"]}