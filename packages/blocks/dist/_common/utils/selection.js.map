{"version":3,"file":"selection.js","sourceRoot":"","sources":["../../../src/_common/utils/selection.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,UAAU,EAAE,MAAM,wBAAwB,CAAC;AACpD,OAAO,EAAE,YAAY,EAAE,MAAM,0BAA0B,CAAC;AAMxD,OAAO,EAAE,aAAa,EAAE,MAAM,YAAY,CAAC;AAC3C,OAAO,EACL,uBAAuB,EACvB,SAAS,EACT,uBAAuB,EACvB,oBAAoB,GACrB,MAAM,YAAY,CAAC;AACpB,OAAO,EAAE,IAAI,EAAE,MAAM,WAAW,CAAC;AAejC,MAAM,CAAC,KAAK,UAAU,mBAAmB,CACvC,UAAsB,EACtB,KAAiB,EACjB,WAAwB;IAExB,MAAM,QAAQ,GAAG,MAAM,uBAAuB,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;IAClE,IAAI,CAAC,QAAQ,EAAE,CAAC;QACd,OAAO;IACT,CAAC;IAED,MAAM,QAAQ,CAAC,cAAc,CAAC;IAC9B,MAAM,YAAY,GAAG,QAAQ,CAAC,YAAY,CAAC;IAC3C,YAAY,CAAC,YAAY,CAAC,CAAC;IAC3B,YAAY,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;AAC3C,CAAC;AAED,MAAM,UAAU,kBAAkB,CAChC,UAAsB,EACtB,EAAU,EACV,cAA2B,EAAE,KAAK,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE;IAElD,MAAM,GAAG,GAAG,UAAU,CAAC,GAAG,CAAC;IAC3B,MAAM,KAAK,GAAG,GAAG,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC;IACnC,YAAY,CAAC,KAAK,CAAC,CAAC;IACpB,IAAI,aAAa,CAAC,KAAK,EAAE,CAAC,gBAAgB,CAAC,CAAC;QAAE,OAAO;IACrD,OAAO,mBAAmB,CAAC,UAAU,EAAE,KAAK,EAAE,WAAW,CAAC,CAAC;AAC7D,CAAC;AAED;;;GAGG;AACH,MAAM,UAAU,mBAAmB,CACjC,OAAe,EACf,OAAe;IAEf,IAAI,UAAU,EAAE,CAAC;QACf,MAAM,KAAK,GAAG,QAAQ,CAAC,sBAAsB,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;QAChE,wCAAwC;QACxC,MAAM,KAAK,GAAG,QAAQ,CAAC,WAAW,EAAE,CAAC;QACrC,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,UAAU,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC;QAC/C,OAAO,KAAK,CAAC;IACf,CAAC;IAED,MAAM,KAAK,GAAG,QAAQ,CAAC,mBAAmB,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;IAE7D,IAAI,CAAC,KAAK,EAAE,CAAC;QACX,OAAO,IAAI,CAAC;IACd,CAAC;IAED,6DAA6D;IAC7D,MAAM,UAAU,GAAG,KAAK,EAAE,cAAc,EAAE,CAAC;IAC3C,IACE,UAAU;QACV,UAAU,CAAC,MAAM,KAAK,CAAC;QACvB,KAAK,CAAC,WAAW,KAAK,KAAK,CAAC,SAAS;QACrC,OAAO,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,MAAM,EAChD,CAAC;QACD,MAAM,MAAM,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAE7D,IAAI,MAAM,GAAG,CAAC,EAAE,CAAC;YACf,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,cAAc,EAAE,KAAK,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC;YAC5D,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,YAAY,EAAE,KAAK,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC;QACxD,CAAC;IACH,CAAC;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,aAAa,CAAC,iBAA0B;IAC/C,MAAM,QAAQ,GAAG,QAAQ,CAAC,WAAW,EAAE,CAAC;IACxC,IAAI,SAAS,GAAG,iBAAiB,CAAC,UAAU,CAAC;IAC7C,OAAO,SAAS,EAAE,UAAU,EAAE,CAAC;QAC7B,SAAS,GAAG,SAAS,CAAC,UAAU,CAAC;IACnC,CAAC;IACD,IAAI,SAAS,EAAE,CAAC;QACd,QAAQ,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;QAChC,QAAQ,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC;IACD,OAAO,QAAQ,CAAC;AAClB,CAAC;AAED,SAAS,WAAW,CAAC,iBAA0B;IAC7C,MAAM,QAAQ,GAAG,QAAQ,CAAC,WAAW,EAAE,CAAC;IACxC,IAAI,QAAQ,GAAG,iBAAiB,CAAC,SAAS,CAAC;IAC3C,OAAO,QAAQ,EAAE,SAAS,EAAE,CAAC;QAC3B,QAAQ,GAAG,QAAQ,CAAC,SAAS,CAAC;IAChC,CAAC;IACD,IAAI,QAAQ,EAAE,CAAC;QACb,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,QAAQ,CAAC,WAAW,EAAE,MAAM,IAAI,CAAC,CAAC,CAAC;QAC/D,QAAQ,CAAC,MAAM,CAAC,QAAQ,EAAE,QAAQ,CAAC,WAAW,EAAE,MAAM,IAAI,CAAC,CAAC,CAAC;IAC/D,CAAC;IACD,OAAO,QAAQ,CAAC;AAClB,CAAC;AAED,SAAS,SAAS,CAAC,CAAS,EAAE,iBAA0B,EAAE,IAAI,GAAG,CAAC;IAChE,MAAM,gBAAgB,GAAG,GAAG,CAAC;IAE7B,MAAM,eAAe,GAAG,iBAAiB,CAAC,OAAO,CAAC,uBAAuB,CAAC,CAAC;IAC3E,MAAM,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC;IACxD,MAAM,EAAE,YAAY,EAAE,GAAG,QAAQ,CAAC,eAAe,CAAC;IAClD,MAAM,UAAU,GACd,CAAC,MAAM,CACL,MAAM,CAAC,gBAAgB,CAAC,iBAAiB,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAC1E,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC;IAElB,MAAM,OAAO,GAAG,MAAM,GAAG,CAAC,CAAC;IAC3B,QAAQ,OAAO,EAAE,CAAC;QAChB,KAAK,IAAI,CAAC,CAAC,CAAC;YACV,IAAI,WAAW,GAAG,MAAM,CAAC;YACzB,IAAI,MAAM,GAAG,gBAAgB,IAAI,eAAe,EAAE,CAAC;gBACjD,eAAe,CAAC,SAAS;oBACvB,eAAe,CAAC,SAAS,GAAG,gBAAgB,GAAG,MAAM,CAAC;gBACxD,kDAAkD;gBAClD,qBAAqB,CAAC,GAAG,EAAE;oBACzB,WAAW,GAAG,iBAAiB,CAAC,qBAAqB,EAAE,CAAC,MAAM,CAAC;gBACjE,CAAC,CAAC,CAAC;YACL,CAAC;YACD,OAAO,WAAW,GAAG,UAAU,GAAG,CAAC,CAAC;QACtC,CAAC;QACD,KAAK,KAAK,CAAC,CAAC,CAAC;YACX,IAAI,QAAQ,GAAG,GAAG,CAAC;YACnB,IAAI,eAAe,IAAI,GAAG,GAAG,YAAY,GAAG,gBAAgB,EAAE,CAAC;gBAC7D,eAAe,CAAC,SAAS;oBACvB,eAAe,CAAC,SAAS,GAAG,CAAC,GAAG,GAAG,gBAAgB,GAAG,YAAY,CAAC,CAAC;gBACtE,gDAAgD;gBAChD,qBAAqB,CAAC,GAAG,EAAE;oBACzB,QAAQ,GAAG,iBAAiB,CAAC,qBAAqB,EAAE,CAAC,GAAG,CAAC;gBAC3D,CAAC,CAAC,CAAC;YACL,CAAC;YACD,OAAO,QAAQ,GAAG,UAAU,GAAG,CAAC,CAAC;QACnC,CAAC;IACH,CAAC;AACH,CAAC;AAED;;GAEG;AACH,MAAM,UAAU,UAAU,CAAC,UAAsB,EAAE,KAAK,GAAG,QAAQ,EAAE,GAAG,GAAG,CAAC;IAC1E,iCAAiC;IAEjC,MAAM,iBAAiB,GAAG,uBAAuB,CAAC,UAAU,CAAC,CAAC;IAC9D,YAAY,CAAC,iBAAiB,CAAC,CAAC;IAEhC,IAAI,KAAK,GAAG,iBAAiB,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;QAC3C,KAAK,GAAG,iBAAiB,CAAC,KAAK,CAAC,MAAM,CAAC;IACzC,CAAC;IACD,iBAAiB,CAAC,cAAc,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC;AAC3D,CAAC;AAED,SAAS,aAAa,CACpB,iBAA0B,EAC1B,WAA8B,KAAK,EACnC,IAAI,GAAG,CAAC;IAER,MAAM,UAAU,GAAG,CAAC,CAAC,oBAAoB,CAAC,iBAAiB,CAAC,CAAC;IAC7D,IAAI,UAAU,EAAE,CAAC;QACf,iBAAiB;aACd,aAAa,CAAQ,QAAQ,CAAC;YAC/B,EAAE,cAAc,CAAC,EAAE,KAAK,EAAE,SAAS,EAAE,CAAC,CAAC;IAC3C,CAAC;IAED,yCAAyC;IACzC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC;IAExD,IAAI,KAAK,GAAiB,IAAI,CAAC;IAC/B,QAAQ,QAAQ,EAAE,CAAC;QACjB,KAAK,OAAO;YACV,KAAK,GAAG,aAAa,CAAC,iBAAiB,CAAC,CAAC;YACzC,MAAM;QACR,KAAK,KAAK;YACR,KAAK,GAAG,WAAW,CAAC,iBAAiB,CAAC,CAAC;YACvC,MAAM;QACR,OAAO,CAAC,CAAC,CAAC;YACR,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,QAAQ,CAAC;YAC1B,IAAI,OAAO,GAAG,CAAC,CAAC;YAChB,MAAM,MAAM,GAAG,SAAS,CAAC,CAAC,EAAE,iBAAiB,EAAE,IAAI,CAAC,CAAC;YACrD,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC;gBACd,OAAO,GAAG,IAAI,GAAG,CAAC,CAAC;YACrB,CAAC;YACD,IAAI,CAAC,IAAI,KAAK,EAAE,CAAC;gBACf,OAAO,GAAG,KAAK,GAAG,CAAC,CAAC;YACtB,CAAC;YACD,KAAK,GAAG,mBAAmB,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;YAC7C,MAAM;QACR,CAAC;IACH,CAAC;IACD,oBAAoB,CAAC,KAAK,CAAC,CAAC;AAC9B,CAAC;AAED;;GAEG;AACH,MAAM,UAAU,iBAAiB,CAC/B,UAAsB,EACtB,KAAiB,EACjB,WAA8B,KAAK,EACnC,IAAI,GAAG,CAAC;IAER,IAAI,aAAa,CAAC,KAAK,EAAE,CAAC,aAAa,EAAE,aAAa,CAAC,CAAC,EAAE,CAAC;QACzD,MAAM,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;IAC9C,CAAC;IAED,YAAY,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;IAC7B,MAAM,WAAW,GAAG,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE;QACxD,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;KAClB,CAA2B,CAAC;IAC7B,YAAY,CAAC,WAAW,CAAC,CAAC;IAC1B,WAAW,CAAC;IAEZ,MAAM,OAAO,GAAG,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC;IACxE,YAAY,CAAC,OAAO,CAAC,CAAC;IACtB,MAAM,iBAAiB,GAAG,OAAO,EAAE,aAAa,CAAC,mBAAmB,CAAC,CAAC;IACtE,IAAI,iBAAiB,EAAE,CAAC;QACtB,aAAa,CAAC,iBAAiB,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;IACnD,CAAC;AACH,CAAC;AAED,MAAM,UAAU,oBAAoB,CAAC,KAAmB;IACtD,MAAM,SAAS,GAAG,MAAM,CAAC,YAAY,EAAE,CAAC;IACxC,YAAY,CAAC,SAAS,CAAC,CAAC;IACxB,SAAS,CAAC,eAAe,EAAE,CAAC;IAC5B,KAAK,IAAI,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;AACrC,CAAC;AAED;;;;;;;;;;GAUG;AACH,MAAM,UAAU,kBAAkB;IAChC,MAAM,SAAS,GAAG,MAAM,CAAC,YAAY,EAAE,CAAC;IACxC,IAAI,CAAC,SAAS;QAAE,OAAO,KAAK,CAAC;IAE7B,qDAAqD;IACrD,0EAA0E;IAC1E,+BAA+B;IAC/B,OAAO,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC;AAChC,CAAC;AAED,MAAM,UAAU,qBAAqB,CAAC,SAAS,GAAG,MAAM,CAAC,YAAY,EAAE;IACrE,+GAA+G;IAC/G,4FAA4F;IAC5F,IAAI,CAAC,SAAS,EAAE,CAAC;QACf,MAAM,IAAI,KAAK,CAAC,gDAAgD,CAAC,CAAC;IACpE,CAAC;IACD,IAAI,SAAS,CAAC,UAAU,KAAK,CAAC,EAAE,CAAC;QAC/B,OAAO,IAAI,CAAC;IACd,CAAC;IACD,IAAI,SAAS,CAAC,UAAU,GAAG,CAAC,EAAE,CAAC;QAC7B,OAAO,CAAC,IAAI,CAAC,oDAAoD,CAAC,CAAC;IACrE,CAAC;IACD,OAAO,SAAS,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;AACjC,CAAC;AAED,MAAM,UAAU,wBAAwB,CAAC,CAAS,EAAE,CAAS;IAC3D,MAAM,KAAK,GAAG,mBAAmB,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IACxC,MAAM,cAAc,GAAG,KAAK,EAAE,cAAc,CAAC;IAC7C,qBAAqB;IACrB,IAAI,cAAc,YAAY,IAAI,EAAE,CAAC;QACnC,oBAAoB,CAAC,KAAK,CAAC,CAAC;IAC9B,CAAC;AACH,CAAC","sourcesContent":["import type { EditorHost } from '@blocksuite/block-std';\nimport { IS_FIREFOX } from '@blocksuite/global/env';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { InlineRange, VLine } from '@blocksuite/inline';\nimport type { BlockModel } from '@blocksuite/store';\n\nimport type { PageRootBlockComponent } from '../../root-block/page/page-root-block.js';\nimport type { SelectionPosition } from '../types.js';\nimport { matchFlavours } from './model.js';\nimport {\n  asyncGetRichTextByModel,\n  buildPath,\n  getDocTitleInlineEditor,\n  getPageRootByElement,\n} from './query.js';\nimport { Rect } from './rect.js';\n\ndeclare global {\n  interface Document {\n    // firefox API\n    caretPositionFromPoint(\n      x: number,\n      y: number\n    ): {\n      offsetNode: Node;\n      offset: number;\n    };\n  }\n}\n\nexport async function asyncSetInlineRange(\n  editorHost: EditorHost,\n  model: BlockModel,\n  inlineRange: InlineRange\n) {\n  const richText = await asyncGetRichTextByModel(editorHost, model);\n  if (!richText) {\n    return;\n  }\n\n  await richText.updateComplete;\n  const inlineEditor = richText.inlineEditor;\n  assertExists(inlineEditor);\n  inlineEditor.setInlineRange(inlineRange);\n}\n\nexport function asyncFocusRichText(\n  editorHost: EditorHost,\n  id: string,\n  inlineRange: InlineRange = { index: 0, length: 0 }\n) {\n  const doc = editorHost.doc;\n  const model = doc.getBlockById(id);\n  assertExists(model);\n  if (matchFlavours(model, ['affine:divider'])) return;\n  return asyncSetInlineRange(editorHost, model, inlineRange);\n}\n\n/**\n * A wrapper for the browser's `caretPositionFromPoint` and `caretRangeFromPoint`,\n * but adapted for different browsers.\n */\nexport function caretRangeFromPoint(\n  clientX: number,\n  clientY: number\n): Range | null {\n  if (IS_FIREFOX) {\n    const caret = document.caretPositionFromPoint(clientX, clientY);\n    // TODO handle caret is covered by popup\n    const range = document.createRange();\n    range.setStart(caret.offsetNode, caret.offset);\n    return range;\n  }\n\n  const range = document.caretRangeFromPoint(clientX, clientY);\n\n  if (!range) {\n    return null;\n  }\n\n  // See https://github.com/toeverything/blocksuite/issues/1382\n  const rangeRects = range?.getClientRects();\n  if (\n    rangeRects &&\n    rangeRects.length === 2 &&\n    range.startOffset === range.endOffset &&\n    clientY < rangeRects[0].y + rangeRects[0].height\n  ) {\n    const deltaX = (rangeRects[0].x | 0) - (rangeRects[1].x | 0);\n\n    if (deltaX > 0) {\n      range.setStart(range.startContainer, range.startOffset - 1);\n      range.setEnd(range.endContainer, range.endOffset - 1);\n    }\n  }\n  return range;\n}\n\nfunction setStartRange(editableContainer: Element) {\n  const newRange = document.createRange();\n  let firstNode = editableContainer.firstChild;\n  while (firstNode?.firstChild) {\n    firstNode = firstNode.firstChild;\n  }\n  if (firstNode) {\n    newRange.setStart(firstNode, 0);\n    newRange.setEnd(firstNode, 0);\n  }\n  return newRange;\n}\n\nfunction setEndRange(editableContainer: Element) {\n  const newRange = document.createRange();\n  let lastNode = editableContainer.lastChild;\n  while (lastNode?.lastChild) {\n    lastNode = lastNode.lastChild;\n  }\n  if (lastNode) {\n    newRange.setStart(lastNode, lastNode.textContent?.length || 0);\n    newRange.setEnd(lastNode, lastNode.textContent?.length || 0);\n  }\n  return newRange;\n}\n\nfunction setNewTop(y: number, editableContainer: Element, zoom = 1) {\n  const SCROLL_THRESHOLD = 100;\n\n  const scrollContainer = editableContainer.closest('.affine-page-viewport');\n  const { top, bottom } = Rect.fromDOM(editableContainer);\n  const { clientHeight } = document.documentElement;\n  const lineHeight =\n    (Number(\n      window.getComputedStyle(editableContainer).lineHeight.replace(/\\D+$/, '')\n    ) || 16) * zoom;\n\n  const compare = bottom < y;\n  switch (compare) {\n    case true: {\n      let finalBottom = bottom;\n      if (bottom < SCROLL_THRESHOLD && scrollContainer) {\n        scrollContainer.scrollTop =\n          scrollContainer.scrollTop - SCROLL_THRESHOLD + bottom;\n        // set scroll may have an animation, wait for over\n        requestAnimationFrame(() => {\n          finalBottom = editableContainer.getBoundingClientRect().bottom;\n        });\n      }\n      return finalBottom - lineHeight / 2;\n    }\n    case false: {\n      let finalTop = top;\n      if (scrollContainer && top > clientHeight - SCROLL_THRESHOLD) {\n        scrollContainer.scrollTop =\n          scrollContainer.scrollTop + (top + SCROLL_THRESHOLD - clientHeight);\n        // set scroll may has a animation, wait for over\n        requestAnimationFrame(() => {\n          finalTop = editableContainer.getBoundingClientRect().top;\n        });\n      }\n      return finalTop + lineHeight / 2;\n    }\n  }\n}\n\n/**\n * As the title is a text area, this function does not yet have support for `SelectionPosition`.\n */\nexport function focusTitle(editorHost: EditorHost, index = Infinity, len = 0) {\n  // TODO support SelectionPosition\n\n  const titleInlineEditor = getDocTitleInlineEditor(editorHost);\n  assertExists(titleInlineEditor);\n\n  if (index > titleInlineEditor.yText.length) {\n    index = titleInlineEditor.yText.length;\n  }\n  titleInlineEditor.setInlineRange({ index, length: len });\n}\n\nfunction focusRichText(\n  editableContainer: Element,\n  position: SelectionPosition = 'end',\n  zoom = 1\n) {\n  const isPageRoot = !!getPageRootByElement(editableContainer);\n  if (isPageRoot) {\n    editableContainer\n      .querySelector<VLine>('v-line')\n      ?.scrollIntoView({ block: 'nearest' });\n  }\n\n  // TODO optimize how get scroll container\n  const { left, right } = Rect.fromDOM(editableContainer);\n\n  let range: Range | null = null;\n  switch (position) {\n    case 'start':\n      range = setStartRange(editableContainer);\n      break;\n    case 'end':\n      range = setEndRange(editableContainer);\n      break;\n    default: {\n      const { x, y } = position;\n      let newLeft = x;\n      const newTop = setNewTop(y, editableContainer, zoom);\n      if (x <= left) {\n        newLeft = left + 1;\n      }\n      if (x >= right) {\n        newLeft = right - 1;\n      }\n      range = caretRangeFromPoint(newLeft, newTop);\n      break;\n    }\n  }\n  resetNativeSelection(range);\n}\n\n/**\n * @deprecated Use `selectionManager.set` instead.\n */\nexport function focusBlockByModel(\n  editorHost: EditorHost,\n  model: BlockModel,\n  position: SelectionPosition = 'end',\n  zoom = 1\n) {\n  if (matchFlavours(model, ['affine:note', 'affine:page'])) {\n    throw new Error(\"Can't focus note or doc!\");\n  }\n\n  assertExists(model.doc.root);\n  const rootElement = editorHost.view.viewFromPath('block', [\n    model.doc.root.id,\n  ]) as PageRootBlockComponent;\n  assertExists(rootElement);\n  rootElement;\n\n  const element = editorHost.view.viewFromPath('block', buildPath(model));\n  assertExists(element);\n  const editableContainer = element?.querySelector('[contenteditable]');\n  if (editableContainer) {\n    focusRichText(editableContainer, position, zoom);\n  }\n}\n\nexport function resetNativeSelection(range: Range | null) {\n  const selection = window.getSelection();\n  assertExists(selection);\n  selection.removeAllRanges();\n  range && selection.addRange(range);\n}\n\n/**\n * Return true if has native selection in the document.\n *\n * @example\n * ```ts\n * const isNativeSelection = hasNativeSelection();\n * if (isNativeSelection) {\n *   // do something\n * }\n * ```\n */\nexport function hasNativeSelection() {\n  const selection = window.getSelection();\n  if (!selection) return false;\n\n  // The `selection.rangeCount` attribute must return 0\n  // if this is empty or either focus or anchor is not in the document tree,\n  // and must return 1 otherwise.\n  return !!selection.rangeCount;\n}\n\nexport function getCurrentNativeRange(selection = window.getSelection()) {\n  // When called on an <iframe> that is not displayed (e.g., where display: none is set) Firefox will return null\n  // See https://developer.mozilla.org/en-US/docs/Web/API/Window/getSelection for more details\n  if (!selection) {\n    throw new Error('Failed to get current range, selection is null');\n  }\n  if (selection.rangeCount === 0) {\n    return null;\n  }\n  if (selection.rangeCount > 1) {\n    console.warn('getCurrentNativeRange may be wrong, rangeCount > 1');\n  }\n  return selection.getRangeAt(0);\n}\n\nexport function handleNativeRangeAtPoint(x: number, y: number) {\n  const range = caretRangeFromPoint(x, y);\n  const startContainer = range?.startContainer;\n  // click on rich text\n  if (startContainer instanceof Node) {\n    resetNativeSelection(range);\n  }\n}\n"]}