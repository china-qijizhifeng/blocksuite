{"version":3,"file":"query.js","sourceRoot":"","sources":["../../../src/_common/utils/query.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  BlockElement,\n  EditorHost,\n  ViewStore,\n} from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { InlineEditor } from '@blocksuite/inline';\nimport type { BlockModel } from '@blocksuite/store';\n\nimport type { Loader } from '../../_common/components/loader.js';\nimport type { RichText } from '../../_common/components/rich-text/rich-text.js';\nimport type { RootBlockComponent } from '../../index.js';\nimport type { EdgelessRootBlockComponent } from '../../root-block/edgeless/edgeless-root-block.js';\nimport type { PageRootBlockComponent } from '../../root-block/page/page-root-block.js';\nimport {\n  BLOCK_CHILDREN_CONTAINER_PADDING_LEFT as PADDING_LEFT,\n  BLOCK_ID_ATTR as ATTR,\n} from '../consts.js';\nimport type { AbstractEditor } from '../types.js';\nimport { clamp } from './math.js';\nimport { matchFlavours } from './model.js';\nimport type { Point, Rect } from './rect.js';\n\nconst ATTR_SELECTOR = `[${ATTR}]`;\n\n// margin-top: calc(var(--affine-paragraph-space) + 24px);\n// h1.margin-top = 8px + 24px = 32px;\nconst MAX_SPACE = 32;\nconst STEPS = MAX_SPACE / 2 / 2;\n\n// Fix use unknown type\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type BlockComponent = BlockElement<any>;\n\ninterface ContainerBlock {\n  model?: BlockModel;\n}\n\n/**\n *\n * @example\n * ```md\n * page\n * - note\n *  - paragraph <- when invoked here, the traverse order will be following\n *    - child <- 1\n *  - sibling <- 2\n * - note <- 3 (will be skipped)\n *   - paragraph <- 4\n * ```\n *\n * NOTE: this method will skip the `affine:note` block\n */\nexport function getNextBlock(\n  editorHost: EditorHost,\n  model: BlockModel,\n  map: Record<string, true> = {}\n): BlockModel | null {\n  if (model.id in map) {\n    throw new Error(\"Can't get next block! There's a loop in the block tree!\");\n  }\n  map[model.id] = true;\n\n  const doc = model.doc;\n  if (model.children.length) {\n    return model.children[0];\n  }\n  let currentBlock: typeof model | null = model;\n  while (currentBlock) {\n    const nextSibling = doc.getNext(currentBlock);\n    if (nextSibling) {\n      // Assert nextSibling is not possible to be `affine:page`\n      if (matchFlavours(nextSibling, ['affine:note'])) {\n        // in edgeless mode, limit search for the next block within the same note\n        if (isInsideEdgelessEditor(editorHost)) {\n          return null;\n        }\n\n        return getNextBlock(editorHost, nextSibling);\n      }\n      return nextSibling;\n    }\n    currentBlock = doc.getParent(currentBlock);\n  }\n  return null;\n}\n\n/**\n *\n * @example\n * ```md\n * doc\n * - note\n *   - paragraph <- 5\n * - note <- 4 (will be skipped)\n *  - paragraph <- 3\n *    - child <- 2\n *      - child <- 1\n *  - paragraph <- when invoked here, the traverse order will be above\n * ```\n *\n * NOTE: this method will just return blocks with `content` role\n */\nexport function getPreviousBlock(\n  editorHost: EditorHost,\n  model: BlockModel\n): BlockModel | null {\n  const getPrev = (model: BlockModel) => {\n    const parent = model.doc.getParent(model);\n    if (!parent) return null;\n\n    const index = parent.children.indexOf(model);\n    if (index > 0) {\n      let prev = parent.children[index - 1];\n      while (prev.children.length > 0) {\n        prev = prev.children[prev.children.length - 1];\n      }\n      return prev;\n    }\n\n    // in edgeless mode, limit search for the previous block within the same note\n    if (\n      isInsideEdgelessEditor(editorHost) &&\n      matchFlavours(parent, ['affine:note'])\n    ) {\n      return null;\n    }\n\n    return parent;\n  };\n\n  const map: Record<string, true> = {};\n  const iterate: (model: BlockModel) => BlockModel | null = (\n    model: BlockModel\n  ) => {\n    if (model.id in map) {\n      throw new Error(\n        \"Can't get previous block! There's a loop in the block tree!\"\n      );\n    }\n    map[model.id] = true;\n\n    const prev = getPrev(model);\n    if (prev) {\n      if (prev.role === 'content' && !matchFlavours(prev, ['affine:frame'])) {\n        return prev;\n      } else {\n        return iterate(prev);\n      }\n    } else {\n      return null;\n    }\n  };\n\n  return iterate(model);\n}\n\n/**\n * This function is used to build model's \"normal\" block path.\n * If this function does not meet your needs, you may need to build path manually to satisfy your needs.\n * You should not modify this function.\n */\nexport function buildPath(model: BlockModel | null): string[] {\n  const path: string[] = [];\n  let current = model;\n  while (current) {\n    path.unshift(current.id);\n    current = current.doc.getParent(current);\n  }\n  return path;\n}\n\nexport function blockElementGetter(model: BlockModel, view: ViewStore) {\n  if (matchFlavours(model, ['affine:image', 'affine:frame'])) {\n    let current: BlockModel | null = model;\n    const path: string[] = [];\n    while (current) {\n      // Top level image render under root block not surface block\n      if (!matchFlavours(current, ['affine:surface'])) {\n        path.unshift(current.id);\n      }\n      current = current.doc.getParent(current);\n    }\n\n    return view.viewFromPath('block', path);\n  } else {\n    return view.viewFromPath('block', buildPath(model));\n  }\n}\n\nexport function getRootByElement(element: Element): RootBlockComponent | null {\n  const pageRoot = getPageRootByElement(element);\n  if (pageRoot) return pageRoot;\n\n  const edgelessRoot = getEdgelessRootByElement(element);\n  if (edgelessRoot) return edgelessRoot;\n\n  return null;\n}\n\nexport function getRootByEditorHost(\n  editorHost: EditorHost\n): RootBlockComponent | null {\n  return (\n    getPageRootByEditorHost(editorHost) ??\n    getEdgelessRootByEditorHost(editorHost)\n  );\n}\n\n/** If it's not in the page mode, it will return `null` directly */\nexport function getPageRootByElement(element: Element) {\n  return element.closest('affine-page-root');\n}\n\n/** If it's not in the page mode, it will return `null` directly */\nexport function getPageRootByEditorHost(editorHost: EditorHost) {\n  return editorHost.querySelector('affine-page-root');\n}\n\n/** If it's not in the edgeless mode, it will return `null` directly */\nexport function getEdgelessRootByElement(element: Element) {\n  return element.closest('affine-edgeless-root');\n}\n\n/** If it's not in the edgeless mode, it will return `null` directly */\nexport function getEdgelessRootByEditorHost(editorHost: EditorHost) {\n  return editorHost.querySelector('affine-edgeless-root');\n}\n\n/** @deprecated */\nexport function getEditorContainer(editorHost: EditorHost): AbstractEditor {\n  const editorContainer = editorHost.closest('affine-editor-container');\n  assertExists(editorContainer);\n  return editorContainer as AbstractEditor;\n}\n\nexport function isInsidePageEditor(host: EditorHost) {\n  return Array.from(host.children).some(\n    v => v.tagName.toLowerCase() === 'affine-page-root'\n  );\n}\n\nexport function isInsideEdgelessEditor(host: EditorHost) {\n  return Array.from(host.children).some(\n    v => v.tagName.toLowerCase() === 'affine-edgeless-root'\n  );\n}\n\n/**\n * Get editor viewport element.\n * @example\n * ```ts\n * const viewportElement = getViewportElement(this.model.doc);\n * if (!viewportElement) return;\n * this._disposables.addFromEvent(viewportElement, 'scroll', () => {\n *   updatePosition();\n * });\n * ```\n */\nexport function getViewportElement(editorHost: EditorHost) {\n  if (!isInsidePageEditor(editorHost)) return null;\n  const doc = editorHost.doc;\n  assertExists(doc.root);\n  const rootElement = editorHost.view.viewFromPath('block', [doc.root.id]);\n\n  if (!rootElement || rootElement.closest('affine-page-root') !== rootElement) {\n    throw new Error('Failed to get viewport element!');\n  }\n  return (rootElement as PageRootBlockComponent).viewportElement;\n}\n\n/**\n * Get block component by model.\n * Note that this function is used for compatibility only, and may be removed in the future.\n *\n * Use `root.view.viewFromPath` instead.\n * @deprecated\n */\nexport function getBlockComponentByModel(\n  editorHost: EditorHost,\n  model: BlockModel | null\n) {\n  if (!model) return null;\n  return getBlockComponentByPath(editorHost, model.id);\n}\n\nexport function getBlockComponentByPath(\n  editorHost: EditorHost,\n  blockId: string\n) {\n  return editorHost.view.getBlock(blockId);\n}\n\n/**\n * Get block component by its model and wait for the doc element to finish updating.\n * Note that this function is used for compatibility only, and may be removed in the future.\n *\n * Use `root.view.viewFromPath` instead.\n * @deprecated\n */\nexport async function asyncGetBlockComponentByModel(\n  editorHost: EditorHost,\n  model: BlockModel\n): Promise<BlockComponent | null> {\n  assertExists(model.doc.root);\n  const rootElement = getRootByEditorHost(editorHost);\n  if (!rootElement) return null;\n  await rootElement.updateComplete;\n\n  if (model.id === model.doc.root.id) {\n    return rootElement;\n  }\n\n  return editorHost.view.getBlock(model.id);\n}\n\n/**\n * @deprecated In most cases, you not need RichText, you can use {@link getInlineEditorByModel} instead.\n */\nexport function getRichTextByModel(editorHost: EditorHost, model: BlockModel) {\n  const blockComponent = editorHost.view.viewFromPath(\n    'block',\n    buildPath(model)\n  );\n  const richText = blockComponent?.querySelector<RichText>('rich-text');\n  if (!richText) return null;\n  return richText;\n}\n\nexport async function asyncGetRichTextByModel(\n  editorHost: EditorHost,\n  model: BlockModel\n) {\n  const blockComponent = await asyncGetBlockComponentByModel(editorHost, model);\n  if (!blockComponent) return null;\n  await blockComponent.updateComplete;\n  const richText = blockComponent?.querySelector<RichText>('rich-text');\n  if (!richText) return null;\n  return richText;\n}\n\nexport function getInlineEditorByModel(\n  editorHost: EditorHost,\n  model: BlockModel\n) {\n  if (matchFlavours(model, ['affine:database'])) {\n    // Not support database model since it's may be have multiple inline editor instances.\n    // Support to enter the editing state through the Enter key in the database.\n    return null;\n  }\n  const richText = getRichTextByModel(editorHost, model);\n  if (!richText) return null;\n  return richText.inlineEditor;\n}\n\nexport async function asyncGetInlineEditorByModel(\n  editorHost: EditorHost,\n  model: BlockModel\n) {\n  if (matchFlavours(model, ['affine:database'])) {\n    // Not support database model since it's may be have multiple inline editor instances.\n    throw new Error('Cannot get inline editor by database model!');\n  }\n  const richText = await asyncGetRichTextByModel(editorHost, model);\n  if (!richText) return null;\n  return richText.inlineEditor;\n}\n\nexport function getModelByElement(element: Element): BlockModel {\n  const closestBlock = element.closest(ATTR_SELECTOR);\n  assertExists(closestBlock, 'Cannot find block element by element');\n  return getModelByBlockComponent(closestBlock);\n}\n\nexport function getDocTitleByEditorHost(\n  editorHost: EditorHost\n): HTMLElement | null {\n  const docViewport = editorHost.closest('.affine-page-viewport');\n  if (!docViewport) return null;\n  return docViewport.querySelector('doc-title');\n}\n\nexport function getDocTitleInlineEditor(\n  editorHost: EditorHost\n): InlineEditor | null {\n  const docTitle = getDocTitleByEditorHost(editorHost);\n  if (!docTitle) return null;\n  const titleRichText = docTitle.querySelector<RichText>('rich-text');\n  assertExists(titleRichText);\n  return titleRichText.inlineEditor;\n}\n\n/**\n * Returns `16` if node is contained in the parent.\n * Otherwise return `0`.\n */\nfunction contains(parent: Element, node: Element) {\n  return (\n    parent.compareDocumentPosition(node) & Node.DOCUMENT_POSITION_CONTAINED_BY\n  );\n}\n\n/**\n * Returns `true` if element has `data-block-id` attribute.\n */\nfunction hasBlockId(element: Element): element is BlockComponent {\n  return element.hasAttribute(ATTR);\n}\n\n/**\n * Returns `true` if element is doc page.\n */\nfunction isDocPage({ tagName }: Element) {\n  return tagName === 'AFFINE-PAGE-ROOT';\n}\n\n/**\n * Returns `true` if element is edgeless page.\n *\n * @deprecated Use context instead. The edgeless page may be customized by the user so it's not recommended to use this method. \\\n */\nexport function isEdgelessPage(\n  element: Element\n): element is EdgelessRootBlockComponent {\n  return element.tagName === 'AFFINE-EDGELESS-ROOT';\n}\n\n/**\n * Returns `true` if element is default/edgeless page or note.\n */\nfunction isRootOrNoteOrSurface(element: Element) {\n  return (\n    isDocPage(element) ||\n    isEdgelessPage(element) ||\n    isNote(element) ||\n    isSurface(element)\n  );\n}\n\nfunction isBlock(element: BlockComponent) {\n  return !isRootOrNoteOrSurface(element);\n}\n\nfunction isImage({ tagName }: Element) {\n  return tagName === 'AFFINE-IMAGE';\n}\n\nfunction isNote({ tagName }: Element) {\n  return tagName === 'AFFINE-NOTE';\n}\n\nfunction isSurface({ tagName }: Element) {\n  return tagName === 'AFFINE-SURFACE';\n}\n\nfunction isDatabase({ tagName }: Element) {\n  return tagName === 'AFFINE-DATABASE-TABLE' || tagName === 'AFFINE-DATABASE';\n}\n\nfunction isEdgelessChildNote({ classList }: Element) {\n  return classList.contains('note-background');\n}\n\nfunction isEdgelessChildImage({ classList }: Element) {\n  return classList.contains('edgeless-block-portal-image');\n}\n\n/**\n * Returns the closest block element by a point in the rect.\n *\n * ```\n * ############### block\n * ||############# block\n * ||||########### block\n * ||||    ...\n * ||||  y - 2 * n\n * ||||    ...\n * ||||----------- cursor\n * ||||    ...\n * ||||  y + 2 * n\n * ||||    ...\n * ||||########### block\n * ||############# block\n * ############### block\n * ```\n */\nexport function getClosestBlockElementByPoint(\n  point: Point,\n  state: {\n    rect?: Rect;\n    container?: Element;\n    snapToEdge?: {\n      x: boolean;\n      y: boolean;\n    };\n  } | null = null,\n  scale = 1\n): Element | null {\n  const { y } = point;\n\n  let container;\n  let element = null;\n  let bounds = null;\n  let childBounds = null;\n  let diff = 0;\n  let n = 1;\n\n  if (state) {\n    const {\n      snapToEdge = {\n        x: true,\n        y: false,\n      },\n    } = state;\n    container = state.container;\n    const rect = state.rect || container?.getBoundingClientRect();\n    if (rect) {\n      if (snapToEdge.x) {\n        point.x = Math.min(\n          Math.max(point.x, rect.left) + PADDING_LEFT * scale - 1,\n          rect.right - PADDING_LEFT * scale - 1\n        );\n      }\n      if (snapToEdge.y) {\n        // TODO handle scale\n        if (scale !== 1) {\n          console.warn('scale is not supported yet');\n        }\n        point.y = clamp(point.y, rect.top + 1, rect.bottom - 1);\n      }\n    }\n  }\n\n  // find block element\n  element = findBlockElement(\n    document.elementsFromPoint(point.x, point.y),\n    container\n  );\n\n  // Horizontal direction: for nested structures\n  if (element) {\n    // Database\n    if (isDatabase(element)) {\n      bounds = element.getBoundingClientRect();\n      const rows = getDatabaseBlockRowsElement(element);\n      if (rows) {\n        childBounds = rows.getBoundingClientRect();\n\n        if (childBounds.height) {\n          if (point.y < childBounds.top || point.y > childBounds.bottom) {\n            return element;\n          }\n          childBounds = null;\n        } else {\n          return element;\n        }\n      }\n    } else {\n      // Indented paragraphs or list\n      bounds = getRectByBlockElement(element);\n      childBounds = element\n        .querySelector('.affine-block-children-container')\n        ?.firstElementChild?.getBoundingClientRect();\n\n      if (childBounds && childBounds.height) {\n        if (bounds.x < point.x && point.x <= childBounds.x) {\n          return element;\n        }\n        childBounds = null;\n      } else {\n        return element;\n      }\n    }\n\n    bounds = null;\n    element = null;\n  }\n\n  // Vertical direction\n  do {\n    point.y = y - n * 2;\n\n    if (n < 0) n--;\n    n *= -1;\n\n    // find block element\n    element = findBlockElement(\n      document.elementsFromPoint(point.x, point.y),\n      container\n    );\n\n    if (element) {\n      bounds = getRectByBlockElement(element);\n      diff = bounds.bottom - point.y;\n      if (diff >= 0 && diff <= STEPS * 2) {\n        return element;\n      }\n      diff = point.y - bounds.top;\n      if (diff >= 0 && diff <= STEPS * 2) {\n        return element;\n      }\n      bounds = null;\n      element = null;\n    }\n  } while (n <= STEPS);\n\n  return element;\n}\n\n/**\n * Find the most close block on the given position\n * @param container container which the blocks can be found inside\n * @param point position\n */\nexport function findClosestBlockElement(\n  container: BlockComponent,\n  point: Point,\n  selector: string\n): BlockComponent | null {\n  const children = (\n    Array.from(container.querySelectorAll(selector)) as BlockComponent[]\n  )\n    .filter(child => child.host === container.host)\n    .filter(child => child !== container);\n\n  let lastDistance = Number.POSITIVE_INFINITY;\n  let lastChild = null;\n\n  if (!children.length) return null;\n\n  for (const child of children) {\n    const rect = child.getBoundingClientRect();\n    if (rect.height === 0 || point.y > rect.bottom || point.y < rect.top)\n      continue;\n    const distance =\n      Math.pow(point.y - (rect.y + rect.height / 2), 2) +\n      Math.pow(point.x - rect.x, 2);\n\n    if (distance <= lastDistance) {\n      lastDistance = distance;\n      lastChild = child;\n    } else {\n      return lastChild;\n    }\n  }\n\n  return lastChild;\n}\n\n/**\n * Returns the closest block element by element that does not contain the page element and note element.\n */\nexport function getClosestBlockElementByElement(\n  element: Element | null\n): BlockComponent | null {\n  if (!element) return null;\n  if (hasBlockId(element) && isBlock(element)) {\n    return element;\n  }\n  const blockComponent = element.closest<BlockComponent>(ATTR_SELECTOR);\n  if (blockComponent && isBlock(blockComponent)) {\n    return blockComponent;\n  }\n  return null;\n}\n\n/**\n * Returns the model of the block element.\n */\nexport function getModelByBlockComponent(component: Element) {\n  const containerBlock = component as ContainerBlock;\n  // In extreme cases, the block may be loading, and the model is not yet available.\n  // For example\n  // // `<loader-element data-block-id=\"586080495:15\" data-service-loading=\"true\"></loader-element>`\n  if ('hostModel' in containerBlock) {\n    const loader = containerBlock as Loader;\n    assertExists(loader.hostModel);\n    return loader.hostModel;\n  }\n  assertExists(containerBlock.model);\n  return containerBlock.model;\n}\n\n/**\n * Returns rect of the block element.\n *\n * Compatible with Safari!\n * https://github.com/toeverything/blocksuite/issues/902\n * https://github.com/toeverything/blocksuite/pull/1121\n */\nexport function getRectByBlockElement(element: Element | BlockComponent) {\n  if (isDatabase(element)) return element.getBoundingClientRect();\n  return (element.firstElementChild ?? element).getBoundingClientRect();\n}\n\n/**\n * Returns block elements excluding their subtrees.\n * Only keep block elements of same level.\n */\nexport function getBlockElementsExcludeSubtrees(\n  elements: Element[] | BlockComponent[]\n) {\n  if (elements.length <= 1) return elements;\n  let parent = elements[0];\n  return elements.filter((node, index) => {\n    if (index === 0) return true;\n    if (contains(parent, node)) {\n      return false;\n    } else {\n      parent = node;\n      return true;\n    }\n  });\n}\n\n/**\n * Find block element from an `Element[]`.\n * In Chrome/Safari, `document.elementsFromPoint` does not include `affine-image`.\n */\nfunction findBlockElement(elements: Element[], parent?: Element) {\n  const len = elements.length;\n  let element = null;\n  let i = 0;\n  while (i < len) {\n    element = elements[i];\n    i++;\n    // if parent does not contain element, it's ignored\n    if (parent && !contains(parent, element)) continue;\n    if (hasBlockId(element) && isBlock(element)) return element;\n    if (isImage(element)) {\n      const element = elements[i];\n      if (i < len && hasBlockId(element) && isBlock(element)) {\n        return elements[i];\n      }\n      return getClosestBlockElementByElement(element);\n    }\n  }\n  return null;\n}\n\nexport function getThemeMode(): 'light' | 'dark' {\n  const mode = getComputedStyle(document.documentElement).getPropertyValue(\n    '--affine-theme-mode'\n  );\n\n  if (mode.trim() === 'dark') {\n    return 'dark';\n  } else {\n    return 'light';\n  }\n}\n\n/**\n * Get hovering note with given a point in edgeless mode.\n */\nexport function getHoveringNote(point: Point) {\n  return (\n    document.elementsFromPoint(point.x, point.y).find(isEdgelessChildNote) ||\n    null\n  );\n}\n\n/**\n * Get hovering top level image with given a point in edgeless mode.\n */\nexport function getHoveringImage(point: Point) {\n  return (\n    document.elementsFromPoint(point.x, point.y).find(isEdgelessChildImage) ||\n    null\n  );\n}\n\n/**\n * Gets the table of the database.\n */\nfunction getDatabaseBlockTableElement(element: Element) {\n  return element.querySelector('.affine-database-block-table');\n}\n\n/**\n * Gets the column header of the database.\n */\nfunction getDatabaseBlockColumnHeaderElement(element: Element) {\n  return element.querySelector('.affine-database-column-header');\n}\n\n/**\n * Gets the rows of the database.\n */\nfunction getDatabaseBlockRowsElement(element: Element) {\n  return element.querySelector('.affine-database-block-rows');\n}\n\n/**\n * Returns a flag for the drop target.\n */\nexport enum DropFlags {\n  Normal,\n  Database,\n  EmptyDatabase,\n}\n\n/**\n * Gets the drop rect by block and point.\n */\nexport function getDropRectByPoint(\n  point: Point,\n  model: BlockModel,\n  element: Element\n): {\n  rect: DOMRect;\n  flag: DropFlags;\n} {\n  const result = {\n    rect: getRectByBlockElement(element),\n    flag: DropFlags.Normal,\n  };\n\n  const isDatabase = matchFlavours(model, ['affine:database']);\n\n  if (isDatabase) {\n    const table = getDatabaseBlockTableElement(element);\n    assertExists(table);\n    let bounds = table.getBoundingClientRect();\n    if (model.isEmpty()) {\n      result.flag = DropFlags.EmptyDatabase;\n\n      if (point.y < bounds.top) return result;\n\n      const header = getDatabaseBlockColumnHeaderElement(element);\n      assertExists(header);\n      bounds = header.getBoundingClientRect();\n      result.rect = new DOMRect(\n        result.rect.left,\n        bounds.bottom,\n        result.rect.width,\n        1\n      );\n    } else {\n      result.flag = DropFlags.Database;\n      const rows = getDatabaseBlockRowsElement(element);\n      assertExists(rows);\n      const rowsBounds = rows.getBoundingClientRect();\n\n      if (point.y < rowsBounds.top || point.y > rowsBounds.bottom)\n        return result;\n\n      const elements = document.elementsFromPoint(point.x, point.y);\n      const len = elements.length;\n      let e;\n      let i = 0;\n      for (; i < len; i++) {\n        e = elements[i];\n\n        if (e.classList.contains('affine-database-block-row-cell-content')) {\n          result.rect = getCellRect(e, bounds);\n          return result;\n        }\n\n        if (e.classList.contains('affine-database-block-row')) {\n          e = e.querySelector(ATTR_SELECTOR);\n          assertExists(e);\n          result.rect = getCellRect(e, bounds);\n          return result;\n        }\n      }\n    }\n  } else {\n    const parent = element.parentElement;\n    if (parent?.classList.contains('affine-database-block-row-cell-content')) {\n      result.flag = DropFlags.Database;\n      result.rect = getCellRect(parent);\n      return result;\n    }\n  }\n\n  return result;\n}\n\nfunction getCellRect(element: Element, bounds?: DOMRect) {\n  if (!bounds) {\n    const table = element.closest('.affine-database-block-table');\n    assertExists(table);\n    bounds = table.getBoundingClientRect();\n  }\n  // affine-database-block-row-cell\n  const col = element.parentElement;\n  assertExists(col);\n  // affine-database-block-row\n  const row = col.parentElement;\n  assertExists(row);\n  const colRect = col.getBoundingClientRect();\n  return new DOMRect(\n    bounds.left,\n    colRect.top,\n    colRect.right - bounds.left,\n    colRect.height\n  );\n}\n\n/**\n * Return `true` if the element has class name in the class list.\n */\nexport function hasClassNameInList(element: Element, classList: string[]) {\n  return classList.some(className => element.classList.contains(className));\n}\n"]}