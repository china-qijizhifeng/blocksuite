{"version":3,"file":"affine-inline-specs.js","sourceRoot":"","sources":["../../../../src/_common/inline/presets/affine-inline-specs.ts"],"names":[],"mappings":"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","sourcesContent":["import './nodes/index.js';\n\nimport type { InlineEditor, InlineRootElement } from '@blocksuite/inline';\nimport { html } from 'lit';\nimport { z } from 'zod';\n\nimport type { InlineSpecs } from '../inline-manager.js';\nimport type { ReferenceNodeConfig } from './nodes/reference-node/reference-config.js';\n\n// ========================================\n// AI 占位符常量已在 nodes/consts.js 中定义\n// 如需使用，从 './nodes/consts.js' 导入 AI_PLACEHOLDER_NODE\n// ========================================\n\nexport type AffineInlineEditor = InlineEditor<AffineTextAttributes>;\nexport type AffineInlineRootElement = InlineRootElement<AffineTextAttributes>;\n\nexport interface AffineTextAttributes {\n  bold?: true | null;\n  italic?: true | null;\n  underline?: true | null;\n  strike?: true | null;\n  code?: true | null;\n  link?: string | null;\n  reference?: {\n    type: 'Subpage' | 'LinkedPage';\n    pageId: string;\n  } | null;\n  background?: string | null;\n  color?: string | null;\n  // AI 占位符属性\n  aiPlaceholder?: {\n    content: string;\n  } | null;\n  // 批注属性\n  // 【v6.3】包含完整的批注信息，用于 AI 读取\n  comment?: {\n    id: string;\n    content?: string;       // 批注内容（用户输入）\n    selectedText?: string;  // 被批注的原始文本\n  } | null;\n  // ========================================\n  // AI Diff 属性 - 用于显示 AI 修改的差异\n  // type: 'delete' 表示要删除的原文（红色删除线）\n  // type: 'insert' 表示要插入的新文（绿色高亮）\n  // ========================================\n  aiDiff?: {\n    id: string;\n    type: 'delete' | 'insert';\n    originalText?: string;\n    newText?: string;\n  } | null;\n}\n\nexport const affineInlineSpecsWithoutReference: InlineSpecs<AffineTextAttributes>[] =\n  [\n    {\n      name: 'bold',\n      schema: z.literal(true).optional().nullable().catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.bold;\n      },\n      renderer: delta => {\n        return html`<affine-text .delta=${delta}></affine-text>`;\n      },\n    },\n    {\n      name: 'italic',\n      schema: z.literal(true).optional().nullable().catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.italic;\n      },\n      renderer: delta => {\n        return html`<affine-text .delta=${delta}></affine-text>`;\n      },\n    },\n    {\n      name: 'underline',\n      schema: z.literal(true).optional().nullable().catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.underline;\n      },\n      renderer: delta => {\n        return html`<affine-text .delta=${delta}></affine-text>`;\n      },\n    },\n    {\n      name: 'strike',\n      schema: z.literal(true).optional().nullable().catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.strike;\n      },\n      renderer: delta => {\n        return html`<affine-text .delta=${delta}></affine-text>`;\n      },\n    },\n    {\n      name: 'code',\n      schema: z.literal(true).optional().nullable().catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.code;\n      },\n      renderer: delta => {\n        return html`<affine-text .delta=${delta}></affine-text>`;\n      },\n    },\n    {\n      name: 'background',\n      schema: z.string().optional().nullable().catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.background;\n      },\n      renderer: delta => {\n        return html`<affine-text .delta=${delta}></affine-text>`;\n      },\n    },\n    {\n      name: 'color',\n      schema: z.string().optional().nullable().catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.color;\n      },\n      renderer: delta => {\n        return html`<affine-text .delta=${delta}></affine-text>`;\n      },\n    },\n  ];\n\nexport function getAffineInlineSpecsWithReference(\n  referenceNodeConfig: ReferenceNodeConfig\n): InlineSpecs<AffineTextAttributes>[] {\n  return [\n    ...affineInlineSpecsWithoutReference,\n    {\n      name: 'reference',\n      schema: z\n        .object({\n          type: z.enum([\n            // @deprecated Subpage is deprecated, use LinkedPage instead\n            'Subpage',\n            'LinkedPage',\n          ]),\n          pageId: z.string(),\n        })\n        .optional()\n        .nullable()\n        .catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.reference;\n      },\n      renderer: (delta, selected) => {\n        return html`<affine-reference\n          .delta=${delta}\n          .selected=${selected}\n          .config=${referenceNodeConfig}\n        ></affine-reference>`;\n      },\n      embed: true,\n    },\n    {\n      name: 'link',\n      schema: z.string().optional().nullable().catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.link;\n      },\n      renderer: delta => {\n        return html`<affine-link .delta=${delta}></affine-link>`;\n      },\n    },\n    // ========================================\n    // AI 占位符 - 自定义内联组件\n    // 用于标记需要 AI 填充的位置\n    // ========================================\n    {\n      name: 'aiPlaceholder',\n      schema: z\n        .object({\n          content: z.string(),\n        })\n        .optional()\n        .nullable()\n        .catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.aiPlaceholder;\n      },\n      renderer: (delta, selected) => {\n        return html`<affine-ai-placeholder\n          .delta=${delta}\n          .selected=${selected}\n        ></affine-ai-placeholder>`;\n      },\n      embed: true,\n    },\n    // ========================================\n    // 批注标记 - 显示黄色下划线\n    // 点击可跳转到批注面板\n    // ========================================\n    {\n      name: 'comment',\n      // 【v6.2】schema 包含完整的批注信息，这样 AI 能读取到批注内容\n      schema: z\n        .object({\n          id: z.string(),\n          content: z.string().optional(),      // 批注内容\n          selectedText: z.string().optional(), // 被批注的原始文本\n        })\n        .optional()\n        .nullable()\n        .catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.comment;\n      },\n      renderer: delta => {\n        const commentId = delta.attributes?.comment?.id || '';\n        // 使用下划线样式渲染批注文本\n        return html`<span\n          class=\"affine-comment-mark\"\n          data-comment-id=\"${commentId}\"\n          style=\"border-bottom: 2px solid #f59e0b; cursor: pointer;\"\n          @click=${(e: Event) => {\n            e.stopPropagation();\n            window.dispatchEvent(new CustomEvent('blocksuite-comment-click', {\n              detail: { commentId }\n            }));\n          }}\n        ><affine-text .delta=${delta}></affine-text></span>`;\n      },\n    },\n    // ========================================\n    // AI Diff 标记 - 显示 AI 修改的差异\n    // delete: 红色删除线\n    // insert: 绿色高亮 + 接受/拒绝按钮\n    // ========================================\n    {\n      name: 'aiDiff',\n      schema: z\n        .object({\n          id: z.string(),\n          type: z.enum(['delete', 'insert']),\n          originalText: z.string().optional(),\n          newText: z.string().optional(),\n        })\n        .optional()\n        .nullable()\n        .catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.aiDiff;\n      },\n      renderer: (delta, selected) => {\n        return html`<affine-ai-diff\n          .delta=${delta}\n          .selected=${selected}\n        ></affine-ai-diff>`;\n      },\n    },\n  ];\n}\n"]}