{"version":3,"file":"link-popup.js","sourceRoot":"","sources":["../../../../../../../src/_common/inline/presets/nodes/link-node/link-popup/link-popup.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../../../../components/button.js';\nimport '../../../../../components/tooltip/tooltip.js';\n\nimport type { BlockElement } from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { InlineRange } from '@blocksuite/inline/types';\nimport { computePosition, flip, inline, offset, shift } from '@floating-ui/dom';\nimport { html, LitElement, nothing } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\n\nimport type { EmbedOptions } from '../../../../../../root-block/root-service.js';\nimport type { IconButton } from '../../../../../components/button.js';\nimport { createLitPortal } from '../../../../../components/portal.js';\nimport { toast } from '../../../../../components/toast.js';\nimport { BLOCK_ID_ATTR } from '../../../../../consts.js';\nimport { BookmarkIcon, MoreVerticalIcon } from '../../../../../icons/index.js';\nimport {\n  ConfirmIcon,\n  CopyIcon,\n  EditIcon,\n  EmbedWebIcon,\n  LinkIcon,\n  UnlinkIcon,\n} from '../../../../../icons/text.js';\nimport { isValidUrl, normalizeUrl } from '../../../../../utils/url.js';\nimport type { AffineInlineEditor } from '../../../affine-inline-specs.js';\nimport { LinkPopupMoreMenu } from './link-popup-more-menu-popup.js';\nimport { linkPopupStyle } from './styles.js';\n\n@customElement('link-popup')\nexport class LinkPopup extends WithDisposable(LitElement) {\n  private get _rootService() {\n    return this.std.spec.getService('affine:page');\n  }\n\n  get host() {\n    return this.blockElement.host;\n  }\n\n  get std() {\n    return this.blockElement.std;\n  }\n\n  get blockElement() {\n    const blockElement = this.inlineEditor.rootElement.closest<BlockElement>(\n      `[${BLOCK_ID_ATTR}]`\n    );\n    assertExists(blockElement);\n    return blockElement;\n  }\n\n  get currentText() {\n    return this.inlineEditor.yTextString.slice(\n      this.targetInlineRange.index,\n      this.targetInlineRange.index + this.targetInlineRange.length\n    );\n  }\n\n  get currentLink() {\n    const link = this.inlineEditor.getFormat(this.targetInlineRange).link;\n    assertExists(link);\n    return link;\n  }\n\n  private get _isBookmarkAllowed() {\n    const blockElement = this.blockElement;\n    const schema = blockElement.doc.schema;\n    const parent = blockElement.doc.getParent(blockElement.model);\n    assertExists(parent);\n    const bookmarkSchema = schema.flavourSchemaMap.get('affine:bookmark');\n    assertExists(bookmarkSchema);\n    const parentSchema = schema.flavourSchemaMap.get(parent.flavour);\n    assertExists(parentSchema);\n\n    try {\n      schema.validateSchema(bookmarkSchema, parentSchema);\n    } catch {\n      return false;\n    }\n\n    return true;\n  }\n\n  private get _canConvertToEmbedView() {\n    return this._embedOptions?.viewType === 'embed';\n  }\n\n  static override styles = linkPopupStyle;\n\n  private _bodyOverflowStyle = '';\n\n  private _moreMenuAbortController: AbortController | null = null;\n\n  private _embedOptions: EmbedOptions | null = null;\n\n  @property()\n  accessor type: 'create' | 'edit' | 'view' = 'create';\n\n  @property({ attribute: false })\n  accessor inlineEditor!: AffineInlineEditor;\n\n  @property({ attribute: false })\n  accessor targetInlineRange!: InlineRange;\n\n  @property({ attribute: false })\n  accessor abortController!: AbortController;\n\n  @query('#text-input')\n  accessor textInput: HTMLInputElement | null = null;\n\n  @query('#link-input')\n  accessor linkInput: HTMLInputElement | null = null;\n\n  @query('.affine-link-popover-container')\n  accessor popupContainer!: HTMLDivElement;\n\n  @query('.mock-selection-container')\n  accessor mockSelectionContainer!: HTMLDivElement;\n\n  @query('.affine-confirm-button')\n  accessor confirmButton: IconButton | null = null;\n\n  private _onConfirm() {\n    if (!this.inlineEditor.isValidInlineRange(this.targetInlineRange)) return;\n\n    assertExists(this.linkInput);\n    const linkInputValue = this.linkInput.value;\n    if (!linkInputValue || !isValidUrl(linkInputValue)) return;\n\n    const link = normalizeUrl(linkInputValue);\n\n    if (this.type === 'create') {\n      this.inlineEditor.formatText(this.targetInlineRange, {\n        link: link,\n        reference: null,\n      });\n      this.inlineEditor.setInlineRange(this.targetInlineRange);\n      const textSelection = this.host.selection.find('text');\n      assertExists(textSelection);\n      this.host.rangeManager?.syncTextSelectionToRange(textSelection);\n    } else if (this.type === 'edit') {\n      const text = this.textInput?.value ?? link;\n      this.inlineEditor.insertText(this.targetInlineRange, text, {\n        link: link,\n        reference: null,\n      });\n      this.inlineEditor.setInlineRange({\n        index: this.targetInlineRange.index,\n        length: text.length,\n      });\n      const textSelection = this.host.selection.find('text');\n      assertExists(textSelection);\n      this.host.rangeManager?.syncTextSelectionToRange(textSelection);\n    }\n\n    this.abortController.abort();\n  }\n\n  private _copyUrl() {\n    navigator.clipboard.writeText(this.currentLink).catch(console.error);\n    toast(this.host, 'Copied link to clipboard');\n    this.abortController.abort();\n  }\n\n  private _convertToCardView() {\n    if (!this.inlineEditor.isValidInlineRange(this.targetInlineRange)) {\n      return;\n    }\n\n    let targetFlavour = 'affine:bookmark';\n\n    if (this._embedOptions && this._embedOptions.viewType === 'card') {\n      targetFlavour = this._embedOptions.flavour;\n    }\n\n    const blockElement = this.blockElement;\n    const url = this.currentLink;\n    const title = this.currentText;\n    const props = {\n      url,\n      title: title === url ? '' : title,\n    };\n    const doc = blockElement.doc;\n    const parent = doc.getParent(blockElement.model);\n    assertExists(parent);\n    const index = parent.children.indexOf(blockElement.model);\n    doc.addBlock(targetFlavour as never, props, parent, index + 1);\n\n    const totalTextLength = this.inlineEditor.yTextLength;\n    const inlineTextLength = this.targetInlineRange.length;\n    if (totalTextLength === inlineTextLength) {\n      doc.deleteBlock(blockElement.model);\n    } else {\n      this.inlineEditor.formatText(this.targetInlineRange, { link: null });\n    }\n\n    this.abortController.abort();\n  }\n\n  private _convertToEmbedView() {\n    if (!this._embedOptions || this._embedOptions.viewType !== 'embed') {\n      return;\n    }\n\n    const { flavour } = this._embedOptions;\n    const url = this.currentLink;\n\n    const blockElement = this.blockElement;\n    const doc = blockElement.doc;\n    const parent = doc.getParent(blockElement.model);\n    assertExists(parent);\n    const index = parent.children.indexOf(blockElement.model);\n\n    doc.addBlock(flavour as never, { url }, parent, index + 1);\n\n    const totalTextLength = this.inlineEditor.yTextLength;\n    const inlineTextLength = this.targetInlineRange.length;\n    if (totalTextLength === inlineTextLength) {\n      doc.deleteBlock(blockElement.model);\n    } else {\n      this.inlineEditor.formatText(this.targetInlineRange, { link: null });\n    }\n\n    this.abortController.abort();\n  }\n\n  private _removeLink() {\n    if (this.inlineEditor.isValidInlineRange(this.targetInlineRange)) {\n      this.inlineEditor.formatText(this.targetInlineRange, {\n        link: null,\n      });\n    }\n    this.abortController.abort();\n  }\n\n  private _onKeydown(e: KeyboardEvent) {\n    e.stopPropagation();\n    if (e.key === 'Enter' && !e.isComposing) {\n      e.preventDefault();\n      this._onConfirm();\n    }\n  }\n\n  private _updateConfirmBtn() {\n    assertExists(this.confirmButton);\n    const link = this.linkInput?.value;\n    this.confirmButton.disabled = !(link && isValidUrl(link));\n    this.confirmButton.requestUpdate();\n  }\n\n  private _confirmBtnTemplate() {\n    return html`<icon-button\n      class=\"affine-confirm-button\"\n      @click=${this._onConfirm}\n      >${ConfirmIcon}</icon-button\n    >`;\n  }\n\n  private _createTemplate() {\n    this.updateComplete\n      .then(() => {\n        this.linkInput?.focus();\n\n        this._updateConfirmBtn();\n      })\n      .catch(console.error);\n\n    return html`\n      <div class=\"affine-link-popover create\">\n        <input\n          id=\"link-input\"\n          class=\"affine-link-popover-input\"\n          type=\"text\"\n          spellcheck=\"false\"\n          placeholder=\"Paste or type a link\"\n          @input=${this._updateConfirmBtn}\n        />\n        <span class=\"affine-link-popover-dividing-line\"></span>\n        ${this._confirmBtnTemplate()}\n      </div>\n    `;\n  }\n\n  private _toggleMoreMenu() {\n    if (this._moreMenuAbortController) {\n      this._moreMenuAbortController.abort();\n      this._moreMenuAbortController = null;\n      return;\n    }\n    this._moreMenuAbortController = new AbortController();\n    const linkPopupMoreMenu = new LinkPopupMoreMenu();\n    linkPopupMoreMenu.abortController = this.abortController;\n    linkPopupMoreMenu.inlineEditor = this.inlineEditor;\n    linkPopupMoreMenu.targetInlineRange = this.targetInlineRange;\n    linkPopupMoreMenu.host = this.blockElement.host;\n\n    createLitPortal({\n      template: linkPopupMoreMenu,\n      container: this.popupContainer,\n      computePosition: {\n        referenceElement: this.popupContainer,\n        placement: 'top-end',\n        middleware: [flip()],\n        autoUpdate: true,\n      },\n      abortController: this._moreMenuAbortController,\n    });\n  }\n\n  private _viewTemplate() {\n    this._embedOptions = this._rootService.getEmbedBlockOptions(\n      this.currentLink\n    );\n\n    return html`\n      <div class=\"affine-link-popover view\">\n        <div class=\"affine-link-preview\" @click=${() => this._copyUrl()}>\n          <span>${this.currentLink}</span>\n        </div>\n\n        <icon-button size=\"32px\" @click=${() => this._copyUrl()}>\n          ${CopyIcon}\n          <affine-tooltip .offset=${12}>${'Click to copy link'}</affine-tooltip>\n        </icon-button>\n\n        <icon-button\n          size=\"32px\"\n          data-testid=\"edit\"\n          @click=${() => {\n            this.type = 'edit';\n          }}\n        >\n          ${EditIcon}\n          <affine-tooltip .offset=${12}>Edit</affine-tooltip>\n        </icon-button>\n\n        <span class=\"affine-link-popover-dividing-line\"></span>\n\n        ${this._isBookmarkAllowed\n          ? html`\n              <div class=\"affine-link-popover-view-selector\">\n                <icon-button\n                  size=\"24px\"\n                  class=\"affine-link-popover-view-selector-button link current-view\"\n                  hover=\"false\"\n                >\n                  ${LinkIcon}\n                  <affine-tooltip .offset=${12}\n                    >${'Inline view'}</affine-tooltip\n                  >\n                </icon-button>\n\n                <icon-button\n                  size=\"24px\"\n                  data-testid=\"link-to-card\"\n                  class=\"affine-link-popover-view-selector-button card\"\n                  hover=\"false\"\n                  @click=${() => this._convertToCardView()}\n                >\n                  ${BookmarkIcon}\n                  <affine-tooltip .offset=${12}>${'Card view'}</affine-tooltip>\n                </icon-button>\n\n                ${this._canConvertToEmbedView\n                  ? html` <icon-button\n                      size=\"24px\"\n                      class=\"affine-link-popover-view-selector-button embed\"\n                      hover=\"false\"\n                      @click=${() => this._convertToEmbedView()}\n                    >\n                      ${EmbedWebIcon}\n                      <affine-tooltip .offset=${12}\n                        >${'Embed view'}</affine-tooltip\n                      >\n                    </icon-button>`\n                  : nothing}\n              </div>\n\n              <span class=\"affine-link-popover-dividing-line\"></span>\n            `\n          : nothing}\n\n        <icon-button data-testid=\"unlink\" @click=${() => this._removeLink()}>\n          ${UnlinkIcon}\n          <affine-tooltip .offset=${12}>Remove</affine-tooltip>\n        </icon-button>\n\n        <span class=\"affine-link-popover-dividing-line\"></span>\n\n        <icon-button size=\"24px\" @click=${() => this._toggleMoreMenu()}>\n          ${MoreVerticalIcon}\n          <affine-tooltip .offset=${12}>More</affine-tooltip>\n        </icon-button>\n      </div>\n    `;\n  }\n\n  private _editTemplate() {\n    this.updateComplete\n      .then(() => {\n        assertExists(this.textInput);\n        this.textInput.value = this.currentText;\n        assertExists(this.linkInput);\n        this.linkInput.value = this.currentLink;\n\n        this.textInput.select();\n\n        this._updateConfirmBtn();\n      })\n      .catch(console.error);\n\n    return html`\n      <div class=\"affine-link-edit-popover\">\n        <div class=\"affine-edit-text-area\">\n          <input\n            class=\"affine-edit-text-input\"\n            id=\"text-input\"\n            type=\"text\"\n            placeholder=\"Enter text\"\n            @input=${this._updateConfirmBtn}\n          />\n          <span class=\"affine-link-popover-dividing-line\"></span>\n          <label class=\"affine-edit-text-text\" for=\"text-input\">Text</label>\n        </div>\n        <div class=\"affine-edit-link-area\">\n          <input\n            id=\"link-input\"\n            class=\"affine-edit-link-input\"\n            type=\"text\"\n            spellcheck=\"false\"\n            placeholder=\"Paste or type a link\"\n            @input=${this._updateConfirmBtn}\n          />\n          <span class=\"affine-link-popover-dividing-line\"></span>\n          <label class=\"affine-edit-link-text\" for=\"link-input\">Link</label>\n        </div>\n        ${this._confirmBtnTemplate()}\n      </div>\n    `;\n  }\n\n  protected override firstUpdated() {\n    if (!this.linkInput) return;\n\n    this._disposables.addFromEvent(this.linkInput, 'copy', e => {\n      e.stopPropagation();\n    });\n    this._disposables.addFromEvent(this.linkInput, 'cut', e => {\n      e.stopPropagation();\n    });\n    this._disposables.addFromEvent(this.linkInput, 'paste', e => {\n      e.stopPropagation();\n    });\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    if (this.targetInlineRange.length === 0) {\n      throw new Error('Cannot toggle link popup on empty range');\n    }\n\n    if (this.type === 'edit' || this.type === 'create') {\n      // disable body scroll\n      this._bodyOverflowStyle = document.body.style.overflow;\n      document.body.style.overflow = 'hidden';\n      this.disposables.add({\n        dispose: () => {\n          document.body.style.overflow = this._bodyOverflowStyle;\n        },\n      });\n    }\n\n    const parent = this.blockElement.doc.getParent(this.blockElement.model);\n    assertExists(parent);\n    this.disposables.add(\n      parent.childrenUpdated.on(() => {\n        const children = parent.children;\n        if (children.includes(this.blockElement.model)) return;\n        this.abortController.abort();\n      })\n    );\n  }\n\n  override updated() {\n    assertExists(this.popupContainer);\n    const range = this.inlineEditor.toDomRange(this.targetInlineRange);\n    assertExists(range);\n\n    if (this.type !== 'view') {\n      const domRects = range.getClientRects();\n\n      Object.values(domRects).forEach(domRect => {\n        const mockSelection = document.createElement('div');\n        mockSelection.classList.add('mock-selection');\n        mockSelection.style.left = `${domRect.left}px`;\n        mockSelection.style.top = `${domRect.top}px`;\n        mockSelection.style.width = `${domRect.width}px`;\n        mockSelection.style.height = `${domRect.height}px`;\n\n        assertExists(this.mockSelectionContainer);\n        this.mockSelectionContainer.append(mockSelection);\n      });\n    }\n\n    const visualElement = {\n      getBoundingClientRect: () => range.getBoundingClientRect(),\n      getClientRects: () => range.getClientRects(),\n    };\n    computePosition(visualElement, this.popupContainer, {\n      middleware: [\n        offset(10),\n        inline(),\n        shift({\n          padding: 6,\n        }),\n      ],\n    })\n      .then(({ x, y }) => {\n        const popupContainer = this.popupContainer;\n        if (!popupContainer) return;\n        popupContainer.style.left = `${x}px`;\n        popupContainer.style.top = `${y}px`;\n      })\n      .catch(console.error);\n  }\n\n  override render() {\n    const mask =\n      this.type === 'edit' || this.type === 'create'\n        ? html`<div\n            class=\"affine-link-popover-overlay-mask\"\n            @click=${() => {\n              this.abortController.abort();\n              this.host.selection.clear();\n            }}\n          ></div>`\n        : nothing;\n\n    const popover =\n      this.type === 'create'\n        ? this._createTemplate()\n        : this.type === 'view'\n          ? this._viewTemplate()\n          : this._editTemplate();\n\n    return html`\n      <div class=\"overlay-root\">\n        ${mask}\n        <div class=\"affine-link-popover-container\" @keydown=${this._onKeydown}>\n          ${popover}\n        </div>\n        <div class=\"mock-selection-container\"></div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'link-popup': LinkPopup;\n  }\n}\n"]}