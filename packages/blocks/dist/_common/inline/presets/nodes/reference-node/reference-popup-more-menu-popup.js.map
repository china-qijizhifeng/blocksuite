{"version":3,"file":"reference-popup-more-menu-popup.js","sourceRoot":"","sources":["../../../../../../src/_common/inline/presets/nodes/reference-node/reference-popup-more-menu-popup.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BlockElement } from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { InlineRange } from '@blocksuite/inline/types';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { RootBlockComponent } from '../../../../../root-block/types.js';\nimport { isPeekable, peek } from '../../../../components/peekable.js';\nimport { BLOCK_ID_ATTR } from '../../../../consts.js';\nimport {\n  CenterPeekIcon,\n  DeleteIcon,\n  OpenIcon,\n} from '../../../../icons/index.js';\nimport type { AffineInlineEditor } from '../../affine-inline-specs.js';\n\n@customElement('reference-popup-more-menu')\nexport class ReferencePopupMoreMenu extends WithDisposable(LitElement) {\n  static override styles = css`\n    .reference-popup-more-menu {\n      box-sizing: border-box;\n      padding-bottom: 4px;\n    }\n\n    .reference-popup-more-menu-container {\n      border-radius: 8px;\n      padding: 8px;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n    }\n\n    .reference-popup-more-menu-container > .menu-item {\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n      padding: 0px 8px;\n      gap: 8px;\n      width: 100%;\n    }\n\n    .reference-popup-more-menu-container > .menu-item:hover {\n      background: var(--affine-hover-color);\n    }\n\n    .reference-popup-more-menu-container > .menu-item:hover.delete {\n      background: var(--affine-background-error-color);\n      color: var(--affine-error-color);\n    }\n    .reference-popup-more-menu-container > .menu-item:hover.delete > svg {\n      color: var(--affine-error-color);\n    }\n\n    .reference-popup-more-menu-container > .divider {\n      height: 1px;\n      margin: 8px;\n      background-color: var(--affine-border-color);\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor target!: LitElement;\n\n  @property({ attribute: false })\n  accessor inlineEditor!: AffineInlineEditor;\n\n  @property({ attribute: false })\n  accessor targetInlineRange!: InlineRange;\n\n  @property({ attribute: false })\n  accessor abortController!: AbortController;\n\n  get referenceDocId() {\n    const docId = this.inlineEditor.getFormat(this.targetInlineRange).reference\n      ?.pageId;\n    assertExists(docId);\n    return docId;\n  }\n\n  get blockElement() {\n    const blockElement = this.inlineEditor.rootElement.closest<BlockElement>(\n      `[${BLOCK_ID_ATTR}]`\n    );\n    assertExists(blockElement);\n    return blockElement;\n  }\n\n  get std() {\n    const std = this.blockElement.std;\n    assertExists(std);\n    return std;\n  }\n\n  get _openButtonDisabled() {\n    return this.referenceDocId === this.blockElement.doc.id;\n  }\n\n  private _openDoc() {\n    const refDocId = this.referenceDocId;\n    const blockElement = this.blockElement;\n    if (refDocId === blockElement.doc.id) return;\n\n    const rootElement = this.std.view.viewFromPath('block', [\n      blockElement.model.doc.root?.id ?? '',\n    ]) as RootBlockComponent | null;\n    assertExists(rootElement);\n\n    rootElement.slots.docLinkClicked.emit({ docId: refDocId });\n  }\n\n  private _delete() {\n    if (this.inlineEditor.isValidInlineRange(this.targetInlineRange)) {\n      this.inlineEditor.deleteText(this.targetInlineRange);\n    }\n    this.abortController.abort();\n  }\n\n  override render() {\n    return html`\n      <div class=\"reference-popup-more-menu\">\n        <div class=\"reference-popup-more-menu-container\">\n          <icon-button\n            width=\"126px\"\n            height=\"32px\"\n            class=\"menu-item open\"\n            text=\"Open this doc\"\n            @click=${() => this._openDoc()}\n            ?disabled=${this._openButtonDisabled}\n          >\n            ${OpenIcon}\n          </icon-button>\n\n          ${isPeekable(this.target)\n            ? html`<icon-button\n                width=\"126px\"\n                height=\"32px\"\n                class=\"menu-item center-peek\"\n                text=\"Open in center peek\"\n                @click=${() => peek(this.target)}\n              >\n                ${CenterPeekIcon}\n              </icon-button>`\n            : nothing}\n\n          <div class=\"divider\"></div>\n\n          <icon-button\n            width=\"126px\"\n            height=\"32px\"\n            class=\"menu-item delete\"\n            text=\"Delete\"\n            @click=${() => this._delete()}\n          >\n            ${DeleteIcon}\n          </icon-button>\n        </div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'reference-popup-more-menu': ReferencePopupMoreMenu;\n  }\n}\n"]}