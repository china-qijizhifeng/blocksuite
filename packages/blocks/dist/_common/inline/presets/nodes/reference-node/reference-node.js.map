{"version":3,"file":"reference-node.js","sourceRoot":"","sources":["../../../../../../src/_common/inline/presets/nodes/reference-node/reference-node.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BlockElement } from '@blocksuite/block-std';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport type { Slot } from '@blocksuite/global/utils';\nimport { assertExists } from '@blocksuite/global/utils';\nimport {\n  type DeltaInsert,\n  INLINE_ROOT_ATTR,\n  type InlineRootElement,\n  ZERO_WIDTH_NON_JOINER,\n  ZERO_WIDTH_SPACE,\n} from '@blocksuite/inline';\nimport type { Doc, DocMeta } from '@blocksuite/store';\nimport { css, html } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { ref } from 'lit/directives/ref.js';\n\nimport type { RootBlockComponent } from '../../../../../root-block/types.js';\nimport { HoverController } from '../../../../components/hover/controller.js';\nimport { Peekable } from '../../../../components/peekable.js';\nimport { BLOCK_ID_ATTR } from '../../../../consts.js';\nimport { FontDocIcon, FontLinkedDocIcon } from '../../../../icons/text.js';\nimport {\n  getModelByElement,\n  getRootByElement,\n} from '../../../../utils/query.js';\nimport type { AffineTextAttributes } from '../../affine-inline-specs.js';\nimport { affineTextStyles } from '../affine-text.js';\nimport { DEFAULT_DOC_NAME, REFERENCE_NODE } from '../consts.js';\nimport type { ReferenceNodeConfig } from './reference-config.js';\nimport { toggleReferencePopup } from './reference-popup.js';\n\nexport type RefNodeSlots = {\n  docLinkClicked: Slot<{ docId: string; blockId?: string }>;\n  tagClicked: Slot<{ tagId: string }>;\n};\n\ndeclare module '@blocksuite/blocks' {\n  interface PeekViewService {\n    peek(target: AffineReference): void;\n  }\n}\n\n@customElement('affine-reference')\n@Peekable({ action: false })\nexport class AffineReference extends WithDisposable(ShadowlessElement) {\n  get inlineEditor() {\n    const inlineRoot = this.closest<InlineRootElement<AffineTextAttributes>>(\n      `[${INLINE_ROOT_ATTR}]`\n    );\n    assertExists(inlineRoot);\n    return inlineRoot.inlineEditor;\n  }\n\n  get selfInlineRange() {\n    const selfInlineRange = this.inlineEditor.getInlineRangeFromElement(this);\n    assertExists(selfInlineRange);\n    return selfInlineRange;\n  }\n\n  get blockElement() {\n    const blockElement = this.inlineEditor.rootElement.closest<BlockElement>(\n      `[${BLOCK_ID_ATTR}]`\n    );\n    assertExists(blockElement);\n    return blockElement;\n  }\n\n  get std() {\n    const std = this.blockElement.std;\n    assertExists(std);\n    return std;\n  }\n\n  get doc() {\n    const doc = this.config.doc;\n    assertExists(doc, '`reference-node` need `Doc`.');\n    return doc;\n  }\n\n  get customIcon() {\n    return this.config.customIcon;\n  }\n\n  get customTitle() {\n    return this.config.customTitle;\n  }\n\n  get customContent() {\n    return this.config.customContent;\n  }\n\n  static override styles = css`\n    .affine-reference {\n      white-space: normal;\n      word-break: break-word;\n      color: var(--affine-text-primary-color);\n      fill: var(--affine-icon-color);\n      border-radius: 4px;\n      text-decoration: none;\n      cursor: pointer;\n      user-select: none;\n      padding: 1px 2px 1px 0;\n    }\n    .affine-reference:hover {\n      background: var(--affine-hover-color);\n    }\n\n    .affine-reference[data-selected='true'] {\n      background: var(--affine-hover-color);\n    }\n\n    .affine-reference-title {\n      margin-left: 4px;\n      border-bottom: 0.5px solid var(--affine-divider-color);\n      transition: border 0.2s ease-out;\n    }\n    .affine-reference-title:hover {\n      border-bottom: 0.5px solid var(--affine-icon-color);\n    }\n  `;\n\n  private _refAttribute: NonNullable<AffineTextAttributes['reference']> = {\n    type: 'LinkedPage',\n    pageId: '0',\n  };\n\n  private _whenHover: HoverController = new HoverController(\n    this,\n    ({ abortController }) => {\n      if (this.doc.readonly) {\n        return null;\n      }\n\n      const selection = this.std.selection;\n      const textSelection = selection.find('text');\n      if (\n        !!textSelection &&\n        (!!textSelection.to || !!textSelection.from.length)\n      ) {\n        return null;\n      }\n\n      const blockSelections = selection.filter('block');\n      if (blockSelections.length) {\n        return null;\n      }\n\n      return {\n        template: toggleReferencePopup(\n          this,\n          this.inlineEditor,\n          this.selfInlineRange,\n          this.refMeta?.title ?? DEFAULT_DOC_NAME,\n          abortController\n        ),\n      };\n    },\n    { enterDelay: 500 }\n  );\n\n  @property({ type: Object })\n  accessor delta: DeltaInsert<AffineTextAttributes> = {\n    insert: ZERO_WIDTH_SPACE,\n    attributes: {},\n  };\n\n  @property({ type: Boolean })\n  accessor selected = false;\n\n  @property({ attribute: false })\n  accessor config!: ReferenceNodeConfig;\n\n  // Since the linked doc may be deleted, the `_refMeta` could be undefined.\n  @state()\n  accessor refMeta: DocMeta | undefined = undefined;\n\n  private _updateRefMeta = (doc: Doc) => {\n    const refAttribute = this.delta.attributes?.reference;\n    assertExists(refAttribute, 'Failed to get reference attribute!');\n    this._refAttribute = refAttribute;\n    const refMeta = doc.collection.meta.docMetas.find(\n      doc => doc.id === refAttribute.pageId\n    );\n    this.refMeta = refMeta\n      ? {\n          ...refMeta,\n        }\n      : undefined;\n  };\n\n  private _onClick() {\n    if (!this.config.interactable) return;\n\n    const refMeta = this.refMeta;\n    const model = getModelByElement(this);\n    if (!refMeta) {\n      // The doc is deleted\n      console.warn('The doc is deleted', this._refAttribute.pageId);\n      return;\n    }\n    if (refMeta.id === model.doc.id) {\n      // the doc is the current doc.\n      return;\n    }\n    const targetDocId = refMeta.id;\n    const rootModel = model.doc.root;\n    assertExists(rootModel);\n    const rootElement = getRootByElement(this) as RootBlockComponent;\n    assertExists(rootElement);\n    rootElement.slots.docLinkClicked.emit({ docId: targetDocId });\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    assertExists(this.config, '`reference-node` need `ReferenceNodeConfig`.');\n\n    if (this.delta.insert !== REFERENCE_NODE) {\n      console.error(\n        `Reference node must be initialized with '${REFERENCE_NODE}', but got '${this.delta.insert}'`\n      );\n    }\n\n    const doc = this.doc;\n    this._disposables.add(\n      doc.collection.slots.docUpdated.on(() => this._updateRefMeta(doc))\n    );\n\n    this.updateComplete\n      .then(() => {\n        // observe yText update\n        this.disposables.add(\n          this.inlineEditor.slots.textChange.on(() => this._updateRefMeta(doc))\n        );\n      })\n      .catch(console.error);\n  }\n\n  override willUpdate(_changedProperties: Map<PropertyKey, unknown>) {\n    super.willUpdate(_changedProperties);\n\n    const doc = this.doc;\n    this._updateRefMeta(doc);\n  }\n\n  override render() {\n    const refMeta = this.refMeta;\n    const isDeleted = !refMeta;\n\n    const attributes = this.delta.attributes;\n    assertExists(attributes, 'Failed to get attributes!');\n\n    const type = attributes.reference?.type;\n    assertExists(type, 'Unable to get reference type!');\n\n    const title = this.customTitle\n      ? this.customTitle(this)\n      : isDeleted\n        ? 'Deleted doc'\n        : refMeta.title.length > 0\n          ? refMeta.title\n          : DEFAULT_DOC_NAME;\n    const icon = this.customIcon\n      ? this.customIcon(this)\n      : type === 'LinkedPage'\n        ? FontLinkedDocIcon\n        : FontDocIcon;\n\n    const style = affineTextStyles(\n      attributes,\n      isDeleted\n        ? {\n            color: 'var(--affine-text-disable-color)',\n            textDecoration: 'line-through',\n            fill: 'var(--affine-text-disable-color)',\n          }\n        : {}\n    );\n\n    const content = this.customContent\n      ? this.customContent(this)\n      : html`${icon}<span data-title=${title} class=\"affine-reference-title\"\n            >${title}</span\n          >`;\n\n    // we need to add `<v-text .str=${ZERO_WIDTH_NON_JOINER}></v-text>` in an\n    // embed element to make sure inline range calculation is correct\n    return html`<span\n      ${this.config.interactable ? ref(this._whenHover.setReference) : ''}\n      data-selected=${this.selected}\n      class=\"affine-reference\"\n      style=${style}\n      @click=${this._onClick}\n      >${content}<v-text .str=${ZERO_WIDTH_NON_JOINER}></v-text\n    ></span>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-reference': AffineReference;\n  }\n}\n"]}