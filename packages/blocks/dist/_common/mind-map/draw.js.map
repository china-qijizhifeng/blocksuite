{"version":3,"file":"draw.js","sourceRoot":"","sources":["../../../src/_common/mind-map/draw.ts"],"names":[],"mappings":"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","sourcesContent":["import { DocCollection } from '@blocksuite/store';\n\nimport type { EdgelessRootService } from '../../root-block/edgeless/edgeless-root-service.js';\nimport { getFontString } from '../../surface-block/canvas-renderer/element-renderer/text/utils.js';\nimport { SHAPE_TEXT_PADDING } from '../../surface-block/element-model/shape.js';\nimport type {\n  ConnectorElementModel,\n  ShapeElementModel,\n} from '../../surface-block/index.js';\nimport {\n  Bound,\n  CanvasElementType,\n  ConnectorMode,\n  getLineWidth,\n  type IShape,\n  normalizeShapeBound,\n  ShapeStyle,\n  type ShapeType,\n  StrokeStyle,\n} from '../../surface-block/index.js';\nimport {\n  type Connector,\n  layout,\n  type LayoutNode,\n  type LayoutNodeResult,\n} from './layout.js';\n\nexport const DEFAULT_SHAPE_PROPS: Partial<IShape> = {\n  shapeType: 'rect' as ShapeType,\n  strokeColor: '--affine-palette-line-blue',\n  fillColor: '--affine-palette-shape-blue',\n  radius: 0.1,\n  strokeWidth: 2,\n  strokeStyle: StrokeStyle.Solid,\n  shapeStyle: ShapeStyle.General,\n};\n\nexport const DEFAULT_CONNECTOR_PROPS: Partial<ConnectorElementModel> = {\n  stroke: '--affine-palette-line-black',\n  mode: ConnectorMode.Orthogonal,\n  strokeWidth: 2,\n  strokeStyle: StrokeStyle.Solid,\n  frontEndpointStyle: 'None',\n  rearEndpointStyle: 'None',\n};\nexport type TreeNode = {\n  // element id in edgeless if it already exists\n  id?: string;\n  text: string;\n  children: TreeNode[];\n};\nexport type TreeNodeWithId = {\n  id: string;\n  children: TreeNodeWithId[];\n};\nconst directionMap: Record<string, { from: number[]; to: number[] }> = {\n  left: {\n    from: [0, 0.5],\n    to: [1, 0.5],\n  },\n  right: {\n    from: [1, 0.5],\n    to: [0, 0.5],\n  },\n  top: {\n    from: [0.5, 0],\n    to: [0.5, 1],\n  },\n  bottom: {\n    from: [0.5, 1],\n    to: [0.5, 0],\n  },\n};\n\nconst drawAllNode = (\n  node: TreeNode,\n  service: EdgelessRootService,\n  options?: {\n    rootId?: string;\n    x?: number;\n    y?: number;\n  }\n) => {\n  const shapeIds: string[] = [];\n  const connectorIds: string[] = [];\n  const connectors: { from: string; to: string }[] = [];\n  type LayoutNode_ = Omit<LayoutNode, 'children'> & {\n    id: string;\n    children: LayoutNode_[];\n  };\n  const drawNode = (node: TreeNode, isRoot = false): LayoutNode_ => {\n    const { text, children } = node;\n    const id = node.id\n      ? node.id\n      : isRoot && options?.rootId\n        ? options.rootId\n        : service.addElement(CanvasElementType.SHAPE, {\n            ...DEFAULT_SHAPE_PROPS,\n            xywh: `[${0},${0},${0},${0}]`,\n            text: new DocCollection.Y.Text(text),\n          });\n    shapeIds.push(id);\n    const ele = service.getElementById(id) as ShapeElementModel;\n    const maxWidth =\n      Math.max(\n        ...text.split('\\n').map(line => getLineWidth(line, getFontString(ele)))\n      ) +\n      SHAPE_TEXT_PADDING * 2;\n    const bound = normalizeShapeBound(\n      ele,\n      new Bound(0, 0, Math.max(148, Math.min(600, maxWidth)), 78)\n    );\n    return {\n      id,\n      width: bound.w,\n      height: bound.h,\n      children: children.map(child => {\n        const layoutNode = drawNode(child);\n        connectors.push({ from: id, to: layoutNode.id });\n        return layoutNode;\n      }),\n    };\n  };\n  const layoutNode = drawNode(node, true);\n  const root = options?.rootId\n    ? (service.getElementById(options.rootId) as ShapeElementModel)\n    : undefined;\n  const result = layout.right(layoutNode, {\n    gapHorizontal: 130,\n    gapVertical: 10,\n    x: root ? root.x : options?.x ?? 0,\n    y: root ? root.y : options?.y ?? 0,\n  });\n  const updatePosition = (node: LayoutNode_, result: LayoutNodeResult) => {\n    const { id, width, height } = node;\n    const { x, y } = result.self;\n\n    service.updateElement(id, {\n      xywh: `[${x},${y},${width},${height}]`,\n    });\n    node.children.forEach((child, index) => {\n      const layoutNodeResult = result.children[index];\n      updatePosition(child, layoutNodeResult);\n    });\n  };\n  updatePosition(layoutNode, result);\n  return { shapeIds, connectorIds };\n};\nconst layoutAllNode = (\n  node: TreeNodeWithId,\n  service: EdgelessRootService,\n  options?: {\n    rootId?: string;\n    x?: number;\n    y?: number;\n  }\n) => {\n  type LayoutNode_ = Omit<LayoutNode, 'children'> & {\n    id: string;\n    children: LayoutNode_[];\n  };\n  const getLayoutNode = (node: TreeNodeWithId): LayoutNode_ => {\n    const { children, id } = node;\n    const ele = service.getElementById(id) as ShapeElementModel;\n    return {\n      id,\n      width: ele.w,\n      height: ele.h,\n      children: children.map(child => getLayoutNode(child)),\n    };\n  };\n  const layoutNode = getLayoutNode(node);\n  const root = options?.rootId\n    ? (service.getElementById(options.rootId) as ShapeElementModel)\n    : undefined;\n  const result = layout.right(layoutNode, {\n    gapHorizontal: 130,\n    gapVertical: 10,\n    x: root ? root.x : options?.x ?? 0,\n    y: root ? root.y : options?.y ?? 0,\n  });\n  const updatePosition = (node: LayoutNode_, result: LayoutNodeResult) => {\n    const { id, width, height } = node;\n    const { x, y } = result.self;\n\n    service.updateElement(id, {\n      xywh: `[${x},${y},${width},${height}]`,\n    });\n    node.children.forEach((child, index) => {\n      const layoutNodeResult = result.children[index];\n      updatePosition(child, layoutNodeResult);\n    });\n  };\n  updatePosition(layoutNode, result);\n};\nexport function drawMindMap(\n  service: EdgelessRootService,\n  mindMap: TreeNode,\n  ops?: {\n    rootId?: string;\n    x?: number;\n    y?: number;\n  }\n) {\n  const { shapeIds, connectorIds } = drawAllNode(mindMap, service, ops);\n\n  service.selection.set({\n    elements: [...shapeIds, ...connectorIds],\n    editing: false,\n  });\n  service.createGroupFromSelected();\n}\nexport function layoutMindMap(\n  service: EdgelessRootService,\n  mindMap: TreeNodeWithId,\n  ops?: {\n    rootId?: string;\n    x?: number;\n    y?: number;\n  }\n) {\n  layoutAllNode(mindMap, service, ops);\n}\nexport const createNode = (\n  text: string,\n  service: EdgelessRootService,\n  connector?: Connector\n) => {\n  const id = service.addElement(CanvasElementType.SHAPE, {\n    ...DEFAULT_SHAPE_PROPS,\n    xywh: `[${0},${0},${0},${0}]`,\n    text: new DocCollection.Y.Text(text),\n  });\n  const ele = service.getElementById(id) as ShapeElementModel;\n  const maxWidth =\n    Math.max(\n      ...text.split('\\n').map(line => getLineWidth(line, getFontString(ele)))\n    ) +\n    SHAPE_TEXT_PADDING * 2;\n  const bound = normalizeShapeBound(\n    ele,\n    new Bound(0, 0, Math.max(148, Math.min(600, maxWidth)), 78)\n  );\n  service.updateElement(id, {\n    xywh: bound.serialize(),\n  });\n  if (connector) {\n    const direction = directionMap[connector.direction];\n    service.addElement(CanvasElementType.CONNECTOR, {\n      ...DEFAULT_CONNECTOR_PROPS,\n      source: {\n        id: connector.parentId,\n        position: direction.from,\n      },\n      target: {\n        id: id,\n        position: direction.to,\n      },\n    });\n  }\n\n  return id;\n};\n\nexport const changeText = (\n  id: string,\n  text: string,\n  service: EdgelessRootService\n) => {\n  service.updateElement(id, {\n    text: new DocCollection.Y.Text(text),\n  });\n  const ele = service.getElementById(id) as ShapeElementModel;\n  const maxWidth =\n    Math.max(\n      ...text.split('\\n').map(line => getLineWidth(line, getFontString(ele)))\n    ) +\n    SHAPE_TEXT_PADDING * 2;\n  const bound = normalizeShapeBound(\n    ele,\n    new Bound(0, 0, Math.max(148, Math.min(600, maxWidth)), 78)\n  );\n  service.updateElement(id, {\n    xywh: bound.serialize(),\n  });\n};\n"]}