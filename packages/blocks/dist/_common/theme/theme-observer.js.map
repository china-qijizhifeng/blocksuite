{"version":3,"file":"theme-observer.js","sourceRoot":"","sources":["../../../src/_common/theme/theme-observer.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,IAAI,EAAE,MAAM,0BAA0B,CAAC;AAGhD,OAAO,EAAE,aAAa,EAAE,cAAc,EAAE,MAAM,oBAAoB,CAAC;AAEnE,MAAM,UAAU,mBAAmB,CAAC,OAAgB;IAClD,MAAM,MAAM,GAAG,MAAM,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;IAChD,MAAM,SAAS,GAAG,cAAc,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,OAAO,EAAE,EAAE;QACvD,MAAM,KAAK,GAAG,MAAM,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,CAAC;QACtD,GAAG,CAAC,OAAO,CAAC,GAAG,KAAK,CAAC;QAErB,0FAA0F;QAC1F,IAAI,OAAO,KAAK,8BAA8B,IAAI,CAAC,KAAK,EAAE,CAAC;YACzD,GAAG,CAAC,OAAO,CAAC,GAAG,WAAW,CAAC;QAC7B,CAAC;QAED,OAAO,GAAG,CAAC;IACb,CAAC,EAAE,EAAqB,CAAC,CAAC;IAC1B,OAAO,SAAS,CAAC;AACnB,CAAC;AAED;;GAEG;AACH,MAAM,OAAO,aAAc,SAAQ,IAAqB;IAAxD;;QAGU,UAAK,GAAG,EAAE,CAAC;QAEX,kBAAa,GAA2B,IAAI,CAAC;IAwCvD,CAAC;IAtCC,IAAI,YAAY;QACd,OAAO,IAAI,CAAC,aAAa,CAAC;IAC5B,CAAC;IAED,OAAO,CAAC,OAAoB;QAC1B,IAAI,CAAC,SAAS,EAAE,UAAU,EAAE,CAAC;QAC7B,IAAI,CAAC,aAAa,GAAG,mBAAmB,CAAC,OAAO,CAAC,CAAC;QAClD,IAAI,CAAC,SAAS,GAAG,IAAI,gBAAgB,CAAC,GAAG,EAAE;YACzC,MAAM,IAAI,GAAG,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC;YACnC,IAAI,IAAI,CAAC,KAAK,KAAK,IAAI,EAAE,CAAC;gBACxB,IAAI,CAAC,aAAa,GAAG,mBAAmB,CAAC,OAAO,CAAC,CAAC;gBAClD,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YAChC,CAAC;QACH,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,OAAO,EAAE;YAC9B,UAAU,EAAE,IAAI;YAChB,eAAe,EAAE,CAAC,YAAY,CAAC;SAChC,CAAC,CAAC;IACL,CAAC;IAED,gBAAgB,CAAC,QAAgB;QAC/B,IAAI,aAAa,CAAC,QAAQ,CAAC,EAAE,CAAC;YAC5B,MAAM,KAAK,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC,QAAQ,CAAC,CAAC;YAE7C,IAAI,KAAK,KAAK,SAAS,EAAE,CAAC;gBACxB,OAAO,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,6BAA6B,QAAQ,EAAE,CAAC,CAAC,CAAC;YACpE,CAAC;iBAAM,CAAC;gBACN,OAAO,KAAK,CAAC;YACf,CAAC;QACH,CAAC;QAED,OAAO,QAAQ,CAAC;IAClB,CAAC;IAEQ,OAAO;QACd,KAAK,CAAC,OAAO,EAAE,CAAC;QAChB,IAAI,CAAC,SAAS,EAAE,UAAU,EAAE,CAAC;IAC/B,CAAC;CACF","sourcesContent":["import { Slot } from '@blocksuite/global/utils';\n\nimport type { CssVariablesMap } from './css-variables.js';\nimport { isCssVariable, StyleVariables } from './css-variables.js';\n\nexport function extractCssVariables(element: Element): CssVariablesMap {\n  const styles = window.getComputedStyle(element);\n  const variables = StyleVariables.reduce((acc, cssName) => {\n    const value = styles.getPropertyValue(cssName).trim();\n    acc[cssName] = value;\n\n    // --affine-palette-transparent: special values added for the sake of logical consistency.\n    if (cssName === '--affine-palette-transparent' && !value) {\n      acc[cssName] = '#00000000';\n    }\n\n    return acc;\n  }, {} as CssVariablesMap);\n  return variables;\n}\n\n/**\n * Observer theme changing by `data-theme` property\n */\nexport class ThemeObserver extends Slot<CssVariablesMap> {\n  private _observer?: MutationObserver;\n\n  private _mode = '';\n\n  private _cssVariables: CssVariablesMap | null = null;\n\n  get cssVariables() {\n    return this._cssVariables;\n  }\n\n  observe(element: HTMLElement) {\n    this._observer?.disconnect();\n    this._cssVariables = extractCssVariables(element);\n    this._observer = new MutationObserver(() => {\n      const mode = element.dataset.theme;\n      if (this._mode !== mode) {\n        this._cssVariables = extractCssVariables(element);\n        this.emit(this._cssVariables);\n      }\n    });\n    this._observer.observe(element, {\n      attributes: true,\n      attributeFilter: ['data-theme'],\n    });\n  }\n\n  getVariableValue(variable: string) {\n    if (isCssVariable(variable)) {\n      const value = this._cssVariables?.[variable];\n\n      if (value === undefined) {\n        console.error(new Error(`Cannot find css variable: ${variable}`));\n      } else {\n        return value;\n      }\n    }\n\n    return variable;\n  }\n\n  override dispose() {\n    super.dispose();\n    this._observer?.disconnect();\n  }\n}\n"]}