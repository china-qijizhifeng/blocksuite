{"version":3,"file":"embed-synced-doc-block.js","sourceRoot":"","sources":["../../src/embed-synced-doc-block/embed-synced-doc-block.ts"],"names":[],"mappings":"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","sourcesContent":["import './components/embed-synced-doc-card.js';\n\nimport type { EditorHost } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport {\n  type BlockSelector,\n  BlockViewType,\n  DocCollection,\n} from '@blocksuite/store';\nimport { html, nothing, type PropertyValues } from 'lit';\nimport { customElement, query, state } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { guard } from 'lit/directives/guard.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { Peekable } from '../_common/components/peekable.js';\nimport { EMBED_CARD_HEIGHT, EMBED_CARD_WIDTH } from '../_common/consts.js';\nimport { EmbedBlockElement } from '../_common/embed-block-helper/embed-block-element.js';\nimport { EmbedEdgelessIcon, EmbedPageIcon } from '../_common/icons/text.js';\nimport { REFERENCE_NODE } from '../_common/inline/presets/nodes/consts.js';\nimport { type DocMode, NoteDisplayMode } from '../_common/types.js';\nimport { matchFlavours } from '../_common/utils/model.js';\nimport { getThemeMode } from '../_common/utils/query.js';\nimport { isEmptyDoc } from '../_common/utils/render-linked-doc.js';\nimport type {\n  EdgelessRootService,\n  RootBlockComponent,\n} from '../root-block/index.js';\nimport { SpecProvider } from '../specs/utils/spec-provider.js';\nimport { Bound } from '../surface-block/utils/bound.js';\nimport type { EmbedSyncedDocCard } from './components/embed-synced-doc-card.js';\nimport type { EmbedSyncedDocModel } from './embed-synced-doc-model.js';\nimport type { EmbedSyncedDocBlockService } from './embed-synced-doc-service.js';\nimport { blockStyles } from './styles.js';\n\n@customElement('affine-embed-synced-doc-block')\n@Peekable()\nexport class EmbedSyncedDocBlockComponent extends EmbedBlockElement<\n  EmbedSyncedDocModel,\n  EmbedSyncedDocBlockService\n> {\n  get syncedDoc() {\n    return this._syncedDocMode === 'page'\n      ? this.std.collection.getDoc(this.model.pageId, {\n          readonly: true,\n          selector: this._pageFilter,\n        })\n      : this.std.collection.getDoc(this.model.pageId, {\n          readonly: true,\n        });\n  }\n\n  get blockState() {\n    return {\n      isLoading: this._loading,\n      isError: this._error,\n      isDeleted: this._deleted,\n      isCycle: this._cycle,\n    };\n  }\n\n  get editorMode() {\n    return this._syncedDocMode;\n  }\n\n  get docUpdatedAt() {\n    return this._docUpdatedAt;\n  }\n\n  get docTitle() {\n    return this.syncedDoc?.meta?.title.length\n      ? this.syncedDoc.meta.title\n      : 'Untitled';\n  }\n\n  private get _rootService() {\n    return this.std.spec.getService('affine:page');\n  }\n\n  private get isPageMode() {\n    return this._syncedDocMode === 'page';\n  }\n\n  static override styles = blockStyles;\n\n  private _pageFilter: BlockSelector = block => {\n    if (\n      matchFlavours(block.model, ['affine:note']) &&\n      block.model.displayMode === NoteDisplayMode.EdgelessOnly\n    ) {\n      return BlockViewType.Hidden;\n    }\n\n    return BlockViewType.Display;\n  };\n\n  @state()\n  accessor depth = 0;\n\n  @state()\n  private accessor _syncedDocMode: DocMode = 'page';\n\n  @state()\n  private accessor _isEmptySyncedDoc: boolean = true;\n\n  @state()\n  private accessor _docUpdatedAt: Date = new Date();\n\n  @state()\n  private accessor _loading = false;\n\n  @state()\n  private accessor _error = false;\n\n  @state()\n  private accessor _deleted = false;\n\n  @state()\n  private accessor _cycle = false;\n\n  override accessor useCaptionEditor = false;\n\n  @query(\n    ':scope > .affine-block-component > .embed-block-container > affine-embed-synced-doc-card'\n  )\n  accessor syncedDocCard: EmbedSyncedDocCard | null = null;\n\n  @query(\n    ':scope > .affine-block-component > .embed-block-container > .affine-embed-synced-doc-container > .affine-embed-synced-doc-editor > div > editor-host'\n  )\n  accessor syncedDocEditorHost: EditorHost | null = null;\n\n  private _checkCycle() {\n    let editorHost: EditorHost | null = this.host;\n    while (editorHost && !this._cycle) {\n      this._cycle = !!editorHost && editorHost.doc.id === this.model.pageId;\n      editorHost =\n        editorHost.parentElement?.closest<EditorHost>('editor-host') ?? null;\n    }\n  }\n\n  private async _load() {\n    this._loading = true;\n    this._error = false;\n    this._deleted = false;\n    this._cycle = false;\n\n    const syncedDoc = this.syncedDoc;\n    if (!syncedDoc) {\n      this._deleted = true;\n      this._loading = false;\n      return;\n    }\n\n    this._checkCycle();\n\n    if (!syncedDoc.loaded) {\n      try {\n        syncedDoc.load();\n      } catch (e) {\n        console.error(e);\n        this._error = true;\n      }\n    }\n\n    if (!this._error && !syncedDoc.root) {\n      await new Promise<void>(resolve => {\n        syncedDoc.slots.rootAdded.once(() => resolve());\n      });\n    }\n\n    this._loading = false;\n  }\n\n  private _setDocUpdatedAt() {\n    const meta = this.doc.collection.meta.getDocMeta(this.model.pageId);\n    if (meta) {\n      const date = meta.updatedDate || meta.createDate;\n      this._docUpdatedAt = new Date(date);\n    }\n  }\n\n  private _isClickAtBorder(\n    event: MouseEvent,\n    element: HTMLElement,\n    tolerance = 8\n  ): boolean {\n    const { x, y } = event;\n    const rect = element.getBoundingClientRect();\n    if (!rect) {\n      return false;\n    }\n\n    return (\n      Math.abs(x - rect.left) < tolerance ||\n      Math.abs(x - rect.right) < tolerance ||\n      Math.abs(y - rect.top) < tolerance ||\n      Math.abs(y - rect.bottom) < tolerance\n    );\n  }\n\n  private _selectBlock() {\n    const selectionManager = this.host.selection;\n    const blockSelection = selectionManager.create('block', {\n      blockId: this.blockId,\n    });\n    selectionManager.setGroup('note', [blockSelection]);\n  }\n\n  private _handleClick(_event: MouseEvent) {\n    if (this.isInSurface) return;\n    this._selectBlock();\n  }\n\n  private _buildPreviewSpec = (name: 'page:preview' | 'edgeless:preview') => {\n    const nextDepth = this.depth + 1;\n    const previewSpecBuilder = SpecProvider.getInstance().getSpec(name);\n    const currentDisposables = this.disposables;\n\n    previewSpecBuilder.setup(\n      'affine:embed-synced-doc',\n      (slots, disposableGroup) => {\n        disposableGroup.add(\n          slots.viewConnected.on(({ component }) => {\n            const nextComponent = component as EmbedSyncedDocBlockComponent;\n            nextComponent.depth = nextDepth;\n            currentDisposables.add(() => {\n              nextComponent.depth = 0;\n            });\n          })\n        );\n        disposableGroup.add(\n          slots.viewDisconnected.on(({ component }) => {\n            const nextComponent = component as EmbedSyncedDocBlockComponent;\n            nextComponent.depth = 0;\n          })\n        );\n      }\n    );\n\n    return previewSpecBuilder.value;\n  };\n\n  private _renderSyncedView = () => {\n    const syncedDoc = this.syncedDoc;\n    const isInSurface = this.isInSurface;\n    const editorMode = this._syncedDocMode;\n\n    assertExists(syncedDoc);\n\n    if (this.isPageMode && !this.isInSurface) {\n      this.style.width = 'calc(100% + 48px)';\n      this.style.marginLeft = '-24px';\n      this.style.marginRight = '-24px';\n    }\n\n    let containerStyleMap = styleMap({\n      position: 'relative',\n      width: '100%',\n    });\n    if (isInSurface) {\n      const scale = this.model.scale ?? 1;\n      const bound = Bound.deserialize(\n        (this.edgeless?.service.getElementById(this.model.id) ?? this.model)\n          .xywh\n      );\n      const width = bound.w / scale;\n      const height = bound.h / scale;\n      containerStyleMap = styleMap({\n        width: `${width}px`,\n        height: `${height}px`,\n        minHeight: `${height}px`,\n        transform: `scale(${scale})`,\n        transformOrigin: '0 0',\n      });\n    }\n\n    const theme = getThemeMode();\n    const isSelected = !!this.selected?.is('block');\n    const scale = isInSurface ? this.model.scale ?? 1 : undefined;\n\n    this.dataset.nestedEditor = '';\n\n    const renderEditor = () => {\n      return choose(editorMode, [\n        [\n          'page',\n          () => html`\n            <div class=\"affine-page-viewport\">\n              ${this.host.renderSpecPortal(\n                syncedDoc,\n                this._buildPreviewSpec('page:preview')\n              )}\n            </div>\n          `,\n        ],\n        [\n          'edgeless',\n          () => html`\n            <div class=\"affine-edgeless-viewport\">\n              ${this.host.renderSpecPortal(\n                syncedDoc,\n                this._buildPreviewSpec('edgeless:preview')\n              )}\n            </div>\n          `,\n        ],\n      ]);\n    };\n\n    const icon = this.isPageMode ? EmbedPageIcon : EmbedEdgelessIcon;\n\n    return this.renderEmbed(\n      () => html`\n        <div\n          class=${classMap({\n            'affine-embed-synced-doc-container': true,\n            [editorMode]: true,\n            [theme]: true,\n            selected: isSelected,\n            surface: isInSurface,\n          })}\n          @click=${this._handleClick}\n          style=${containerStyleMap}\n          ?data-scale=${scale}\n        >\n          <div class=\"affine-embed-synced-doc-editor\">\n            ${this.isPageMode && this._isEmptySyncedDoc\n              ? html`\n                  <div class=\"affine-embed-synced-doc-editor-empty\">\n                    <span>\n                      This is a linked doc, you can add content here.\n                    </span>\n                  </div>\n                `\n              : guard([editorMode, syncedDoc], renderEditor)}\n          </div>\n          ${isInSurface\n            ? nothing\n            : html`\n                <div\n                  class=${classMap({\n                    'affine-embed-synced-doc-header-wrapper': true,\n                    selected: isSelected,\n                  })}\n                >\n                  <div class=\"affine-embed-synced-doc-header\">\n                    ${icon}\n                    <span class=\"affine-embed-synced-doc-title\">\n                      ${this.docTitle}\n                    </span>\n                  </div>\n                </div>\n              `}\n          ${isInSurface\n            ? html` <div class=\"affine-embed-synced-doc-editor-overlay\"></div> `\n            : nothing}\n        </div>\n      `\n    );\n  };\n\n  private _initEdgelessFitEffect = () => {\n    const fitToContent = () => {\n      const { _syncedDocMode } = this;\n\n      if (_syncedDocMode !== 'edgeless') return;\n\n      const service = this.syncedDocEditorHost?.std.spec.getService(\n        'affine:page'\n      ) as EdgelessRootService;\n\n      if (!service) return;\n\n      service.viewport.onResize();\n      service.zoomToFit();\n    };\n\n    const observer = new ResizeObserver(fitToContent);\n    const blockElement = this.embedBlock;\n\n    observer.observe(blockElement);\n\n    this._disposables.add(() => {\n      observer.disconnect();\n    });\n\n    this.syncedDocEditorHost?.updateComplete\n      .then(() => {\n        fitToContent();\n      })\n      .catch(() => {});\n  };\n\n  open = () => {\n    const syncedDocId = this.model.pageId;\n    if (syncedDocId === this.doc.id) return;\n\n    const rootElement = this.std.view.viewFromPath('block', [\n      this.doc.root?.id ?? '',\n    ]) as RootBlockComponent | null;\n    assertExists(rootElement);\n\n    rootElement.slots.docLinkClicked.emit({ docId: syncedDocId });\n  };\n\n  covertToInline = () => {\n    const { doc, pageId } = this.model;\n    const parent = doc.getParent(this.model);\n    assertExists(parent);\n    const index = parent.children.indexOf(this.model);\n\n    const yText = new DocCollection.Y.Text();\n    yText.insert(0, REFERENCE_NODE);\n    yText.format(0, REFERENCE_NODE.length, {\n      reference: { type: 'LinkedPage', pageId },\n    });\n    const text = new doc.Text(yText);\n\n    doc.addBlock(\n      'affine:paragraph',\n      {\n        text,\n      },\n      parent,\n      index\n    );\n\n    doc.deleteBlock(this.model);\n  };\n\n  convertToCard = () => {\n    const { id, doc, pageId, caption, xywh } = this.model;\n\n    if (this.isInSurface) {\n      const style = 'vertical';\n      const bound = Bound.deserialize(xywh);\n      bound.w = EMBED_CARD_WIDTH[style];\n      bound.h = EMBED_CARD_HEIGHT[style];\n\n      const edgeless = this.edgeless;\n      assertExists(edgeless);\n      const newId = edgeless.service.addBlock(\n        'affine:embed-linked-doc',\n        { pageId, xywh: bound.serialize(), style, caption },\n        edgeless.surface.model\n      );\n\n      this.std.command.exec('reassociateConnectors', {\n        oldId: id,\n        newId,\n      });\n\n      edgeless.service.selection.set({\n        editing: false,\n        elements: [newId],\n      });\n    } else {\n      const parent = doc.getParent(this.model);\n      assertExists(parent);\n      const index = parent.children.indexOf(this.model);\n\n      doc.addBlock(\n        'affine:embed-linked-doc',\n        { pageId, caption },\n        parent,\n        index\n      );\n\n      this.std.selection.setGroup('note', []);\n    }\n    doc.deleteBlock(this.model);\n  };\n\n  refreshData = () => {\n    this._load().catch(e => {\n      console.error(e);\n      this._error = true;\n    });\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this.style.display = 'block';\n    this._load().catch(e => {\n      console.error(e);\n      this._error = true;\n    });\n\n    this.contentEditable = 'false';\n\n    this.model.propsUpdated.on(({ key }) => {\n      if (key === 'pageId' || key === 'style') {\n        this._load().catch(e => {\n          console.error(e);\n          this._error = true;\n        });\n      }\n    });\n\n    if (this.isInSurface) {\n      const surface = this.surface;\n      assertExists(surface);\n\n      this.disposables.add(\n        this.model.propsUpdated.on(() => {\n          this.requestUpdate();\n        })\n      );\n    }\n\n    this._setDocUpdatedAt();\n    this.disposables.add(\n      this.doc.collection.meta.docMetaUpdated.on(() => {\n        this._setDocUpdatedAt();\n      })\n    );\n\n    this._syncedDocMode = this._rootService.docModeService.getMode(\n      this.model.pageId\n    );\n    this._isEmptySyncedDoc = isEmptyDoc(this.syncedDoc, this._syncedDocMode);\n    this.disposables.add(\n      this._rootService.docModeService.onModeChange(mode => {\n        this._syncedDocMode = mode;\n        this._isEmptySyncedDoc = isEmptyDoc(this.syncedDoc, mode);\n      }, this.model.pageId)\n    );\n\n    this.syncedDoc &&\n      this.disposables.add(\n        this.syncedDoc.slots.blockUpdated.on(() => {\n          this._isEmptySyncedDoc = isEmptyDoc(\n            this.syncedDoc,\n            this._syncedDocMode\n          );\n        })\n      );\n  }\n\n  override firstUpdated() {\n    this.disposables.addFromEvent(this, 'click', e => {\n      e.stopPropagation();\n      if (this._isClickAtBorder(e, this)) {\n        e.preventDefault();\n        this._selectBlock();\n      }\n    });\n\n    // Forward docLinkClicked event from the synced doc\n    const syncedDocRootService =\n      this.syncedDocEditorHost?.std.spec.getService('affine:page');\n    if (syncedDocRootService) {\n      this.disposables.add(\n        syncedDocRootService.slots.docLinkClicked.on(({ docId }) => {\n          this._rootService.slots.docLinkClicked.emit({ docId });\n        })\n      );\n    }\n\n    this._initEdgelessFitEffect();\n  }\n\n  override updated(changedProperties: PropertyValues) {\n    super.updated(changedProperties);\n    this.syncedDocCard?.requestUpdate();\n  }\n\n  override renderBlock() {\n    delete this.dataset.nestedEditor;\n\n    const { style, xywh } = this.model;\n\n    this._cardStyle = style;\n\n    const bound = Bound.deserialize(xywh);\n    this._width = this.isInSurface ? bound.w : EMBED_CARD_WIDTH[style];\n    this._height = this.isInSurface ? bound.h : EMBED_CARD_HEIGHT[style];\n\n    const syncedDoc = this.syncedDoc;\n    const { isLoading, isError, isDeleted, isCycle } = this.blockState;\n    const isInSurface = this.isInSurface;\n    const isCardOnly = this.depth >= 1;\n\n    if (\n      isLoading ||\n      isError ||\n      isDeleted ||\n      isCardOnly ||\n      isCycle ||\n      !syncedDoc\n    ) {\n      let cardStyleMap = styleMap({\n        position: 'relative',\n        display: 'block',\n        width: '100%',\n      });\n      if (isInSurface) {\n        const bound = Bound.deserialize(this.model.xywh);\n        const scaleX = bound.w / EMBED_CARD_WIDTH[style];\n        const scaleY = bound.h / EMBED_CARD_HEIGHT[style];\n        cardStyleMap = styleMap({\n          display: 'block',\n          width: `${EMBED_CARD_WIDTH[style]}px`,\n          height: `${EMBED_CARD_HEIGHT[style]}px`,\n          transform: `scale(${scaleX}, ${scaleY})`,\n          transformOrigin: '0 0',\n        });\n      }\n\n      return this.renderEmbed(\n        () => html`\n          <affine-embed-synced-doc-card\n            style=${cardStyleMap}\n            .block=${this}\n          ></affine-embed-synced-doc-card>\n        `\n      );\n    }\n\n    return this._renderSyncedView();\n  }\n}\n"]}