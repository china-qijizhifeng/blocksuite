{"version":3,"file":"edgeless-text-block.js","sourceRoot":"","sources":["../../src/edgeless-text/edgeless-text-block.ts"],"names":[],"mappings":"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","sourcesContent":["import { BlockElement } from '@blocksuite/block-std';\nimport { html } from 'lit';\nimport { customElement, query } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { isCssVariable } from '../_common/theme/css-variables.js';\nimport { wrapFontFamily } from '../surface-block/utils/font.js';\nimport type { EdgelessTextBlockModel } from './edgeless-text-model.js';\n\nexport const EDGELESS_TEXT_BLOCK_MIN_WIDTH = 50;\nexport const EDGELESS_TEXT_BLOCK_MIN_HEIGHT = 50;\n\n@customElement('affine-edgeless-text')\nexport class EdgelessTextBlockComponent extends BlockElement<EdgelessTextBlockModel> {\n  tryFocusEnd() {\n    const paragraphOrLists = Array.from(\n      this.querySelectorAll<BlockElement>('affine-paragraph, affine-list')\n    );\n    const last = paragraphOrLists.at(-1);\n    if (last) {\n      this.host.selection.setGroup('note', [\n        this.host.selection.create('text', {\n          from: {\n            blockId: last.blockId,\n            index: last.model.text?.length ?? 0,\n            length: 0,\n          },\n          to: null,\n        }),\n      ]);\n    }\n  }\n\n  @query('.affine-block-children-container')\n  accessor childrenContainer!: HTMLDivElement;\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this.disposables.add(\n      this.model.propsUpdated.on(({ key }) => {\n        this.updateComplete\n          .then(() => {\n            const command = this.host.command;\n            const blockSelections = this.model.children.map(child =>\n              this.host.selection.create('block', {\n                blockId: child.id,\n              })\n            );\n\n            if (key === 'fontStyle') {\n              command.exec('formatBlock', {\n                blockSelections,\n                styles: {\n                  italic: null,\n                },\n              });\n            } else if (key === 'color') {\n              command.exec('formatBlock', {\n                blockSelections,\n                styles: {\n                  color: null,\n                },\n              });\n            } else if (key === 'fontWeight') {\n              command.exec('formatBlock', {\n                blockSelections,\n                styles: {\n                  bold: null,\n                },\n              });\n            }\n          })\n          .catch(console.error);\n      })\n    );\n  }\n\n  override renderBlock() {\n    const { color, fontFamily, fontStyle, fontWeight, textAlign } = this.model;\n\n    const style = styleMap({\n      color: isCssVariable(color) ? `var(${color})` : color,\n      fontFamily: wrapFontFamily(fontFamily),\n      fontStyle,\n      fontWeight,\n      textAlign,\n    });\n\n    return html`\n      <div style=${style} class=\"affine-edgeless-text-block-container\">\n        <div class=\"affine-block-children-container\">\n          ${this.renderChildren(this.model)}\n        </div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-edgeless-text': EdgelessTextBlockComponent;\n  }\n}\n"]}