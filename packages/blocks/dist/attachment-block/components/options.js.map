{"version":3,"file":"options.js","sourceRoot":"","sources":["../../../src/attachment-block/components/options.ts"],"names":[],"mappings":"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","sourcesContent":["import { assertExists } from '@blocksuite/global/utils';\nimport { flip, offset } from '@floating-ui/dom';\nimport { html } from 'lit';\nimport { createRef, ref, type RefOrCallback } from 'lit/directives/ref.js';\n\nimport { createLitPortal } from '../../_common/components/portal.js';\nimport {\n  BookmarkIcon,\n  CaptionIcon,\n  EditIcon,\n  EmbedWebIcon,\n  LinkIcon,\n  MoreIcon,\n  ViewIcon,\n} from '../../_common/icons/index.js';\nimport { stopPropagation } from '../../_common/utils/event.js';\nimport type { AttachmentBlockComponent } from '../attachment-block.js';\nimport type { AttachmentBlockModel } from '../attachment-model.js';\nimport { allowEmbed, convertToEmbed } from '../embed.js';\nimport { MoreMenu } from './more-menu.js';\nimport { RenameModal } from './rename-model.js';\nimport { styles } from './styles.js';\n\nexport function AttachmentOptionsTemplate({\n  anchor,\n  model,\n  showCaption,\n  downloadAttachment,\n  abortController,\n  ref: refOrCallback = createRef<HTMLDivElement>(),\n}: {\n  anchor: AttachmentBlockComponent;\n  model: AttachmentBlockModel;\n  downloadAttachment: (model: AttachmentBlockModel) => void | Promise<void>;\n  showCaption: () => void;\n  abortController: AbortController;\n  ref?: RefOrCallback;\n}) {\n  let containerEl: Element | undefined;\n  const refCallback = (el: Element | undefined) => {\n    containerEl = el;\n\n    if (!refCallback) return;\n    // See also https://github.com/lit/lit/blob/c134604f178e36444261d83eabe9e578c1ed90c4/packages/lit-html/src/directives/ref.ts\n    typeof refOrCallback === 'function'\n      ? refOrCallback(el)\n      : ((\n          refOrCallback as {\n            // RefInternal\n            value: Element | undefined;\n          }\n        ).value = el);\n  };\n\n  const disableEmbed = !allowEmbed(model, anchor.service.maxFileSize);\n  const readonly = model.doc.readonly;\n  let moreMenuAbortController: AbortController | null = null;\n  return html`<style>\n      ${styles}\n    </style>\n\n    <div\n      ${ref(refCallback)}\n      class=\"affine-attachment-options\"\n      @pointerdown=${stopPropagation}\n    >\n      <icon-button size=\"32px\" ?hidden=${true}>\n        ${ViewIcon}\n        <affine-tooltip .offset=${12}>Preview</affine-tooltip>\n      </icon-button>\n      <div class=\"divider\" ?hidden=${true}></div>\n\n      <icon-button size=\"32px\" ?hidden=${true}>\n        ${LinkIcon}\n        <affine-tooltip .offset=${12}>Turn into Link view</affine-tooltip>\n      </icon-button>\n\n      <icon-button\n        size=\"32px\"\n        ?hidden=${!model.embed}\n        ?disabled=${readonly}\n        @click=\"${() => {\n          model.doc.updateBlock(model, { embed: false });\n          abortController.abort();\n        }}\"\n      >\n        ${BookmarkIcon}\n        <affine-tooltip .offset=${12}>Turn into Card view</affine-tooltip>\n      </icon-button>\n\n      <icon-button\n        size=\"32px\"\n        ?hidden=${model.embed}\n        ?disabled=${readonly || disableEmbed}\n        @click=\"${() => {\n          convertToEmbed(model, anchor.service.maxFileSize);\n          abortController.abort();\n        }}\"\n      >\n        ${EmbedWebIcon}\n        <affine-tooltip .offset=${12}>Turn into Embed view</affine-tooltip>\n      </icon-button>\n      <div class=\"divider\"></div>\n\n      <icon-button\n        size=\"32px\"\n        ?hidden=${readonly}\n        @click=\"${() => {\n          abortController.abort();\n          const renameAbortController = new AbortController();\n          createLitPortal({\n            template: RenameModal({\n              editorHost: anchor.host,\n              model,\n              abortController: renameAbortController,\n            }),\n            computePosition: {\n              referenceElement: anchor,\n              placement: 'top-start',\n              middleware: [flip(), offset(4)],\n              // It has a overlay mask, so we don't need to update the position.\n              // autoUpdate: true,\n            },\n            abortController: renameAbortController,\n          });\n        }}\"\n      >\n        ${EditIcon}\n        <affine-tooltip .offset=${12}>Rename</affine-tooltip>\n      </icon-button>\n      <icon-button\n        size=\"32px\"\n        ?hidden=${readonly}\n        @click=${() => {\n          showCaption();\n        }}\n      >\n        ${CaptionIcon}\n        <affine-tooltip .offset=${12}>Caption</affine-tooltip>\n      </icon-button>\n      <div class=\"divider\" ?hidden=${readonly}></div>\n      <icon-button\n        size=\"32px\"\n        class=\"more-button\"\n        @click=${() => {\n          if (moreMenuAbortController) {\n            moreMenuAbortController.abort();\n            moreMenuAbortController = null;\n            return;\n          }\n          moreMenuAbortController = new AbortController();\n\n          assertExists(containerEl);\n          createLitPortal({\n            container: containerEl,\n            template: MoreMenu({ model, abortController, downloadAttachment }),\n            abortController: moreMenuAbortController,\n            computePosition: {\n              referenceElement: containerEl,\n              placement: 'top-end',\n              middleware: [flip()],\n            },\n          });\n        }}\n      >\n        ${MoreIcon}\n        <affine-tooltip .offset=${12}>More</affine-tooltip>\n      </icon-button>\n    </div>`;\n}\n"]}