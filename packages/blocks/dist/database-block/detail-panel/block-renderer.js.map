{"version":3,"file":"block-renderer.js","sourceRoot":"","sources":["../../../src/database-block/detail-panel/block-renderer.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EditorHost } from '@blocksuite/block-std';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { css, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { DetailSlotProps } from '../data-view/common/data-source/base.js';\nimport type { DataViewKanbanManager } from '../data-view/view/presets/kanban/kanban-view-manager.js';\nimport type { DataViewTableManager } from '../data-view/view/presets/table/table-view-manager.js';\n\n@customElement('database-datasource-block-renderer')\nexport class BlockRenderer\n  extends WithDisposable(ShadowlessElement)\n  implements DetailSlotProps\n{\n  get model() {\n    return this.host?.doc.getBlock(this.rowId)?.model;\n  }\n\n  get service() {\n    return this.host.std.spec.getService('affine:database');\n  }\n\n  get inlineManager() {\n    return this.service.inlineManager;\n  }\n\n  get attributesSchema() {\n    return this.inlineManager.getSchema();\n  }\n\n  get attributeRenderer() {\n    return this.inlineManager.getRenderer();\n  }\n\n  static override styles = css`\n    database-datasource-block-renderer {\n      padding-bottom: 16px;\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n      margin-bottom: 12px;\n      border-bottom: 1px solid var(--affine-border-color);\n      font-size: var(--affine-font-base);\n      line-height: var(--affine-line-height);\n    }\n\n    database-datasource-block-renderer .tips-placeholder {\n      display: none;\n    }\n\n    .database-block-detail-header-icon {\n      width: 20px;\n      height: 20px;\n      padding: 2px;\n      border-radius: 4px;\n      background-color: var(--affine-background-secondary-color);\n    }\n\n    .database-block-detail-header-icon svg {\n      width: 16px;\n      height: 16px;\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor view!: DataViewTableManager | DataViewKanbanManager;\n\n  @property({ attribute: false })\n  accessor rowId!: string;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  protected override render(): unknown {\n    const model = this.model;\n    if (!model) {\n      return;\n    }\n    return html`\n      ${this.renderIcon()}\n      <rich-text\n        .yText=${model.text}\n        .attributesSchema=${this.attributesSchema}\n        .attributeRenderer=${this.attributeRenderer}\n        .embedChecker=${this.inlineManager.embedChecker}\n        .markdownShortcutHandler=${this.inlineManager.markdownShortcutHandler}\n        class=\"inline-editor\"\n      ></rich-text>\n    `;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._disposables.addFromEvent(\n      this,\n      'keydown',\n      e => {\n        if (e.key === 'Enter' && !e.shiftKey && !e.isComposing) {\n          e.stopPropagation();\n          e.preventDefault();\n          return;\n        }\n        if (\n          e.key === 'Backspace' &&\n          !e.shiftKey &&\n          !e.metaKey &&\n          this.model?.text?.length === 0\n        ) {\n          e.stopPropagation();\n          e.preventDefault();\n          return;\n        }\n      },\n      true\n    );\n  }\n\n  renderIcon() {\n    const iconColumn = this.view.header.iconColumn;\n    if (!iconColumn) {\n      return;\n    }\n    return html` <div class=\"database-block-detail-header-icon\">\n      ${this.view.cellGetValue(this.rowId, iconColumn)}\n    </div>`;\n  }\n}\n"]}