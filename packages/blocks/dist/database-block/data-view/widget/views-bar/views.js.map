{"version":3,"file":"views.js","sourceRoot":"","sources":["../../../../../src/database-block/data-view/widget/views-bar/views.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../common/component/overflow/overflow.js';\n\nimport { css, html } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\n\nimport {\n  popFilterableSimpleMenu,\n  popMenu,\n} from '../../../../_common/components/index.js';\nimport {\n  AddCursorIcon,\n  DuplicateIcon,\n  MoreHorizontalIcon,\n  MoveLeftIcon,\n  MoveRightIcon,\n} from '../../../../_common/icons/index.js';\nimport { DeleteIcon } from '../../common/icons/index.js';\nimport type { SingleViewSource } from '../../common/index.js';\nimport { renderUniLit } from '../../utils/uni-component/index.js';\nimport { WidgetBase } from '../widget-base.js';\n\n@customElement('data-view-header-views')\nexport class DataViewHeaderViews extends WidgetBase {\n  get readonly() {\n    return this.viewSource.readonly;\n  }\n\n  static override styles = css`\n    data-view-header-views {\n      height: 32px;\n      display: flex;\n      user-select: none;\n      gap: 4px;\n    }\n    data-view-header-views::-webkit-scrollbar-thumb {\n      width: 1px;\n    }\n\n    .database-view-button {\n      height: 100%;\n      cursor: pointer;\n      padding: 4px 8px;\n      border-radius: 4px;\n      font-size: 14px;\n      display: flex;\n      align-items: center;\n      color: var(--affine-text-secondary-color);\n      white-space: nowrap;\n    }\n\n    .database-view-button .name {\n      align-items: center;\n      height: 22px;\n      max-width: 100px;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n\n    .database-view-button .icon {\n      margin-right: 6px;\n      display: block;\n    }\n\n    .database-view-button .icon svg {\n      width: 16px;\n      height: 16px;\n    }\n\n    .database-view-button.active {\n      color: var(--affine-text-primary-color);\n      background-color: var(--affine-hover-color-filled);\n    }\n  `;\n\n  private getRenderer(view: SingleViewSource) {\n    return this.viewSource.getViewMeta(view.view.mode).renderer;\n  }\n\n  _addViewMenu = (event: MouseEvent) => {\n    popFilterableSimpleMenu(\n      event.target as HTMLElement,\n      this.viewSource.allViewMeta.map(v => {\n        return {\n          type: 'action',\n          name: v.model.defaultName,\n          icon: html`<uni-lit .uni=${v.renderer.icon}></uni-lit>`,\n          select: () => {\n            const id = this.viewSource.viewAdd(v.type);\n            this.viewSource.selectView(id);\n          },\n        };\n      })\n    );\n  };\n\n  _showMore = (event: MouseEvent) => {\n    const views = this.viewSource.views;\n    popFilterableSimpleMenu(event.target as HTMLElement, [\n      ...views.map(v => {\n        const openViewOption = (event: MouseEvent) => {\n          event.stopPropagation();\n          this.openViewOption(event.target as HTMLElement, v.view.id);\n        };\n        return {\n          type: 'action' as const,\n          icon: html`<uni-lit .uni=${this.getRenderer(v).icon}></uni-lit>`,\n          name: v.view.name,\n          isSelected: this.viewSource.currentViewId === v.view.id,\n          select: () => {\n            this.viewSource.selectView(v.view.id);\n          },\n          postfix: html`<div\n            class=\"dv-hover dv-round-4\"\n            @click=\"${openViewOption}\"\n            style=\"display:flex;align-items:center;\"\n          >\n            ${MoreHorizontalIcon}\n          </div>`,\n        };\n      }),\n      {\n        type: 'group',\n        name: '',\n        hide: () => this.readonly,\n        children: () =>\n          this.viewSource.allViewMeta.map(v => {\n            return {\n              type: 'action',\n              name: `Create ${v.model.defaultName}`,\n              icon: html`<uni-lit .uni=${v.renderer.icon}></uni-lit>`,\n              select: () => {\n                const id = this.viewSource.viewAdd(v.type);\n                this.viewSource.selectView(id);\n              },\n            };\n          }),\n      },\n    ]);\n  };\n\n  openViewOption = (target: HTMLElement, id: string) => {\n    if (this.readonly) {\n      return;\n    }\n    const views = this.viewSource.views;\n    const index = views.findIndex(v => v.view.id === id);\n    const view = views[index];\n    if (!view) {\n      return;\n    }\n    popMenu(target, {\n      options: {\n        input: {\n          initValue: view.view.name,\n          onComplete: text => {\n            view.updateView(_data => ({\n              name: text,\n            }));\n          },\n        },\n        items: [\n          {\n            type: 'action',\n            name: 'Edit View',\n            icon: renderUniLit(this.getRenderer(view).icon, {}),\n            select: () => {\n              this.closest('affine-data-view-renderer')\n                ?.querySelector('data-view-header-tools-view-options')\n                ?.openMoreAction(target);\n            },\n          },\n          {\n            type: 'action',\n            name: 'Move Left',\n            hide: () => index === 0,\n            icon: MoveLeftIcon,\n            select: () => {\n              const target = views[index - 1];\n              this.viewSource.moveTo(\n                view.view.id,\n                target ? { before: true, id: target.view.id } : 'start'\n              );\n            },\n          },\n          {\n            type: 'action',\n            name: 'Move Right',\n            icon: MoveRightIcon,\n            hide: () => index === views.length - 1,\n            select: () => {\n              const target = views[index + 1];\n              this.viewSource.moveTo(\n                view.view.id,\n                target ? { before: false, id: target.view.id } : 'end'\n              );\n            },\n          },\n          {\n            type: 'action',\n            name: 'Duplicate',\n            icon: DuplicateIcon,\n            select: () => {\n              this.viewSource.duplicate(view.view.id);\n            },\n          },\n          {\n            type: 'group',\n            name: '',\n            children: () => [\n              {\n                type: 'action',\n                name: 'Delete View',\n                icon: DeleteIcon,\n                select: () => {\n                  view.delete();\n                },\n                class: 'delete-item',\n              },\n            ],\n          },\n        ],\n      },\n    });\n  };\n\n  _clickView(event: MouseEvent, id: string) {\n    if (this.viewSource.currentViewId !== id) {\n      this.viewSource.selectView(id);\n      return;\n    }\n    this.openViewOption(event.target as HTMLElement, id);\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.disposables.add(\n      this.viewSource.updateSlot.on(() => {\n        this.requestUpdate();\n      })\n    );\n  }\n\n  renderMore = (count: number) => {\n    const views = this.viewSource.views;\n    if (count === views.length) {\n      if (this.readonly) {\n        return;\n      }\n      return html`<div\n        class=\"database-view-button dv-icon-16 dv-hover\"\n        @click=\"${this._addViewMenu}\"\n      >\n        ${AddCursorIcon}\n      </div>`;\n    }\n    return html`\n      <div class=\"database-view-button dv-hover\" @click=\"${this._showMore}\">\n        ${views.length - count} More\n      </div>\n    `;\n  };\n\n  renderViews = () => {\n    const views = this.viewSource.views;\n    return views.map(view => () => {\n      const classList = classMap({\n        'database-view-button': true,\n        'dv-hover': true,\n        active: this.viewSource.currentViewId === view.view.id,\n      });\n      return html`\n        <div\n          class=\"${classList}\"\n          style=\"margin-right: 4px;\"\n          @click=\"${(event: MouseEvent) =>\n            this._clickView(event, view.view.id)}\"\n        >\n          <uni-lit class=\"icon\" .uni=\"${this.getRenderer(view).icon}\"></uni-lit>\n          <div class=\"name\">${view.view.name}</div>\n        </div>\n      `;\n    });\n  };\n\n  override render() {\n    return html`\n      <component-overflow\n        .renderItem=\"${this.renderViews()}\"\n        .renderMore=\"${this.renderMore}\"\n      ></component-overflow>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'data-view-header-views': DataViewHeaderViews;\n  }\n}\n"]}