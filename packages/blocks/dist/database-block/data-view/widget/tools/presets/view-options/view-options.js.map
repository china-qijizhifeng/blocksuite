{"version":3,"file":"view-options.js","sourceRoot":"","sources":["../../../../../../../src/database-block/data-view/widget/tools/presets/view-options/view-options.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html } from 'lit';\nimport { customElement } from 'lit/decorators.js';\n\nimport { popMenu } from '../../../../../../_common/components/index.js';\nimport {\n  ArrowRightSmallIcon,\n  DeleteIcon,\n  DuplicateIcon,\n  MoreHorizontalIcon,\n} from '../../../../../../_common/icons/index.js';\nimport {\n  popGroupSetting,\n  popSelectGroupByProperty,\n} from '../../../../common/group-by/setting.js';\nimport {\n  FilterIcon,\n  GroupingIcon,\n  InfoIcon,\n} from '../../../../common/icons/index.js';\nimport { popPropertiesSetting } from '../../../../common/properties.js';\nimport type { DataViewKanbanManager } from '../../../../view/presets/kanban/kanban-view-manager.js';\nimport type { DataViewTableManager } from '../../../../view/presets/table/table-view-manager.js';\nimport { popFilterModal } from '../../../filter/filter-modal.js';\nimport { WidgetBase } from '../../../widget-base.js';\n\nconst styles = css`\n  .affine-database-toolbar-item.more-action {\n    padding: 2px;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    cursor: pointer;\n  }\n\n  .affine-database-toolbar-item.more-action:hover {\n    background: var(--affine-hover-color);\n  }\n\n  .affine-database-toolbar-item.more-action svg {\n    width: 20px;\n    height: 20px;\n    fill: var(--affine-icon-color);\n  }\n\n  .more-action.active {\n    background: var(--affine-hover-color);\n  }\n`;\n\n@customElement('data-view-header-tools-view-options')\nexport class DataViewHeaderToolsViewOptions extends WidgetBase {\n  static override styles = styles;\n\n  override accessor view!: DataViewTableManager | DataViewKanbanManager;\n\n  showToolBar(show: boolean) {\n    const tools = this.closest('data-view-header-tools');\n    if (tools) {\n      tools.showToolBar = show;\n    }\n  }\n\n  openMoreAction = (target: HTMLElement) => {\n    this.showToolBar(true);\n    popViewOptions(target, this.view, () => {\n      this.showToolBar(false);\n    });\n  };\n\n  clickMoreAction = (e: MouseEvent) => {\n    e.stopPropagation();\n    this.openMoreAction(e.target as HTMLElement);\n  };\n\n  override render() {\n    if (this.view.readonly) {\n      return;\n    }\n    return html` <div\n      class=\"affine-database-toolbar-item more-action dv-icon-20\"\n      @click=\"${this.clickMoreAction}\"\n    >\n      ${MoreHorizontalIcon}\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'data-view-header-tools-view-options': DataViewHeaderToolsViewOptions;\n  }\n}\nexport const popViewOptions = (\n  target: HTMLElement,\n  view: DataViewTableManager | DataViewKanbanManager,\n  onClose?: () => void\n) => {\n  const reopen = () => {\n    popViewOptions(target, view);\n  };\n  popMenu(target, {\n    options: {\n      style: 'min-width:300px',\n      input: {\n        initValue: view.name,\n        onComplete: text => {\n          view.updateName(text);\n        },\n      },\n      items: [\n        {\n          type: 'action',\n          name: 'Properties',\n          icon: InfoIcon,\n          postfix: ArrowRightSmallIcon,\n          select: () => {\n            requestAnimationFrame(() => {\n              popPropertiesSetting(target, {\n                view: view,\n                onBack: reopen,\n              });\n            });\n          },\n        },\n        {\n          type: 'action',\n          name: 'Filter',\n          icon: FilterIcon,\n          postfix: ArrowRightSmallIcon,\n          select: () => {\n            popFilterModal(target, {\n              vars: view.vars,\n              value: view.filter,\n              onChange: view.updateFilter.bind(view),\n              isRoot: true,\n              onBack: reopen,\n              onDelete: () => {\n                view.updateFilter({\n                  ...view.filter,\n                  conditions: [],\n                });\n              },\n            });\n          },\n        },\n        {\n          type: 'action',\n          name: 'Group',\n          icon: GroupingIcon,\n          postfix: ArrowRightSmallIcon,\n          select: () => {\n            const groupBy = view.view.groupBy;\n            if (!groupBy) {\n              popSelectGroupByProperty(target, view);\n            } else {\n              popGroupSetting(target, view, reopen);\n            }\n          },\n        },\n        {\n          type: 'action',\n          name: 'Duplicate',\n          icon: DuplicateIcon,\n          select: () => {\n            view.duplicateView();\n          },\n        },\n        {\n          type: 'group',\n          name: '',\n          children: () => [\n            {\n              type: 'action',\n              name: 'Delete View',\n              icon: DeleteIcon,\n              select: () => {\n                view.deleteView();\n              },\n              class: 'delete-item',\n            },\n          ],\n        },\n      ],\n      onClose: onClose,\n    },\n  });\n};\n"]}