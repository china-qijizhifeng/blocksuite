{"version":3,"file":"filter.js","sourceRoot":"","sources":["../../../../../../../src/database-block/data-view/widget/tools/presets/filter/filter.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,iCAAiC,CAAC;AAEzC,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AACzC,OAAO,EAAE,aAAa,EAAE,MAAM,mBAAmB,CAAC;AAGlD,OAAO,EAAE,UAAU,EAAE,MAAM,mCAAmC,CAAC;AAC/D,OAAO,EAAE,eAAe,EAAE,MAAM,+BAA+B,CAAC;AAChE,OAAO,EAAE,UAAU,EAAE,MAAM,yBAAyB,CAAC;AAErD,MAAM,MAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;CAoBjB,CAAC;IAGW,yBAAyB;4BADrC,aAAa,CAAC,+BAA+B,CAAC;;;;sBACA,UAAU;yCAAlB,SAAQ,WAAU;;;;YAAzD,6KA6DC;;;;QA5DC,IAAY,QAAQ;YAClB,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;QAC5B,CAAC;QAED,IAAY,OAAO;YACjB,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;QAC1B,CAAC;QAED,IAAY,OAAO,CAAC,MAAmB;YACrC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QACjC,CAAC;iBAEe,WAAM,GAAG,MAAM,AAAT,CAAU;QAExB,SAAS,CAAC,KAAiB;YACjC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;gBAChE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;gBACvB,eAAe,CAAC,KAAK,CAAC,MAAqB,EAAE;oBAC3C,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI;oBACpB,QAAQ,EAAE,MAAM,CAAC,EAAE;wBACjB,IAAI,CAAC,OAAO,GAAG;4BACb,GAAG,IAAI,CAAC,OAAO;4BACf,UAAU,EAAE,CAAC,MAAM,CAAC;yBACrB,CAAC;wBACF,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;oBACnC,CAAC;oBACD,OAAO,EAAE,GAAG,EAAE;wBACZ,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;oBAC1B,CAAC;iBACF,CAAC,CAAC;gBACH,OAAO;YACT,CAAC;YACD,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACvD,CAAC;QAEQ,iBAAiB;YACxB,KAAK,CAAC,iBAAiB,EAAE,CAAC;YAC1B,IAAI,CAAC,WAAW,CAAC,GAAG,CAClB,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG,EAAE;gBAC7B,IAAI,CAAC,aAAa,EAAE,CAAC;YACvB,CAAC,CAAC,CACH,CAAC;QACJ,CAAC;QAED,WAAW,CAAC,IAAa;YACvB,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,wBAAwB,CAAC,CAAC;YACrD,IAAI,KAAK,EAAE,CAAC;gBACV,KAAK,CAAC,WAAW,GAAG,IAAI,CAAC;YAC3B,CAAC;QACH,CAAC;QAEQ,MAAM;YACb,IAAI,IAAI,CAAC,QAAQ;gBAAE,OAAO,OAAO,CAAC;YAClC,OAAO,IAAI,CAAA;gBACC,IAAI,CAAC,SAAS;;;QAGtB,UAAU;WACP,CAAC;QACV,CAAC;;YA5DU,uDAAyB;;;;;SAAzB,yBAAyB","sourcesContent":["import '../../../filter/filter-group.js';\n\nimport { css, html, nothing } from 'lit';\nimport { customElement } from 'lit/decorators.js';\n\nimport type { FilterGroup } from '../../../../common/ast.js';\nimport { FilterIcon } from '../../../../common/icons/index.js';\nimport { popCreateFilter } from '../../../../common/ref/ref.js';\nimport { WidgetBase } from '../../../widget-base.js';\n\nconst styles = css`\n  .affine-database-filter-button {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 12px;\n    line-height: 20px;\n    padding: 2px 4px;\n    border-radius: 4px;\n    cursor: pointer;\n  }\n\n  .affine-database-filter-button:hover {\n    background-color: var(--affine-hover-color);\n  }\n\n  .affine-database-filter-button svg {\n    width: 20px;\n    height: 20px;\n  }\n`;\n\n@customElement('data-view-header-tools-filter')\nexport class DataViewHeaderToolsFilter extends WidgetBase {\n  private get readonly() {\n    return this.view.readonly;\n  }\n\n  private get _filter() {\n    return this.view.filter;\n  }\n\n  private set _filter(filter: FilterGroup) {\n    this.view.updateFilter(filter);\n  }\n\n  static override styles = styles;\n\n  private addFilter(event: MouseEvent) {\n    if (!this._filter.conditions.length && !this.view.filterVisible) {\n      this.showToolBar(true);\n      popCreateFilter(event.target as HTMLElement, {\n        vars: this.view.vars,\n        onSelect: filter => {\n          this._filter = {\n            ...this._filter,\n            conditions: [filter],\n          };\n          this.view.filterSetVisible(true);\n        },\n        onClose: () => {\n          this.showToolBar(false);\n        },\n      });\n      return;\n    }\n    this.view.filterSetVisible(!this.view.filterVisible);\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.disposables.add(\n      this.view.slots.update.on(() => {\n        this.requestUpdate();\n      })\n    );\n  }\n\n  showToolBar(show: boolean) {\n    const tools = this.closest('data-view-header-tools');\n    if (tools) {\n      tools.showToolBar = show;\n    }\n  }\n\n  override render() {\n    if (this.readonly) return nothing;\n    return html`<div\n      @click=\"${this.addFilter}\"\n      class=\"affine-database-filter-button dv-icon-20\"\n    >\n      ${FilterIcon} Filter\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'data-view-header-tools-filter': DataViewHeaderToolsFilter;\n  }\n}\n"]}