{"version":3,"file":"data-view.js","sourceRoot":"","sources":["../../../../src/database-block/data-view/view/data-view.ts"],"names":[],"mappings":"AAuGA,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAsB,IAAU,EAAE,EAAE,CAAC,CAAC;IAC5D,IAAI;IACJ,WAAW,EAAE,CACX,KAA2B,EAC3B,EAAE,CAAC,CAAC;QACJ,IAAI;QACJ,KAAK;QACL,cAAc,EAAE,CAAC,QAAgC,EAAE,EAAE,CAAC,CAAC;YACrD,IAAI;YACJ,KAAK;YACL,QAAQ;SACT,CAAC;KACH,CAAC;CACH,CAAC,CAAC;AAEH,MAAM,OAAO,mBAAmB;IAAhC;QACE,8DAA8D;QACtD,QAAG,GAAG,IAAI,GAAG,EAAkC,CAAC;IAa1D,CAAC;IAXC,OAAO,CAAC,IAAY;QAClB,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAChC,IAAI,CAAC,IAAI,EAAE,CAAC;YACV,MAAM,IAAI,KAAK,CAAC,GAAG,IAAI,eAAe,CAAC,CAAC;QAC1C,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAED,IAAI,GAAG;QACL,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC;IACvC,CAAC;CACF;AAED,MAAM,CAAC,MAAM,mBAAmB,GAAG,IAAI,mBAAmB,EAAE,CAAC","sourcesContent":["import type {\n  BlockStdScope,\n  EventName,\n  UIEventHandler,\n} from '@blocksuite/block-std';\nimport type { Disposable, Slot } from '@blocksuite/global/utils';\nimport type { Doc } from '@blocksuite/store';\n\nimport type { DataSource } from '../common/data-source/base.js';\nimport type { ViewSource } from '../common/index.js';\nimport type { DataViewRenderer } from '../data-view.js';\nimport type { DataViewSelection, InsertToPosition } from '../types.js';\nimport type { UniComponent } from '../utils/uni-component/index.js';\nimport type { DataViewWidget } from '../widget/types.js';\nimport type { DataViewManagerBase } from './data-view-manager.js';\nimport type { DataViewManager } from './data-view-manager.js';\n\nexport interface DataViewProps<\n  T extends DataViewManager = DataViewManager,\n  Selection extends DataViewSelection = DataViewSelection,\n> {\n  dataViewEle: DataViewRenderer;\n\n  headerWidget?: DataViewWidget;\n\n  view: T;\n  viewSource: ViewSource;\n  dataSource: DataSource;\n\n  bindHotkey: (hotkeys: Record<string, UIEventHandler>) => Disposable;\n\n  handleEvent: (name: EventName, handler: UIEventHandler) => Disposable;\n\n  setSelection: (selection?: Selection) => void;\n\n  selectionUpdated: Slot<Selection | undefined>;\n\n  onDrag?: (evt: MouseEvent, id: string) => () => void;\n\n  getFlag?: Doc['awarenessStore']['getFlag'];\n\n  std: BlockStdScope;\n}\n\nexport interface DataViewExpose {\n  addRow?(position: InsertToPosition | number): void;\n\n  getSelection?(): DataViewSelection | undefined;\n\n  focusFirstCell(): void;\n\n  showIndicator?(evt: MouseEvent): boolean;\n\n  hideIndicator?(): void;\n\n  moveTo?(id: string, evt: MouseEvent): void;\n}\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-empty-interface\n  export interface DataViewDataTypeMap {}\n}\nexport type BasicViewDataType<\n  Type extends string = string,\n  T = NonNullable<unknown>,\n> = {\n  id: string;\n  name: string;\n  mode: Type;\n} & T;\nexport type _DataViewDataTypeMap = {\n  [K in keyof DataViewDataTypeMap]: BasicViewDataType<\n    Extract<K, string>,\n    DataViewDataTypeMap[K]\n  >;\n};\nexport type DefaultViewDataType = BasicViewDataType & { mode: string };\ntype FallBack<T> = [T] extends [never] ? DefaultViewDataType : T;\nexport type DataViewDataType = FallBack<\n  _DataViewDataTypeMap[keyof _DataViewDataTypeMap]\n>;\nexport type DataViewTypes = keyof DataViewDataTypeMap;\nexport interface DataViewConfig<\n  Data extends DataViewDataType = DataViewDataType,\n> {\n  defaultName: string;\n  dataViewManager: new () => DataViewManagerBase<Data>;\n}\n\nexport interface DataViewRendererConfig {\n  view: UniComponent<DataViewProps, DataViewExpose>;\n  icon: UniComponent;\n}\n\nexport type ViewMeta<\n  Type extends string = DataViewTypes,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  Data extends DataViewDataType = any,\n> = {\n  type: Type;\n  model: DataViewConfig<Data>;\n  renderer: DataViewRendererConfig;\n};\nexport const viewType = <Type extends string>(type: Type) => ({\n  type,\n  modelConfig: <Data extends DataViewDataType>(\n    model: DataViewConfig<Data>\n  ) => ({\n    type,\n    model,\n    rendererConfig: (renderer: DataViewRendererConfig) => ({\n      type,\n      model,\n      renderer,\n    }),\n  }),\n});\n\nexport class ViewRendererManager {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private map = new Map<string, DataViewRendererConfig>();\n\n  getView(type: string): DataViewRendererConfig {\n    const view = this.map.get(type);\n    if (!view) {\n      throw new Error(`${type} is not exist`);\n    }\n    return view;\n  }\n\n  get all() {\n    return Array.from(this.map.values());\n  }\n}\n\nexport const viewRendererManager = new ViewRendererManager();\n"]}