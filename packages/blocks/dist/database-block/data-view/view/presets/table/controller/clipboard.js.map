{"version":3,"file":"clipboard.js","sourceRoot":"","sources":["../../../../../../../src/database-block/data-view/view/presets/table/controller/clipboard.ts"],"names":[],"mappings":"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","sourcesContent":["import type { UIEventStateContext } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { Y } from '@blocksuite/store';\nimport type { ReactiveController } from 'lit';\n\nimport type { DatabaseCellContainer } from '../components/cell-container.js';\nimport type { DataViewTable } from '../table-view.js';\nimport type { DataViewTableManager } from '../table-view-manager.js';\nimport type { TableViewSelection } from '../types.js';\n\nconst BLOCKSUITE_DATABASE = 'blocksuite/database';\nconst TEXT = 'text/plain';\n\nexport class TableClipboardController implements ReactiveController {\n  private get readonly() {\n    return this.host.view.readonly;\n  }\n\n  private get std() {\n    return this.host.std;\n  }\n\n  constructor(public host: DataViewTable) {\n    host.addController(this);\n  }\n\n  private _onCopy = (\n    _context: UIEventStateContext,\n    tableSelection: TableViewSelection,\n    isCut = false\n  ) => {\n    const view = this.host;\n    const data = this.host.view;\n\n    // cells\n    // For database paste inside.\n    const copiedValues = getCopiedValuesFromSelection(\n      tableSelection,\n      data,\n      view\n    );\n\n    // For database paste outside(raw text).\n    const cellsValue = copyCellsValue(tableSelection, data, view, isCut);\n    const formatValue = cellsValue.map(value => value.join('\\t')).join('\\n');\n    this.std.clipboard\n      .writeToClipboard(items => {\n        return {\n          ...items,\n          [TEXT]: formatValue,\n          [BLOCKSUITE_DATABASE]: JSON.stringify(copiedValues),\n        };\n      })\n      .catch(console.error);\n\n    return true;\n  };\n\n  private _onCut = (\n    _context: UIEventStateContext,\n    tableSelection: TableViewSelection\n  ) => {\n    this._onCopy(_context, tableSelection, true);\n  };\n\n  private _onPaste = async (_context: UIEventStateContext) => {\n    const event = _context.get('clipboardState').raw;\n    event.stopPropagation();\n    const view = this.host;\n    const data = this.host.view;\n\n    const clipboardData = event.clipboardData;\n    if (!clipboardData) return;\n\n    const tableSelection = this.host.selectionController.selection;\n    if (tableSelection) {\n      const json = await this.std.clipboard.readFromClipboard(clipboardData);\n      const copiedValues = json[BLOCKSUITE_DATABASE];\n      if (!copiedValues) return;\n      const copyedSelectionData = JSON.parse(\n        copiedValues\n      ) as CopyedSelectionData;\n\n      // paste cells\n      const targetRange = getTargetRangeFromSelection(tableSelection, data);\n      let rowStartIndex = targetRange.row.start;\n      let columnStartIndex = targetRange.column.start;\n      let rowLength = targetRange.row.length;\n      let columnLength = targetRange.column.length;\n\n      if (targetRange.anchor) {\n        rowStartIndex = tableSelection.focus.rowIndex;\n        columnStartIndex = tableSelection.focus.columnIndex;\n        rowLength = copyedSelectionData.length;\n        columnLength = copyedSelectionData[0].length;\n      }\n\n      pasteToCells(\n        data,\n        view,\n        copyedSelectionData,\n        tableSelection.groupKey,\n        rowStartIndex,\n        columnStartIndex,\n        rowLength,\n        columnLength\n      );\n    }\n\n    return true;\n  };\n\n  hostConnected() {\n    this.host.disposables.add(\n      this.host.handleEvent('copy', ctx => {\n        const tableSelection = this.host.selectionController.selection;\n        if (!tableSelection) return false;\n\n        this._onCopy(ctx, tableSelection);\n        return true;\n      })\n    );\n\n    this.host.disposables.add(\n      this.host.handleEvent('cut', ctx => {\n        const tableSelection = this.host.selectionController.selection;\n        if (!tableSelection) return false;\n\n        this._onCut(ctx, tableSelection);\n        return true;\n      })\n    );\n\n    this.host.disposables.add(\n      this.host.handleEvent('paste', ctx => {\n        if (this.readonly) return false;\n\n        this._onPaste(ctx).catch(console.error);\n        return true;\n      })\n    );\n  }\n}\n\nfunction getColumnValue(container: DatabaseCellContainer | undefined) {\n  const rowId = container?.dataset.rowId;\n  assertExists(rowId);\n  return container?.column.getStringValue(rowId) ?? '';\n}\n\n/**\n * Columns that do not support cut operation yet\n */\nconst UNSUPPORTED_COLUMNS = ['progress', 'checkbox'];\nfunction copyCellsValue(\n  selection: TableViewSelection,\n  data: DataViewTableManager,\n  view: DataViewTable,\n  isCut = false\n) {\n  const { rowsSelection, columnsSelection, focus, groupKey } = selection;\n  const values: string[][] = [];\n  if (rowsSelection && !columnsSelection) {\n    // rows\n    const { start, end } = rowsSelection;\n    const titleIndex = data.columnsWithoutFilter.findIndex(\n      id => data.columnGetType(id) === 'title'\n    );\n    for (let i = start; i <= end; i++) {\n      const container = view.selectionController.getCellContainer(\n        groupKey,\n        i,\n        titleIndex\n      );\n      const value = (cellToStringMap['title']?.(container) ?? '') as string;\n      values.push([value]);\n    }\n  } else if (rowsSelection && columnsSelection) {\n    // multiple cells\n    for (let i = rowsSelection.start; i <= rowsSelection.end; i++) {\n      const value: string[] = [];\n      for (let j = columnsSelection.start; j <= columnsSelection.end; j++) {\n        const column = data.columnGet(data.columns[j]);\n        const container = view.selectionController.getCellContainer(\n          groupKey,\n          i,\n          j\n        );\n        const cellValue = (cellToStringMap[column.type]?.(container) ??\n          '') as string;\n        if (!isCut) {\n          value.push(cellValue);\n        }\n        if (isCut && !UNSUPPORTED_COLUMNS.includes(column.type)) {\n          value.push(cellValue);\n          container?.column.setValue(container.rowId, undefined);\n          if (column.type === 'title' || column.type === 'rich-text') {\n            const yText = container?.column.getValue(container.rowId) as Y.Text;\n            yText.delete(0, yText.length);\n          }\n        }\n      }\n      values.push(value);\n    }\n  } else if (!rowsSelection && !columnsSelection && focus) {\n    // single cell\n    const column = data.columnGet(data.columns[focus.columnIndex]);\n    const container = view.selectionController.getCellContainer(\n      groupKey,\n      focus.rowIndex,\n      focus.columnIndex\n    );\n    const value = (cellToStringMap[column.type]?.(container) ?? '') as string;\n    if (!isCut) {\n      values.push([value]);\n    }\n    if (isCut && !UNSUPPORTED_COLUMNS.includes(column.type)) {\n      values.push([value]);\n      container?.column.setValue(container.rowId, undefined);\n      if (column.type === 'title' || column.type === 'rich-text') {\n        const yText = container?.column.getValue(container.rowId) as Y.Text;\n        yText.delete(0, yText.length);\n      }\n    }\n  }\n\n  return values;\n}\n\ntype CopyedColumn = { type: string; value: string };\ntype CopyedSelectionData = CopyedColumn[][];\nfunction getCopiedValuesFromSelection(\n  selection: TableViewSelection,\n  data: DataViewTableManager,\n  view: DataViewTable\n): CopyedSelectionData {\n  const { rowsSelection, columnsSelection, focus, groupKey } = selection;\n  const values: CopyedColumn[][] = [];\n  if (rowsSelection && !columnsSelection) {\n    // rows\n    const { start, end } = rowsSelection;\n    for (let i = start; i <= end; i++) {\n      const cellValues: CopyedColumn[] = [];\n      for (let j = 0; j < data.columns.length; j++) {\n        const column = data.columnGet(data.columns[j]);\n        const container = view.selectionController.getCellContainer(\n          groupKey,\n          i,\n          j\n        );\n        const value = cellToStringMap[column.type]?.(container);\n        cellValues.push({ type: column.type, value });\n      }\n      values.push(cellValues);\n    }\n  } else if (rowsSelection && columnsSelection) {\n    // multiple cells\n    for (let i = rowsSelection.start; i <= rowsSelection.end; i++) {\n      const cellValues: CopyedColumn[] = [];\n      for (let j = columnsSelection.start; j <= columnsSelection.end; j++) {\n        const column = data.columnGet(data.columns[j]);\n        const container = view.selectionController.getCellContainer(\n          groupKey,\n          i,\n          j\n        );\n        const value = cellToStringMap[column.type]?.(container);\n        cellValues.push({ type: column.type, value });\n      }\n      values.push(cellValues);\n    }\n  } else if (!rowsSelection && !columnsSelection && focus) {\n    // single cell\n    const container = view.selectionController.getCellContainer(\n      groupKey,\n      focus.rowIndex,\n      focus.columnIndex\n    );\n    const column = data.columnGet(data.columns[focus.columnIndex]);\n    const value = cellToStringMap[column.type]?.(container);\n    values.push([{ type: column.type, value }]);\n  }\n  return values;\n}\n\nfunction getTargetRangeFromSelection(\n  selection: TableViewSelection,\n  data: DataViewTableManager\n) {\n  const { rowsSelection, columnsSelection, focus } = selection;\n  let range: {\n    row: { start: number; end: number; length: number };\n    column: { start: number; end: number; length: number };\n    anchor?: boolean;\n  } = {\n    row: {\n      start: 0,\n      end: 0,\n      length: 0,\n    },\n    column: {\n      start: 0,\n      end: 0,\n      length: 0,\n    },\n  };\n\n  if (rowsSelection && !columnsSelection) {\n    // rows\n    range = {\n      row: {\n        start: rowsSelection.start,\n        end: rowsSelection.end,\n        length: rowsSelection.end - rowsSelection.start + 1,\n      },\n      column: {\n        start: 0,\n        end: data.columns.length - 1,\n        length: data.columns.length,\n      },\n    };\n    if (rowsSelection.start === rowsSelection.end) {\n      range.anchor = true;\n    }\n  } else if (rowsSelection && columnsSelection) {\n    // multiple cells\n    range = {\n      row: {\n        start: rowsSelection.start,\n        end: rowsSelection.end,\n        length: rowsSelection.end - rowsSelection.start + 1,\n      },\n      column: {\n        start: columnsSelection.start,\n        end: columnsSelection.end,\n        length: columnsSelection.end - columnsSelection.start + 1,\n      },\n    };\n  } else if (!rowsSelection && !columnsSelection && focus) {\n    // single cell\n    range = {\n      anchor: true,\n      row: {\n        start: focus.rowIndex,\n        end: focus.rowIndex,\n        length: 1,\n      },\n      column: {\n        start: focus.columnIndex,\n        end: focus.columnIndex,\n        length: 1,\n      },\n    };\n  }\n  return range;\n}\n\nfunction pasteToCells(\n  data: DataViewTableManager,\n  view: DataViewTable,\n  copied: CopyedSelectionData,\n  groupKey: string | undefined,\n  rowStartIndex: number,\n  columnStartIndex: number,\n  rowLength: number,\n  columnLength: number\n) {\n  const srcColumns = copied;\n  const srcRowLength = srcColumns.length;\n  const srcColumnLength = srcColumns[0].length;\n\n  for (let i = 0; i < rowLength; i++) {\n    for (let j = 0; j < columnLength; j++) {\n      const rowIndex = rowStartIndex + i;\n      const columnIndex = columnStartIndex + j;\n\n      const srcRowIndex = i % srcRowLength;\n      const srcColumnIndex = j % srcColumnLength;\n      const srcColumn = srcColumns[srcRowIndex][srcColumnIndex];\n\n      const targetContainer = view.selectionController.getCellContainer(\n        groupKey,\n        rowIndex,\n        columnIndex\n      );\n      const rowId = targetContainer?.dataset.rowId;\n      const columnId = targetContainer?.dataset.columnId;\n\n      if (rowId && columnId) {\n        const value = targetContainer?.column.setValueFromString(\n          srcColumn.value\n        );\n        data.cellUpdateValue(rowId, columnId, value);\n      }\n    }\n  }\n}\n\nconst cellToStringMap: Record<\n  string,\n  (container: DatabaseCellContainer | undefined) => string\n> = {\n  'rich-text': container => {\n    const cell = container?.querySelector(\n      'affine-database-rich-text-cell-editing'\n    );\n    const value = getColumnValue(container);\n    const range = cell?.inlineEditor?.getInlineRange();\n    if (range) {\n      const start = range.index;\n      const end = range.index + range.length;\n      const data = value?.slice(start, end) ?? '';\n      return data;\n    }\n    return value ?? '';\n  },\n  title: container => {\n    const cell = container?.querySelector('data-view-header-area-text-editing');\n    const value = getColumnValue(container);\n    const range = cell?.inlineEditor?.getInlineRange();\n    if (range) {\n      const start = range.index;\n      const end = range.index + range.length;\n      const data = value?.slice(start, end) ?? '';\n      return data;\n    }\n    return value ?? '';\n  },\n  date: container => {\n    return getColumnValue(container);\n  },\n  number: container => {\n    return getColumnValue(container);\n  },\n  select: container => {\n    return getColumnValue(container);\n  },\n  'multi-select': container => {\n    return getColumnValue(container);\n  },\n  progress: container => {\n    return getColumnValue(container);\n  },\n  link: container => getColumnValue(container),\n  checkbox: container => {\n    return getColumnValue(container);\n  },\n};\n"]}