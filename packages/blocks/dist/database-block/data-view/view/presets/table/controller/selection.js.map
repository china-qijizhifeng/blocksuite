{"version":3,"file":"selection.js","sourceRoot":"","sources":["../../../../../../../src/database-block/data-view/view/presets/table/controller/selection.ts"],"names":[],"mappings":"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","sourcesContent":["import { ShadowlessElement } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { ReactiveController } from 'lit';\nimport { css, html } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport type { Ref } from 'lit/directives/ref.js';\nimport { createRef, ref } from 'lit/directives/ref.js';\n\nimport { clamp } from '../../../../../../_common/utils/math.js';\nimport { startDrag } from '../../../../utils/drag.js';\nimport { autoScrollOnBoundary } from '../../../../utils/frame-loop.js';\nimport type { DatabaseCellContainer } from '../components/cell-container.js';\nimport type { DataViewTable } from '../table-view.js';\nimport type {\n  CellFocus,\n  MultiSelection,\n  TableViewSelection,\n} from '../types.js';\nimport {\n  DragToFillElement,\n  fillSelectionWithFocusCellData,\n} from './drag-to-fill.js';\n\nexport class TableSelectionController implements ReactiveController {\n  private get dragToFillDraggable() {\n    return this.__dragToFillElement.dragToFillRef.value;\n  }\n\n  private get focusSelectionElement() {\n    return this.__selectionElement.focusRef.value;\n  }\n\n  private get areaSelectionElement() {\n    return this.__selectionElement.selectionRef.value;\n  }\n\n  get tableContainer() {\n    const tableContainer = this.host.querySelector(\n      '.affine-database-table-container'\n    );\n    assertExists(tableContainer);\n    return tableContainer;\n  }\n\n  get viewData() {\n    return this.view;\n  }\n\n  get selection(): TableViewSelection | undefined {\n    return this._tableViewSelection;\n  }\n\n  set selection(data: Omit<TableViewSelection, 'viewId' | 'type'> | undefined) {\n    if (!data) {\n      this.clearSelection();\n      return;\n    }\n    const selection: TableViewSelection = {\n      ...data,\n      viewId: this.view.id,\n      type: 'table',\n    };\n    if (selection.isEditing) {\n      const focus = selection.focus;\n      const container = this.getCellContainer(\n        selection.groupKey,\n        focus.rowIndex,\n        focus.columnIndex\n      );\n      const cell = container?.cell;\n      const isEditing = cell ? cell.beforeEnterEditMode() : true;\n      this.host.setSelection({\n        ...selection,\n        isEditing,\n      });\n    } else {\n      this.host.setSelection(selection);\n    }\n  }\n\n  private get view() {\n    return this.host.view;\n  }\n\n  private _tableViewSelection?: TableViewSelection;\n\n  __selectionElement = new SelectionElement();\n\n  __dragToFillElement = new DragToFillElement();\n\n  selectionStyleUpdateTask = 0;\n\n  constructor(public host: DataViewTable) {\n    host.addController(this);\n  }\n\n  private handleSelectionChange() {\n    this.host.disposables.add(\n      this.host.selectionUpdated.on(tableSelection => {\n        if (!this.isValidSelection(tableSelection)) {\n          this.selection = undefined;\n          return;\n        }\n\n        const old = this._tableViewSelection;\n        if (\n          old?.focus.rowIndex !== tableSelection?.focus.rowIndex ||\n          old?.focus.columnIndex !== tableSelection?.focus.columnIndex\n        ) {\n          requestAnimationFrame(() => {\n            this.scrollToFocus();\n          });\n        }\n\n        if (\n          this.isSelectedRowOnly() &&\n          (old?.rowsSelection?.start !== tableSelection?.rowsSelection?.start ||\n            old?.rowsSelection?.end !== tableSelection?.rowsSelection?.end)\n        ) {\n          requestAnimationFrame(() => {\n            this.scrollToAreaSelection();\n          });\n        }\n\n        if (old) {\n          const container = this.getCellContainer(\n            old.groupKey,\n            old.focus.rowIndex,\n            old.focus.columnIndex\n          );\n          if (container) {\n            const cell = container.cell;\n            if (old.isEditing) {\n              cell?.onExitEditMode();\n              cell?.blurCell();\n              container.isEditing = false;\n            }\n          }\n        }\n\n        this.updateSelection(tableSelection);\n\n        if (tableSelection) {\n          const container = this.getCellContainer(\n            tableSelection.groupKey,\n            tableSelection.focus.rowIndex,\n            tableSelection.focus.columnIndex\n          );\n          if (container) {\n            const cell = container.cell;\n            if (tableSelection.isEditing) {\n              cell?.onEnterEditMode();\n              container.isEditing = true;\n              cell?.focusCell();\n            }\n          }\n        }\n      })\n    );\n  }\n\n  private getFocusCellContainer = () => {\n    if (!this._tableViewSelection) return null;\n    const { groupKey, focus } = this._tableViewSelection;\n\n    const dragStartCell = this.getCellContainer(\n      groupKey,\n      focus.rowIndex,\n      focus.columnIndex\n    );\n    return dragStartCell ?? null;\n  };\n\n  private resolveDragStartTarget(\n    target: HTMLElement\n  ): [cell: DatabaseCellContainer | null, fillValues: boolean] {\n    let cell: DatabaseCellContainer | null;\n    const fillValues = !!target.dataset.dragToFill;\n    if (fillValues) {\n      const focusCellContainer = this.getFocusCellContainer();\n      assertExists(focusCellContainer);\n      cell = focusCellContainer;\n    } else {\n      cell = target.closest('affine-database-cell-container');\n    }\n    return [cell, fillValues];\n  }\n\n  private handleDragEvent() {\n    this.host.disposables.add(\n      this.host.handleEvent('dragStart', context => {\n        const event = context.get('pointerState').raw;\n        const target = event.target;\n        if (target instanceof HTMLElement) {\n          const [cell, fillValues] = this.resolveDragStartTarget(target);\n\n          if (cell) {\n            const selection = this.selection;\n            if (\n              selection &&\n              selection.isEditing &&\n              selection.focus.rowIndex === cell.rowIndex &&\n              selection.focus.columnIndex === cell.columnIndex\n            ) {\n              return false;\n            }\n            this.startDrag(event, cell, fillValues);\n            event.preventDefault();\n            return true;\n          }\n          return false;\n        }\n        return false;\n      })\n    );\n  }\n\n  private clearSelection() {\n    this.host.setSelection();\n  }\n\n  private scrollToFocus() {\n    this.focusSelectionElement?.scrollIntoView({\n      block: 'nearest',\n      inline: 'nearest',\n    });\n  }\n\n  private scrollToAreaSelection() {\n    this.areaSelectionElement?.scrollIntoView({\n      block: 'nearest',\n      inline: 'nearest',\n    });\n  }\n\n  private insertTo(\n    groupKey: string | undefined,\n    rowId: string,\n    before: boolean\n  ) {\n    const id = this.view.rowAdd({ before, id: rowId });\n    if (groupKey != null) {\n      this.view.groupHelper?.moveCardTo(id, undefined, groupKey, {\n        before,\n        id: rowId,\n      });\n    }\n    const rows =\n      groupKey != null\n        ? this.view.groupHelper?.groupMap[groupKey].rows\n        : this.view.rows;\n    requestAnimationFrame(() => {\n      const index = this.host.view.columnManagerList.findIndex(\n        v => v.type === 'title'\n      );\n      this.selection = {\n        groupKey: groupKey,\n        focus: {\n          rowIndex: rows?.findIndex(v => v === id) ?? 0,\n          columnIndex: index,\n        },\n        isEditing: true,\n      };\n    });\n  }\n\n  private checkSelection() {\n    const selection = this.selection;\n    if (!selection) {\n      return true;\n    }\n    const cell = this.getCellContainer(\n      selection.groupKey,\n      selection.focus.rowIndex,\n      selection.focus.columnIndex\n    );\n    if (!cell) {\n      return false;\n    }\n    return true;\n  }\n\n  hostConnected() {\n    requestAnimationFrame(() => {\n      this.tableContainer.append(this.__selectionElement);\n      this.tableContainer.append(this.__dragToFillElement);\n    });\n    this.handleDragEvent();\n    this.handleSelectionChange();\n  }\n\n  isValidSelection(selection?: TableViewSelection): boolean {\n    if (!selection) {\n      return true;\n    }\n    if (selection.focus.rowIndex > this.view.rows.length - 1) {\n      this.selection = undefined;\n      return false;\n    }\n    if (selection.focus.columnIndex > this.view.columns.length - 1) {\n      this.selection = undefined;\n      return false;\n    }\n    return true;\n  }\n\n  cellPosition(groupKey: string | undefined) {\n    const rows = this.rows(groupKey);\n    const cells = rows\n      ?.item(0)\n      .querySelectorAll('affine-database-cell-container');\n\n    return (x1: number, x2: number, y1: number, y2: number) => {\n      const rowOffsets: number[] = Array.from(rows ?? []).map(\n        v => v.getBoundingClientRect().top\n      );\n      const columnOffsets: number[] = Array.from(cells ?? []).map(\n        v => v.getBoundingClientRect().left\n      );\n      const [startX, endX] = x1 < x2 ? [x1, x2] : [x2, x1];\n      const [startY, endY] = y1 < y2 ? [y1, y2] : [y2, y1];\n      const row: MultiSelection = {\n        start: 0,\n        end: 0,\n      };\n      const column: MultiSelection = {\n        start: 0,\n        end: 0,\n      };\n      for (let i = 0; i < rowOffsets.length; i++) {\n        const offset = rowOffsets[i];\n        if (offset < startY) {\n          row.start = i;\n        }\n        if (offset < endY) {\n          row.end = i;\n        }\n      }\n      for (let i = 0; i < columnOffsets.length; i++) {\n        const offset = columnOffsets[i];\n        if (offset < startX) {\n          column.start = i;\n        }\n        if (offset < endX) {\n          column.end = i;\n        }\n      }\n      return {\n        row,\n        column,\n      };\n    };\n  }\n\n  startDrag(\n    evt: PointerEvent,\n    cell: DatabaseCellContainer,\n    fillValues?: boolean\n  ) {\n    const groupKey = cell.closest('affine-data-view-table-group')?.group?.key;\n    const table = this.tableContainer;\n    const scrollContainer = table.parentElement;\n    assertExists(scrollContainer);\n    const tableRect = table.getBoundingClientRect();\n    const startOffsetX = evt.x - tableRect.left;\n    const startOffsetY = evt.y - tableRect.top;\n    const offsetToSelection = this.cellPosition(groupKey);\n    const select = (selection: {\n      row: MultiSelection;\n      column: MultiSelection;\n    }) => {\n      this.selection = {\n        groupKey: groupKey,\n        rowsSelection: selection.row,\n        columnsSelection: selection.column,\n        focus: {\n          rowIndex: cell.rowIndex,\n          columnIndex: cell.columnIndex,\n        },\n        isEditing: false,\n      };\n    };\n    const cancelScroll = autoScrollOnBoundary(scrollContainer, {\n      onScroll() {\n        drag.move({ x: drag.last.x, y: drag.last.y });\n      },\n    });\n    const drag = startDrag<\n      | {\n          row: MultiSelection;\n          column: MultiSelection;\n        }\n      | undefined,\n      {\n        x: number;\n        y: number;\n      }\n    >(evt, {\n      transform: evt => ({\n        x: evt.x,\n        y: evt.y,\n      }),\n      onDrag: () => {\n        if (fillValues) this.__dragToFillElement.dragging = true;\n        return undefined;\n      },\n      onMove: ({ x, y }) => {\n        const tableRect = table.getBoundingClientRect();\n        const startX = tableRect.left + startOffsetX;\n        const startY = tableRect.top + startOffsetY;\n        const selection = offsetToSelection(startX, x, startY, y);\n\n        if (fillValues)\n          selection.column = {\n            start: cell.columnIndex,\n            end: cell.columnIndex,\n          };\n\n        select(selection);\n        return selection;\n      },\n      onDrop: selection => {\n        if (!selection) {\n          return;\n        }\n        select(selection);\n        if (fillValues && this.selection) {\n          this.__dragToFillElement.dragging = false;\n          fillSelectionWithFocusCellData(this.host, this.selection);\n        }\n      },\n      onClear: () => {\n        cancelScroll();\n      },\n    });\n  }\n\n  navigateRowSelection(direction: 'up' | 'down', append = false) {\n    if (!this.selection || !this.isSelectedRowOnly()) return;\n\n    const focusCell = this.getCellContainer(\n      this.selection.groupKey,\n      this.selection.focus.rowIndex,\n      this.selection.focus.columnIndex\n    );\n\n    if (!focusCell) return;\n\n    const rows = Array.from(this.rows(this.selection.groupKey));\n    const rowsLen = rows.length;\n\n    const { start: rowSelStart, end: rowSelEnd } =\n      this.selection.rowsSelection!;\n\n    const isMultiRowSelection = rowSelEnd - rowSelStart > 0;\n    const focus = this.selection.focus;\n\n    const isGoingUp = direction === 'up';\n    let newStart = rowSelStart;\n    let newEnd = rowSelEnd;\n    let newFocusRowIdx = focus.rowIndex;\n\n    if (append) {\n      if (isGoingUp) {\n        if (rowSelEnd > focus.rowIndex) {\n          newStart = focus.rowIndex; // use focus as an anchor\n          newEnd = rowSelEnd - 1;\n        } else {\n          newStart = rowSelStart - 1;\n          newEnd = focus.rowIndex; // use focus as an anchor\n        }\n      } else {\n        if (rowSelStart < focus.rowIndex) {\n          newStart = rowSelStart + 1;\n          newEnd = focus.rowIndex; // use focus as an anchor\n        } else {\n          newStart = focus.rowIndex; // use focus as an anchor\n          newEnd = rowSelEnd + 1;\n        }\n      }\n    } else {\n      // if it is a multi row selection then collapse to the selection start row or to the selection corresponding to the direction end row else select the row corresponding to the direction\n      const dir = isGoingUp ? -1 : 1;\n      const newIndex = isMultiRowSelection\n        ? isGoingUp\n          ? rowSelStart\n          : rowSelEnd\n        : rowSelStart + dir;\n\n      newStart = newEnd = newFocusRowIdx = newIndex;\n    }\n\n    // clamp ranges\n    newStart = clamp(newStart, 0, rowsLen - 1);\n    newEnd = clamp(newEnd, 0, rowsLen - 1);\n    newFocusRowIdx = clamp(newFocusRowIdx, 0, rowsLen - 1);\n\n    this.selection = {\n      ...this.selection,\n      rowsSelection: {\n        start: newStart,\n        end: newEnd,\n      },\n      focus: { ...focus, rowIndex: newFocusRowIdx },\n    };\n  }\n\n  focusToCell(position: 'left' | 'right' | 'up' | 'down') {\n    if (!this.selection) {\n      return;\n    }\n    const cell = this.getCellContainer(\n      this.selection.groupKey,\n      this.selection.focus.rowIndex,\n      this.selection.focus.columnIndex\n    );\n    if (!cell) {\n      return;\n    }\n    const row = cell.closest('data-view-table-row');\n    const rows = Array.from(\n      row\n        ?.closest('.affine-database-table-container')\n        ?.querySelectorAll('data-view-table-row') ?? []\n    );\n    const cells = Array.from(\n      row?.querySelectorAll('affine-database-cell-container') ?? []\n    );\n    if (!row || !rows || !cells) {\n      return;\n    }\n    let rowIndex = rows.indexOf(row);\n    let columnIndex = cells.indexOf(cell);\n    if (position === 'left') {\n      if (columnIndex === 0) {\n        columnIndex = cells.length - 1;\n        rowIndex--;\n      } else {\n        columnIndex--;\n      }\n    }\n    if (position === 'right') {\n      if (columnIndex === cells.length - 1) {\n        columnIndex = 0;\n        rowIndex++;\n      } else {\n        columnIndex++;\n      }\n    }\n    if (position === 'up') {\n      if (rowIndex === 0) {\n        //\n      } else {\n        rowIndex--;\n      }\n    }\n    if (position === 'down') {\n      if (rowIndex === rows.length - 1) {\n        //\n      } else {\n        rowIndex++;\n      }\n    }\n    rows[rowIndex]\n      ?.querySelectorAll('affine-database-cell-container')\n      ?.item(columnIndex)\n      ?.selectCurrentCell(false);\n  }\n\n  selectRange(\n    selection: TableViewSelection,\n    row: MultiSelection,\n    column: MultiSelection\n  ) {\n    this.selection = {\n      ...selection,\n      rowsSelection: row,\n      columnsSelection: column,\n      isEditing: false,\n    };\n  }\n\n  getCellContainer(\n    groupKey: string | undefined,\n    rowIndex: number,\n    columnIndex: number\n  ): DatabaseCellContainer | undefined {\n    const row = this.rows(groupKey)?.item(rowIndex);\n    return row\n      ?.querySelectorAll('affine-database-cell-container')\n      .item(columnIndex);\n  }\n\n  rows(groupKey: string | undefined) {\n    const container =\n      groupKey != null\n        ? this.tableContainer.querySelector(\n            `affine-data-view-table-group[data-group-key=\"${groupKey}\"]`\n          )\n        : this.tableContainer;\n    assertExists(container);\n    return container.querySelectorAll('data-view-table-row');\n  }\n\n  updateSelection(tableSelection?: TableViewSelection) {\n    const update = (): boolean => {\n      const result = this.checkSelection();\n      if (!result) {\n        return false;\n      }\n      this.updateSelectionStyle(\n        tableSelection?.groupKey,\n        tableSelection?.rowsSelection,\n        tableSelection?.columnsSelection\n      );\n\n      const isRowSelection =\n        tableSelection?.rowsSelection && !tableSelection?.columnsSelection;\n\n      const rowSel = tableSelection?.rowsSelection;\n\n      const isDragElemDragging = this.__dragToFillElement.dragging;\n      const isEditing = !!tableSelection?.isEditing;\n\n      const showDragToFillHandle =\n        !isEditing && ((rowSel && isDragElemDragging) || !rowSel);\n\n      this.updateFocusSelectionStyle(\n        tableSelection?.groupKey,\n        tableSelection?.focus,\n        isRowSelection,\n        isEditing,\n        showDragToFillHandle\n      );\n      return true;\n    };\n    this._tableViewSelection = tableSelection;\n    if (!tableSelection) {\n      cancelAnimationFrame(this.selectionStyleUpdateTask);\n      update();\n    } else {\n      const task = () => {\n        cancelAnimationFrame(this.selectionStyleUpdateTask);\n        if (!update()) {\n          this.selection = undefined;\n          return;\n        }\n        this.selectionStyleUpdateTask = requestAnimationFrame(task);\n      };\n      task();\n    }\n  }\n\n  updateSelectionStyle(\n    groupKey: string | undefined,\n    rowSelection?: MultiSelection,\n    columnSelection?: MultiSelection\n  ) {\n    const div = this.areaSelectionElement;\n    if (!div) return;\n    if (!rowSelection && !columnSelection) {\n      div.style.display = 'none';\n      return;\n    }\n    const tableRect = this.tableContainer.getBoundingClientRect();\n    // eslint-disable-next-line prefer-const\n    let { left, top, width, height, scale } = this.getRect(\n      groupKey,\n      rowSelection?.start ?? 0,\n      rowSelection?.end ?? this.view.rows.length - 1,\n      columnSelection?.start ?? 0,\n      columnSelection?.end ?? this.view.columnManagerList.length - 1\n    );\n    const isRowSelection = rowSelection && !columnSelection;\n    if (isRowSelection) {\n      left = tableRect.left;\n      width = tableRect.width;\n    }\n    div.style.left = `${left - tableRect.left / scale}px`;\n    div.style.top = `${top - tableRect.top / scale}px`;\n    div.style.width = `${width}px`;\n    div.style.height = `${height}px`;\n    div.style.display = 'block';\n    div.style.border = isRowSelection\n      ? '1px solid var(--affine-primary-color)'\n      : 'unset';\n  }\n\n  updateFocusSelectionStyle(\n    groupKey: string | undefined,\n    focus?: CellFocus,\n    isRowSelection?: boolean,\n    isEditing = false,\n    showDragToFillHandle = false\n  ) {\n    const div = this.focusSelectionElement;\n    const dragToFill = this.dragToFillDraggable;\n\n    if (!div || !dragToFill) return;\n    if (focus && !isRowSelection) {\n      // Check if row is removed.\n      const rows = this.rows(groupKey) ?? [];\n      if (rows.length <= focus.rowIndex) return;\n\n      const { left, top, width, height, scale } = this.getRect(\n        groupKey,\n        focus.rowIndex,\n        focus.rowIndex,\n        focus.columnIndex,\n        focus.columnIndex\n      );\n      const tableRect = this.tableContainer.getBoundingClientRect();\n\n      const x = left - tableRect.left / scale;\n      const y = top - 1 - tableRect.top / scale;\n      const w = width + 1;\n      const h = height + 1;\n      div.style.left = `${x}px`;\n      div.style.top = `${y}px`;\n      div.style.width = `${w}px`;\n      div.style.height = `${h}px`;\n      div.style.borderColor = 'var(--affine-primary-color)';\n      div.style.borderStyle = this.__dragToFillElement.dragging\n        ? 'dashed'\n        : 'solid';\n      div.style.boxShadow = isEditing\n        ? '0px 0px 0px 2px rgba(30, 150, 235, 0.30)'\n        : 'unset';\n      div.style.display = 'block';\n\n      dragToFill.style.left = `${x + w}px`;\n      dragToFill.style.top = `${y + h}px`;\n      dragToFill.style.display = showDragToFillHandle ? 'block' : 'none';\n    } else {\n      div.style.display = 'none';\n      dragToFill.style.display = 'none';\n    }\n  }\n\n  getRect(\n    groupKey: string | undefined,\n    top: number,\n    bottom: number,\n    left: number,\n    right: number\n  ) {\n    const rows = this.rows(groupKey);\n    const topRow = rows.item(top);\n    const bottomRow = rows.item(bottom);\n    const topCells = topRow.querySelectorAll('affine-database-cell-container');\n    const leftCell = topCells.item(left);\n    const rightCell = topCells.item(right);\n    const leftRect = leftCell.getBoundingClientRect();\n    const scale = leftRect.width / leftCell.column.width;\n    return {\n      top: leftRect.top / scale,\n      left: leftRect.left / scale,\n      width: (rightCell.getBoundingClientRect().right - leftRect.left) / scale,\n      height: (bottomRow.getBoundingClientRect().bottom - leftRect.top) / scale,\n      scale,\n    };\n  }\n\n  selectRow(index: number) {\n    this.selection = {\n      rowsSelection: {\n        start: index,\n        end: index,\n      },\n      focus: {\n        rowIndex: index,\n        columnIndex: 0,\n      },\n      isEditing: false,\n    };\n  }\n\n  toggleRow(index: number) {\n    const selection = this.selection;\n    if (selection) {\n      const rowsSelection = selection.rowsSelection;\n      if (\n        rowsSelection &&\n        !selection.columnsSelection &&\n        rowsSelection.start === index &&\n        rowsSelection.end === index\n      ) {\n        this.selection = {\n          ...selection,\n          rowsSelection: undefined,\n        };\n        return;\n      }\n    }\n    this.selection = {\n      rowsSelection: {\n        start: index,\n        end: index,\n      },\n      focus: {\n        rowIndex: index,\n        columnIndex: 0,\n      },\n      isEditing: false,\n    };\n  }\n\n  focusFirstCell() {\n    this.selection = {\n      focus: {\n        rowIndex: 0,\n        columnIndex: 0,\n      },\n      isEditing: false,\n    };\n  }\n\n  insertRowBefore(groupKey: string | undefined, rowId: string) {\n    this.insertTo(groupKey, rowId, true);\n  }\n\n  insertRowAfter(groupKey: string | undefined, rowId: string) {\n    this.insertTo(groupKey, rowId, false);\n  }\n\n  deleteRow(rowId: string) {\n    this.view.rowDelete([rowId]);\n    this.focusToCell('up');\n  }\n\n  isSelectedRowOnly() {\n    const selection = this.selection;\n    return (\n      !!selection && !!selection.rowsSelection && !selection.columnsSelection\n    );\n  }\n\n  isRowSelected(groupKey: string | undefined, rowIndex: number) {\n    const selection = this.selection;\n    if (!selection || selection.groupKey != groupKey) {\n      return false;\n    }\n    const { rowsSelection, columnsSelection } = selection;\n    if (!rowsSelection || columnsSelection) {\n      return false;\n    }\n    return rowsSelection.start === rowIndex && rowsSelection.end === rowIndex;\n  }\n}\n\n@customElement('data-view-table-selection')\nclass SelectionElement extends ShadowlessElement {\n  static override styles = css`\n    .database-selection {\n      position: absolute;\n      z-index: 1;\n      box-sizing: border-box;\n      background: var(--affine-primary-color-04);\n      pointer-events: none;\n      display: none;\n    }\n\n    .database-focus {\n      position: absolute;\n      width: 100%;\n      z-index: 1;\n      box-sizing: border-box;\n      border: 1px solid var(--affine-primary-color);\n      border-radius: 2px;\n      pointer-events: none;\n      display: none;\n      outline: none;\n    }\n\n    @media print {\n      affine-database-selection {\n        display: none;\n      }\n    }\n  `;\n\n  focusRef: Ref<HTMLDivElement> = createRef<HTMLDivElement>();\n\n  selectionRef: Ref<HTMLDivElement> = createRef<HTMLDivElement>();\n\n  override render() {\n    return html`\n      <div ${ref(this.selectionRef)} class=\"database-selection\"></div>\n      <div tabindex=\"0\" ${ref(this.focusRef)} class=\"database-focus\"></div>\n    `;\n  }\n}\n"]}