{"version":3,"file":"row.js","sourceRoot":"","sources":["../../../../../../../src/database-block/data-view/view/presets/table/components/row.ts"],"names":[],"mappings":"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","sourcesContent":["import { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { css, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\nimport { html } from 'lit/static-html.js';\n\nimport { NewEditIcon } from '../../../../../../_common/icons/index.js';\nimport { MoreHorizontalIcon } from '../../../../common/icons/index.js';\nimport type { DataViewRenderer } from '../../../../data-view.js';\nimport { DEFAULT_COLUMN_MIN_WIDTH } from '../consts.js';\nimport type { DataViewTableManager } from '../table-view-manager.js';\nimport type { TableViewSelection } from '../types.js';\nimport { openDetail, popRowMenu } from './menu.js';\n\n@customElement('data-view-table-row')\nexport class TableRow extends WithDisposable(ShadowlessElement) {\n  get selectionController() {\n    return this.closest('affine-database-table')?.selectionController;\n  }\n\n  get groupKey() {\n    return this.closest('affine-data-view-table-group')?.group?.key;\n  }\n\n  static override styles = css`\n    .data-view-table-row {\n      width: 100%;\n    }\n    .affine-database-block-row {\n      width: 100%;\n      display: flex;\n      flex-direction: row;\n      border-bottom: 1px solid var(--affine-border-color);\n      position: relative;\n    }\n\n    .affine-database-block-row.selected > .database-cell {\n      background: transparent;\n    }\n\n    .database-cell {\n      min-width: ${DEFAULT_COLUMN_MIN_WIDTH}px;\n    }\n\n    .row-ops {\n      position: relative;\n      width: 0;\n      margin-top: 8px;\n      height: max-content;\n      visibility: hidden;\n      display: flex;\n      gap: 4px;\n      cursor: pointer;\n      justify-content: end;\n    }\n\n    .row-op:last-child {\n      margin-right: 8px;\n    }\n\n    .affine-database-block-row:hover .row-ops {\n      visibility: visible;\n    }\n    .affine-database-block-row .show-on-hover-row {\n      visibility: hidden;\n      opacity: 0;\n      transition: opacity 150ms cubic-bezier(0.42, 0, 1, 1);\n    }\n    .affine-database-block-row:hover .show-on-hover-row {\n      visibility: visible;\n      opacity: 1;\n    }\n\n    .row-op {\n      display: flex;\n      padding: 4px;\n      border-radius: 4px;\n      box-shadow: 0px 0px 4px 0px rgba(66, 65, 73, 0.14);\n      background-color: var(--affine-background-primary-color);\n      position: relative;\n    }\n\n    .row-op:hover:before {\n      content: '';\n      border-radius: 4px;\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      background-color: var(--affine-hover-color);\n    }\n\n    .row-op svg {\n      fill: var(--affine-icon-color);\n      color: var(--affine-icon-color);\n      width: 16px;\n      height: 16px;\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor dataViewEle!: DataViewRenderer;\n\n  @property({ attribute: false })\n  accessor view!: DataViewTableManager;\n\n  @property({ attribute: false })\n  accessor rowIndex!: number;\n\n  @property({ attribute: false })\n  accessor rowId!: string;\n\n  private _clickDragHandler = () => {\n    const selectionController = this.selectionController;\n    if (selectionController) {\n      if (\n        selectionController.isRowSelected(this.groupKey, this.rowIndex) &&\n        selectionController.selection\n      ) {\n        selectionController.selection = {\n          ...selectionController.selection,\n          rowsSelection: undefined,\n        };\n      } else {\n        selectionController.selection = {\n          groupKey: this.groupKey,\n          rowsSelection: {\n            start: this.rowIndex,\n            end: this.rowIndex,\n          },\n          focus: {\n            rowIndex: this.rowIndex,\n            columnIndex: 0,\n          },\n          isEditing: false,\n        };\n      }\n    }\n  };\n\n  protected override render(): unknown {\n    const view = this.view;\n    return html`\n      <div class=\"data-view-table-left-bar\">\n        <div\n          class=\"data-view-table-view-drag-handler\"\n          @click=${this._clickDragHandler}\n          style=\"width: 8px;height: 100%;display:flex;align-items:center;justify-content:center;cursor:grab;\"\n        >\n          <div\n            class=\"show-on-hover-row\"\n            style=\"width: 4px;\n            border-radius: 2px;\n            height: 12px;\n            background-color: var(--affine-placeholder-color);\"\n          ></div>\n        </div>\n      </div>\n      ${repeat(\n        view.columnManagerList,\n        v => v.id,\n        (column, i) => {\n          const clickDetail = () => {\n            if (!this.selectionController) {\n              return;\n            }\n            this.setSelection({\n              groupKey: this.groupKey,\n              rowsSelection: {\n                start: this.rowIndex,\n                end: this.rowIndex,\n              },\n              focus: {\n                rowIndex: this.rowIndex,\n                columnIndex: i,\n              },\n              isEditing: false,\n            });\n            openDetail(this.dataViewEle, this.rowId, this.selectionController);\n          };\n          const openMenu = (e: MouseEvent) => {\n            if (!this.selectionController) {\n              return;\n            }\n            const ele = e.currentTarget as HTMLElement;\n            this.setSelection({\n              groupKey: this.groupKey,\n              rowsSelection: {\n                start: this.rowIndex,\n                end: this.rowIndex,\n              },\n              focus: {\n                rowIndex: this.rowIndex,\n                columnIndex: i,\n              },\n              isEditing: false,\n            });\n            popRowMenu(\n              this.dataViewEle,\n              ele,\n              this.rowId,\n              this.selectionController\n            );\n          };\n          return html`\n            <div>\n              <affine-database-cell-container\n                class=\"database-cell\"\n                style=${styleMap({\n                  width: `${column.width}px`,\n                  border: i === 0 ? 'none' : undefined,\n                })}\n                .view=\"${view}\"\n                .column=\"${column}\"\n                .rowId=\"${this.rowId}\"\n                data-row-id=\"${this.rowId}\"\n                .rowIndex=\"${this.rowIndex}\"\n                data-row-index=\"${this.rowIndex}\"\n                .columnId=\"${column.id}\"\n                data-column-id=\"${column.id}\"\n                .columnIndex=\"${i}\"\n                data-column-index=\"${i}\"\n              >\n              </affine-database-cell-container>\n            </div>\n            ${column.dataViewManager.header.titleColumn === column.id\n              ? html`<div class=\"row-ops\">\n                  <div class=\"row-op\" @click=\"${clickDetail}\">\n                    ${NewEditIcon}\n                  </div>\n                  ${!view.readonly\n                    ? html`<div class=\"row-op\" @click=\"${openMenu}\">\n                        ${MoreHorizontalIcon}\n                      </div>`\n                    : nothing}\n                </div>`\n              : nothing}\n          `;\n        }\n      )}\n      <div class=\"database-cell add-column-button\"></div>\n    `;\n  }\n\n  setSelection = (selection?: Omit<TableViewSelection, 'viewId' | 'type'>) => {\n    if (this.selectionController) {\n      this.selectionController.selection = selection;\n    }\n  };\n\n  contextMenu = (e: MouseEvent) => {\n    const selection = this.selectionController;\n    if (!selection) {\n      return;\n    }\n    e.preventDefault();\n    const ele = e.target as HTMLElement;\n    const cell = ele.closest('affine-database-cell-container');\n    const columnIndex = cell?.columnIndex ?? 0;\n    selection.selection = {\n      groupKey: this.groupKey,\n      rowsSelection: {\n        start: this.rowIndex,\n        end: this.rowIndex,\n      },\n      focus: {\n        rowIndex: this.rowIndex,\n        columnIndex: columnIndex,\n      },\n      isEditing: false,\n    };\n    popRowMenu(\n      this.dataViewEle,\n      e.target as HTMLElement,\n      this.rowId,\n      selection\n    );\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.disposables.addFromEvent(this, 'contextmenu', this.contextMenu);\n    // eslint-disable-next-line wc/no-self-class\n    this.classList.add('affine-database-block-row', 'database-row');\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'data-view-table-row': TableRow;\n  }\n}\n"]}