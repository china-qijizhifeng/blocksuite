{"version":3,"file":"cell-container.js","sourceRoot":"","sources":["../../../../../../../src/database-block/data-view/view/presets/table/components/cell-container.ts"],"names":[],"mappings":"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","sourcesContent":["import { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { css } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { createRef } from 'lit/directives/ref.js';\n\nimport type {\n  CellRenderProps,\n  DataViewCellLifeCycle,\n} from '../../../../column/index.js';\nimport { renderUniLit } from '../../../../utils/uni-component/index.js';\nimport type { DataViewManager } from '../../../data-view-manager.js';\nimport type { DataViewTableColumnManager } from '../table-view-manager.js';\n\n@customElement('affine-database-cell-container')\nexport class DatabaseCellContainer extends WithDisposable(ShadowlessElement) {\n  private get selectionView() {\n    return this.closest('affine-database-table')?.selectionController;\n  }\n\n  private get groupKey() {\n    return this.closest('affine-data-view-table-group')?.group?.key;\n  }\n\n  private get readonly() {\n    return this.column.readonly;\n  }\n\n  get table() {\n    const table = this.closest('affine-database-table');\n    assertExists(table);\n    return table;\n  }\n\n  get cell(): DataViewCellLifeCycle | undefined {\n    return this._cell.value;\n  }\n\n  static override styles = css`\n    affine-database-cell-container {\n      display: flex;\n      align-items: start;\n      width: 100%;\n      height: 100%;\n      border: none;\n      outline: none;\n    }\n\n    affine-database-cell-container * {\n      box-sizing: border-box;\n    }\n\n    affine-database-cell-container uni-lit > *:first-child {\n      padding: 8px;\n    }\n  `;\n\n  private _cell = createRef<DataViewCellLifeCycle>();\n\n  @state()\n  accessor isEditing = false;\n\n  @property({ attribute: false })\n  accessor view!: DataViewManager;\n\n  @property({ attribute: false })\n  accessor rowId!: string;\n\n  @property({ attribute: false })\n  accessor rowIndex!: number;\n\n  @property({ attribute: false })\n  accessor columnId!: string;\n\n  @property({ attribute: false })\n  accessor columnIndex!: number;\n\n  @property({ attribute: false })\n  accessor column!: DataViewTableColumnManager;\n\n  selectCurrentCell = (editing: boolean) => {\n    if (this.selectionView) {\n      this.selectionView.selection = {\n        groupKey: this.groupKey,\n        focus: {\n          rowIndex: this.rowIndex,\n          columnIndex: this.columnIndex,\n        },\n        isEditing: editing,\n      };\n    }\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._disposables.addFromEvent(this, 'click', () => {\n      if (!this.isEditing) {\n        this.selectCurrentCell(!this.column.readonly);\n      }\n    });\n  }\n\n  /* eslint-disable lit/binding-positions, lit/no-invalid-html */\n  override render() {\n    const { edit, view } = this.column.renderer;\n\n    const uni = !this.readonly && this.isEditing && edit != null ? edit : view;\n    const props: CellRenderProps = {\n      view: this.view,\n      column: this.column,\n      rowId: this.rowId,\n      isEditing: this.isEditing,\n      selectCurrentCell: this.selectCurrentCell,\n    };\n    return renderUniLit(uni, props, {\n      ref: this._cell,\n      style: {\n        display: 'contents',\n      },\n    });\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-cell-container': DatabaseCellContainer;\n  }\n}\n"]}