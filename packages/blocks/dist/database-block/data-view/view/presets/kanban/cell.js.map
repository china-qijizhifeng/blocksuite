{"version":3,"file":"cell.js","sourceRoot":"","sources":["../../../../../../src/database-block/data-view/view/presets/kanban/cell.ts"],"names":[],"mappings":"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","sourcesContent":["// related component\n\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { css } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { createRef } from 'lit/directives/ref.js';\nimport { html } from 'lit/static-html.js';\n\nimport type {\n  CellRenderProps,\n  DataViewCellLifeCycle,\n} from '../../../column/index.js';\nimport { renderUniLit } from '../../../utils/uni-component/uni-component.js';\nimport type {\n  DataViewKanbanColumnManager,\n  DataViewKanbanManager,\n} from './kanban-view-manager.js';\n\nconst styles = css`\n  affine-data-view-kanban-cell {\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    padding: 4px;\n    min-height: 20px;\n    border: 1px solid transparent;\n    box-sizing: border-box;\n  }\n\n  affine-data-view-kanban-cell:hover {\n    background-color: var(--affine-hover-color);\n  }\n\n  affine-data-view-kanban-cell .icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    align-self: start;\n    margin-right: 12px;\n    height: var(--data-view-cell-text-line-height);\n  }\n\n  affine-data-view-kanban-cell .icon svg {\n    width: 16px;\n    height: 16px;\n    fill: var(--affine-icon-color);\n    color: var(--affine-icon-color);\n  }\n\n  .kanban-cell {\n    flex: 1;\n    display: block;\n    width: 196px;\n  }\n`;\n\n@customElement('affine-data-view-kanban-cell')\nexport class KanbanCell extends WithDisposable(ShadowlessElement) {\n  get cell(): DataViewCellLifeCycle | undefined {\n    return this._cell.value;\n  }\n\n  get selection() {\n    return this.closest('affine-data-view-kanban')?.selectionController;\n  }\n\n  static override styles = styles;\n\n  private _cell = createRef<DataViewCellLifeCycle>();\n\n  @property({ attribute: false })\n  accessor contentOnly = false;\n\n  @property({ attribute: false })\n  accessor view!: DataViewKanbanManager;\n\n  @property({ attribute: false })\n  accessor groupKey!: string;\n\n  @property({ attribute: false })\n  accessor cardId!: string;\n\n  @property({ attribute: false })\n  accessor column!: DataViewKanbanColumnManager;\n\n  @state()\n  accessor isFocus = false;\n\n  @state()\n  accessor editing = false;\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._disposables.addFromEvent(this, 'click', e => {\n      if (e.shiftKey) {\n        return;\n      }\n      e.stopPropagation();\n      const selectionElement = this.closest(\n        'affine-data-view-kanban'\n      )?.selectionController;\n      if (!selectionElement) return;\n      if (e.shiftKey) return;\n\n      if (!this.editing) {\n        this.selectCurrentCell(!this.column.readonly);\n      }\n    });\n  }\n\n  selectCurrentCell = (editing: boolean) => {\n    const selectionElement = this.closest(\n      'affine-data-view-kanban'\n    )?.selectionController;\n    if (!selectionElement) return;\n\n    selectionElement.selection = {\n      selectionType: 'cell',\n      groupKey: this.groupKey,\n      cardId: this.cardId,\n      columnId: this.column.id,\n      isEditing: editing,\n    };\n  };\n\n  renderIcon() {\n    if (this.contentOnly) {\n      return;\n    }\n    return html` <uni-lit class=\"icon\" .uni=\"${this.column.icon}\"></uni-lit>`;\n  }\n\n  override render() {\n    const props: CellRenderProps = {\n      view: this.view,\n      column: this.column,\n      rowId: this.cardId,\n      isEditing: this.editing,\n      selectCurrentCell: this.selectCurrentCell,\n    };\n    const { view, edit } = this.column.renderer;\n    this.style.border = this.isFocus\n      ? '1px solid var(--affine-primary-color)'\n      : '';\n    this.style.boxShadow = this.editing\n      ? '0px 0px 0px 2px rgba(30, 150, 235, 0.30)'\n      : '';\n    return html` ${this.renderIcon()}\n    ${renderUniLit(this.editing && edit ? edit : view, props, {\n      ref: this._cell,\n      class: 'kanban-cell',\n      style: { display: 'block', flex: '1', overflow: 'hidden' },\n    })}`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-data-view-kanban-cell': KanbanCell;\n  }\n}\n"]}