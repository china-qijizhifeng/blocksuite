{"version":3,"file":"kanban-view-manager.js","sourceRoot":"","sources":["../../../../../../src/database-block/data-view/view/presets/kanban/kanban-view-manager.ts"],"names":[],"mappings":"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","sourcesContent":["import type { FilterGroup } from '../../../common/ast.js';\nimport {\n  GroupHelper,\n  sortByManually,\n} from '../../../common/group-by/helper.js';\nimport { groupByMatcher } from '../../../common/group-by/matcher.js';\nimport { defaultGroupBy } from '../../../common/view-manager.js';\nimport { evalFilter } from '../../../logical/eval-filter.js';\nimport type { TType } from '../../../logical/typesystem.js';\nimport type { InsertToPosition } from '../../../types.js';\nimport { insertPositionToIndex } from '../../../utils/insert.js';\nimport {\n  DataViewColumnManagerBase,\n  DataViewManagerBase,\n} from '../../data-view-manager.js';\nimport type { KanbanViewData } from './define.js';\n\nexport class DataViewKanbanManager extends DataViewManagerBase<KanbanViewData> {\n  get view() {\n    return this.viewSource.view;\n  }\n\n  get filter(): FilterGroup {\n    return this.view.filter;\n  }\n\n  get id() {\n    return this.view.id;\n  }\n\n  get name(): string {\n    return this.view.name;\n  }\n\n  get columns(): string[] {\n    return this.columnsWithoutFilter.filter(id => !this.columnGetHide(id));\n  }\n\n  get detailColumns(): string[] {\n    return this.columnsWithoutFilter.filter(\n      id => this.columnGetType(id) !== 'title'\n    );\n  }\n\n  get columnsWithoutFilter(): string[] {\n    const needShow = new Set(this.dataSource.properties);\n    const result: string[] = [];\n    this.view.columns.forEach(v => {\n      if (needShow.has(v.id)) {\n        result.push(v.id);\n        needShow.delete(v.id);\n      }\n    });\n    result.push(...needShow);\n    return result;\n  }\n\n  override get readonly(): boolean {\n    return this.viewSource.readonly;\n  }\n\n  get groupHelper(): GroupHelper | undefined {\n    const groupBy = this.view.groupBy;\n    if (!groupBy) {\n      return;\n    }\n    const result = groupByMatcher.find(v => v.data.name === groupBy.name);\n    if (!result) {\n      return;\n    }\n    const groupByConfig = result.data;\n    const type = this.columnGetDataType(groupBy.columnId);\n    if (!this.checkGroup(groupBy.columnId, result.type, type)) {\n      // reset groupBy config\n      return this.groupHelper;\n    }\n    return new GroupHelper(groupBy, groupByConfig, type, this, {\n      sortGroup: ids =>\n        sortByManually(\n          ids,\n          v => v,\n          this.view.groupProperties.map(v => v.key)\n        ),\n      sortRow: (key, ids) => {\n        const property = this.view.groupProperties.find(v => v.key === key);\n        return sortByManually(ids, v => v, property?.manuallyCardSort ?? []);\n      },\n      changeGroupSort: keys => {\n        const map = new Map(this.view.groupProperties.map(v => [v.key, v]));\n        this.updateView(() => {\n          return {\n            groupProperties: keys.map(key => {\n              const property = map.get(key);\n              if (property) {\n                return property;\n              }\n              return {\n                key,\n                hide: false,\n                manuallyCardSort: [],\n              };\n            }),\n          };\n        });\n      },\n      changeRowSort: (groupKeys, groupKey, keys) => {\n        const map = new Map(this.view.groupProperties.map(v => [v.key, v]));\n        this.updateView(() => {\n          return {\n            groupProperties: groupKeys.map(key => {\n              if (key === groupKey) {\n                const group = map.get(key);\n                return group\n                  ? {\n                      ...group,\n                      manuallyCardSort: keys,\n                    }\n                  : {\n                      key,\n                      hide: false,\n                      manuallyCardSort: keys,\n                    };\n              } else {\n                return (\n                  map.get(key) ?? {\n                    key,\n                    hide: false,\n                    manuallyCardSort: [],\n                  }\n                );\n              }\n            }),\n          };\n        });\n      },\n    });\n  }\n\n  get type(): string {\n    return this.view.mode;\n  }\n\n  get header() {\n    return this.view.header;\n  }\n\n  get isDeleted(): boolean {\n    return this.viewSource.isDeleted();\n  }\n\n  private updateView(\n    updater: (view: KanbanViewData) => Partial<KanbanViewData>\n  ) {\n    this.syncView();\n    this.viewSource.updateView(updater);\n  }\n\n  private syncView() {\n    if (this.view.columns.length === this.columns.length) {\n      return;\n    }\n    this.viewSource.updateView(_view => {\n      return {\n        columns: this.columnsWithoutFilter.map(id => {\n          const column = this.columnGet(id);\n          return {\n            id: column.id,\n            hide: column.hide,\n          };\n        }),\n      };\n    });\n  }\n\n  updateFilter(filter: FilterGroup): void {\n    this.updateView(() => {\n      return {\n        filter,\n      };\n    });\n  }\n\n  updateName(name: string): void {\n    this.updateView(() => {\n      return {\n        name,\n      };\n    });\n  }\n\n  columnGet(columnId: string): DataViewKanbanColumnManager {\n    return new DataViewKanbanColumnManager(columnId, this);\n  }\n\n  columnMove(columnId: string, toAfterOfColumn: InsertToPosition): void {\n    this.updateView(view => {\n      const columnIndex = view.columns.findIndex(v => v.id === columnId);\n      if (columnIndex < 0) {\n        return {};\n      }\n      const columns = [...view.columns];\n      const [column] = columns.splice(columnIndex, 1);\n      const index = insertPositionToIndex(toAfterOfColumn, columns);\n      columns.splice(index, 0, column);\n      return {\n        columns,\n      };\n    });\n  }\n\n  override rowMove(rowId: string, position: InsertToPosition): void {\n    this.dataSource.rowMove(rowId, position);\n  }\n\n  isShow(rowId: string): boolean {\n    if (this.filter.conditions.length) {\n      const rowMap = Object.fromEntries(\n        this.columnManagerList.map(column => [\n          column.id,\n          column.getJsonValue(rowId),\n        ])\n      );\n      return evalFilter(this.filter, rowMap);\n    }\n    return true;\n  }\n\n  checkGroup(columnId: string, type: TType, target: TType): boolean {\n    if (!groupByMatcher.isMatched(type, target)) {\n      this.changeGroup(columnId);\n      return false;\n    }\n    return true;\n  }\n\n  changeGroup(columnId: string) {\n    const column = this.columnGet(columnId);\n    this.updateView(_view => {\n      return {\n        groupBy: defaultGroupBy(\n          this.columnGetMeta(column.type),\n          column.id,\n          column.data\n        ),\n      };\n    });\n  }\n\n  addCard(position: InsertToPosition, group: string) {\n    const id = this.rowAdd(position);\n    this.groupHelper?.addToGroup(id, group);\n    return id;\n  }\n\n  isInHeader(columnId: string) {\n    const hd = this.view.header;\n\n    return (\n      hd.titleColumn === columnId ||\n      hd.iconColumn === columnId ||\n      hd.coverColumn === columnId\n    );\n  }\n\n  hasHeader(_rowId: string): boolean {\n    const hd = this.view.header;\n    return !!hd.titleColumn || !!hd.iconColumn || !!hd.coverColumn;\n  }\n\n  getHeaderTitle(_rowId: string): DataViewKanbanColumnManager | undefined {\n    const columnId = this.view.header.titleColumn;\n    if (!columnId) {\n      return;\n    }\n    return this.columnGet(columnId);\n  }\n\n  getHeaderIcon(_rowId: string): DataViewKanbanColumnManager | undefined {\n    const columnId = this.view.header.iconColumn;\n    if (!columnId) {\n      return;\n    }\n    return this.columnGet(columnId);\n  }\n\n  getHeaderCover(_rowId: string): DataViewKanbanColumnManager | undefined {\n    const columnId = this.view.header.coverColumn;\n    if (!columnId) {\n      return;\n    }\n    return this.columnGet(columnId);\n  }\n\n  columnUpdateHide(columnId: string, hide: boolean): void {\n    this.updateView(view => {\n      return {\n        columns: view.columns.map(v =>\n          v.id === columnId\n            ? {\n                ...v,\n                hide,\n              }\n            : v\n        ),\n      };\n    });\n  }\n\n  columnGetHide(columnId: string): boolean {\n    return this.view.columns.find(v => v.id === columnId)?.hide ?? false;\n  }\n\n  duplicateView(): void {\n    this.viewSource.duplicate();\n  }\n\n  deleteView(): void {\n    this.viewSource.delete();\n  }\n}\n\nexport class DataViewKanbanColumnManager extends DataViewColumnManagerBase {\n  constructor(\n    propertyId: string,\n    override dataViewManager: DataViewKanbanManager\n  ) {\n    super(propertyId, dataViewManager);\n  }\n}\n"]}