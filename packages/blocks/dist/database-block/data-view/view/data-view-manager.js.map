{"version":3,"file":"data-view-manager.js","sourceRoot":"","sources":["../../../../src/database-block/data-view/view/data-view-manager.ts"],"names":[],"mappings":"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","sourcesContent":["import { assertExists, type Disposable, Slot } from '@blocksuite/global/utils';\n\nimport type { ColumnMeta } from '../column/column-config.js';\nimport type { CellRenderer, ColumnConfig } from '../column/index.js';\nimport type { FilterGroup, Variable } from '../common/ast.js';\nimport type { DataSource, DetailSlots } from '../common/data-source/base.js';\nimport type { DataViewContextKey } from '../common/data-source/context.js';\nimport type { SingleViewSource } from '../common/index.js';\nimport type { TType } from '../logical/typesystem.js';\nimport type { ColumnDataUpdater, InsertToPosition } from '../types.js';\nimport type { UniComponent } from '../utils/uni-component/index.js';\nimport type { DataViewDataType } from './data-view.js';\n\nexport interface DataViewManager {\n  get id(): string;\n\n  get type(): string;\n\n  get readonly(): boolean;\n\n  get columnManagerList(): DataViewColumnManager[];\n\n  get columns(): string[];\n\n  get detailColumns(): string[];\n\n  get columnsWithoutFilter(): string[];\n\n  get rows(): string[];\n\n  get filter(): FilterGroup;\n\n  get filterVisible(): boolean;\n\n  get vars(): Variable[];\n\n  get allColumnConfig(): ColumnConfig[];\n\n  get isDeleted(): boolean;\n\n  get detailSlots(): DetailSlots;\n\n  slots: {\n    update: Slot<{\n      viewId: string;\n    }>;\n  };\n\n  filterSetVisible(visible: boolean): void;\n\n  updateFilter(filter: FilterGroup): void;\n\n  cellGetValue(rowId: string, columnId: string): unknown;\n\n  cellGetRenderValue(rowId: string, columnId: string): unknown;\n\n  cellGetJsonValue(rowId: string, columnId: string): unknown;\n\n  cellGetStringValue(rowId: string, columnId: string): string;\n\n  cellGetExtra(rowId: string, columnId: string): unknown | undefined;\n\n  cellSetValueFromString(\n    columnId: string,\n    value: string\n  ): {\n    value: unknown;\n    data?: Record<string, unknown>;\n  };\n\n  cellUpdateRenderValue(rowId: string, columnId: string, value: unknown): void;\n\n  cellUpdateValue(rowId: string, columnId: string, value: unknown): void;\n\n  rowDelete(ids: string[]): void;\n\n  rowAdd(insertPosition: InsertToPosition): string;\n\n  columnAdd(toAfterOfColumn: InsertToPosition, type?: string): string;\n\n  columnDelete(columnId: string): void;\n\n  columnDuplicate(columnId: string): void;\n\n  columnGet(columnId: string): DataViewColumnManager;\n\n  columnGetMeta(type: string): ColumnMeta;\n\n  columnGetPreColumn(columnId: string): DataViewColumnManager | undefined;\n\n  columnGetNextColumn(columnId: string): DataViewColumnManager | undefined;\n\n  columnGetName(columnId: string): string;\n\n  columnGetType(columnId: string): string;\n\n  columnGetHide(columnId: string): boolean;\n\n  columnGetData(columnId: string): Record<string, unknown>;\n\n  columnGetDataType(columnId: string): TType;\n\n  columnGetIndex(columnId: string): number;\n\n  columnGetIdByIndex(index: number): string;\n\n  columnGetReadonly(columnId: string): boolean;\n\n  columnUpdateName(columnId: string, name: string): void;\n\n  columnUpdateHide(columnId: string, hide: boolean): void;\n\n  columnUpdateType(columnId: string, type: string): void;\n\n  columnUpdateData(columnId: string, data: Record<string, unknown>): void;\n\n  getIcon(type: string): UniComponent | undefined;\n\n  onCellUpdate(\n    rowId: string,\n    columnId: string,\n    callback: () => void\n  ): Disposable;\n\n  columnMove(columnId: string, position: InsertToPosition): void;\n  rowMove(rowId: string, position: InsertToPosition): void;\n\n  duplicateView(): void;\n  deleteView(): void;\n\n  getContext<T>(key: DataViewContextKey<T>): T | undefined;\n}\n\nexport interface DataViewColumnManager<\n  Value = unknown,\n  Data extends Record<string, unknown> = Record<string, unknown>,\n> {\n  get dataViewManager(): DataViewManager;\n\n  get id(): string;\n\n  get index(): number;\n\n  get type(): string;\n\n  get dataType(): TType;\n\n  get name(): string;\n\n  get hide(): boolean;\n\n  get data(): Data;\n\n  get readonly(): boolean;\n\n  get renderer(): CellRenderer;\n\n  get detailRenderer(): CellRenderer;\n\n  get isFirst(): boolean;\n\n  get isLast(): boolean;\n\n  isEmpty(rowId: string): boolean;\n\n  getStringValue(rowId: string): string;\n\n  getJsonValue(rowId: string): unknown;\n\n  getValue(rowId: string): Value | undefined;\n\n  getExtra(rowId: string): unknown;\n\n  setValue(rowId: string, value: Value | undefined): void;\n\n  updateData(updater: ColumnDataUpdater<Data>): void;\n\n  updateHide(hide: boolean): void;\n\n  updateName(name: string): void;\n\n  get updateType(): undefined | ((type: string) => void);\n\n  get delete(): undefined | (() => void);\n\n  get duplicate(): undefined | (() => void);\n\n  get icon(): UniComponent | undefined;\n\n  onCellUpdate(rowId: string, callback: () => void): Disposable;\n}\n\nexport abstract class DataViewManagerBase<ViewData extends DataViewDataType>\n  implements DataViewManager\n{\n  protected get dataSource(): DataSource {\n    assertExists(this._dataSource, 'data source is not set');\n    return this._dataSource;\n  }\n\n  protected get viewSource(): SingleViewSource<ViewData> {\n    assertExists(this._viewSource, 'view source is not set');\n    return this._viewSource;\n  }\n\n  get rows(): string[] {\n    return this.filteredRows(this.searchString);\n  }\n\n  get columnManagerList(): ReturnType<this['columnGet']>[] {\n    return this.columns.map(\n      id => this.columnGet(id) as ReturnType<this['columnGet']>\n    );\n  }\n\n  get readonly(): boolean {\n    return false;\n  }\n\n  abstract get columns(): string[];\n\n  abstract get detailColumns(): string[];\n\n  abstract get columnsWithoutFilter(): string[];\n\n  abstract get id(): string;\n\n  abstract get type(): string;\n\n  get allColumnConfig(): ColumnConfig[] {\n    return this.dataSource.addPropertyConfigList;\n  }\n\n  abstract get isDeleted(): boolean;\n\n  get detailSlots(): DetailSlots {\n    return this.dataSource.detailSlots;\n  }\n\n  abstract get filter(): FilterGroup;\n\n  get vars(): Variable[] {\n    return this.columnsWithoutFilter.map(id => {\n      const v = this.columnGet(id);\n      const propertyMeta = this.dataSource.getPropertyMeta(v.type);\n      return {\n        id: v.id,\n        name: v.name,\n        type: propertyMeta.model.dataType(v.data),\n        icon: v.icon,\n      };\n    });\n  }\n\n  get filterVisible(): boolean {\n    return this._filterVisible ?? this.filter.conditions.length > 0;\n  }\n\n  private _viewSource?: SingleViewSource<ViewData>;\n\n  private _dataSource?: DataSource;\n\n  private searchString = '';\n\n  private _filterVisible?: boolean;\n\n  slots = {\n    update: new Slot<{\n      viewId: string;\n    }>(),\n  };\n\n  private filteredRows(searchString: string) {\n    return this.dataSource.rows.filter(id => {\n      if (searchString) {\n        const containsSearchString = this.columns.some(columnId => {\n          return this.cellGetStringValue(id, columnId)\n            ?.toLowerCase()\n            .includes(searchString?.toLowerCase());\n        });\n        if (!containsSearchString) {\n          return false;\n        }\n      }\n      return this.isShow(id);\n    });\n  }\n\n  getContext<T>(key: DataViewContextKey<T>): T | undefined {\n    return this.dataSource.getContext(key);\n  }\n\n  init(dataSource: DataSource, viewSource: SingleViewSource<ViewData>) {\n    this._dataSource = dataSource;\n    this._viewSource = viewSource;\n    this._dataSource.slots.update\n      .flatMap(() => ({ viewId: this.id }))\n      .pipe(this.slots.update);\n    this._viewSource.updateSlot.pipe(this.slots.update);\n  }\n\n  setSearch(str: string): void {\n    this.searchString = str;\n    this.slots.update.emit({ viewId: this.id });\n  }\n\n  abstract isShow(rowId: string): boolean;\n\n  onCellUpdate(\n    rowId: string,\n    columnId: string,\n    callback: () => void\n  ): Disposable {\n    return this.dataSource.onCellUpdate(rowId, columnId, callback);\n  }\n\n  cellGetValue(rowId: string, columnId: string): unknown {\n    return this.dataSource\n      .getPropertyMeta(this.columnGetType(columnId))\n      .model.formatValue(\n        this.dataSource.cellGetValue(rowId, columnId),\n        this.columnGetData(columnId)\n      );\n  }\n\n  cellGetJsonValue(rowId: string, columnId: string): unknown {\n    return this.dataSource\n      .getPropertyMeta(this.columnGetType(columnId))\n      .model.toJson(\n        this.dataSource.cellGetValue(rowId, columnId),\n        this.columnGetData(columnId)\n      );\n  }\n\n  cellGetRenderValue(rowId: string, columnId: string): unknown {\n    return this.dataSource.cellGetRenderValue(rowId, columnId);\n  }\n\n  cellGetStringValue(rowId: string, columnId: string): string {\n    return (\n      this.dataSource\n        .getPropertyMeta(this.columnGetType(columnId))\n        .model.toString(\n          this.dataSource.cellGetValue(rowId, columnId),\n          this.columnGetData(columnId)\n        ) ?? ''\n    );\n  }\n\n  cellGetExtra(rowId: string, columnId: string): unknown {\n    return this.dataSource.cellGetExtra(rowId, columnId);\n  }\n\n  cellSetValueFromString(columnId: string, cellData: string) {\n    return (\n      this.dataSource\n        .getPropertyMeta(this.columnGetType(columnId))\n        .model.fromString(cellData, this.columnGetData(columnId)) ?? ''\n    );\n  }\n\n  cellUpdateRenderValue(rowId: string, columnId: string, value: unknown): void {\n    this.dataSource.cellChangeValue(rowId, columnId, value);\n  }\n\n  cellUpdateValue(rowId: string, columnId: string, value: unknown): void {\n    this.dataSource.cellChangeValue(rowId, columnId, value);\n  }\n\n  columnAdd(position: InsertToPosition, type?: string): string {\n    const id = this.dataSource.propertyAdd(position, type);\n    this.columnMove(id, position);\n    return id;\n  }\n\n  columnDelete(columnId: string): void {\n    this.dataSource.propertyDelete(columnId);\n  }\n\n  columnDuplicate(columnId: string): void {\n    const id = this.dataSource.propertyDuplicate(columnId);\n    this.columnMove(id, {\n      before: false,\n      id: columnId,\n    });\n  }\n\n  abstract columnGet(columnId: string): DataViewColumnManager;\n\n  columnGetMeta(type: string): ColumnMeta {\n    return this.dataSource.getPropertyMeta(type);\n  }\n\n  columnGetData(columnId: string): Record<string, unknown> {\n    return this.dataSource.propertyGetData(columnId);\n  }\n\n  columnGetDataType(columnId: string): TType {\n    return this.dataSource\n      .getPropertyMeta(this.columnGetType(columnId))\n      .model.dataType(this.columnGetData(columnId));\n  }\n\n  abstract columnGetHide(columnId: string): boolean;\n\n  abstract columnUpdateHide(columnId: string, hide: boolean): void;\n\n  columnGetIdByIndex(index: number): string {\n    return this.columns[index];\n  }\n\n  columnGetReadonly(columnId: string): boolean {\n    return this.dataSource.propertyGetReadonly(columnId);\n  }\n\n  columnGetIndex(columnId: string): number {\n    return this.columns.indexOf(columnId);\n  }\n\n  columnGetName(columnId: string): string {\n    return this.dataSource.propertyGetName(columnId);\n  }\n\n  columnGetNextColumn(columnId: string): DataViewColumnManager | undefined {\n    return this.columnGet(\n      this.columnGetIdByIndex(this.columnGetIndex(columnId) + 1)\n    );\n  }\n\n  columnGetPreColumn(columnId: string): DataViewColumnManager | undefined {\n    return this.columnGet(\n      this.columnGetIdByIndex(this.columnGetIndex(columnId) - 1)\n    );\n  }\n\n  columnGetType(columnId: string): string {\n    return this.dataSource.propertyGetType(columnId);\n  }\n\n  columnUpdateData(columnId: string, data: Record<string, unknown>): void {\n    this.dataSource.propertyChangeData(columnId, data);\n  }\n\n  columnUpdateName(columnId: string, name: string): void {\n    this.dataSource.propertyChangeName(columnId, name);\n  }\n\n  columnUpdateType(columnId: string, type: string): void {\n    this.dataSource.propertyChangeType(columnId, type);\n  }\n\n  rowAdd(insertPosition: InsertToPosition | number): string {\n    return this.dataSource.rowAdd(insertPosition);\n  }\n\n  rowDelete(ids: string[]): void {\n    this.dataSource.rowDelete(ids);\n  }\n\n  getIcon(type: string): UniComponent | undefined {\n    return this.dataSource.getPropertyMeta(type).renderer.icon;\n  }\n\n  abstract columnMove(columnId: string, position: InsertToPosition): void;\n\n  abstract deleteView(): void;\n\n  abstract updateFilter(filter: FilterGroup): void;\n\n  filterSetVisible(visible: boolean): void {\n    this._filterVisible = visible;\n    this.slots.update.emit({ viewId: this.id });\n  }\n\n  rowMove(rowId: string, position: InsertToPosition): void {\n    this.dataSource.rowMove(rowId, position);\n  }\n\n  abstract duplicateView(): void;\n}\n\nexport abstract class DataViewColumnManagerBase\n  implements DataViewColumnManager\n{\n  protected constructor(\n    protected propertyId: string,\n    public dataViewManager: DataViewManager\n  ) {}\n\n  get index(): number {\n    return this.dataViewManager.columnGetIndex(this.id);\n  }\n\n  get data(): Record<string, unknown> {\n    return this.dataViewManager.columnGetData(this.id);\n  }\n\n  get hide(): boolean {\n    return this.dataViewManager.columnGetHide(this.id);\n  }\n\n  get id(): string {\n    return this.propertyId;\n  }\n\n  get isFirst(): boolean {\n    return this.dataViewManager.columnGetIndex(this.id) === 0;\n  }\n\n  get isLast(): boolean {\n    return (\n      this.dataViewManager.columnGetIndex(this.id) ===\n      this.dataViewManager.columnManagerList.length - 1\n    );\n  }\n\n  get name(): string {\n    return this.dataViewManager.columnGetName(this.id);\n  }\n\n  get renderer(): CellRenderer {\n    return this.dataViewManager.columnGetMeta(this.type).renderer.cellRenderer;\n  }\n\n  get detailRenderer(): CellRenderer {\n    return (\n      this.dataViewManager.columnGetMeta(this.type).renderer\n        .detailCellRenderer ?? this.renderer\n    );\n  }\n\n  get type(): string {\n    return this.dataViewManager.columnGetType(this.id);\n  }\n\n  get dataType(): TType {\n    return this.dataViewManager.columnGetDataType(this.id);\n  }\n\n  isEmpty(rowId: string): boolean {\n    return this.dataViewManager\n      .columnGetMeta(this.type)\n      .model.ops.isEmpty(this.getValue(rowId));\n  }\n\n  getValue(rowId: string): unknown | undefined {\n    return this.dataViewManager.cellGetRenderValue(rowId, this.id);\n  }\n\n  getExtra(rowId: string): unknown {\n    return this.dataViewManager.cellGetExtra(rowId, this.id);\n  }\n\n  setValue(rowId: string, value: unknown | undefined): void {\n    this.dataViewManager.cellUpdateRenderValue(rowId, this.id, value);\n  }\n\n  updateData(updater: ColumnDataUpdater): void {\n    const data = this.dataViewManager.columnGetData(this.id);\n    this.dataViewManager.columnUpdateData(this.id, {\n      ...data,\n      ...updater(data),\n    });\n  }\n\n  updateHide(hide: boolean): void {\n    this.dataViewManager.columnUpdateHide(this.id, hide);\n  }\n\n  updateName(name: string): void {\n    this.dataViewManager.columnUpdateName(this.id, name);\n  }\n\n  get delete(): (() => void) | undefined {\n    return () => this.dataViewManager.columnDelete(this.id);\n  }\n\n  get duplicate(): (() => void) | undefined {\n    return () => this.dataViewManager.columnDuplicate(this.id);\n  }\n\n  get updateType(): undefined | ((type: string) => void) {\n    return type => this.dataViewManager.columnUpdateType(this.id, type);\n  }\n\n  get readonly(): boolean {\n    return (\n      this.dataViewManager.readonly ||\n      this.dataViewManager.columnGetReadonly(this.id)\n    );\n  }\n\n  getJsonValue(rowId: string): unknown {\n    return this.dataViewManager.cellGetJsonValue(rowId, this.id);\n  }\n\n  getStringValue(rowId: string): string {\n    return this.dataViewManager.cellGetStringValue(rowId, this.id);\n  }\n\n  setValueFromString(value: string) {\n    const result = this.dataViewManager.cellSetValueFromString(this.id, value);\n\n    if (result.data) {\n      this.dataViewManager.columnUpdateData(this.id, result.data);\n    }\n    return result.value;\n  }\n\n  get icon(): UniComponent | undefined {\n    if (!this.type) return undefined;\n    return this.dataViewManager.getIcon(this.type);\n  }\n\n  onCellUpdate(rowId: string, callback: () => void): Disposable {\n    return this.dataViewManager.onCellUpdate(rowId, this.id, callback);\n  }\n}\n"]}