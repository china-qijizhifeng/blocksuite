{"version":3,"file":"base.js","sourceRoot":"","sources":["../../../../../src/database-block/data-view/common/data-source/base.ts"],"names":[],"mappings":"AAOA,OAAO,EAAE,oBAAoB,EAAE,MAAM,oCAAoC,CAAC;AA+D1E,MAAM,OAAgB,cAAc;IAApC;QAKE,YAAO,GAAG,IAAI,GAAG,EAAwC,CAAC;IA+F5D,CAAC;IAnGC,IAAI,WAAW;QACb,OAAO,EAAE,CAAC;IACZ,CAAC;IAcS,UAAU,CAAI,GAA0B,EAAE,KAAQ;QAC1D,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;IAC/B,CAAC;IAED,UAAU,CAAI,GAA0B;QACtC,OAAO,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAM,CAAC;IACpC,CAAC;IAQD,qBAAqB,CACnB,KAAa,EACb,UAAkB,EAClB,KAAc;QAEd,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,UAAU,EAAE,KAAK,CAAC,CAAC;IACjD,CAAC;IAED,kBAAkB,CAAC,KAAa,EAAE,UAAkB;QAClD,OAAO,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC;IAC9C,CAAC;IAED,YAAY,CAAC,MAAc,EAAE,WAAmB;QAC9C,OAAO,SAAS,CAAC;IACnB,CAAC;IAwBD,mBAAmB,CAAC,WAAmB;QACrC,OAAO,KAAK,CAAC;IACf,CAAC;IAED,uBAAuB,CAAC,WAAmB;QACzC,OAAO,oBAAoB,CAAC;IAC9B,CAAC;IAED,YAAY,CACV,MAAc,EACd,WAAmB,EACnB,SAAqB;QAErB,OAAO;YACL,OAAO,EAAE,GAAG,EAAE;gBACZ,EAAE;YACJ,CAAC;SACF,CAAC;IACJ,CAAC;CAaF","sourcesContent":["import type { Disposable, Slot } from '@blocksuite/global/utils';\n\nimport type { ColumnMeta } from '../../column/column-config.js';\nimport type { ColumnConfig } from '../../column/index.js';\nimport type { InsertToPosition } from '../../types.js';\nimport type { UniComponent } from '../../utils/uni-component/index.js';\nimport type { DataViewManager } from '../../view/data-view-manager.js';\nimport { DEFAULT_COLUMN_WIDTH } from '../../view/presets/table/consts.js';\nimport type { DataViewContextKey } from './context.js';\n\nexport type DetailSlotProps = {\n  view: DataViewManager;\n  rowId: string;\n};\n\nexport interface DetailSlots {\n  header?: UniComponent<DetailSlotProps>;\n  note?: UniComponent<DetailSlotProps>;\n}\n\nexport interface DataSource {\n  addPropertyConfigList: ColumnConfig[];\n\n  properties: string[];\n  rows: string[];\n  cellGetValue: (rowId: string, propertyId: string) => unknown;\n  cellGetRenderValue: (rowId: string, propertyId: string) => unknown;\n  cellGetExtra: (rowId: string, columnId: string) => unknown;\n  cellChangeRenderValue: (\n    rowId: string,\n    propertyId: string,\n    value: unknown\n  ) => unknown;\n  cellChangeValue: (rowId: string, propertyId: string, value: unknown) => void;\n  rowAdd: (InsertToPosition: InsertToPosition | number) => string;\n  rowDelete: (ids: string[]) => void;\n  propertyGetName: (propertyId: string) => string;\n  propertyGetDefaultWidth: (propertyId: string) => number;\n  propertyGetType: (propertyId: string) => string;\n  propertyGetData: (propertyId: string) => Record<string, unknown>;\n  propertyGetReadonly: (columnId: string) => boolean;\n  propertyChangeName: (propertyId: string, name: string) => void;\n  propertyChangeType: (propertyId: string, type: string) => void;\n  propertyChangeData: (\n    propertyId: string,\n    data: Record<string, unknown>\n  ) => void;\n  propertyAdd: (insertToPosition: InsertToPosition, type?: string) => string;\n  propertyDelete: (id: string) => void;\n  propertyDuplicate: (columnId: string) => string;\n\n  slots: {\n    update: Slot;\n  };\n\n  onCellUpdate: (\n    rowId: string,\n    propertyId: string,\n    callback: () => void\n  ) => Disposable;\n\n  detailSlots: DetailSlots;\n\n  getPropertyMeta(type: string): ColumnMeta;\n\n  rowMove(rowId: string, position: InsertToPosition): void;\n\n  getContext<T>(key: DataViewContextKey<T>): T | undefined;\n}\n\nexport abstract class BaseDataSource implements DataSource {\n  get detailSlots(): DetailSlots {\n    return {};\n  }\n\n  context = new Map<DataViewContextKey<unknown>, unknown>();\n\n  abstract properties: string[];\n\n  abstract rows: string[];\n\n  abstract slots: {\n    update: Slot;\n  };\n\n  abstract addPropertyConfigList: ColumnConfig[];\n\n  protected setContext<T>(key: DataViewContextKey<T>, value: T): void {\n    this.context.set(key, value);\n  }\n\n  getContext<T>(key: DataViewContextKey<T>): T | undefined {\n    return this.context.get(key) as T;\n  }\n\n  abstract cellChangeValue(\n    rowId: string,\n    propertyId: string,\n    value: unknown\n  ): void;\n\n  cellChangeRenderValue(\n    rowId: string,\n    propertyId: string,\n    value: unknown\n  ): void {\n    this.cellChangeValue(rowId, propertyId, value);\n  }\n\n  cellGetRenderValue(rowId: string, propertyId: string): unknown {\n    return this.cellGetValue(rowId, propertyId);\n  }\n\n  cellGetExtra(_rowId: string, _propertyId: string): unknown {\n    return undefined;\n  }\n\n  abstract cellGetValue(rowId: string, propertyId: string): unknown;\n\n  abstract propertyAdd(\n    insertToPosition: InsertToPosition,\n    type?: string\n  ): string;\n\n  abstract propertyChangeData(\n    propertyId: string,\n    data: Record<string, unknown>\n  ): void;\n\n  abstract propertyChangeName(propertyId: string, name: string): void;\n\n  abstract propertyChangeType(propertyId: string, type: string): void;\n\n  abstract propertyDelete(id: string): void;\n\n  abstract propertyDuplicate(columnId: string): string;\n\n  abstract propertyGetData(propertyId: string): Record<string, unknown>;\n\n  propertyGetReadonly(_propertyId: string): boolean {\n    return false;\n  }\n\n  propertyGetDefaultWidth(_propertyId: string): number {\n    return DEFAULT_COLUMN_WIDTH;\n  }\n\n  onCellUpdate(\n    _rowId: string,\n    _propertyId: string,\n    _callback: () => void\n  ): Disposable {\n    return {\n      dispose: () => {\n        //\n      },\n    };\n  }\n\n  abstract propertyGetName(propertyId: string): string;\n\n  abstract propertyGetType(propertyId: string): string;\n\n  abstract rowAdd(InsertToPosition: InsertToPosition | number): string;\n\n  abstract rowDelete(ids: string[]): void;\n\n  abstract getPropertyMeta(type: string): ColumnMeta;\n\n  abstract rowMove(rowId: string, position: InsertToPosition): void;\n}\n"]}