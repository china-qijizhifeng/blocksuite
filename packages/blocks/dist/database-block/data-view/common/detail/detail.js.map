{"version":3,"file":"detail.js","sourceRoot":"","sources":["../../../../../src/database-block/data-view/common/detail/detail.ts"],"names":[],"mappings":"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","sourcesContent":["import './field.js';\n\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { css, nothing, unsafeCSS } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { html } from 'lit/static-html.js';\n\nimport { popFilterableSimpleMenu } from '../../../../_common/components/index.js';\nimport { renderUniLit } from '../../utils/uni-component/uni-component.js';\nimport type { DataViewManager } from '../../view/data-view-manager.js';\nimport { dataViewCommonStyle } from '../css-variable.js';\nimport type { DetailSlotProps, DetailSlots } from '../data-source/base.js';\nimport { PlusIcon } from '../icons/index.js';\nimport { DetailSelection } from './selection.js';\n\nconst styles = css`\n  ${unsafeCSS(dataViewCommonStyle('affine-data-view-record-detail'))}\n  affine-data-view-record-detail {\n    display: flex;\n    flex: 1;\n    flex-direction: column;\n    padding: 20px 36px;\n    gap: 12px;\n    min-height: 100%;\n    background-color: var(--affine-background-primary-color);\n  }\n\n  .add-property {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: var(--data-view-cell-text-size);\n    font-style: normal;\n    font-weight: 400;\n    line-height: var(--data-view-cell-text-line-height);\n    color: var(--affine-text-disable-color);\n    border-radius: 4px;\n    padding: 6px 8px 6px 4px;\n    cursor: pointer;\n    margin-top: 8px;\n    width: max-content;\n  }\n\n  .add-property:hover {\n    background-color: var(--affine-hover-color);\n  }\n\n  .add-property .icon {\n    display: flex;\n    align-items: center;\n  }\n\n  .add-property .icon svg {\n    fill: var(--affine-icon-color);\n    width: 20px;\n    height: 20px;\n  }\n`;\n\n@customElement('affine-data-view-record-detail')\nexport class RecordDetail extends WithDisposable(ShadowlessElement) {\n  private get readonly() {\n    return this.view.readonly;\n  }\n\n  private get columns() {\n    return this.view.detailColumns.map(id => this.view.columnGet(id));\n  }\n\n  static override styles = styles;\n\n  @property({ attribute: false })\n  accessor view!: DataViewManager;\n\n  @property({ attribute: false })\n  accessor rowId!: string;\n\n  selection = new DetailSelection(this);\n\n  @query('.add-property')\n  accessor addPropertyButton!: HTMLElement;\n\n  detailSlots?: DetailSlots;\n\n  private renderHeader() {\n    const header = this.detailSlots?.header;\n    if (header) {\n      const props: DetailSlotProps = {\n        view: this.view,\n        rowId: this.rowId,\n      };\n      return renderUniLit(header, props);\n    }\n    return undefined;\n  }\n\n  private renderNote() {\n    const note = this.detailSlots?.note;\n    if (note) {\n      const props: DetailSlotProps = {\n        view: this.view,\n        rowId: this.rowId,\n      };\n      return renderUniLit(note, props);\n    }\n    return undefined;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this.disposables.add(\n      this.view.slots.update.on(() => {\n        this.requestUpdate();\n      })\n    );\n\n    this.disposables.addFromEvent(this, 'click', e => {\n      e.stopPropagation();\n      this.selection.selection = undefined;\n    });\n    //FIXME: simulate as a widget\n    this.dataset.widgetId = 'affine-detail-widget';\n    this.detailSlots = this.view.detailSlots;\n  }\n\n  _clickAddProperty = () => {\n    popFilterableSimpleMenu(\n      this.addPropertyButton,\n      this.view.allColumnConfig.map(config => {\n        return {\n          type: 'action',\n          name: config.name,\n          icon: html` <uni-lit\n            .uni=\"${this.view.getIcon(config.type)}\"\n          ></uni-lit>`,\n          select: () => {\n            this.view.columnAdd('end', config.type);\n          },\n        };\n      })\n    );\n  };\n\n  override render() {\n    const columns = this.columns;\n\n    return html`\n      <div\n        style=\"max-width: var(--affine-editor-width);display: flex;flex-direction: column;margin: 0 auto\"\n      >\n        ${this.renderHeader()}\n        ${repeat(\n          columns,\n          v => v.id,\n          column => {\n            return html` <affine-data-view-record-field\n              .view=\"${this.view}\"\n              .column=\"${column}\"\n              .rowId=\"${this.rowId}\"\n              data-column-id=\"${column.id}\"\n            ></affine-data-view-record-field>`;\n          }\n        )}\n        ${!this.readonly\n          ? html`<div class=\"add-property\" @click=\"${this._clickAddProperty}\">\n              <div class=\"icon\">${PlusIcon}</div>\n              Add Property\n            </div>`\n          : nothing}\n        <div style=\"width: var(--affine-editor-width)\"></div>\n      </div>\n      ${this.renderNote()}\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-data-view-record-detail': RecordDetail;\n  }\n}\n"]}