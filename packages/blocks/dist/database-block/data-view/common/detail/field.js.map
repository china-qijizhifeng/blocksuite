{"version":3,"file":"field.js","sourceRoot":"","sources":["../../../../../src/database-block/data-view/common/detail/field.ts"],"names":[],"mappings":"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","sourcesContent":["import { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { css } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { createRef } from 'lit/directives/ref.js';\nimport { html } from 'lit/static-html.js';\n\nimport { popMenu } from '../../../../_common/components/index.js';\nimport type {\n  CellRenderProps,\n  DataViewCellLifeCycle,\n} from '../../column/index.js';\nimport { renderUniLit } from '../../utils/uni-component/uni-component.js';\nimport type {\n  DataViewColumnManager,\n  DataViewManager,\n} from '../../view/data-view-manager.js';\nimport {\n  DatabaseDuplicate,\n  DatabaseMoveLeft,\n  DatabaseMoveRight,\n  DeleteIcon,\n  TextIcon,\n} from '../icons/index.js';\n\n@customElement('affine-data-view-record-field')\nexport class RecordField extends WithDisposable(ShadowlessElement) {\n  private get readonly() {\n    return this.view.readonly;\n  }\n\n  get cell(): DataViewCellLifeCycle | undefined {\n    return this._cell.value;\n  }\n\n  static override styles = css`\n    affine-data-view-record-field {\n      display: flex;\n      gap: 12px;\n    }\n\n    .field-left {\n      padding: 6px;\n      display: flex;\n      height: max-content;\n      align-items: center;\n      gap: 6px;\n      font-size: var(--data-view-cell-text-size);\n      line-height: var(--data-view-cell-text-line-height);\n      color: var(--affine-text-secondary-color);\n      width: 160px;\n      border-radius: 4px;\n      cursor: pointer;\n      user-select: none;\n    }\n\n    .field-left:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    affine-data-view-record-field .icon {\n      display: flex;\n      align-items: center;\n      width: 16px;\n      height: 16px;\n    }\n\n    affine-data-view-record-field .icon svg {\n      width: 16px;\n      height: 16px;\n      fill: var(--affine-icon-color);\n    }\n\n    .filed-name {\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n    }\n\n    .field-content {\n      padding: 6px 8px;\n      border-radius: 4px;\n      flex: 1;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      border: 1px solid transparent;\n    }\n\n    .field-content .affine-database-number {\n      text-align: left;\n      justify-content: start;\n    }\n\n    .field-content:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .field-content.is-editing {\n      box-shadow: 0px 0px 0px 2px rgba(30, 150, 235, 0.3);\n    }\n\n    .field-content.is-focus {\n      border: 1px solid var(--affine-primary-color);\n    }\n    .field-content.empty::before {\n      content: 'Empty';\n      color: var(--affine-text-disable-color);\n      font-size: 14px;\n      line-height: 22px;\n    }\n  `;\n\n  private _cell = createRef<DataViewCellLifeCycle>();\n\n  @property({ attribute: false })\n  accessor view!: DataViewManager;\n\n  @property({ attribute: false })\n  accessor column!: DataViewColumnManager;\n\n  @property({ attribute: false })\n  accessor rowId!: string;\n\n  @state()\n  accessor isFocus = false;\n\n  @state()\n  accessor editing = false;\n\n  changeEditing = (editing: boolean) => {\n    const selection = this.closest('affine-data-view-record-detail')?.selection;\n    if (selection) {\n      selection.selection = {\n        propertyId: this.column.id,\n        isEditing: editing,\n      };\n    }\n  };\n\n  _click = (e: MouseEvent) => {\n    e.stopPropagation();\n    if (this.readonly) return;\n\n    this.changeEditing(true);\n  };\n\n  _clickLeft = (e: MouseEvent) => {\n    if (this.readonly) return;\n    const ele = e.currentTarget as HTMLElement;\n    const columns = this.view.detailColumns;\n    popMenu(ele, {\n      options: {\n        input: {\n          initValue: this.column.name,\n          onComplete: text => {\n            this.column.updateName(text);\n          },\n        },\n        items: [\n          {\n            type: 'sub-menu',\n            name: 'Column Type',\n            icon: TextIcon,\n            hide: () => !this.column.updateType || this.column.type === 'title',\n            options: {\n              input: {\n                search: true,\n              },\n              items: this.view.allColumnConfig\n                .filter(v => v.type !== this.column.type)\n                .map(config => {\n                  return {\n                    type: 'action',\n                    name: config.name,\n                    icon: html` <uni-lit\n                      .uni=\"${this.view.getIcon(config.type)}\"\n                    ></uni-lit>`,\n                    select: () => {\n                      this.column.updateType?.(config.type);\n                    },\n                  };\n                }),\n            },\n          },\n          {\n            type: 'action',\n            name: 'Duplicate Column',\n            icon: DatabaseDuplicate,\n            hide: () => !this.column.duplicate || this.column.type === 'title',\n            select: () => {\n              this.column.duplicate?.();\n            },\n          },\n          {\n            type: 'action',\n            name: 'Move Up',\n            icon: html` <div\n              style=\"transform: rotate(90deg);display:flex;align-items:center;\"\n            >\n              ${DatabaseMoveLeft}\n            </div>`,\n            hide: () => columns.findIndex(v => v === this.column.id) === 0,\n            select: () => {\n              const index = columns.findIndex(v => v === this.column.id);\n              const targetId = columns[index - 1];\n              if (!targetId) {\n                return;\n              }\n              this.view.columnMove(this.column.id, {\n                id: targetId,\n                before: true,\n              });\n            },\n          },\n          {\n            type: 'action',\n            name: 'Move Down',\n            icon: html` <div\n              style=\"transform: rotate(90deg);display:flex;align-items:center;\"\n            >\n              ${DatabaseMoveRight}\n            </div>`,\n            hide: () =>\n              columns.findIndex(v => v === this.column.id) ===\n              columns.length - 1,\n            select: () => {\n              const index = columns.findIndex(v => v === this.column.id);\n              const targetId = columns[index + 1];\n              if (!targetId) {\n                return;\n              }\n              this.view.columnMove(this.column.id, {\n                id: targetId,\n                before: false,\n              });\n            },\n          },\n          {\n            type: 'group',\n            name: 'operation',\n            children: () => [\n              {\n                type: 'action',\n                name: 'Delete Column',\n                icon: DeleteIcon,\n                hide: () => !this.column.delete || this.column.type === 'title',\n                select: () => {\n                  this.column.delete?.();\n                },\n                class: 'delete-item',\n              },\n            ],\n          },\n        ],\n      },\n    });\n  };\n\n  override render() {\n    const column = this.column;\n\n    const props: CellRenderProps = {\n      view: this.view,\n      column: this.column,\n      rowId: this.rowId,\n      isEditing: this.editing,\n      selectCurrentCell: this.changeEditing,\n    };\n    const { view, edit } = this.column.renderer;\n    const contentClass = classMap({\n      'field-content': true,\n      empty: !this.editing && this.column.isEmpty(this.rowId),\n      'is-editing': this.editing,\n      'is-focus': this.isFocus,\n    });\n    return html`\n      <div>\n        <div class=\"field-left\" @click=\"${this._clickLeft}\">\n          <div class=\"icon\">\n            <uni-lit .uni=\"${this.column.icon}\"></uni-lit>\n          </div>\n          <div class=\"filed-name\">${column.name}</div>\n        </div>\n      </div>\n      <div @click=\"${this._click}\" class=\"${contentClass}\">\n        ${renderUniLit(this.editing && edit ? edit : view, props, {\n          ref: this._cell,\n          class: 'kanban-cell',\n        })}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-data-view-record-field': RecordField;\n  }\n}\n"]}