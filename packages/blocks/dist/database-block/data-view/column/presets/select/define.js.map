{"version":3,"file":"define.js","sourceRoot":"","sources":["../../../../../../src/database-block/data-view/column/presets/select/define.ts"],"names":[],"mappings":"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","sourcesContent":["import { nanoid, Text } from '@blocksuite/store';\n\nimport { tTag } from '../../../logical/data-type.js';\nimport { getTagColor } from '../../../utils/tags/colors.js';\nimport type { SelectTag } from '../../../utils/tags/multi-tag-select.js';\nimport { columnType } from '../../column-config.js';\nimport type { SelectColumnData } from '../../types.js';\n\nexport const selectColumnType = columnType('select');\n\ndeclare global {\n  interface ColumnConfigMap {\n    [selectColumnType.type]: typeof selectColumnModelConfig.model;\n  }\n}\nexport const selectColumnModelConfig = selectColumnType.modelConfig<\n  string,\n  SelectColumnData\n>({\n  name: 'Select',\n  type: data => tTag.create({ tags: data.options }),\n  defaultData: () => ({\n    options: [],\n  }),\n  addGroup: (text, oldData) => {\n    return {\n      options: [\n        ...oldData.options,\n        { id: nanoid(), value: text, color: getTagColor() },\n      ],\n    };\n  },\n  cellToString: (data, colData) =>\n    colData.options.find(v => v.id === data)?.value ?? '',\n  cellFromString: (data, colData) => {\n    if (!data) {\n      return { value: null, data: colData };\n    }\n    const optionMap = Object.fromEntries(\n      colData.options.map(v => [v.value, v])\n    );\n    const name = data\n      .split(',')\n      .map(v => v.trim())\n      .filter(v => v)[0];\n\n    let value = null;\n    const option = optionMap[name];\n    if (!option) {\n      const newOption: SelectTag = {\n        id: nanoid(),\n        value: name,\n        color: getTagColor(),\n      };\n      colData.options.push(newOption);\n      value = newOption.id;\n    } else {\n      value = option.id;\n    }\n\n    return {\n      value,\n      data: colData,\n    };\n  },\n  cellToJson: data => data ?? null,\n  isEmpty: data => data == null,\n});\n\nselectColumnModelConfig.addConvert('multi-select', (column, cells) => ({\n  column,\n  cells: cells.map(v => (v ? [v] : undefined)),\n}));\n\nselectColumnModelConfig.addConvert('rich-text', (column, cells) => {\n  const optionMap = Object.fromEntries(column.options.map(v => [v.id, v]));\n  return {\n    column: {},\n    cells: cells.map(v => new Text(v ? optionMap[v]?.value : '').yText),\n  };\n});\n"]}