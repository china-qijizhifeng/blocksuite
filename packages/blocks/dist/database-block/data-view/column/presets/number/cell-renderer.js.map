{"version":3,"file":"cell-renderer.js","sourceRoot":"","sources":["../../../../../../src/database-block/data-view/column/presets/number/cell-renderer.ts"],"names":[],"mappings":"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","sourcesContent":["import { IS_MAC } from '@blocksuite/global/env';\nimport { baseTheme } from '@toeverything/theme';\nimport { css, html, unsafeCSS } from 'lit';\nimport { customElement, query } from 'lit/decorators.js';\n\nimport { stopPropagation } from '../../../utils/event.js';\nimport { createIcon } from '../../../utils/uni-icon.js';\nimport { BaseCellRenderer } from '../../base-cell.js';\nimport { createFromBaseCellRenderer } from '../../renderer.js';\nimport { numberColumnModelConfig } from './define.js';\n\n@customElement('affine-database-number-cell')\nexport class NumberCell extends BaseCellRenderer<number> {\n  static override styles = css`\n    affine-database-number-cell {\n      display: block;\n      width: 100%;\n    }\n\n    .affine-database-number {\n      display: flex;\n      align-items: center;\n      justify-content: flex-end;\n      width: 100%;\n      padding: 0;\n      border: none;\n      font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n      font-size: var(--data-view-cell-text-size);\n      line-height: var(--data-view-cell-text-line-height);\n      color: var(--affine-text-primary-color);\n      font-weight: 400;\n      background-color: transparent;\n    }\n  `;\n\n  override render() {\n    return html` <div class=\"affine-database-number number\">\n      ${this.value ?? ''}\n    </div>`;\n  }\n}\n\n@customElement('affine-database-number-cell-editing')\nexport class NumberCellEditing extends BaseCellRenderer<number> {\n  static override styles = css`\n    affine-database-number-cell-editing {\n      display: block;\n      width: 100%;\n      cursor: text;\n    }\n\n    .affine-database-number {\n      display: flex;\n      align-items: center;\n      width: 100%;\n      padding: 0;\n      border: none;\n      font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n      font-size: var(--data-view-cell-text-size);\n      line-height: var(--data-view-cell-text-line-height);\n      color: var(--affine-text-primary-color);\n      font-weight: 400;\n      background-color: transparent;\n      text-align: right;\n    }\n\n    .affine-database-number:focus {\n      outline: none;\n    }\n  `;\n\n  @query('input')\n  private accessor _inputEle!: HTMLInputElement;\n\n  private _setValue = (str: string = this._inputEle.value) => {\n    if (!str) {\n      this.onChange(undefined);\n      return;\n    }\n    const value = Number.parseFloat(str);\n    if (Object.is(value, NaN)) {\n      this._inputEle.value = `${this.value ?? ''}`;\n      return;\n    }\n    this._inputEle.value = `${this.value ?? ''}`;\n    this.onChange(value);\n  };\n\n  private _keydown = (e: KeyboardEvent) => {\n    const ctrlKey = IS_MAC ? e.metaKey : e.ctrlKey;\n\n    if (e.key.toLowerCase() === 'z' && ctrlKey) {\n      e.stopPropagation();\n      return;\n    }\n\n    if (e.key === 'Enter' && !e.isComposing) {\n      requestAnimationFrame(() => {\n        this.selectCurrentCell(false);\n      });\n    }\n  };\n\n  focusEnd = () => {\n    const end = this._inputEle.value.length;\n    this._inputEle.focus();\n    this._inputEle.setSelectionRange(end, end);\n  };\n\n  override onExitEditMode() {\n    this._setValue();\n  }\n\n  override firstUpdated() {\n    requestAnimationFrame(() => {\n      this.focusEnd();\n    });\n  }\n\n  _blur() {\n    this.selectCurrentCell(false);\n  }\n\n  _focus() {\n    if (!this.isEditing) {\n      this.selectCurrentCell(true);\n    }\n  }\n\n  override render() {\n    const value = `${this.value ?? ''}`;\n    return html`<input\n      type=\"text\"\n      autocomplete=\"off\"\n      .value=\"${value}\"\n      @keydown=\"${this._keydown}\"\n      @blur=\"${this._blur}\"\n      @focus=\"${this._focus}\"\n      class=\"affine-database-number number\"\n      @pointerdown=\"${stopPropagation}\"\n    />`;\n  }\n}\n\nexport const numberColumnConfig = numberColumnModelConfig.renderConfig({\n  icon: createIcon('DatabaseNumber'),\n  cellRenderer: {\n    view: createFromBaseCellRenderer(NumberCell),\n    edit: createFromBaseCellRenderer(NumberCellEditing),\n  },\n});\n"]}