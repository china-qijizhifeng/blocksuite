{"version":3,"file":"define.js","sourceRoot":"","sources":["../../../../../../src/database-block/data-view/column/presets/multi-select/define.ts"],"names":[],"mappings":"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","sourcesContent":["import { nanoid, Text } from '@blocksuite/store';\n\nimport { tTag } from '../../../logical/data-type.js';\nimport { tArray } from '../../../logical/typesystem.js';\nimport { getTagColor } from '../../../utils/tags/colors.js';\nimport type { SelectTag } from '../../../utils/tags/multi-tag-select.js';\nimport { columnType } from '../../column-config.js';\nimport type { SelectColumnData } from '../../types.js';\n\nexport const multiSelectColumnType = columnType('multi-select');\ndeclare global {\n  interface ColumnConfigMap {\n    [multiSelectColumnType.type]: typeof multiSelectColumnModelConfig.model;\n  }\n}\nexport const multiSelectColumnModelConfig = multiSelectColumnType.modelConfig<\n  string[],\n  SelectColumnData\n>({\n  name: 'Multi-select',\n  type: data => tArray(tTag.create({ tags: data.options })),\n  defaultData: () => ({\n    options: [],\n  }),\n  addGroup: (text, oldData) => {\n    return {\n      options: [\n        ...oldData.options,\n        { id: nanoid(), value: text, color: getTagColor() },\n      ],\n    };\n  },\n  formatValue: v => {\n    if (Array.isArray(v)) {\n      return v.filter(v => v != null);\n    }\n    return [];\n  },\n  cellToString: (data, colData) =>\n    data?.map(id => colData.options.find(v => v.id === id)?.value).join(','),\n  cellFromString: (data, colData) => {\n    const optionMap = Object.fromEntries(\n      colData.options.map(v => [v.value, v])\n    );\n    const optionNames = data\n      .split(',')\n      .map(v => v.trim())\n      .filter(v => v);\n\n    const value: string[] = [];\n    optionNames.forEach(name => {\n      if (!optionMap[name]) {\n        const newOption: SelectTag = {\n          id: nanoid(),\n          value: name,\n          color: getTagColor(),\n        };\n        colData.options.push(newOption);\n        value.push(newOption.id);\n      } else {\n        value.push(optionMap[name].id);\n      }\n    });\n\n    return {\n      value,\n      data: colData,\n    };\n  },\n  cellToJson: data => data ?? null,\n  isEmpty: data => data == null || data.length === 0,\n});\nmultiSelectColumnModelConfig.addConvert('select', (column, cells) => ({\n  column,\n  cells: cells.map(v => v?.[0]),\n}));\nmultiSelectColumnModelConfig.addConvert('rich-text', (column, cells) => {\n  const optionMap = Object.fromEntries(column.options.map(v => [v.id, v]));\n  return {\n    column: {},\n    cells: cells.map(\n      arr => new Text(arr?.map(v => optionMap[v]?.value ?? '').join(',')).yText\n    ),\n  };\n});\n"]}