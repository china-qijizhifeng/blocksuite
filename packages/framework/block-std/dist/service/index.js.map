{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/service/index.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,eAAe,EAAE,MAAM,0BAA0B,CAAC;AAa3D,MAAM,OAAO,YAAY;IASvB,YAAY,OAA4B;QAJ/B,gBAAW,GAAG,IAAI,eAAe,EAAE,CAAC;QAK3C,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;QAC/B,IAAI,CAAC,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC;QACvB,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC,KAAK,CAAC;IACjC,CAAC;IAED,IAAI,UAAU;QACZ,OAAO,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC;IAC7B,CAAC;IAED,IAAI,GAAG;QACL,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC;IACtB,CAAC;IAED,IAAI,IAAI;QACN,OAAO,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC;IACvB,CAAC;IAED,IAAI,gBAAgB;QAClB,OAAO,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC;IAC5B,CAAC;IAED,IAAI,iBAAiB;QACnB,OAAO,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC;IACxB,CAAC;IAED,mBAAmB;IACnB,OAAO;QACL,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE,CAAC;IAC7B,CAAC;IAED,OAAO;QACL,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;IACjD,CAAC;IAED,SAAS;QACP,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;IACnD,CAAC;IACD,iBAAiB;IAEjB,uBAAuB;IACvB,WAAW,CACT,IAAe,EACf,EAAkB,EAClB,OAA6B;QAE7B,IAAI,CAAC,WAAW,CAAC,GAAG,CAClB,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,IAAI,EAAE,EAAE,EAAE;YACnC,OAAO,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO;SACpD,CAAC,CACH,CAAC;IACJ,CAAC;IAED,UAAU,CACR,MAAsC,EACtC,OAA6B;QAE7B,IAAI,CAAC,WAAW,CAAC,GAAG,CAClB,IAAI,CAAC,iBAAiB,CAAC,UAAU,CAAC,MAAM,EAAE;YACxC,OAAO,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO;SACpD,CAAC,CACH,CAAC;IACJ,CAAC;CAEF","sourcesContent":["import { DisposableGroup } from '@blocksuite/global/utils';\nimport type { BlockModel } from '@blocksuite/store';\n\nimport type { EventName, UIEventHandler } from '../event/index.js';\nimport type { BlockStdScope } from '../scope/index.js';\nimport type { BlockSpecSlots } from '../spec/slots.js';\n\nexport interface BlockServiceOptions {\n  flavour: string;\n  std: BlockStdScope;\n  slots: BlockSpecSlots;\n}\n\nexport class BlockService<_Model extends BlockModel = BlockModel> {\n  readonly std: BlockStdScope;\n\n  readonly flavour: string;\n\n  readonly disposables = new DisposableGroup();\n\n  readonly specSlots: BlockSpecSlots;\n\n  constructor(options: BlockServiceOptions) {\n    this.flavour = options.flavour;\n    this.std = options.std;\n    this.specSlots = options.slots;\n  }\n\n  get collection() {\n    return this.std.collection;\n  }\n\n  get doc() {\n    return this.std.doc;\n  }\n\n  get host() {\n    return this.std.host;\n  }\n\n  get selectionManager() {\n    return this.std.selection;\n  }\n\n  get uiEventDispatcher() {\n    return this.std.event;\n  }\n\n  // life cycle start\n  dispose() {\n    this.disposables.dispose();\n  }\n\n  mounted() {\n    this.specSlots.mounted.emit({ service: this });\n  }\n\n  unmounted() {\n    this.specSlots.unmounted.emit({ service: this });\n  }\n  // life cycle end\n\n  // event handlers start\n  handleEvent(\n    name: EventName,\n    fn: UIEventHandler,\n    options?: { global: boolean }\n  ) {\n    this.disposables.add(\n      this.uiEventDispatcher.add(name, fn, {\n        flavour: options?.global ? undefined : this.flavour,\n      })\n    );\n  }\n\n  bindHotKey(\n    keymap: Record<string, UIEventHandler>,\n    options?: { global: boolean }\n  ) {\n    this.disposables.add(\n      this.uiEventDispatcher.bindHotkey(keymap, {\n        flavour: options?.global ? undefined : this.flavour,\n      })\n    );\n  }\n  // event handlers end\n}\n\nexport type BlockServiceConstructor<T extends BlockService = BlockService> =\n  new (options: BlockServiceOptions) => T;\n"]}