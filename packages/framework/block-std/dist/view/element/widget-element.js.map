{"version":3,"file":"widget-element.js","sourceRoot":"","sources":["../../../src/view/element/widget-element.ts"],"names":[],"mappings":"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","sourcesContent":["import { assertExists } from '@blocksuite/global/utils';\nimport type { BlockModel, Doc } from '@blocksuite/store';\nimport { LitElement } from 'lit';\nimport { property } from 'lit/decorators.js';\n\nimport type { EventName, UIEventHandler } from '../../event/index.js';\nimport type { BlockService } from '../../service/index.js';\nimport { WithDisposable } from '../utils/with-disposable.js';\nimport type { BlockElement } from './block-element.js';\nimport type { EditorHost } from './lit-host.js';\n\nexport class WidgetElement<\n  Model extends BlockModel = BlockModel,\n  B extends BlockElement = BlockElement,\n  S extends BlockService = BlockService,\n> extends WithDisposable(LitElement) {\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor doc!: Doc;\n\n  @property({ attribute: false })\n  accessor model!: Model;\n\n  path!: string[];\n\n  service!: S;\n\n  blockElement!: B;\n\n  get flavour(): string {\n    assertExists(this.blockElement);\n    return this.blockElement.model.flavour;\n  }\n\n  get std() {\n    return this.host.std;\n  }\n\n  handleEvent = (\n    name: EventName,\n    handler: UIEventHandler,\n    options?: { global?: boolean }\n  ) => {\n    this._disposables.add(\n      this.host.event.add(name, handler, {\n        flavour: options?.global ? undefined : this.flavour,\n      })\n    );\n  };\n\n  bindHotKey(\n    keymap: Record<string, UIEventHandler>,\n    options?: { global: boolean }\n  ) {\n    this._disposables.add(\n      this.host.event.bindHotkey(keymap, {\n        flavour: options?.global ? undefined : this.flavour,\n      })\n    );\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    const id = this.dataset.widgetId as string;\n    this.std.view.setWidget(this);\n    const parentElement = this.parentElement;\n    assertExists(parentElement);\n    // TODO(mirone/#6534): find a better way to get block element from a node\n    this.blockElement = parentElement.closest('[data-block-id]') as B;\n    this.service = this.blockElement.service as S;\n    this.path = this.host.view.calculatePath(this.model).concat(id);\n    this.service.specSlots.widgetConnected.emit({\n      service: this.blockElement.service,\n      component: this,\n    });\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.std.view.deleteWidget(this);\n    this.service.specSlots.widgetDisconnected.emit({\n      service: this.blockElement.service,\n      component: this,\n    });\n  }\n\n  override render(): unknown {\n    return null;\n  }\n}\n"]}