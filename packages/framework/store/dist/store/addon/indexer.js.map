{"version":3,"file":"indexer.js","sourceRoot":"","sources":["../../../src/store/addon/indexer.ts"],"names":[],"mappings":"AACA,OAAO,EACL,eAAe,EACf,YAAY,EACZ,aAAa,GACd,MAAM,wBAAwB,CAAC;AAEhC,OAAO,EAAE,YAAY,EAAE,MAAM,aAAa,CAAC;AAY3C,MAAM,CAAC,MAAM,OAAO,GAAG,YAAY,CACjC,aAAa,CAAC,EAAE,CACd,KAAM,SAAQ,aAAa;IAGzB,YAAY,YAAkC;QAC5C,KAAK,CAAC,YAAY,CAAC,CAAC;QACpB,MAAM,YAAY,GAAG,IAAI,YAAY,CAAC,IAAI,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;QACvE,IAAI,CAAC,OAAO,GAAG;YACb,MAAM,EAAE,CAAC,YAAY,CAAC,kBAAkB;gBACtC,CAAC,CAAC,IAAI,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC;gBAC7B,CAAC,CAAC,IAAI;YACR,QAAQ,EAAE,IAAI,eAAe,CAAC,YAAY,CAAC;SAC5C,CAAC;IACJ,CAAC;IAED,MAAM,CAAC,KAAmB;QACxB,OAAO,CACL,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,MAAM,CAAC,KAAK,CAAC;YAClC,IAAI,GAAG,EAMJ,CACJ,CAAC;IACJ,CAAC;CACF,CACJ,CAAC","sourcesContent":["import type { QueryContent } from '../../indexer/index.js';\nimport {\n  BacklinkIndexer,\n  BlockIndexer,\n  SearchIndexer,\n} from '../../indexer/index.js';\nimport type { DocCollectionOptions } from '../collection.js';\nimport { addOnFactory } from './shared.js';\n\ntype Indexer = {\n  search: SearchIndexer | null;\n  backlink: BacklinkIndexer | null;\n};\n\nexport interface IndexerAddon {\n  indexer: Indexer;\n  search: (query: QueryContent) => Map<string, string>;\n}\n\nexport const indexer = addOnFactory<keyof IndexerAddon>(\n  originalClass =>\n    class extends originalClass {\n      indexer: Indexer;\n\n      constructor(storeOptions: DocCollectionOptions) {\n        super(storeOptions);\n        const blockIndexer = new BlockIndexer(this.doc, { slots: this.slots });\n        this.indexer = {\n          search: !storeOptions.disableSearchIndex\n            ? new SearchIndexer(this.doc)\n            : null,\n          backlink: new BacklinkIndexer(blockIndexer),\n        };\n      }\n\n      search(query: QueryContent) {\n        return (\n          this.indexer.search?.search(query) ??\n          new Map<\n            string,\n            {\n              space: string;\n              content: string;\n            }\n          >()\n        );\n      }\n    }\n);\n"]}