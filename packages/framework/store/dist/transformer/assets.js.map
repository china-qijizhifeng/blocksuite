{"version":3,"file":"assets.js","sourceRoot":"","sources":["../../src/transformer/assets.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,YAAY,EAAE,MAAM,0BAA0B,CAAC;AAaxD,MAAM,OAAO,aAAa;IAKxB,YAAY,OAA4B;QAJvB,eAAU,GAAG,IAAI,GAAG,EAAgB,CAAC;QAKpD,IAAI,CAAC,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC;IAC5B,CAAC;IAED,SAAS;QACP,OAAO,IAAI,CAAC,UAAU,CAAC;IACzB,CAAC;IAED,OAAO;QACL,OAAO,IAAI,CAAC,UAAU,CAAC,IAAI,KAAK,CAAC,CAAC;IACpC,CAAC;IAED,OAAO;QACL,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;IAC1B,CAAC;IAED,KAAK,CAAC,YAAY,CAAC,MAAc;QAC/B,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAC1C,YAAY,CAAC,IAAI,EAAE,QAAQ,MAAM,4BAA4B,CAAC,CAAC;QAE/D,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;IACpC,CAAC;IAED,KAAK,CAAC,WAAW,CAAC,MAAc;QAC9B,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACzC,YAAY,CAAC,IAAI,CAAC,CAAC;QAEnB,MAAM,MAAM,GAAG,CAAC,MAAM,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,KAAK,IAAI,CAAC;QACvD,IAAI,MAAM,EAAE,CAAC;YACX,OAAO;QACT,CAAC;QAED,MAAM,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;IACrC,CAAC;CACF","sourcesContent":["import { assertExists } from '@blocksuite/global/utils';\n\ninterface BlobCRUD {\n  get: (key: string) => Promise<Blob | null> | Blob | null;\n  set: (key: string, value: Blob) => Promise<string> | string;\n  delete: (key: string) => Promise<void> | void;\n  list: () => Promise<string[]> | string[];\n}\n\ntype AssetsManagerConfig = {\n  blob: BlobCRUD;\n};\n\nexport class AssetsManager {\n  private readonly _assetsMap = new Map<string, Blob>();\n\n  private readonly _blob: BlobCRUD;\n\n  constructor(options: AssetsManagerConfig) {\n    this._blob = options.blob;\n  }\n\n  getAssets() {\n    return this._assetsMap;\n  }\n\n  isEmpty() {\n    return this._assetsMap.size === 0;\n  }\n\n  cleanup() {\n    this._assetsMap.clear();\n  }\n\n  async readFromBlob(blobId: string) {\n    const blob = await this._blob.get(blobId);\n    assertExists(blob, `Blob ${blobId} not found in blob manager`);\n\n    this._assetsMap.set(blobId, blob);\n  }\n\n  async writeToBlob(blobId: string) {\n    const blob = this._assetsMap.get(blobId);\n    assertExists(blob);\n\n    const exists = (await this._blob.get(blobId)) !== null;\n    if (exists) {\n      return;\n    }\n\n    await this._blob.set(blobId, blob);\n  }\n}\n"]}