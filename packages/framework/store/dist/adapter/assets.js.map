{"version":3,"file":"assets.js","sourceRoot":"","sources":["../../src/adapter/assets.ts"],"names":[],"mappings":"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","sourcesContent":["import { assertExists, sha } from '@blocksuite/global/utils';\n\n/**\n * @internal just for test\n */\nexport class MemoryBlobCRUD {\n  private readonly _map = new Map<string, Blob>();\n\n  get(key: string) {\n    return this._map.get(key) ?? null;\n  }\n\n  async set(value: Blob): Promise<string>;\n  async set(key: string, value: Blob): Promise<string>;\n  async set(valueOrKey: string | Blob, _value?: Blob) {\n    const key =\n      typeof valueOrKey === 'string'\n        ? valueOrKey\n        : await sha(await valueOrKey.arrayBuffer());\n    const value = typeof valueOrKey === 'string' ? _value : valueOrKey;\n\n    if (!value) {\n      throw new Error('value is required');\n    }\n\n    this._map.set(key, value);\n    return key;\n  }\n\n  delete(key: string) {\n    this._map.delete(key);\n  }\n\n  list() {\n    return Array.from(this._map.keys());\n  }\n}\n\nexport const mimeExtMap = new Map([\n  ['audio/aac', 'aac'],\n  ['application/x-abiword', 'abw'],\n  ['image/apng', 'apng'],\n  ['application/x-freearc', 'arc'],\n  ['image/avif', 'avif'],\n  ['video/x-msvideo', 'avi'],\n  ['application/vnd.amazon.ebook', 'azw'],\n  ['application/octet-stream', 'bin'],\n  ['image/bmp', 'bmp'],\n  ['application/x-bzip', 'bz'],\n  ['application/x-bzip2', 'bz2'],\n  ['application/x-cdf', 'cda'],\n  ['application/x-csh', 'csh'],\n  ['text/css', 'css'],\n  ['text/csv', 'csv'],\n  ['application/msword', 'doc'],\n  [\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    'docx',\n  ],\n  ['application/vnd.ms-fontobject', 'eot'],\n  ['application/epub+zip', 'epub'],\n  ['application/gzip', 'gz'],\n  ['image/gif', 'gif'],\n  ['text/html', 'html'],\n  ['image/vnd.microsoft.icon', 'ico'],\n  ['text/calendar', 'ics'],\n  ['application/java-archive', 'jar'],\n  ['image/jpeg', 'jpeg'],\n  ['text/javascript', 'js'],\n  ['application/json', 'json'],\n  ['application/ld+json', 'jsonld'],\n  ['audio/midi', 'mid'],\n  ['audio/x-midi', 'midi'],\n  ['audio/mpeg', 'mp3'],\n  ['video/mp4', 'mp4'],\n  ['video/mpeg', 'mpeg'],\n  ['application/vnd.apple.installer+xml', 'mpkg'],\n  ['application/vnd.oasis.opendocument.presentation', 'odp'],\n  ['application/vnd.oasis.opendocument.spreadsheet', 'ods'],\n  ['application/vnd.oasis.opendocument.text', 'odt'],\n  ['audio/ogg', 'oga'],\n  ['video/ogg', 'ogv'],\n  ['application/ogg', 'ogx'],\n  ['audio/opus', 'opus'],\n  ['font/otf', 'otf'],\n  ['image/png', 'png'],\n  ['application/pdf', 'pdf'],\n  ['application/x-httpd-php', 'php'],\n  ['application/vnd.ms-powerpoint', 'ppt'],\n  [\n    'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n    'pptx',\n  ],\n  ['application/vnd.rar', 'rar'],\n  ['application/rtf', 'rtf'],\n  ['application/x-sh', 'sh'],\n  ['image/svg+xml', 'svg'],\n  ['application/x-tar', 'tar'],\n  ['image/tiff', 'tiff'],\n  ['video/mp2t', 'ts'],\n  ['font/ttf', 'ttf'],\n  ['text/plain', 'txt'],\n  ['application/vnd.visio', 'vsd'],\n  ['audio/wav', 'wav'],\n  ['audio/webm', 'weba'],\n  ['video/webm', 'webm'],\n  ['image/webp', 'webp'],\n  ['font/woff', 'woff'],\n  ['font/woff2', 'woff2'],\n  ['application/xhtml+xml', 'xhtml'],\n  ['application/vnd.ms-excel', 'xls'],\n  ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'xlsx'],\n  ['application/xml', 'xml'],\n  ['text/xml', 'xml'],\n  ['application/vnd.mozilla.xul+xml', 'xul'],\n  ['application/zip', 'zip'],\n  ['application/zstd', 'zst'],\n  ['video/3gpp', '3gp'],\n  ['audio/3gpp', '3gp'],\n  ['video/3gpp2', '3g2'],\n  ['audio/3gpp2', '3g2'],\n  ['application/x-7z-compressed', '7z'],\n]);\n\nexport const extMimeMap = new Map(\n  Array.from(mimeExtMap.entries()).map(([mime, ext]) => [ext, mime])\n);\n\nexport function getAssetName(assets: Map<string, Blob>, blobId: string) {\n  const getExt = (type: string) => {\n    if (type === '') return 'blob';\n    const ext = mimeExtMap.get(type);\n    if (ext) return ext;\n    const exts = type.split('/');\n    return exts.at(-1) ?? 'blob';\n  };\n  const blob = assets.get(blobId);\n  assertExists(blob);\n  const name = (blob as File).name ?? undefined;\n  const ext =\n    name !== undefined && name.includes('.')\n      ? name.split('.').at(-1)\n      : getExt(blob.type);\n  return `${name?.split('.').at(0) ?? blobId}.${ext}`;\n}\n"]}