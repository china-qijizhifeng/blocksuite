{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../src/utils/utils.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,gBAAgB,CAAC;AAC1C,OAAO,KAAK,CAAC,MAAM,KAAK,CAAC;AAGzB,OAAO,EAAE,QAAQ,EAAE,MAAM,cAAc,CAAC;AACxC,OAAO,EAAE,QAAQ,EAAE,MAAM,sBAAsB,CAAC;AAGhD,OAAO,EAAE,kBAAkB,EAAE,MAAM,mBAAmB,CAAC;AAKvD,MAAM,UAAU,mBAAmB,CACjC,OAAgB,EAChB,KAA0B;IAE1B,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC;QAAE,OAAO;IAE3C,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;QAC7B,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC;YAC3B,MAAM,IAAI,KAAK,CAAC,oBAAoB,GAAG,KAAK,CAAC,EAAE,CAAC,CAAC;QACnD,CAAC;IACH,CAAC,CAAC,CAAC;AACL,CAAC;AAED,MAAM,UAAU,cAAc,CAC5B,MAAmC,EACnC,KAAiB,EACjB,MAAc,EACd,KAA0B;IAE1B,MAAM,YAAY,GAAG,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,kBAAkB,CAAC,IAAI,EAAE,CAAC;IAEpE,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,EAAE,KAAK,CAAC,EAAE,EAAE;QAC7C,IAAI,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC;YAAE,OAAO;QAC9B,IAAI,KAAK,KAAK,SAAS;YAAE,OAAO;QAEhC,aAAa;QACb,KAAK,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;IACrB,CAAC,CAAC,CAAC;IAEH,oBAAoB;IACpB,MAAM,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,EAAE,KAAK,CAAC,EAAE,EAAE;QACpD,MAAM,SAAS,GACb,CAAC,MAAM,CAAC,GAAG,CAAC,QAAQ,GAAG,EAAE,CAAC,IAAI,MAAM,CAAC,GAAG,CAAC,QAAQ,GAAG,EAAE,CAAC,KAAK,SAAS,CAAC;QACxE,IAAI,CAAC,SAAS,EAAE,CAAC;YACf,OAAO;QACT,CAAC;QAED,aAAa;QACb,KAAK,CAAC,GAAG,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;IAC/B,CAAC,CAAC,CAAC;AACL,CAAC;AAED,MAAM,UAAU,6BAA6B,CAC3C,UAAyB;IAEzB,OAAO,QAAQ,CAAC,CAAC,CAAC,qBAAqB,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC;AAC3D,CAAC;AAED,MAAM,CAAC,MAAM,IAAI,GAAG,CAAC,GAAW,EAAE,EAAE;IAClC,OAAO,GAAG;SACP,KAAK,CAAC,EAAE,CAAC;SACT,MAAM,CACL,CAAC,QAAQ,EAAE,OAAO,EAAE,EAAE,CACpB,CAAC,CAAC,QAAQ,IAAI,CAAC,CAAC,GAAG,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,EAC1D,CAAC,CACF,CAAC;AACN,CAAC,CAAC","sourcesContent":["import { toBase64 } from 'lib0/buffer.js';\nimport * as Y from 'yjs';\nimport type { z } from 'zod';\n\nimport { SYS_KEYS } from '../consts.js';\nimport { native2Y } from '../reactive/index.js';\nimport type { BlockModel } from '../schema/base.js';\nimport type { BlockSchema } from '../schema/base.js';\nimport { internalPrimitives } from '../schema/base.js';\nimport type { YBlock } from '../store/doc/block.js';\nimport type { BlockProps, YBlocks } from '../store/doc/block-collection.js';\nimport type { DocCollection } from '../store/index.js';\n\nexport function assertValidChildren(\n  yBlocks: YBlocks,\n  props: Partial<BlockProps>\n) {\n  if (!Array.isArray(props.children)) return;\n\n  props.children.forEach(child => {\n    if (!yBlocks.has(child.id)) {\n      throw new Error('Invalid child id: ' + child.id);\n    }\n  });\n}\n\nexport function syncBlockProps(\n  schema: z.infer<typeof BlockSchema>,\n  model: BlockModel,\n  yBlock: YBlock,\n  props: Partial<BlockProps>\n) {\n  const defaultProps = schema.model.props?.(internalPrimitives) ?? {};\n\n  Object.entries(props).forEach(([key, value]) => {\n    if (SYS_KEYS.has(key)) return;\n    if (value === undefined) return;\n\n    // @ts-ignore\n    model[key] = value;\n  });\n\n  // set default value\n  Object.entries(defaultProps).forEach(([key, value]) => {\n    const notExists =\n      !yBlock.has(`prop:${key}`) || yBlock.get(`prop:${key}`) === undefined;\n    if (!notExists) {\n      return;\n    }\n\n    // @ts-ignore\n    model[key] = native2Y(value);\n  });\n}\n\nexport function encodeCollectionAsYjsUpdateV2(\n  collection: DocCollection\n): string {\n  return toBase64(Y.encodeStateAsUpdateV2(collection.doc));\n}\n\nexport const hash = (str: string) => {\n  return str\n    .split('')\n    .reduce(\n      (prevHash, currVal) =>\n        ((prevHash << 5) - prevHash + currVal.charCodeAt(0)) | 0,\n      0\n    );\n};\n"]}