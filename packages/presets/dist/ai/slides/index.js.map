{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../src/ai/slides/index.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EditorHost } from '@blocksuite/block-std';\nimport type { EdgelessRootService } from '@blocksuite/blocks';\nimport type { BlockSnapshot } from '@blocksuite/store';\n\nimport { markdownToSnapshot } from '../_common/markdown-utils.js';\nimport { getSurfaceElementFromEditor } from '../_common/selection-utils.js';\nimport {\n  basicTheme,\n  type PPTDoc,\n  type PPTSection,\n  type TemplateImage,\n} from './template.js';\n\nexport const PPTBuilder = (host: EditorHost) => {\n  const service = host.spec.getService<EdgelessRootService>('affine:page');\n  const docs: PPTDoc[] = [];\n  const contents: unknown[] = [];\n  const allImages: TemplateImage[][] = [];\n\n  const addDoc = async (block: BlockSnapshot) => {\n    const sections = block.children.map(v => {\n      const title = getText(v);\n      const keywords = getText(v.children[0]);\n      const content = getText(v.children[1]);\n      return {\n        title,\n        keywords,\n        content,\n      } satisfies PPTSection;\n    });\n    const doc: PPTDoc = {\n      isCover: docs.length === 0,\n      title: getText(block),\n      sections,\n    };\n    docs.push(doc);\n\n    if (doc.isCover) return;\n    const job = service.createTemplateJob('template');\n    const { images, content } = await basicTheme(doc);\n    contents.push(content);\n    allImages.push(images);\n    if (images.length) {\n      await Promise.all(\n        images.map(({ id, url }) =>\n          fetch(url)\n            .then(res => res.blob())\n            .then(blob => job.job.assets.set(id, blob))\n        )\n      );\n    }\n    await job.insertTemplate(content);\n    getSurfaceElementFromEditor(host).refresh();\n  };\n\n  return {\n    process: async (text: string) => {\n      try {\n        const snapshot = await markdownToSnapshot(text, host);\n\n        const block = snapshot.snapshot.content[0];\n        for (let i = 0; i < block.children.length; i++) {\n          await addDoc(block.children[i]);\n          const { centerX, centerY, zoom } = service.getFitToScreenData();\n          service.viewport.setViewport(zoom, [centerX, centerY]);\n        }\n      } catch (e) {\n        console.error(e);\n      }\n\n      return { contents, images: allImages };\n    },\n    done: async (text: string) => {\n      const snapshot = await markdownToSnapshot(text, host);\n      const block = snapshot.snapshot.content[0];\n      await addDoc(block.children[block.children.length - 1]);\n    },\n  };\n};\n\nconst getText = (block: BlockSnapshot) => {\n  // @ts-ignore\n  return block.props.text?.delta?.[0]?.insert ?? '';\n};\n"]}