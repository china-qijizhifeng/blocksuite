{"version":3,"file":"edgeless.js","sourceRoot":"","sources":["../../../src/ai/utils/edgeless.ts"],"names":[],"mappings":"AAKA,OAAO,EACL,8BAA8B,EAC9B,aAAa,EACb,mBAAmB,GAEpB,MAAM,oBAAoB,CAAC;AAE5B,MAAM,UAAU,iBAAiB,CAAC,OAA4B;IAC5D,IAAI,WAAW,GAAG,EAAE,CAAC;IAErB,MAAM,QAAQ,GAAG,CACf,IAAqD,EACrD,SAAiB,CAAC,EAClB,EAAE;QACF,MAAM,IAAI,GAAI,IAAI,CAAC,OAA6B,CAAC,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;QAExE,WAAW,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,IAAI,IAAI,CAAC;QAEnD,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;YAClB,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,EAAE,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;QAC5D,CAAC;IACH,CAAC,CAAC;IAEF,QAAQ,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;IAE1B,OAAO,WAAW,CAAC;AACrB,CAAC;AAED,MAAM,UAAU,aAAa,CAAC,GAAiC;IAC7D,MAAM,KAAK,GAAG,GAAG,EAAE,KAAK,CAAC;IAEzB,OAAO,KAAK,YAAY,mBAAmB,IAAI,KAAK,CAAC,IAAI,CAAC,OAAO,KAAK,GAAG,CAAC;AAC5E,CAAC;AAED,MAAM,UAAU,cAAc,CAAC,GAAiC;IAC9D,OAAO,GAAG,EAAE,KAAK,YAAY,mBAAmB,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;AAC1E,CAAC;AAED,MAAM,UAAU,UAAU,CAAC,IAAgB;IACzC,MAAM,eAAe,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAC1C,aAAa,CACS,CAAC;IAEzB,OAAO,eAAe,CAAC;AACzB,CAAC;AAED,MAAM,UAAU,wBAAwB,CACtC,IAAgB;IAEhB,MAAM,WAAW,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,EAAY,CAAC;IAChD,MAAM,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CACvC,8BAA8B,EAC9B,WAAW,CACa,CAAC;IAE3B,OAAO,aAAa,CAAC;AACvB,CAAC;AAED,MAAM,UAAU,kBAAkB,CAAC,YAA0B;IAC3D,IAAI,QAAQ,GAAG,YAAY,CAAC;IAC5B,OAAO,QAAQ,EAAE,CAAC;QAChB,IAAI,aAAa,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,aAAa,CAAC,CAAC,EAAE,CAAC;YACnD,OAAO,QAAQ,CAAC,KAAK,CAAC;QACxB,CAAC;QACD,IAAI,aAAa,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,aAAa,EAAE,gBAAgB,CAAC,CAAC,EAAE,CAAC;YACrE,OAAO,IAAI,CAAC;QACd,CAAC;QACD,QAAQ,GAAG,QAAQ,CAAC,kBAAkB,CAAC;IACzC,CAAC;IACD,OAAO,IAAI,CAAC;AACd,CAAC","sourcesContent":["import type { BlockElement, EditorHost } from '@blocksuite/block-std';\nimport type {\n  EdgelessCopilotWidget,\n  EdgelessRootService,\n} from '@blocksuite/blocks';\nimport {\n  AFFINE_EDGELESS_COPILOT_WIDGET,\n  matchFlavours,\n  MindmapElementModel,\n  type ShapeElementModel,\n} from '@blocksuite/blocks';\n\nexport function mindMapToMarkdown(mindmap: MindmapElementModel) {\n  let markdownStr = '';\n\n  const traverse = (\n    node: MindmapElementModel['tree']['children'][number],\n    indent: number = 0\n  ) => {\n    const text = (node.element as ShapeElementModel).text?.toString() ?? '';\n\n    markdownStr += `${'  '.repeat(indent)}- ${text}\\n`;\n\n    if (node.children) {\n      node.children.forEach(node => traverse(node, indent + 2));\n    }\n  };\n\n  traverse(mindmap.tree, 0);\n\n  return markdownStr;\n}\n\nexport function isMindMapRoot(ele: BlockSuite.EdgelessModelType) {\n  const group = ele?.group;\n\n  return group instanceof MindmapElementModel && group.tree.element === ele;\n}\n\nexport function isMindmapChild(ele: BlockSuite.EdgelessModelType) {\n  return ele?.group instanceof MindmapElementModel && !isMindMapRoot(ele);\n}\n\nexport function getService(host: EditorHost) {\n  const edgelessService = host.spec.getService(\n    'affine:page'\n  ) as EdgelessRootService;\n\n  return edgelessService;\n}\n\nexport function getEdgelessCopilotWidget(\n  host: EditorHost\n): EdgelessCopilotWidget {\n  const rootBlockId = host.doc.root?.id as string;\n  const copilotWidget = host.view.getWidget(\n    AFFINE_EDGELESS_COPILOT_WIDGET,\n    rootBlockId\n  ) as EdgelessCopilotWidget;\n\n  return copilotWidget;\n}\n\nexport function findNoteBlockModel(blockElement: BlockElement) {\n  let curBlock = blockElement;\n  while (curBlock) {\n    if (matchFlavours(curBlock.model, ['affine:note'])) {\n      return curBlock.model;\n    }\n    if (matchFlavours(curBlock.model, ['affine:page', 'affine:surface'])) {\n      return null;\n    }\n    curBlock = curBlock.parentBlockElement;\n  }\n  return null;\n}\n"]}