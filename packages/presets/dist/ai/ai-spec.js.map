{"version":3,"file":"ai-spec.js","sourceRoot":"","sources":["../../src/ai/ai-spec.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BlockSpec } from '@blocksuite/block-std';\nimport {\n  AFFINE_AI_PANEL_WIDGET,\n  AFFINE_EDGELESS_COPILOT_WIDGET,\n  AffineAIPanelWidget,\n  AffineCodeToolbarWidget,\n  AffineFormatBarWidget,\n  AffineImageToolbarWidget,\n  AffineSlashMenuWidget,\n  CodeBlockSpec,\n  EdgelessCopilotWidget,\n  EdgelessElementToolbarWidget,\n  EdgelessRootBlockSpec,\n  ImageBlockSpec,\n  PageRootBlockSpec,\n  ParagraphBlockService,\n  ParagraphBlockSpec,\n} from '@blocksuite/blocks';\nimport { assertInstanceOf } from '@blocksuite/global/utils';\nimport { literal, unsafeStatic } from 'lit/static-html.js';\n\nimport { buildAIPanelConfig } from './ai-panel.js';\nimport { setupCodeToolbarEntry } from './entries/code-toolbar/setup-code-toolbar.js';\nimport {\n  setupEdgelessCopilot,\n  setupEdgelessElementToolbarEntry,\n} from './entries/edgeless/index.js';\nimport { setupFormatBarEntry } from './entries/format-bar/setup-format-bar.js';\nimport { setupImageToolbarEntry } from './entries/image-toolbar/setup-image-toolbar.js';\nimport { setupSlashMenuEntry } from './entries/slash-menu/setup-slash-menu.js';\nimport { setupSpaceEntry } from './entries/space/setup-space.js';\n\nexport const AIPageRootBlockSpec: BlockSpec = {\n  ...PageRootBlockSpec,\n  view: {\n    ...PageRootBlockSpec.view,\n    widgets: {\n      ...PageRootBlockSpec.view.widgets,\n      [AFFINE_AI_PANEL_WIDGET]: literal`${unsafeStatic(\n        AFFINE_AI_PANEL_WIDGET\n      )}`,\n    },\n  },\n  setup: (slots, disposableGroup) => {\n    PageRootBlockSpec.setup?.(slots, disposableGroup);\n    disposableGroup.add(\n      slots.widgetConnected.on(view => {\n        if (view.component instanceof AffineAIPanelWidget) {\n          view.component.style.width = '630px';\n          view.component.config = buildAIPanelConfig(view.component);\n          setupSpaceEntry(view.component);\n        }\n\n        if (view.component instanceof AffineFormatBarWidget) {\n          setupFormatBarEntry(view.component);\n        }\n\n        if (view.component instanceof AffineSlashMenuWidget) {\n          setupSlashMenuEntry(view.component);\n        }\n      })\n    );\n  },\n};\n\nexport const AIEdgelessRootBlockSpec: BlockSpec = {\n  ...EdgelessRootBlockSpec,\n  view: {\n    ...EdgelessRootBlockSpec.view,\n    widgets: {\n      ...EdgelessRootBlockSpec.view.widgets,\n      [AFFINE_EDGELESS_COPILOT_WIDGET]: literal`${unsafeStatic(\n        AFFINE_EDGELESS_COPILOT_WIDGET\n      )}`,\n      [AFFINE_AI_PANEL_WIDGET]: literal`${unsafeStatic(\n        AFFINE_AI_PANEL_WIDGET\n      )}`,\n    },\n  },\n  setup(slots, disposableGroup) {\n    EdgelessRootBlockSpec.setup?.(slots, disposableGroup);\n    slots.widgetConnected.on(view => {\n      if (view.component instanceof AffineAIPanelWidget) {\n        view.component.style.width = '430px';\n        view.component.config = buildAIPanelConfig(view.component);\n        setupSpaceEntry(view.component);\n      }\n\n      if (view.component instanceof EdgelessCopilotWidget) {\n        setupEdgelessCopilot(view.component);\n      }\n\n      if (view.component instanceof EdgelessElementToolbarWidget) {\n        setupEdgelessElementToolbarEntry(view.component);\n      }\n\n      if (view.component instanceof AffineFormatBarWidget) {\n        setupFormatBarEntry(view.component);\n      }\n\n      if (view.component instanceof AffineSlashMenuWidget) {\n        setupSlashMenuEntry(view.component);\n      }\n    });\n  },\n};\n\nexport const AIParagraphBlockSpec: BlockSpec = {\n  ...ParagraphBlockSpec,\n  setup(slots, disposableGroup) {\n    ParagraphBlockSpec.setup?.(slots, disposableGroup);\n    slots.mounted.on(({ service }) => {\n      assertInstanceOf(service, ParagraphBlockService);\n      service.placeholderGenerator = model => {\n        if (model.type === 'text') {\n          return \"Type '/' for commands, 'space' for AI\";\n        }\n\n        const placeholders = {\n          h1: 'Heading 1',\n          h2: 'Heading 2',\n          h3: 'Heading 3',\n          h4: 'Heading 4',\n          h5: 'Heading 5',\n          h6: 'Heading 6',\n          quote: '',\n        };\n        return placeholders[model.type];\n      };\n    });\n  },\n};\n\nexport const AICodeBlockSpec: BlockSpec = {\n  ...CodeBlockSpec,\n  setup(slots, disposableGroup) {\n    CodeBlockSpec.setup?.(slots, disposableGroup);\n    slots.widgetConnected.on(view => {\n      if (view.component instanceof AffineCodeToolbarWidget) {\n        setupCodeToolbarEntry(view.component);\n      }\n    });\n  },\n};\n\nexport const AIImageBlockSpec: BlockSpec = {\n  ...ImageBlockSpec,\n  setup(slots, disposableGroup) {\n    ImageBlockSpec.setup?.(slots, disposableGroup);\n    slots.widgetConnected.on(view => {\n      if (view.component instanceof AffineImageToolbarWidget) {\n        setupImageToolbarEntry(view.component);\n      }\n    });\n  },\n};\n"]}