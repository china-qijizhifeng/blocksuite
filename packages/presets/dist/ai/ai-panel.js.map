{"version":3,"file":"ai-panel.js","sourceRoot":"","sources":["../../src/ai/ai-panel.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EditorHost } from '@blocksuite/block-std';\nimport {\n  AFFINE_AI_PANEL_WIDGET,\n  AffineAIPanelWidget,\n  type AffineAIPanelWidgetConfig,\n  type AIItemConfig,\n  Bound,\n  ImageBlockModel,\n  isInsideEdgelessEditor,\n  matchFlavours,\n  NoteDisplayMode,\n} from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { TemplateResult } from 'lit';\n\nimport {\n  AIPenIcon,\n  AIStarIconWithAnimation,\n  ChatWithAIIcon,\n  CreateIcon,\n  DiscardIcon,\n  InsertBelowIcon,\n  InsertTopIcon,\n  ReplaceIcon,\n  RetryIcon,\n} from './_common/icons.js';\nimport { INSERT_ABOVE_ACTIONS } from './actions/consts.js';\nimport { createTextRenderer } from './messages/text.js';\nimport { AIProvider } from './provider.js';\nimport { reportResponse } from './utils/action-reporter.js';\nimport { findNoteBlockModel, getService } from './utils/edgeless.js';\nimport {\n  copyTextAnswer,\n  insertAbove,\n  insertBelow,\n  replace,\n} from './utils/editor-actions.js';\nimport { insertFromMarkdown } from './utils/markdown-utils.js';\nimport { getSelections } from './utils/selection-utils.js';\n\nfunction getSelection(host: EditorHost) {\n  const textSelection = host.selection.find('text');\n  const mode = textSelection ? 'flat' : 'highest';\n  const { selectedBlocks } = getSelections(host, mode);\n  assertExists(selectedBlocks);\n  const length = selectedBlocks.length;\n  const firstBlock = selectedBlocks[0];\n  const lastBlock = selectedBlocks[length - 1];\n  const selectedModels = selectedBlocks.map(block => block.model);\n  return {\n    textSelection,\n    selectedModels,\n    firstBlock,\n    lastBlock,\n  };\n}\n\nfunction useAsCaption<T extends keyof BlockSuitePresets.AIActions>(\n  host: EditorHost,\n  id?: T\n): AIItemConfig {\n  return {\n    name: 'Use as caption',\n    icon: AIPenIcon,\n    showWhen: () => {\n      const panel = getAIPanel(host);\n      return id === 'generateCaption' && !!panel.answer;\n    },\n    handler: () => {\n      reportResponse('result:use-as-caption');\n      const panel = getAIPanel(host);\n      const caption = panel.answer;\n      if (!caption) return;\n\n      const { selectedBlocks } = getSelections(host);\n      if (!selectedBlocks || selectedBlocks.length !== 1) return;\n\n      const imageBlock = selectedBlocks[0].model;\n      if (!(imageBlock instanceof ImageBlockModel)) return;\n\n      host.doc.updateBlock(imageBlock, { caption });\n      panel.hide();\n    },\n  };\n}\n\nfunction createNewNote(host: EditorHost): AIItemConfig {\n  return {\n    name: 'Create new note',\n    icon: CreateIcon,\n    showWhen: () => {\n      const panel = getAIPanel(host);\n      return !!panel.answer && isInsideEdgelessEditor(host);\n    },\n    handler: () => {\n      reportResponse('result:add-note');\n      // get the note block\n      const { selectedBlocks } = getSelections(host);\n      if (!selectedBlocks || !selectedBlocks.length) return;\n      const firstBlock = selectedBlocks[0];\n      const noteModel = findNoteBlockModel(firstBlock);\n      if (!noteModel) return;\n\n      // create a new note block at the left of the current note block\n      const bound = Bound.deserialize(noteModel.xywh);\n      const newBound = new Bound(bound.x - bound.w - 20, bound.y, bound.w, 72);\n      const doc = host.doc;\n      const panel = getAIPanel(host);\n      const service = getService(host);\n      doc.transact(() => {\n        const noteBlockId = doc.addBlock(\n          'affine:note',\n          {\n            xywh: newBound.serialize(),\n            displayMode: NoteDisplayMode.EdgelessOnly,\n            index: service.generateIndex('affine:note'),\n          },\n          doc.root!.id\n        );\n\n        insertFromMarkdown(host, panel.answer!, noteBlockId)\n          .then(() => {\n            service.selection.set({\n              elements: [noteBlockId],\n              editing: false,\n            });\n\n            // set the viewport to show the new note block and original note block\n            const newNote = doc.getBlock(noteBlockId)?.model;\n            if (!newNote || !matchFlavours(newNote, ['affine:note'])) return;\n            const newNoteBound = Bound.deserialize(newNote.xywh);\n\n            const bounds = [bound, newNoteBound];\n            const { zoom, centerX, centerY } = service.getFitToScreenData(\n              [20, 20, 20, 20],\n              bounds\n            );\n            service.viewport.setViewport(zoom, [centerX, centerY]);\n          })\n          .catch(err => {\n            console.error(err);\n          });\n      });\n      // hide the panel\n      panel.hide();\n    },\n  };\n}\n\nexport function buildTextResponseConfig<\n  T extends keyof BlockSuitePresets.AIActions,\n>(panel: AffineAIPanelWidget, id?: T) {\n  const host = panel.host;\n\n  const _replace = async () => {\n    const selection = getSelection(host);\n    if (!selection || !panel.answer) return;\n\n    const { textSelection, firstBlock, selectedModels } = selection;\n    await replace(\n      host,\n      panel.answer,\n      firstBlock,\n      selectedModels,\n      textSelection\n    );\n\n    panel.hide();\n  };\n\n  const _insertBelow = async () => {\n    const selection = getSelection(host);\n\n    if (!selection || !panel.answer) {\n      return;\n    }\n\n    const { lastBlock } = selection;\n    await insertBelow(host, panel.answer ?? '', lastBlock);\n    panel.hide();\n  };\n\n  const _insertAbove = async () => {\n    const selection = getSelection(host);\n    if (!selection || !panel.answer) return;\n\n    const { firstBlock } = selection;\n    await insertAbove(host, panel.answer, firstBlock);\n    panel.hide();\n  };\n\n  return [\n    {\n      name: 'Response',\n      items: [\n        {\n          name: 'Insert below',\n          icon: InsertBelowIcon,\n          showWhen: () =>\n            !!panel.answer && (!id || !INSERT_ABOVE_ACTIONS.includes(id)),\n          handler: () => {\n            reportResponse('result:insert');\n            _insertBelow().catch(console.error);\n          },\n        },\n        {\n          name: 'Insert above',\n          icon: InsertTopIcon,\n          showWhen: () =>\n            !!panel.answer && !!id && INSERT_ABOVE_ACTIONS.includes(id),\n          handler: () => {\n            reportResponse('result:insert');\n            _insertAbove().catch(console.error);\n          },\n        },\n        useAsCaption(host, id),\n        {\n          name: 'Replace selection',\n          icon: ReplaceIcon,\n          showWhen: () => !!panel.answer,\n          handler: () => {\n            reportResponse('result:replace');\n            _replace().catch(console.error);\n          },\n        },\n        createNewNote(host),\n      ],\n    },\n    {\n      name: '',\n      items: [\n        {\n          name: 'Continue in chat',\n          icon: ChatWithAIIcon,\n          handler: () => {\n            reportResponse('result:continue-in-chat');\n            AIProvider.slots.requestContinueInChat.emit({\n              host: panel.host,\n              show: true,\n            });\n            panel.hide();\n          },\n        },\n        {\n          name: 'Regenerate',\n          icon: RetryIcon,\n          handler: () => {\n            reportResponse('result:retry');\n            panel.generate();\n          },\n        },\n        {\n          name: 'Discard',\n          icon: DiscardIcon,\n          handler: () => {\n            panel.discard();\n          },\n        },\n      ],\n    },\n  ];\n}\n\nexport function buildErrorResponseConfig<\n  T extends keyof BlockSuitePresets.AIActions,\n>(panel: AffineAIPanelWidget, id?: T) {\n  const host = panel.host;\n  const _replace = async () => {\n    const selection = getSelection(host);\n    if (!selection || !panel.answer) return;\n\n    const { textSelection, firstBlock, selectedModels } = selection;\n    await replace(\n      host,\n      panel.answer,\n      firstBlock,\n      selectedModels,\n      textSelection\n    );\n\n    panel.hide();\n  };\n\n  const _insertBelow = async () => {\n    const selection = getSelection(host);\n\n    if (!selection || !panel.answer) {\n      return;\n    }\n\n    const { lastBlock } = selection;\n    await insertBelow(host, panel.answer ?? '', lastBlock);\n    panel.hide();\n  };\n\n  const _insertAbove = async () => {\n    const selection = getSelection(host);\n    if (!selection || !panel.answer) return;\n\n    const { firstBlock } = selection;\n    await insertAbove(host, panel.answer, firstBlock);\n    panel.hide();\n  };\n\n  return [\n    {\n      name: 'Response',\n      items: [\n        {\n          name: 'Replace selection',\n          icon: ReplaceIcon,\n          showWhen: () => !!panel.answer,\n          handler: () => {\n            _replace().catch(console.error);\n          },\n        },\n        {\n          name: 'Insert below',\n          icon: InsertBelowIcon,\n          showWhen: () =>\n            !!panel.answer && (!id || !INSERT_ABOVE_ACTIONS.includes(id)),\n          handler: () => {\n            _insertBelow().catch(console.error);\n          },\n        },\n        {\n          name: 'Insert above',\n          icon: InsertTopIcon,\n          showWhen: () =>\n            !!panel.answer && !!id && INSERT_ABOVE_ACTIONS.includes(id),\n          handler: () => {\n            reportResponse('result:insert');\n            _insertAbove().catch(console.error);\n          },\n        },\n        useAsCaption(host, id),\n        createNewNote(host),\n      ],\n    },\n    {\n      name: '',\n      items: [\n        {\n          name: 'Retry',\n          icon: RetryIcon,\n          showWhen: () => true,\n          handler: () => {\n            reportResponse('result:retry');\n            panel.generate();\n          },\n        },\n        {\n          name: 'Discard',\n          icon: DiscardIcon,\n          showWhen: () => !!panel.answer,\n          handler: () => {\n            panel.discard();\n          },\n        },\n      ],\n    },\n  ];\n}\n\nexport function buildFinishConfig<T extends keyof BlockSuitePresets.AIActions>(\n  panel: AffineAIPanelWidget,\n  id?: T\n) {\n  return {\n    responses: buildTextResponseConfig(panel, id),\n    actions: [],\n  };\n}\n\nexport function buildErrorConfig<T extends keyof BlockSuitePresets.AIActions>(\n  panel: AffineAIPanelWidget,\n  id?: T\n) {\n  return {\n    upgrade: () => {\n      AIProvider.slots.requestUpgradePlan.emit({ host: panel.host });\n      panel.hide();\n    },\n    login: () => {\n      AIProvider.slots.requestLogin.emit({ host: panel.host });\n      panel.hide();\n    },\n    cancel: () => {\n      panel.hide();\n    },\n    responses: buildErrorResponseConfig(panel, id),\n  };\n}\n\nexport function buildGeneratingConfig(generatingIcon?: TemplateResult<1>) {\n  return {\n    generatingIcon: generatingIcon ?? AIStarIconWithAnimation,\n  };\n}\n\nexport function buildCopyConfig(panel: AffineAIPanelWidget) {\n  return {\n    allowed: true,\n    onCopy: () => {\n      return copyTextAnswer(panel);\n    },\n  };\n}\n\nexport function buildAIPanelConfig(\n  panel: AffineAIPanelWidget\n): AffineAIPanelWidgetConfig {\n  return {\n    answerRenderer: createTextRenderer(panel.host, { maxHeight: 320 }),\n    finishStateConfig: buildFinishConfig(panel),\n    generatingStateConfig: buildGeneratingConfig(),\n    errorStateConfig: buildErrorConfig(panel),\n    copy: buildCopyConfig(panel),\n  };\n}\n\nexport const getAIPanel = (host: EditorHost): AffineAIPanelWidget => {\n  const rootBlockId = host.doc.root?.id;\n  assertExists(rootBlockId);\n  const aiPanel = host.view.getWidget(AFFINE_AI_PANEL_WIDGET, rootBlockId);\n  assertExists(aiPanel);\n  if (!(aiPanel instanceof AffineAIPanelWidget)) {\n    throw new Error('AI panel not found');\n  }\n  return aiPanel;\n};\n"]}