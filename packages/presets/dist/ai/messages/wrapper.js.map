{"version":3,"file":"wrapper.js","sourceRoot":"","sources":["../../../src/ai/messages/wrapper.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE,UAAU,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AACrD,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAE,MAAM,mBAAmB,CAAC;AAE5D,OAAO,EAAE,UAAU,EAAE,MAAM,gBAAgB,CAAC;AAC5C,OAAO,EAAE,cAAc,EAAE,MAAM,kBAAkB,CAAC;IAOrC,eAAe;4BAD3B,aAAa,CAAC,mBAAmB,CAAC;;;;sBACE,UAAU;;;;+BAAlB,SAAQ,WAAU;;;;mCAyB5C,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;YAC/B,0KAAS,OAAO,6BAAP,OAAO,yFAAiD;YA1BnE,6KAsCC;;;;iBArCiB,WAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;;GAsB3B,AAtBqB,CAsBpB;QAGF,2EAAuD,SAAS,EAAC;QAAjE,IAAS,OAAO,6CAAiD;QAAjE,IAAS,OAAO,mDAAiD;QAE9C,MAAM;YACvB,OAAO,IAAI,CAAA;;oBAEK,IAAI,CAAC,OAAO,EAAE,MAAM;gBAC5B,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,MAAM,GAAG,IAAI;gBAC7B,CAAC,CAAC,MAAM;;;qBAGC,CAAC;QACpB,CAAC;;;;;;YArCU,uDAAe;;;;;SAAf,eAAe;AA8C5B,MAAM,CAAC,MAAM,oBAAoB,GAGkB,CAAC,IAAI,EAAE,OAAO,EAAE,EAAE;IACnE,OAAO,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;QACvB,IAAI,KAAK,KAAK,YAAY,EAAE,CAAC;YAC3B,MAAM,KAAK,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC;YAC/B,KAAK,CAAC,iBAAiB,EAAE,qBAAqB,CAAC,CAAC,CAAC,CAAC;YAClD,OAAO,OAAO,CAAC;QACjB,CAAC;QAED,IAAI,KAAK,KAAK,UAAU,IAAI,KAAK,KAAK,OAAO,EAAE,CAAC;YAC9C,OAAO,OAAO,CAAC;QACjB,CAAC;QAED,MAAM,QAAQ,GAAG,IAAI,CAAA;;;;;gBAKT,cAAc,CAAC,MAAM,CAAC;;cAExB,CAAC;QACX,OAAO,IAAI,CAAA,+BAA+B,OAAO;SAC5C,QAAQ;MACX,CAAC;IACL,CAAC,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,mBAAmB,GAGmB,CAAC,IAAI,EAAE,OAAO,EAAE,EAAE;IACnE,OAAO,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;QACvB,IAAI,KAAK,KAAK,YAAY,EAAE,CAAC;YAC3B,MAAM,KAAK,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC;YAC/B,KAAK,CAAC,iBAAiB,EAAE,qBAAqB,CAAC,CAAC,CAAC,CAAC;YAClD,OAAO,OAAO,CAAC;QACjB,CAAC;QAED,IAAI,KAAK,KAAK,UAAU,IAAI,KAAK,KAAK,OAAO,EAAE,CAAC;YAC9C,OAAO,OAAO,CAAC;QACjB,CAAC;QAED,MAAM,QAAQ,GAAG,IAAI,CAAA;;;;;;;;iBAQR,MAAM;WACZ,CAAC;QAER,OAAO,IAAI,CAAA,+BAA+B,OAAO;SAC5C,QAAQ;MACX,CAAC;IACL,CAAC,CAAC;AACJ,CAAC,CAAC","sourcesContent":["import type { EditorHost } from '@blocksuite/block-std';\nimport type { AffineAIPanelWidgetConfig } from '@blocksuite/blocks';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport { getAIPanel } from '../ai-panel.js';\nimport { preprocessHtml } from '../utils/html.js';\n\ntype AIAnswerWrapperOptions = {\n  height: number;\n};\n\n@customElement('ai-answer-wrapper')\nexport class AIAnswerWrapper extends LitElement {\n  static override styles = css`\n    :host {\n      display: block;\n      width: 100%;\n      box-sizing: border-box;\n      border-radius: 4px;\n      border: 1px solid var(--affine-border-color);\n      box-shadow: var(--affine-shadow-1);\n      background: var(--affine-background-secondary-color);\n      overflow: hidden;\n    }\n\n    ::slotted(.ai-answer-iframe) {\n      width: 100%;\n      height: 100%;\n      border: none;\n    }\n\n    ::slotted(.ai-answer-image) {\n      width: 100%;\n      height: 100%;\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor options: AIAnswerWrapperOptions | undefined = undefined;\n\n  protected override render() {\n    return html`<style>\n        :host {\n          height: ${this.options?.height\n            ? this.options?.height + 'px'\n            : '100%'};\n        }\n      </style>\n      <slot></slot> `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'ai-answer-wrapper': AIAnswerWrapper;\n  }\n}\n\nexport const createIframeRenderer: (\n  host: EditorHost,\n  options?: AIAnswerWrapperOptions\n) => AffineAIPanelWidgetConfig['answerRenderer'] = (host, options) => {\n  return (answer, state) => {\n    if (state === 'generating') {\n      const panel = getAIPanel(host);\n      panel.generatingElement?.updateLoadingProgress(2);\n      return nothing;\n    }\n\n    if (state !== 'finished' && state !== 'error') {\n      return nothing;\n    }\n\n    const template = html`<iframe\n      class=\"ai-answer-iframe\"\n      sandbox=\"allow-scripts\"\n      scrolling=\"no\"\n      allowfullscreen\n      .srcdoc=${preprocessHtml(answer)}\n    >\n    </iframe>`;\n    return html`<ai-answer-wrapper .options=${options}\n      >${template}</ai-answer-wrapper\n    >`;\n  };\n};\n\nexport const createImageRenderer: (\n  host: EditorHost,\n  options?: AIAnswerWrapperOptions\n) => AffineAIPanelWidgetConfig['answerRenderer'] = (host, options) => {\n  return (answer, state) => {\n    if (state === 'generating') {\n      const panel = getAIPanel(host);\n      panel.generatingElement?.updateLoadingProgress(2);\n      return nothing;\n    }\n\n    if (state !== 'finished' && state !== 'error') {\n      return nothing;\n    }\n\n    const template = html`<style>\n      .ai-answer-image img{\n        width: 100%;\n        height: 100%;\n        object-fit: contain;\n      }\n    </style>\n    <div class=\"ai-answer-image\">\n      <img src=${answer}></img>\n    </div>`;\n\n    return html`<ai-answer-wrapper .options=${options}\n      >${template}</ai-answer-wrapper\n    >`;\n  };\n};\n"]}