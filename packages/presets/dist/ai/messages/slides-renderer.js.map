{"version":3,"file":"slides-renderer.js","sourceRoot":"","sources":["../../../src/ai/messages/slides-renderer.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EditorHost } from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/block-std';\nimport {\n  type AffineAIPanelWidgetConfig,\n  EdgelessEditorBlockSpecs,\n} from '@blocksuite/blocks';\nimport { AffineSchemas } from '@blocksuite/blocks/schemas';\nimport type { Doc } from '@blocksuite/store';\nimport { DocCollection, Schema } from '@blocksuite/store';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\n\nimport { getAIPanel } from '../ai-panel.js';\nimport { PPTBuilder } from '../slides/index.js';\n\nexport const createSlidesRenderer: (\n  host: EditorHost,\n  ctx: {\n    get: () => Record<string, unknown>;\n    set: (data: Record<string, unknown>) => void;\n  }\n) => AffineAIPanelWidgetConfig['answerRenderer'] = (host, ctx) => {\n  return (answer, state) => {\n    if (state === 'generating') {\n      const panel = getAIPanel(host);\n      panel.generatingElement?.updateLoadingProgress(2);\n      return nothing;\n    }\n\n    if (state !== 'finished' && state !== 'error') {\n      return nothing;\n    }\n\n    return html`<style>\n        .slides-container {\n          width: 100%;\n          height: 300px;\n        }\n      </style>\n      <div class=\"slides-container\">\n        <ai-slides-renderer\n          .host=${host}\n          .ctx=${ctx}\n          .text=${answer}\n        ></ai-slides-renderer>\n      </div>`;\n  };\n};\n\n@customElement('ai-slides-renderer')\nexport class AISlidesRenderer extends WithDisposable(LitElement) {\n  static override styles = css``;\n\n  private _editorContainer: Ref<HTMLDivElement> = createRef<HTMLDivElement>();\n\n  private _doc!: Doc;\n\n  @query('editor-host')\n  private accessor _editorHost!: EditorHost;\n\n  @property({ attribute: false })\n  accessor text!: string;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor ctx:\n    | {\n        get(): Record<string, unknown>;\n        set(data: Record<string, unknown>): void;\n      }\n    | undefined = undefined;\n\n  protected override firstUpdated() {\n    requestAnimationFrame(() => {\n      if (!this._editorHost) return;\n      PPTBuilder(this._editorHost)\n        .process(this.text)\n        .then(res => {\n          if (this.ctx) {\n            this.ctx.set({\n              contents: res.contents,\n              images: res.images,\n            });\n          }\n        })\n        .catch(console.error);\n    });\n  }\n\n  protected override render() {\n    return html`<style>\n        .slides-container {\n          position: relative;\n          width: 100%;\n          height: 100%;\n        }\n\n        .edgeless-container {\n          width: 100%;\n          height: 100%;\n          border-radius: 4px;\n          border: 1px solid var(--affine-border-color);\n        }\n\n        .mask {\n          position: absolute;\n          top: 0;\n          left: 0;\n          z-index: 1;\n          background-color: transparent;\n          width: 100%;\n          height: 100%;\n        }\n\n        .edgeless-container affine-edgeless-zoom-toolbar-widget,\n        edgeless-toolbar {\n          display: none;\n        }\n\n        * {\n          box-sizing: border-box;\n        }\n\n        .affine-edgeless-viewport {\n          display: block;\n          height: 100%;\n          position: relative;\n          overflow: hidden;\n          container-name: viewport;\n          container-type: inline-size;\n        }\n\n        .affine-edgeless-surface-block-container {\n          position: absolute;\n          width: 100%;\n          height: 100%;\n        }\n\n        .affine-edgeless-surface-block-container canvas {\n          width: 100%;\n          height: 100%;\n          position: relative;\n          z-index: 1;\n          pointer-events: none;\n        }\n\n        edgeless-block-portal-container {\n          position: relative;\n          box-sizing: border-box;\n          overflow: hidden;\n          display: block;\n          height: 100%;\n          font-family: var(--affine-font-family);\n          font-size: var(--affine-font-base);\n          line-height: var(--affine-line-height);\n          color: var(--affine-text-primary-color);\n          font-weight: 400;\n        }\n\n        .affine-block-children-container.edgeless {\n          padding-left: 0;\n          position: relative;\n          overflow: hidden;\n          height: 100%;\n          touch-action: none;\n          background-color: var(--affine-background-primary-color);\n          background-image: radial-gradient(\n            var(--affine-edgeless-grid-color) 1px,\n            var(--affine-background-primary-color) 1px\n          );\n          z-index: 0;\n        }\n\n        .affine-edgeless-block-child {\n          position: absolute;\n          transform-origin: center;\n          box-sizing: border-box;\n          border: 2px solid var(--affine-white-10);\n          border-radius: 8px;\n          box-shadow: var(--affine-shadow-3);\n          pointer-events: all;\n        }\n\n        affine-edgeless-image .resizable-img,\n        affine-edgeless-image .resizable-img img {\n          width: 100%;\n          height: 100%;\n        }\n\n        .affine-edgeless-layer {\n          position: absolute;\n          top: 0;\n          left: 0;\n          contain: size layout style;\n        }\n      </style>\n      <div class=\"slides-container\">\n        <div\n          class=\"edgeless-container affine-edgeless-viewport\"\n          ${ref(this._editorContainer)}\n        >\n          ${this.host.renderSpecPortal(this._doc, EdgelessEditorBlockSpecs)}\n        </div>\n        <div class=\"mask\"></div>\n      </div>`;\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n\n    const schema = new Schema().register(AffineSchemas);\n    const collection = new DocCollection({ schema, id: 'SLIDES_PREVIEW' });\n    collection.meta.initialize();\n    collection.start();\n    const doc = collection.createDoc();\n\n    doc.load(() => {\n      const pageBlockId = doc.addBlock('affine:page', {});\n      doc.addBlock('affine:surface', {}, pageBlockId);\n    });\n\n    doc.resetHistory();\n    this._doc = doc;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'ai-slides-renderer': AISlidesRenderer;\n  }\n}\n"]}