{"version":3,"file":"selection-utils.js","sourceRoot":"","sources":["../../../src/ai/_common/selection-utils.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EditorHost } from '@blocksuite/block-std';\nimport {\n  BlocksUtils,\n  EdgelessRootService,\n  type FrameBlockModel,\n  type ImageBlockModel,\n  type SurfaceBlockComponent,\n} from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { Slice } from '@blocksuite/store';\n\nimport { getMarkdownFromSlice } from './markdown-utils.js';\n\nexport const getRootService = (host: EditorHost) => {\n  return host.std.spec.getService('affine:page');\n};\n\nexport function getEdgelessRootFromEditor(editor: EditorHost) {\n  const edgelessRoot = editor.getElementsByTagName('affine-edgeless-root')[0];\n  if (!edgelessRoot) {\n    alert('Please switch to edgeless mode');\n    throw new Error('Please open switch to edgeless mode');\n  }\n  return edgelessRoot;\n}\nexport function getEdgelessService(editor: EditorHost) {\n  const rootService = editor.std.spec.getService('affine:page');\n  if (rootService instanceof EdgelessRootService) {\n    return rootService;\n  }\n  alert('Please switch to edgeless mode');\n  throw new Error('Please open switch to edgeless mode');\n}\n\nexport async function selectedToCanvas(editor: EditorHost) {\n  const edgelessRoot = getEdgelessRootFromEditor(editor);\n  const { notes, frames, shapes, images } = BlocksUtils.splitElements(\n    edgelessRoot.service.selection.selectedElements\n  );\n  if (notes.length + frames.length + images.length + shapes.length === 0) {\n    return;\n  }\n  const canvas = await edgelessRoot.clipboardController.toCanvas(\n    [...notes, ...frames, ...images],\n    shapes\n  );\n  if (!canvas) {\n    return;\n  }\n  return canvas;\n}\n\nexport async function frameToCanvas(\n  frame: FrameBlockModel,\n  editor: EditorHost\n) {\n  const edgelessRoot = getEdgelessRootFromEditor(editor);\n  const { notes, frames, shapes, images } = BlocksUtils.splitElements(\n    edgelessRoot.service.frame.getElementsInFrame(frame, true)\n  );\n  if (notes.length + frames.length + images.length + shapes.length === 0) {\n    return;\n  }\n  const canvas = await edgelessRoot.clipboardController.toCanvas(\n    [...notes, ...frames, ...images],\n    shapes\n  );\n  if (!canvas) {\n    return;\n  }\n  return canvas;\n}\n\nexport async function selectedToPng(editor: EditorHost) {\n  return (await selectedToCanvas(editor))?.toDataURL('image/png');\n}\n\nexport async function getSelectedTextContent(editorHost: EditorHost) {\n  const slice = Slice.fromModels(\n    editorHost.std.doc,\n    getRootService(editorHost).selectedModels\n  );\n  return getMarkdownFromSlice(editorHost, slice);\n}\n\nexport const stopPropagation = (e: Event) => {\n  e.stopPropagation();\n};\n\nexport function getSurfaceElementFromEditor(editor: EditorHost) {\n  const { doc } = editor;\n  const surfaceModel = doc.getBlockByFlavour('affine:surface')[0];\n  assertExists(surfaceModel);\n\n  const surfaceId = surfaceModel.id;\n  const surfaceElement = editor.querySelector(\n    `affine-surface[data-block-id=\"${surfaceId}\"]`\n  ) as SurfaceBlockComponent;\n  assertExists(surfaceElement);\n\n  return surfaceElement;\n}\n\nexport const getFirstImageInFrame = (\n  frame: FrameBlockModel,\n  editor: EditorHost\n) => {\n  const edgelessRoot = getEdgelessRootFromEditor(editor);\n  const elements = edgelessRoot.service.frame.getElementsInFrame(frame, false);\n  const image = elements.find(ele => {\n    if (!BlocksUtils.isCanvasElement(ele)) {\n      return ele.flavour === 'affine:image';\n    }\n    return false;\n  }) as ImageBlockModel | undefined;\n  return image?.id;\n};\n"]}