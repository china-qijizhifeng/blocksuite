{"version":3,"file":"ask-ai-button.js","sourceRoot":"","sources":["../../../../src/ai/_common/components/ask-ai-button.ts"],"names":[],"mappings":"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","sourcesContent":["import './ask-ai-panel.js';\n\nimport { type EditorHost, WithDisposable } from '@blocksuite/block-std';\nimport {\n  type AIItemGroupConfig,\n  AIStarIcon,\n  EdgelessRootService,\n} from '@blocksuite/blocks';\nimport { HoverController } from '@blocksuite/blocks';\nimport { createLitPortal } from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { flip, offset } from '@floating-ui/dom';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { ref } from 'lit/directives/ref.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { getRootService } from '../../utils/selection-utils.js';\n\ntype buttonSize = 'small' | 'middle' | 'large';\ntype toggleType = 'hover' | 'click';\n\nconst buttonWidthMap: Record<buttonSize, string> = {\n  small: '72px',\n  middle: '76px',\n  large: '82px',\n};\n\nconst buttonHeightMap: Record<buttonSize, string> = {\n  small: '24px',\n  middle: '32px',\n  large: '32px',\n};\n\nexport type AskAIButtonOptions = {\n  size: buttonSize;\n  backgroundColor?: string;\n  boxShadow?: string;\n  panelWidth?: number;\n};\n\n@customElement('ask-ai-button')\nexport class AskAIButton extends WithDisposable(LitElement) {\n  get _edgeless() {\n    const rootService = getRootService(this.host);\n    if (rootService instanceof EdgelessRootService) {\n      return rootService;\n    }\n    return null;\n  }\n\n  static override styles = css`\n    .ask-ai-button {\n      border-radius: 4px;\n      position: relative;\n    }\n\n    .ask-ai-icon-button {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: var(--affine-brand-color);\n      font-size: var(--affine-font-sm);\n      font-weight: 500;\n    }\n\n    .ask-ai-icon-button.small {\n      font-size: var(--affine-font-xs);\n      svg {\n        scale: 0.8;\n        margin-right: 2px;\n      }\n    }\n\n    .ask-ai-icon-button.large {\n      font-size: var(--affine-font-md);\n      svg {\n        scale: 1.2;\n      }\n    }\n\n    .ask-ai-icon-button span {\n      line-height: 22px;\n    }\n\n    .ask-ai-icon-button svg {\n      margin-right: 4px;\n      color: var(--affine-brand-color);\n    }\n  `;\n\n  @query('.ask-ai-button')\n  private accessor _askAIButton!: HTMLDivElement;\n\n  private _abortController: AbortController | null = null;\n\n  private _whenHover = new HoverController(\n    this,\n    ({ abortController }) => {\n      return {\n        template: html`<ask-ai-panel\n          .host=${this.host}\n          .actionGroups=${this.actionGroups}\n          .abortController=${abortController}\n        ></ask-ai-panel>`,\n        computePosition: {\n          referenceElement: this,\n          placement: 'top-start',\n          middleware: [flip(), offset(-40)],\n          autoUpdate: true,\n        },\n      };\n    },\n    { allowMultiple: true }\n  );\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor actionGroups!: AIItemGroupConfig[];\n\n  @property({ attribute: false })\n  accessor toggleType: toggleType = 'hover';\n\n  @property({ attribute: false })\n  accessor options: AskAIButtonOptions = {\n    size: 'middle',\n    backgroundColor: undefined,\n    boxShadow: undefined,\n    panelWidth: 330,\n  };\n\n  private _clearAbortController = () => {\n    if (this._abortController) {\n      this._abortController.abort();\n      this._abortController = null;\n    }\n  };\n\n  private _toggleAIPanel = () => {\n    if (this.toggleType !== 'click') {\n      return;\n    }\n\n    if (this._abortController) {\n      this._clearAbortController();\n      return;\n    }\n\n    this._abortController = new AbortController();\n    assertExists(this._askAIButton);\n    const panelMinWidth = this.options.panelWidth || 330;\n    createLitPortal({\n      template: html`<ask-ai-panel\n        .host=${this.host}\n        .actionGroups=${this.actionGroups}\n        .minWidth=${panelMinWidth}\n      ></ask-ai-panel>`,\n      container: this._askAIButton,\n      computePosition: {\n        referenceElement: this._askAIButton,\n        placement: 'bottom-start',\n        middleware: [flip(), offset(4)],\n        autoUpdate: true,\n      },\n      abortController: this._abortController,\n      closeOnClickAway: true,\n    });\n  };\n\n  override firstUpdated() {\n    this.disposables.add(() => {\n      this._edgeless?.tool.setEdgelessTool({ type: 'default' });\n    });\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this._clearAbortController();\n  }\n\n  override render() {\n    const { size = 'small', backgroundColor, boxShadow } = this.options;\n    const { toggleType } = this;\n    const buttonStyles = styleMap({\n      backgroundColor: backgroundColor || 'transparent',\n      boxShadow: boxShadow || 'none',\n    });\n    return html`<div\n      class=\"ask-ai-button\"\n      style=${buttonStyles}\n      ${toggleType === 'hover' ? ref(this._whenHover.setReference) : nothing}\n      @click=${this._toggleAIPanel}\n    >\n      <icon-button\n        class=\"ask-ai-icon-button ${size}\"\n        width=${buttonWidthMap[size]}\n        height=${buttonHeightMap[size]}\n      >\n        ${AIStarIcon} <span>Ask AI</span></icon-button\n      >\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'ask-ai-button': AskAIButton;\n  }\n}\n"]}