{"version":3,"file":"frame-panel-header.js","sourceRoot":"","sources":["../../../../src/fragments/frame-panel/header/frame-panel-header.ts"],"names":[],"mappings":"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","sourcesContent":["import './frames-setting-menu.js';\n\nimport type { EditorHost } from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/block-std';\nimport type { EdgelessRootBlockComponent } from '@blocksuite/blocks';\nimport type { NavigatorMode } from '@blocksuite/blocks';\nimport { createButtonPopper } from '@blocksuite/blocks';\nimport { DisposableGroup } from '@blocksuite/global/utils';\nimport { css, html, LitElement, type PropertyValues } from 'lit';\nimport { property, query, state } from 'lit/decorators.js';\n\nimport { SettingsIcon, SmallFrameNavigatorIcon } from '../../_common/icons.js';\n\nconst styles = css`\n  :host {\n    display: flex;\n    width: 100%;\n    justify-content: start;\n  }\n\n  .frame-panel-header {\n    display: flex;\n    width: 100%;\n    height: 36px;\n    align-items: center;\n    justify-content: space-between;\n    box-sizing: border-box;\n    padding: 0 8px;\n  }\n\n  .all-frames-setting {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    width: 100px;\n    height: 24px;\n    margin: 8px 4px;\n  }\n\n  .all-frames-setting-button svg {\n    color: var(--affine-icon-secondary);\n  }\n\n  .all-frames-setting-button:hover svg,\n  .all-frames-setting-button.active svg {\n    color: var(--affine-icon-color);\n  }\n\n  .all-frames-setting-label {\n    width: 68px;\n    height: 22px;\n    font-size: var(--affine-font-sm);\n    font-weight: 500;\n    line-height: 22px;\n    color: var(--light-text-color-text-secondary-color, #8e8d91);\n  }\n\n  .frames-setting-container {\n    display: none;\n    justify-content: center;\n    align-items: center;\n    background: var(--affine-background-overlay-panel-color);\n    box-shadow: var(--affine-shadow-2);\n    border-radius: 8px;\n  }\n\n  .frames-setting-container[data-show] {\n    display: flex;\n  }\n\n  .presentation-button {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    box-sizing: border-box;\n    width: 117px;\n    height: 28px;\n    padding: 4px 8px;\n    border-radius: 8px;\n    margin: 4px 0;\n    border: 1px solid var(--affine-border-color);\n    background: var(--affine-white);\n  }\n\n  .presentation-button:hover {\n    background: var(--affine-hover-color);\n    cursor: pointer;\n  }\n\n  .presentation-button svg {\n    fill: var(--affine-icon-color);\n    margin-right: 4px;\n  }\n\n  .presentation-button-label {\n    font-size: 12px;\n    font-weight: 500;\n    line-height: 20px;\n  }\n`;\n\nexport class FramePanelHeader extends WithDisposable(LitElement) {\n  get rootService() {\n    return this.editorHost.spec.getService('affine:page');\n  }\n\n  static override styles = styles;\n\n  @state()\n  private accessor _settingPopperShow = false;\n\n  @query('.all-frames-setting-button')\n  private accessor _frameSettingButton!: HTMLDivElement;\n\n  @query('.frames-setting-container')\n  private accessor _frameSettingMenu!: HTMLDivElement;\n\n  private _framesSettingMenuPopper: ReturnType<\n    typeof createButtonPopper\n  > | null = null;\n\n  private _navigatorMode: NavigatorMode = 'fit';\n\n  private _edgelessDisposables: DisposableGroup | null = null;\n\n  @property({ attribute: false })\n  accessor editorHost!: EditorHost;\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent | null;\n\n  private _enterPresentationMode = () => {\n    if (!this.edgeless) {\n      this.rootService.docModeService.setMode('edgeless');\n    }\n\n    setTimeout(() => {\n      this.edgeless?.updateComplete\n        .then(() => {\n          this.edgeless?.tools.setEdgelessTool({\n            type: 'frameNavigator',\n            mode: this._navigatorMode,\n          });\n        })\n        .catch(console.error);\n    }, 100);\n  };\n\n  private _tryLoadNavigatorStateLocalRecord() {\n    this._navigatorMode = this.editorHost.spec\n      .getService('affine:page')\n      .editPropsStore.getItem('presentFillScreen')\n      ? 'fill'\n      : 'fit';\n  }\n\n  private _clearEdgelessDisposables = () => {\n    this._edgelessDisposables?.dispose();\n    this._edgelessDisposables = null;\n  };\n\n  private _setEdgelessDisposables = () => {\n    if (!this.edgeless) return;\n\n    this._clearEdgelessDisposables();\n    this._edgelessDisposables = new DisposableGroup();\n    this._edgelessDisposables.add(\n      this.edgeless.slots.navigatorSettingUpdated.on(({ fillScreen }) => {\n        this._navigatorMode = fillScreen ? 'fill' : 'fit';\n      })\n    );\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._tryLoadNavigatorStateLocalRecord();\n  }\n\n  override firstUpdated() {\n    const disposables = this.disposables;\n\n    this._framesSettingMenuPopper = createButtonPopper(\n      this._frameSettingButton,\n      this._frameSettingMenu,\n      ({ display }) => {\n        this._settingPopperShow = display === 'show';\n      },\n      14,\n      -100\n    );\n    disposables.add(this._framesSettingMenuPopper);\n  }\n\n  override updated(_changedProperties: PropertyValues) {\n    if (_changedProperties.has('edgeless')) {\n      if (this.edgeless) {\n        this._setEdgelessDisposables();\n      } else {\n        this._clearEdgelessDisposables();\n      }\n    }\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    if (this._edgelessDisposables) {\n      this._clearEdgelessDisposables();\n    }\n  }\n\n  override render() {\n    return html`<div class=\"frame-panel-header\">\n      <div class=\"all-frames-setting\">\n        <span class=\"all-frames-setting-label\">All frames</span>\n        <edgeless-tool-icon-button\n          class=\"all-frames-setting-button ${this._settingPopperShow\n            ? 'active'\n            : ''}\"\n          .tooltip=${this._settingPopperShow ? '' : 'All Frames Settings'}\n          .tipPosition=${'top'}\n          .active=${this._settingPopperShow}\n          .activeMode=${'background'}\n          @click=${() => this._framesSettingMenuPopper?.toggle()}\n        >\n          ${SettingsIcon}\n        </edgeless-tool-icon-button>\n      </div>\n      <div class=\"frames-setting-container\">\n        <frames-setting-menu\n          .edgeless=${this.edgeless}\n          .editorHost=${this.editorHost}\n        ></frames-setting-menu>\n      </div>\n      <div class=\"presentation-button\" @click=${this._enterPresentationMode}>\n        ${SmallFrameNavigatorIcon}<span class=\"presentation-button-label\"\n          >Presentation</span\n        >\n      </div>\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'frame-panel-header': FramePanelHeader;\n  }\n}\n"]}