{"version":3,"file":"frame-card-title-editor.js","sourceRoot":"","sources":["../../../../src/fragments/frame-panel/card/frame-card-title-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport type {\n  AffineInlineEditor,\n  FrameBlockModel,\n  RichText,\n} from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { css, html } from 'lit';\nimport { property, query } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nconst styles = css`\n  frame-card-title-editor rich-text .nowrap-lines::-webkit-scrollbar {\n    display: none;\n  }\n`;\n\nexport class FrameCardTitleEditor extends WithDisposable(ShadowlessElement) {\n  get inlineEditor(): AffineInlineEditor {\n    assertExists(this.richText.inlineEditor);\n    return this.richText.inlineEditor;\n  }\n\n  get inlineEditorContainer() {\n    return this.inlineEditor.rootElement;\n  }\n\n  static override styles = styles;\n\n  private _isComposing = false;\n\n  @query('rich-text')\n  accessor richText!: RichText;\n\n  @property({ attribute: false })\n  accessor frameModel!: FrameBlockModel;\n\n  @property({ attribute: false })\n  accessor titleContentElement!: HTMLElement;\n\n  @property({ attribute: false })\n  accessor left!: number;\n\n  @property({ attribute: false })\n  accessor maxWidth!: number;\n\n  private _unmount() {\n    // dispose in advance to avoid execute `this.remove()` twice\n    this.disposables.dispose();\n    this.remove();\n    this.titleContentElement.style.display = 'block';\n  }\n\n  override async getUpdateComplete(): Promise<boolean> {\n    const result = await super.getUpdateComplete();\n    await this.richText?.updateComplete;\n    return result;\n  }\n\n  override firstUpdated(): void {\n    this.updateComplete\n      .then(() => {\n        this.titleContentElement.style.display = 'none';\n\n        this.inlineEditor.selectAll();\n\n        this.inlineEditor.slots.renderComplete.on(() => {\n          this.requestUpdate();\n        });\n\n        this.disposables.addFromEvent(\n          this.inlineEditorContainer,\n          'blur',\n          () => {\n            this._unmount();\n          }\n        );\n        this.disposables.addFromEvent(\n          this.inlineEditorContainer,\n          'click',\n          e => {\n            e.stopPropagation();\n          }\n        );\n        this.disposables.addFromEvent(\n          this.inlineEditorContainer,\n          'dblclick',\n          e => {\n            e.stopPropagation();\n          }\n        );\n\n        this.disposables.addFromEvent(\n          this.inlineEditorContainer,\n          'keydown',\n          e => {\n            e.stopPropagation();\n            if (e.key === 'Enter' && !this._isComposing) {\n              this._unmount();\n            }\n          }\n        );\n      })\n      .catch(console.error);\n  }\n\n  override render() {\n    const inlineEditorStyle = styleMap({\n      transformOrigin: 'top left',\n      borderRadius: '4px',\n      maxWidth: `${this.maxWidth}px`,\n      maxHeight: '20px',\n      width: 'fit-content',\n      height: '20px',\n      fontSize: 'var(--affine-font-sm)',\n      lineHeight: '20px',\n      position: 'absolute',\n      left: `${this.left}px`,\n      top: '0px',\n      minWidth: '8px',\n      background: 'var(--affine-background-primary-color)',\n      border: '1px solid var(--affine-primary-color)',\n      color: 'var(--affine-text-primary-color)',\n      boxShadow: '0px 0px 0px 2px rgba(30, 150, 235, 0.30)',\n      zIndex: '1',\n      display: 'block',\n    });\n    return html`<rich-text\n      .yText=${this.frameModel.title.yText}\n      .enableFormat=${false}\n      .enableAutoScrollHorizontally=${true}\n      .enableUndoRedo=${false}\n      .wrapText=${false}\n      style=${inlineEditorStyle}\n    ></rich-text>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'frame-card-title-editor': FrameCardTitleEditor;\n  }\n}\n"]}