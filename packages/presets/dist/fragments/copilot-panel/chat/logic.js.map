{"version":3,"file":"logic.js","sourceRoot":"","sources":["../../../../src/fragments/copilot-panel/chat/logic.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EditorHost } from '@blocksuite/block-std';\nimport {\n  BlocksUtils,\n  EmbedHtmlBlockSpec,\n  MarkdownAdapter,\n  type ShapeElementModel,\n  SurfaceBlockComponent,\n  type TreeNodeWithId,\n} from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { type BlockSnapshot, type Doc, Job } from '@blocksuite/store';\n\nimport { LANGUAGE, TONE } from '../config.js';\nimport { copilotConfig } from '../copilot-service/copilot-config.js';\nimport { EmbeddingServiceKind } from '../copilot-service/service-base.js';\nimport {\n  runAnalysisAction,\n  runChangeToneAction,\n  runFixSpellingAction,\n  runGenerateAction,\n  runImproveWritingAction,\n  runMakeLongerAction,\n  runMakeShorterAction,\n  runPartAnalysisAction,\n  runPPTGenerateAction,\n  runRefineAction,\n  runSimplifyWritingAction,\n  runSummaryAction,\n  runTranslateAction,\n} from '../doc/actions.js';\nimport { getChatService } from '../doc/api.js';\nimport { genHtml } from '../edgeless/gen-html.js';\nimport type { AILogic } from '../logic.js';\nimport { findLeaf, findTree, getConnectorPath } from '../utils/connector.js';\nimport {\n  insertFromMarkdown,\n  markdownToSnapshot,\n} from '../utils/markdown-utils.js';\nimport {\n  getEdgelessRootFromEditor,\n  getEdgelessService,\n  getRootService,\n  getSelectedTextContent,\n  getSurfaceElementFromEditor,\n  selectedToCanvas,\n  selectedToPng,\n} from '../utils/selection-utils.js';\nimport { basicTheme, type PPTDoc, type PPTSection } from './template.js';\n\nexport type ChatReactiveData = {\n  history: ChatMessage[];\n  syncedDocs: EmbeddedDoc[];\n  value: string;\n  currentRequest?: number;\n  tempMessage?: string;\n};\n\nexport class AIChatLogic {\n  get loading() {\n    return this.reactiveData.currentRequest != null;\n  }\n\n  get host() {\n    return this.getHost();\n  }\n\n  get docs() {\n    return [...this.host.doc.collection.docs.values()];\n  }\n\n  private requestId = 0;\n\n  reactiveData!: ChatReactiveData;\n\n  docSelectionActionList: AllAction[] = [\n    {\n      type: 'group',\n      name: 'Translate',\n      children: LANGUAGE.map(language => ({\n        type: 'action',\n        name: language,\n        action: this.createAction(`Translate to ${language}`, input =>\n          runTranslateAction({ input, language })\n        ),\n      })),\n    },\n    {\n      type: 'group',\n      name: 'Change tone',\n      children: TONE.map(tone => ({\n        type: 'action',\n        name: tone,\n        action: this.createAction(`Make more ${tone}`, input =>\n          runChangeToneAction({ input, tone })\n        ),\n      })),\n    },\n    {\n      type: 'action',\n      name: 'Refine',\n      action: this.createAction('Refine', input => runRefineAction({ input })),\n    },\n    {\n      type: 'action',\n      name: 'Generate',\n      action: this.createAction('Generate', input =>\n        runGenerateAction({ input })\n      ),\n    },\n    {\n      type: 'action',\n      name: 'Summary',\n      action: this.createAction('Summary', input =>\n        runSummaryAction({ input })\n      ),\n    },\n    {\n      type: 'action',\n      name: 'Improve writing',\n      action: this.createAction('Improve writing', input =>\n        runImproveWritingAction({ input })\n      ),\n    },\n    {\n      type: 'action',\n      name: 'Fix spelling',\n      action: this.createAction('Fix spelling', input =>\n        runFixSpellingAction({ input })\n      ),\n    },\n    {\n      type: 'action',\n      name: 'Make shorter',\n      action: this.createAction('Make shorter', input =>\n        runMakeShorterAction({ input })\n      ),\n    },\n    {\n      type: 'action',\n      name: 'Make longer',\n      action: this.createAction('Make longer', input =>\n        runMakeLongerAction({ input })\n      ),\n    },\n    {\n      type: 'action',\n      name: 'Simplify language',\n      action: this.createAction('Simplify language', input =>\n        runSimplifyWritingAction({ input })\n      ),\n    },\n    {\n      type: 'action',\n      name: 'Create mind-map',\n      action: this.createAction('Create mind-map', (input, background) => {\n        const service = getEdgelessService(this.host);\n        const [x, y] = [service.viewport.centerX, service.viewport.centerY];\n        const reactiveData = this.reactiveData;\n        const build = mindMapBuilder(this.host, x, y);\n        return (async function* () {\n          const strings = runAnalysisAction({ input, background });\n          let text = '';\n          for await (const item of strings) {\n            yield item;\n            text += item;\n            if (text) {\n              await build(text);\n            }\n            reactiveData.tempMessage = text;\n          }\n        })();\n      }),\n    },\n    {\n      type: 'action',\n      name: 'Create presentation',\n      action: this.createAction('Create mind-map', (input, background) => {\n        const reactiveData = this.reactiveData;\n        const build = pptBuilder(this.host);\n        return (async function* () {\n          const strings = runPPTGenerateAction({ input, background });\n          let text = '';\n          for await (const item of strings) {\n            yield item;\n            text += item;\n            if (text) {\n              await build.process(text);\n            }\n            reactiveData.tempMessage = text;\n          }\n          await build.done(text);\n        })();\n      }),\n    },\n    {\n      type: 'action',\n      name: 'Insert into Chat',\n      action: async () => {\n        const input = await this.getSelectedText();\n        if (!input) {\n          return;\n        }\n        this.reactiveData.history = [\n          ...this.reactiveData.history,\n          {\n            role: 'user',\n            content: [{ text: input, type: 'text' }],\n          },\n        ];\n      },\n    },\n  ];\n\n  edgelessSelectionActionList: AllAction[] = [\n    {\n      type: 'action',\n      name: 'Create mind-map',\n      hide: () => {\n        const service = getEdgelessService(this.host);\n        const ele = service.selection.selectedElements[0];\n        return !SurfaceBlockComponent.isShape(ele);\n      },\n      action: async () => {\n        const reactiveData = this.reactiveData;\n        const service = getEdgelessService(this.host);\n        const ele = service.selection.selectedElements[0];\n        if (!SurfaceBlockComponent.isShape(ele)) {\n          return;\n        }\n        const text = ele.text?.toString();\n        if (!text) {\n          return;\n        }\n        const pathIds = getConnectorPath(ele.id, service);\n        const rootId = [...pathIds, ele.id][0];\n        const rootEle = service.getElementById(rootId) as ShapeElementModel;\n        const path = pathIds.map(id => {\n          const ele = service.getElementById(id);\n          if (ele && SurfaceBlockComponent.isShape(ele)) {\n            return ele.text?.toString() ?? '';\n          }\n          return '';\n        });\n        const oldTree = findTree(rootId, service);\n        const target = findLeaf(oldTree, ele.id);\n        assertExists(target);\n        const build = mindMapBuilder(\n          this.host,\n          rootEle.x,\n          rootEle.y,\n          ele.id,\n          tree => {\n            target.children = tree.children;\n            return oldTree;\n          }\n        );\n        await this.createAction('Part analysis', (input, background) => {\n          return (async function* () {\n            const strings = runPartAnalysisAction({ input, path, background });\n            let text = '';\n            for await (const item of strings) {\n              yield item;\n              text += item;\n              if (text) {\n                await build(text);\n              }\n              reactiveData.tempMessage = text;\n            }\n          })();\n        })(text);\n      },\n    },\n    {\n      type: 'action',\n      name: 'Make it real',\n      hide: () => {\n        const service = getEdgelessService(this.host);\n        const elements = service.selection.selectedElements;\n        return elements.length === 0;\n      },\n      action: async () => {\n        const img = await selectedToPng(this.host);\n        if (!img) return;\n\n        const html = await genHtml(img);\n        if (!html) return;\n\n        const edgelessRoot = getEdgelessRootFromEditor(this.host);\n        edgelessRoot.doc.addBlock(\n          EmbedHtmlBlockSpec.schema.model.flavour as 'affine:embed-html',\n          { html, design: img, xywh: '[0, 400, 400, 200]' },\n          edgelessRoot.surface.model.id\n        );\n      },\n    },\n  ];\n\n  constructor(\n    private logic: AILogic,\n    private getHost: () => EditorHost\n  ) {\n    this.logic;\n  }\n\n  async startRequest<T>(p: () => Promise<T>): Promise<T> {\n    const id = this.requestId++;\n    this.reactiveData.currentRequest = id;\n    try {\n      const result = await p();\n      if (id === this.reactiveData.currentRequest) {\n        return result;\n      }\n    } finally {\n      this.reactiveData.currentRequest = undefined;\n    }\n    return new Promise(() => {});\n  }\n\n  getSelectedText = async () => {\n    const text = await getSelectedTextContent(this.host);\n    return text;\n  };\n\n  selectTextForBackground = async () => {\n    const text = await this.getSelectedText();\n    if (!text) return;\n    this.reactiveData.history.push({\n      role: 'user',\n      content: [\n        {\n          type: 'text',\n          text,\n        },\n      ],\n    });\n  };\n\n  selectShapesForBackground = async () => {\n    const canvas = await selectedToCanvas(this.host);\n    if (!canvas) {\n      alert('Please select some shapes first');\n      return;\n    }\n    const url = canvas.toDataURL();\n    this.reactiveData.history.push({\n      role: 'user',\n      content: [\n        {\n          type: 'image_url',\n          image_url: {\n            url,\n          },\n        },\n      ],\n    });\n  };\n\n  splitDoc = async (doc: Doc): Promise<string[]> => {\n    const markdown = await docToMarkdown(doc);\n    return splitText(markdown);\n  };\n\n  embeddingDocs = async (docList: Doc[]): Promise<EmbeddedDoc[]> => {\n    const result: Record<string, EmbeddedDoc> = {};\n    const list = (\n      await Promise.all(\n        docList.map(async doc =>\n          (await this.splitDoc(doc)).map(v => ({ id: doc.id, text: v }))\n        )\n      )\n    ).flat();\n    const vectors = await copilotConfig\n      .getService('chat with workspace', EmbeddingServiceKind)\n      .generateEmbeddings(list.map(v => v.text));\n    list.forEach((v, i) => {\n      const doc = result[v.id] ?? (result[v.id] = { id: v.id, sections: [] });\n      doc.sections.push({ vector: vectors[i], text: v.text });\n    });\n    return Object.values(result);\n  };\n\n  syncWorkspace = async () => {\n    this.reactiveData.syncedDocs = await this.embeddingDocs(\n      [...this.host.doc.collection.docs.values()].map(v => v.getDoc())\n    );\n  };\n\n  async docBackground(): Promise<ChatMessage[]> {\n    return [\n      {\n        role: 'system',\n        content: `the background is:\\n${await Promise.all(this.docs.map(v => docToMarkdown(v.getDoc()))).then(list => list.join('\\n'))}`,\n      },\n    ];\n  }\n\n  genAnswer = async (text: string) => {\n    if (this.loading) {\n      return;\n    }\n    this.reactiveData.history = [\n      ...this.reactiveData.history,\n      {\n        role: 'user',\n        content: [{ text: text, type: 'text' }],\n      },\n    ];\n    const background = await this.getBackground();\n    this.reactiveData.value = '';\n    const r = await this.startRequest(async () => {\n      const iter = getChatService().chat([\n        ...(await this.docBackground()),\n        ...background.messages,\n        ...this.reactiveData.history,\n      ]);\n      let result = '';\n      for await (const item of iter) {\n        result += item;\n        this.reactiveData.tempMessage = result;\n      }\n      this.reactiveData.tempMessage = undefined;\n      return result;\n    });\n    this.reactiveData.history = [\n      ...this.reactiveData.history,\n      {\n        role: 'assistant',\n        content: r ?? '',\n        sources: background.sources,\n      },\n    ];\n  };\n\n  async getBackground(): Promise<{\n    messages: ChatMessage[];\n    sources: BackgroundSource[];\n  }> {\n    if (this.reactiveData.syncedDocs.length === 0) {\n      return {\n        messages: [],\n        sources: [],\n      };\n    }\n    const [result] = await copilotConfig\n      .getService('chat with workspace', EmbeddingServiceKind)\n      .generateEmbeddings([this.reactiveData.value]);\n    const list = this.reactiveData.syncedDocs\n      .flatMap(doc => {\n        return doc.sections.map(section => ({\n          id: doc.id,\n          distance: distance(result, section.vector),\n          text: section.text,\n        }));\n      })\n      .sort((a, b) => a.distance - b.distance)\n      .filter(v => v.distance < 0.7)\n      .slice(0, 3);\n    const sources = new Map<string, string[]>();\n    list.forEach(v => {\n      let source = sources.get(v.id);\n      if (!source) {\n        source = [];\n        sources.set(v.id, source);\n      }\n      source.push(v.text);\n    });\n    return {\n      messages: [\n        {\n          role: 'system',\n          content: `the background is:\\n${list.map(v => v.text).join('\\n')}`,\n        },\n      ],\n      sources: [...sources.entries()].map(([id, textList]) => ({\n        id,\n        slice: textList,\n      })),\n    };\n  }\n\n  async replaceSelectedContent(text: string) {\n    if (!text) return;\n    const selectedBlocks = getRootService(this.host).selectedBlocks;\n    if (!selectedBlocks.length) return;\n\n    const firstBlock = selectedBlocks[0];\n    const parentBlock = firstBlock.parentBlockElement;\n\n    // update selected block\n    const firstIndex = parentBlock.model.children.findIndex(\n      child => child.id === firstBlock.model.id\n    ) as number;\n    selectedBlocks.forEach(block => {\n      this.host.doc.deleteBlock(block.model);\n    });\n\n    const models = await insertFromMarkdown(\n      this.host,\n      text,\n      parentBlock.model.id,\n      firstIndex\n    );\n    setTimeout(() => {\n      const selections = models\n        .map(model => model.id)\n        .map(blockId => this.host.selection.create('block', { blockId }));\n      this.host.selection.setGroup('note', selections);\n    }, 0);\n  }\n\n  async insertBelowSelectedContent(text: string) {\n    if (!text) return;\n\n    const selectedBlocks = getRootService(this.host).selectedBlocks;\n    const blockLength = selectedBlocks.length;\n    if (!blockLength) return;\n\n    const lastBlock = selectedBlocks[blockLength - 1];\n    const parentBlock = lastBlock.parentBlockElement;\n\n    const lastIndex = parentBlock.model.children.findIndex(\n      child => child.id === lastBlock.model.id\n    ) as number;\n\n    const models = await insertFromMarkdown(\n      this.host,\n      text,\n      parentBlock.model.id,\n      lastIndex + 1\n    );\n\n    setTimeout(() => {\n      const selections = models\n        .map(model => model.id)\n        .map(blockId => this.host.selection.create('block', { blockId }));\n      this.host.selection.setGroup('note', selections);\n    }, 0);\n  }\n\n  createAction(\n    name: string,\n    action: (\n      input: string,\n      background: ChatMessage[]\n    ) => Promise<AsyncIterable<string>> | AsyncIterable<string>\n  ) {\n    return async (text?: string): Promise<void> => {\n      const input = text ? text : await this.getSelectedText();\n      if (!input) {\n        return;\n      }\n      this.reactiveData.history = [\n        ...this.reactiveData.history,\n        {\n          role: 'user',\n          content: [{ text: input, type: 'text' }],\n        },\n        {\n          role: 'user',\n          content: [{ text: name, type: 'text' }],\n        },\n      ];\n      const result = await this.startRequest(async () => {\n        const strings = await action(input, await this.docBackground());\n        let r = '';\n        for await (const item of strings) {\n          r += item;\n          this.reactiveData.tempMessage = r;\n        }\n        this.reactiveData.tempMessage = undefined;\n        return r;\n      });\n      this.reactiveData.history = [\n        ...this.reactiveData.history,\n        {\n          role: 'assistant',\n          content: result,\n          sources: [],\n        },\n      ];\n    };\n  }\n}\n\ntype Action = {\n  type: 'action';\n  name: string;\n  hide?: () => boolean;\n  action: () => Promise<void>;\n};\ntype ActionGroup = {\n  type: 'group';\n  name: string;\n  children: AllAction[];\n};\nexport type AllAction = Action | ActionGroup;\ntype MessageContent =\n  | {\n      type: 'text';\n      text: string;\n    }\n  | {\n      type: 'image_url';\n      image_url: {\n        url: string;\n      };\n    };\n\ntype BackgroundSource = {\n  id: string;\n  slice: string[];\n};\nexport type ChatMessage =\n  | {\n      role: 'user';\n      content: MessageContent[];\n    }\n  | {\n      role: 'system';\n      content: string;\n    }\n  | {\n      role: 'assistant';\n      content: string;\n      sources: BackgroundSource[];\n    };\n\nconst docToMarkdown = async (doc: Doc) => {\n  const job = new Job({ collection: doc.collection });\n  const markdownAdapter = new MarkdownAdapter(job);\n  const result = await markdownAdapter.fromDoc(doc);\n  return result.file;\n};\nconst distance = (a: number[], b: number[]) => {\n  let sum = 0;\n  for (let i = 0; i < a.length; i++) {\n    sum += (a[i] - b[i]) ** 2;\n  }\n  return Math.sqrt(sum);\n};\n\nconst split = (text: string, n: number) => {\n  const result: string[] = [];\n  while (text.length) {\n    result.push(text.slice(0, n));\n    text = text.slice(n);\n  }\n  return result;\n};\nconst maxChunk = 300;\nconst splitText = (text: string) => {\n  const data = text.split(/(?<=[\\n。，.,])/).flatMap(s => {\n    if (s.length > maxChunk) {\n      return split(s, Math.ceil(s.length / maxChunk));\n    }\n    return [s];\n  });\n  const result: string[] = [];\n  let current = '';\n  for (const item of data) {\n    if (current.length + item.length > maxChunk) {\n      result.push(current);\n      current = '';\n    }\n    current += item;\n  }\n  if (current.length) {\n    result.push(current);\n  }\n  return result;\n};\nexport type EmbeddedDoc = {\n  id: string;\n  sections: {\n    vector: number[];\n    text: string;\n  }[];\n};\nconst mindMapBuilder = (\n  host: EditorHost,\n  x: number,\n  y: number,\n  rootId?: string,\n  wrapTree?: (tree: TreeNodeWithId) => TreeNodeWithId\n) => {\n  const service = getEdgelessService(host);\n  const ids: string[] = rootId ? [rootId] : [];\n  const buildTree = async (text: string) => {\n    const snapshot = await markdownToSnapshot(text, host);\n    const block = snapshot.snapshot.content[0];\n    let i = 0;\n    const toTreeNode = (\n      block: BlockSnapshot,\n      parentId?: string\n    ): TreeNodeWithId => {\n      const text = getText(block);\n      if (ids[i] == null) {\n        ids[i] = BlocksUtils.mindMap.createNode(\n          text,\n          service,\n          parentId ? { direction: 'right', parentId } : undefined\n        );\n      }\n      const selfId = ids[i];\n      const shape = service.getElementById(selfId) as ShapeElementModel;\n      if (shape.text?.toString() !== text) {\n        BlocksUtils.mindMap.changeText(selfId, text, service);\n      }\n      return {\n        id: ids[i++],\n        children: block.children.map(id => toTreeNode(id, selfId)),\n      };\n    };\n    const tree = toTreeNode(block.children[0]);\n    BlocksUtils.mindMap.layoutInEdgeless(service, wrapTree?.(tree) ?? tree, {\n      x,\n      y,\n    });\n  };\n  return buildTree;\n};\nconst createTaskQueue = () => {\n  const queue: Array<() => Promise<void>> = [];\n  let current: Promise<void> | undefined;\n  const runTask = () => {\n    if (current) {\n      return;\n    }\n    const task = queue.shift();\n    if (!task) {\n      return;\n    }\n    current = task().finally(() => {\n      current = undefined;\n      runTask();\n    });\n  };\n  return {\n    add: (task: () => Promise<void>) => {\n      queue.push(task);\n      runTask();\n    },\n  };\n};\nconst addPPTTaskQueue = createTaskQueue();\nconst pptBuilder = (host: EditorHost) => {\n  const service = getEdgelessService(host);\n  const docs: PPTDoc[] = [];\n  const addDoc = async (block: BlockSnapshot) => {\n    const sections = block.children.map(v => {\n      const title = getText(v);\n      const keywords = getText(v.children[0]);\n      const content = getText(v.children[1]);\n      return {\n        title,\n        keywords,\n        content,\n      } satisfies PPTSection;\n    });\n    const doc: PPTDoc = {\n      isCover: docs.length === 0,\n      title: getText(block),\n      sections,\n    };\n    docs.push(doc);\n    const job = service.createTemplateJob('template');\n    const { images, content } = await basicTheme(doc);\n    if (images.length) {\n      await Promise.all(\n        images.map(({ id, url }) =>\n          fetch(url)\n            .then(res => res.blob())\n            .then(blob => job.job.assets.set(id, blob))\n        )\n      );\n    }\n    await job.insertTemplate(content);\n    getSurfaceElementFromEditor(host).refresh();\n  };\n  return {\n    process: async (text: string) => {\n      const snapshot = await markdownToSnapshot(text, host);\n      const block = snapshot.snapshot.content[0];\n      if (block.children.length > docs.length + 1) {\n        addPPTTaskQueue.add(() => addDoc(block.children[docs.length]));\n      }\n    },\n    done: async (text: string) => {\n      const snapshot = await markdownToSnapshot(text, host);\n      const block = snapshot.snapshot.content[0];\n      addPPTTaskQueue.add(() =>\n        addDoc(block.children[block.children.length - 1])\n      );\n    },\n  };\n};\nconst getText = (block: BlockSnapshot) => {\n  // @ts-ignore\n  return block.props.text?.delta?.[0]?.insert ?? '';\n};\n"]}