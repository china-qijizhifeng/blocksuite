{"version":3,"file":"connector.js","sourceRoot":"","sources":["../../../../src/fragments/copilot-panel/utils/connector.ts"],"names":[],"mappings":"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","sourcesContent":["import type { EdgelessRootService } from '@blocksuite/blocks';\nimport {\n  type ConnectorElementModel,\n  SurfaceBlockComponent,\n} from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\n\nexport const getConnectorFromId = (\n  id: string,\n  surface: EdgelessRootService\n) => {\n  return surface.elements.filter(\n    v => SurfaceBlockComponent.isConnector(v) && v.source.id === id\n  ) as ConnectorElementModel[];\n};\nexport const getConnectorToId = (id: string, surface: EdgelessRootService) => {\n  return surface.elements.filter(\n    v => SurfaceBlockComponent.isConnector(v) && v.target.id === id\n  ) as ConnectorElementModel[];\n};\nexport const getConnectorPath = (id: string, surface: EdgelessRootService) => {\n  let current: string | undefined = id;\n  const set = new Set<string>();\n  const result: string[] = [];\n  while (current) {\n    if (set.has(current)) {\n      return result;\n    }\n    set.add(current);\n    const connector = getConnectorToId(current, surface);\n    if (connector.length !== 1) {\n      return result;\n    }\n    current = connector[0].source.id;\n    if (current) {\n      result.unshift(current);\n    }\n  }\n  return result;\n};\ntype ElementTree = {\n  id: string;\n  children: ElementTree[];\n};\nexport const findTree = (\n  rootId: string,\n  surface: EdgelessRootService\n): ElementTree => {\n  const set = new Set<string>();\n  const run = (id: string): ElementTree | undefined => {\n    if (set.has(id)) {\n      return;\n    }\n    set.add(id);\n    const children = getConnectorFromId(id, surface);\n    return {\n      id,\n      children: children.flatMap(model => {\n        const childId = model.target.id;\n        if (childId) {\n          const elementTree = run(childId);\n          if (elementTree) {\n            return [elementTree];\n          }\n        }\n        return [];\n      }),\n    };\n  };\n  const tree = run(rootId);\n  assertExists(tree);\n  return tree;\n};\nexport const findLeaf = (\n  tree: ElementTree,\n  id: string\n): ElementTree | undefined => {\n  if (tree.id === id) {\n    return tree;\n  }\n  for (const child of tree.children) {\n    const result = findLeaf(child, id);\n    if (result) {\n      return result;\n    }\n  }\n  return;\n};\n"]}