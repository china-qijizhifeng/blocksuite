{"version":3,"file":"markdown-utils.js","sourceRoot":"","sources":["../../../../src/fragments/copilot-panel/utils/markdown-utils.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,eAAe,EAAE,MAAM,oBAAoB,CAAC;AACrD,OAAO,EAAE,YAAY,EAAE,MAAM,0BAA0B,CAAC;AAExD,OAAO,EAAE,GAAG,EAAc,MAAM,mBAAmB,CAAC;AAEpD,MAAM,CAAC,KAAK,UAAU,oBAAoB,CAAC,IAAgB,EAAE,KAAY;IACvE,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,EAAE,UAAU,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC,CAAC;IAC7D,MAAM,eAAe,GAAG,IAAI,eAAe,CAAC,GAAG,CAAC,CAAC;IACjD,MAAM,QAAQ,GAAG,MAAM,eAAe,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;IAExD,OAAO,QAAQ,CAAC,IAAI,CAAC;AACvB,CAAC;AACD,MAAM,CAAC,MAAM,kBAAkB,GAAG,KAAK,EACrC,QAAgB,EAChB,IAAgB,EAChB,EAAE;IACF,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,EAAE,UAAU,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC,CAAC;IAC7D,MAAM,eAAe,GAAG,IAAI,eAAe,CAAC,GAAG,CAAC,CAAC;IACjD,MAAM,EAAE,aAAa,EAAE,gBAAgB,EAAE,WAAW,EAAE,GACpD,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC;IAC/B,IAAI,CAAC,aAAa,IAAI,CAAC,gBAAgB,IAAI,CAAC,WAAW;QACrD,MAAM,IAAI,KAAK,CACb,iFAAiF,CAClF,CAAC;IAEJ,MAAM,OAAO,GAAG;QACd,IAAI,EAAE,QAAQ;QACd,MAAM,EAAE,GAAG,CAAC,aAAa;QACzB,aAAa;QACb,WAAW;QACX,gBAAgB;QAChB,WAAW,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE;QACvC,MAAM,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;KACxB,CAAC;IAEF,MAAM,QAAQ,GAAG,MAAM,eAAe,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;IAChE,YAAY,CAAC,QAAQ,EAAE,oDAAoD,CAAC,CAAC;IAE7E,OAAO;QACL,QAAQ;QACR,GAAG;KACJ,CAAC;AACJ,CAAC,CAAC;AACF,MAAM,CAAC,KAAK,UAAU,kBAAkB,CACtC,IAAgB,EAChB,QAAgB,EAChB,MAAe,EACf,KAAc;IAEd,MAAM,EAAE,QAAQ,EAAE,GAAG,EAAE,GAAG,MAAM,kBAAkB,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;IAEnE,MAAM,SAAS,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC;IAE/C,MAAM,MAAM,GAAiB,EAAE,CAAC;IAChC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QAC1C,MAAM,aAAa,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;QACnC,MAAM,KAAK,GAAG,MAAM,GAAG,CAAC,eAAe,CACrC,aAAa,EACb,IAAI,CAAC,GAAG,CAAC,GAAG,EACZ,MAAM,EACN,CAAC,KAAK,IAAI,CAAC,CAAC,GAAG,CAAC,CACjB,CAAC;QACF,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACrB,CAAC;IAED,OAAO,MAAM,CAAC;AAChB,CAAC","sourcesContent":["import type { EditorHost } from '@blocksuite/block-std';\nimport { MarkdownAdapter } from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { BlockModel } from '@blocksuite/store';\nimport { Job, type Slice } from '@blocksuite/store';\n\nexport async function getMarkdownFromSlice(host: EditorHost, slice: Slice) {\n  const job = new Job({ collection: host.std.doc.collection });\n  const markdownAdapter = new MarkdownAdapter(job);\n  const markdown = await markdownAdapter.fromSlice(slice);\n\n  return markdown.file;\n}\nexport const markdownToSnapshot = async (\n  markdown: string,\n  host: EditorHost\n) => {\n  const job = new Job({ collection: host.std.doc.collection });\n  const markdownAdapter = new MarkdownAdapter(job);\n  const { blockVersions, workspaceVersion, pageVersion } =\n    host.std.doc.collection.meta;\n  if (!blockVersions || !workspaceVersion || !pageVersion)\n    throw new Error(\n      'Need blockVersions, workspaceVersion, pageVersion meta information to get slice'\n    );\n\n  const payload = {\n    file: markdown,\n    assets: job.assetsManager,\n    blockVersions,\n    pageVersion,\n    workspaceVersion,\n    workspaceId: host.std.doc.collection.id,\n    pageId: host.std.doc.id,\n  };\n\n  const snapshot = await markdownAdapter.toSliceSnapshot(payload);\n  assertExists(snapshot, 'import markdown failed, expected to get a snapshot');\n\n  return {\n    snapshot,\n    job,\n  };\n};\nexport async function insertFromMarkdown(\n  host: EditorHost,\n  markdown: string,\n  parent?: string,\n  index?: number\n) {\n  const { snapshot, job } = await markdownToSnapshot(markdown, host);\n\n  const snapshots = snapshot.content[0].children;\n\n  const models: BlockModel[] = [];\n  for (let i = 0; i < snapshots.length; i++) {\n    const blockSnapshot = snapshots[i];\n    const model = await job.snapshotToBlock(\n      blockSnapshot,\n      host.std.doc,\n      parent,\n      (index ?? 0) + i\n    );\n    models.push(model);\n  }\n\n  return models;\n}\n"]}