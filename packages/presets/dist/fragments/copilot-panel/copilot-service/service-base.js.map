{"version":3,"file":"service-base.js","sourceRoot":"","sources":["../../../../src/fragments/copilot-panel/copilot-service/service-base.ts"],"names":[],"mappings":"AAuBA,MAAM,CAAC,MAAM,YAAY,GAAG,CAC1B,MAAoB,EACN,EAAE;IAChB,OAAO,MAAM,CAAC;AAChB,CAAC,CAAC;AACF,MAAM,iBAAiB,GAAG,CAAI,MAG7B,EAAkB,EAAE;IACnB,MAAM,QAAQ,GAAG,EAA+B,CAAC;IACjD,OAAO;QACL,IAAI,EAAE,MAAM,CAAC,IAAI;QACjB,KAAK,EAAE,MAAM,CAAC,KAAK;QACnB,OAAO,EAAE,QAAQ,CAAC,EAAE;YAClB,OAAO,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,QAAQ,CAAC,CAAC;QACjD,CAAC;QACD,QAAQ;QACR,WAAW,EAAE,IAAI,CAAC,EAAE;YAClB,QAAQ,CAAC,IAAI,CAAC,IAAa,CAAC,CAAC;QAC/B,CAAC;KACF,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,eAAe,GAAG,iBAAiB,CAE7C;IACD,IAAI,EAAE,cAAc;IACpB,KAAK,EAAE,cAAc;CACtB,CAAC,CAAC;AACH,MAAM,CAAC,MAAM,eAAe,GAAG,iBAAiB,CAE7C;IACD,IAAI,EAAE,cAAc;IACpB,KAAK,EAAE,cAAc;CACtB,CAAC,CAAC;AAEH,MAAM,CAAC,MAAM,qBAAqB,GAAG,iBAAiB,CAEnD;IACD,IAAI,EAAE,uBAAuB;IAC7B,KAAK,EAAE,uBAAuB;CAC/B,CAAC,CAAC;AAEH,MAAM,CAAC,MAAM,oBAAoB,GAAG,iBAAiB,CAGlD;IACD,IAAI,EAAE,mBAAmB;IACzB,KAAK,EAAE,mBAAmB;CAC3B,CAAC,CAAC;AAEH,MAAM,CAAC,MAAM,qBAAqB,GAAG,iBAAiB,CAInD;IACD,IAAI,EAAE,uBAAuB;IAC7B,KAAK,EAAE,uBAAuB;CAC/B,CAAC,CAAC;AAEH,MAAM,CAAC,MAAM,sBAAsB,GAAG,iBAAiB,CAEpD;IACD,IAAI,EAAE,wBAAwB;IAC9B,KAAK,EAAE,wBAAwB;CAChC,CAAC,CAAC;AACH,MAAM,CAAC,MAAM,0BAA0B,GAAG,iBAAiB,CAExD;IACD,IAAI,EAAE,6BAA6B;IACnC,KAAK,EAAE,6BAA6B;CACrC,CAAC,CAAC;AAEH,MAAM,CAAC,MAAM,cAAc,GAAG;IAC5B,eAAe;IACf,eAAe;IACf,qBAAqB;IACrB,qBAAqB;IACrB,sBAAsB;IACtB,0BAA0B;IAC1B,oBAAoB;CACrB,CAAC","sourcesContent":["import type { TemplateResult } from 'lit';\nimport type { OpenAI } from 'openai';\n\nimport type { ChatMessage } from '../chat/logic.js';\n\nexport type Vendor<Data> = {\n  key: string;\n  color: string;\n  initData: () => Data;\n  renderConfigEditor: (data: Data, refresh: () => void) => TemplateResult;\n};\nexport type ServiceImpl<M, Data> = {\n  name: string;\n  method: (data: Data) => M;\n  vendor: Vendor<Data>;\n};\nexport type ServiceKind<M> = {\n  type: string;\n  title: string;\n  getImpl: (implName: string) => ServiceImpl<M, unknown> | undefined;\n  implList: ServiceImpl<M, unknown>[];\n  implService: <Data>(impl: ServiceImpl<M, Data>) => void;\n};\nexport const createVendor = <Data extends object>(\n  config: Vendor<Data>\n): Vendor<Data> => {\n  return config;\n};\nconst createServiceKind = <M>(config: {\n  type: string;\n  title: string;\n}): ServiceKind<M> => {\n  const implList = [] as ServiceImpl<M, unknown>[];\n  return {\n    type: config.type,\n    title: config.title,\n    getImpl: implName => {\n      return implList.find(v => v.name === implName);\n    },\n    implList,\n    implService: impl => {\n      implList.push(impl as never);\n    },\n  };\n};\n\nexport const TextServiceKind = createServiceKind<{\n  generateText(messages: ChatMessage[]): Promise<string>;\n}>({\n  type: 'text-service',\n  title: 'Text service',\n});\nexport const ChatServiceKind = createServiceKind<{\n  chat(messages: Array<ChatMessage>): AsyncIterable<string>;\n}>({\n  type: 'chat-service',\n  title: 'Chat service',\n});\n\nexport const Text2ImageServiceKind = createServiceKind<{\n  generateImage(prompt: string): Promise<File>;\n}>({\n  type: 'text-to-image-service',\n  title: 'Text to image service',\n});\n\nexport const EmbeddingServiceKind = createServiceKind<{\n  generateEmbedding(text: string): Promise<number[]>;\n  generateEmbeddings(textList: string[]): Promise<number[][]>;\n}>({\n  type: 'embedding-service',\n  title: 'Embedding service',\n});\n\nexport const Image2TextServiceKind = createServiceKind<{\n  generateText(\n    messages: Array<OpenAI.ChatCompletionMessageParam>\n  ): Promise<string>;\n}>({\n  type: 'image-to-text-service',\n  title: 'Image to text service',\n});\n\nexport const Image2ImageServiceKind = createServiceKind<{\n  generateImage(prompt: string, image: string): Promise<string>;\n}>({\n  type: 'image-to-image-service',\n  title: 'Image to image service',\n});\nexport const FastImage2ImageServiceKind = createServiceKind<{\n  createFastRequest(): (prompt: string, image: string) => Promise<string>;\n}>({\n  type: 'fast-image-to-image-service',\n  title: 'Fast image to image service',\n});\n\nexport const allKindService = [\n  TextServiceKind,\n  ChatServiceKind,\n  Text2ImageServiceKind,\n  Image2TextServiceKind,\n  Image2ImageServiceKind,\n  FastImage2ImageServiceKind,\n  EmbeddingServiceKind,\n];\nexport type AllServiceKind = (typeof allKindService)[number];\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type GetMethod<Kind extends ServiceKind<any>> =\n  Kind extends ServiceKind<infer M> ? M : never;\n"]}