{"version":3,"file":"llama2.js","sourceRoot":"","sources":["../../../../src/fragments/copilot-panel/copilot-service/llama2.ts"],"names":[],"mappings":"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","sourcesContent":["import { html } from 'lit';\n\nimport {\n  ChatServiceKind,\n  createVendor,\n  TextServiceKind,\n} from './service-base.js';\n\nexport const llama2Vendor = createVendor<{\n  host: string;\n}>({\n  key: 'llama',\n  color: '#202123',\n  initData: () => ({ host: '' }),\n  renderConfigEditor: (data, refresh) => {\n    return html`\n      <div style=\"display:flex;flex-direction: column;gap: 12px;\">\n        <div>\n          <label for=\"key\">Host</label>\n          <input\n            type=\"text\"\n            id=\"key\"\n            .value=\"${data.host}\"\n            @input=\"${(e: Event) => {\n              const input = e.target as HTMLInputElement;\n              data.host = input.value;\n              refresh();\n            }}\"\n          />\n        </div>\n      </div>\n    `;\n  },\n});\nTextServiceKind.implService({\n  name: 'llama2',\n  method: data => ({\n    generateText: async messages => {\n      const result: {\n        message: {\n          role: string;\n          content: string;\n        };\n      } = await fetch(`${data.host}/api/chat`, {\n        method: 'POST',\n        body: JSON.stringify({\n          model: 'llama2',\n          messages: messages,\n          stream: false,\n        }),\n      }).then(res => res.json());\n      return result.message.content;\n    },\n  }),\n  vendor: llama2Vendor,\n});\n\nChatServiceKind.implService({\n  name: 'llama2',\n  method: data => ({\n    chat: messages => {\n      const llama2Messages = messages.map(message => {\n        if (message.role === 'user') {\n          let text = '';\n          const imgs: string[] = [];\n          message.content.forEach(v => {\n            if (v.type === 'text') {\n              text += `${v.text}\\n`;\n            }\n            if (v.type === 'image_url') {\n              imgs.push(v.image_url.url.split(',')[1]);\n            }\n          });\n          return {\n            role: message.role,\n            content: text,\n            images: imgs,\n          };\n        }\n        return message;\n      });\n      return (async function* () {\n        const result: {\n          message: {\n            role: string;\n            content: string;\n          };\n        } = await fetch(`${data.host}/api/chat`, {\n          method: 'POST',\n          body: JSON.stringify({\n            model: 'llama2',\n            messages: llama2Messages,\n            stream: false,\n          }),\n        }).then(res => res.json());\n        yield result.message.content;\n      })();\n    },\n  }),\n  vendor: llama2Vendor,\n});\n"]}