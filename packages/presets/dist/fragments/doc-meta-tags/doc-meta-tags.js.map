{"version":3,"file":"doc-meta-tags.js","sourceRoot":"","sources":["../../../src/fragments/doc-meta-tags/doc-meta-tags.ts"],"names":[],"mappings":"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","sourcesContent":["import { WithDisposable } from '@blocksuite/block-std';\nimport {\n  ArrowDownSmallIcon,\n  DocIcon,\n  DualLinkIcon16,\n  LinkedDocIcon,\n  PlusIcon,\n  popTagSelect,\n  type SelectTag,\n  TagsIcon,\n} from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { Doc } from '@blocksuite/store';\nimport { baseTheme } from '@toeverything/theme';\nimport { css, html, LitElement, nothing, unsafeCSS } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { BacklinkButton } from './backlink-popover.js';\nimport {\n  type BackLink,\n  type BacklinkData,\n  DEFAULT_DOC_NAME,\n  DOC_BLOCK_CHILD_PADDING,\n} from './utils.js';\n\n@customElement('doc-meta-tags')\nexport class DocMetaTags extends WithDisposable(LitElement) {\n  get pageRoot() {\n    const pageViewport = this.closest('.affine-page-viewport');\n    assertExists(pageViewport);\n    const pageRoot = pageViewport.querySelector('affine-page-root');\n    assertExists(pageRoot);\n    return pageRoot;\n  }\n\n  get meta() {\n    return this.doc.collection.meta;\n  }\n\n  get options() {\n    return this.meta.properties.tags?.options ?? [];\n  }\n\n  set options(tags: SelectTag[]) {\n    this.tags = this.tags.filter(v => tags.find(x => x.id === v));\n    this.doc.collection.meta.setProperties({\n      ...this.meta.properties,\n      tags: {\n        ...this.meta.properties.tags,\n        options: tags,\n      },\n    });\n  }\n\n  get tags() {\n    return this.doc.meta?.tags ?? [];\n  }\n\n  set tags(tags: string[]) {\n    assertExists(this.doc.meta);\n    this.doc.meta.tags = tags;\n  }\n\n  static override styles = css`\n    .doc-meta-container {\n      font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n      font-size: var(--affine-font-base);\n      line-height: var(--affine-line-height);\n      color: var(--affine-text-primary-color);\n      display: block;\n      box-sizing: border-box;\n      max-width: var(--affine-editor-width);\n      margin-left: auto;\n      margin-right: auto;\n      padding-left: var(\n        --affine-editor-side-padding,\n        ${DOC_BLOCK_CHILD_PADDING}px\n      );\n      padding-right: var(\n        --affine-editor-side-padding,\n        ${DOC_BLOCK_CHILD_PADDING}px\n      );\n    }\n\n    /* Extra small devices (phones, 640px and down) */\n    @container viewport (width <= 640px) {\n      .doc-meta-container {\n        padding-left: ${DOC_BLOCK_CHILD_PADDING}px;\n        padding-right: ${DOC_BLOCK_CHILD_PADDING}px;\n      }\n    }\n\n    .meta-data {\n      border-radius: 8px;\n      display: flex;\n      align-items: center;\n      height: 30px;\n      cursor: pointer;\n      justify-content: space-between;\n      margin: 0 -12px;\n    }\n\n    .meta-data-content {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: var(--affine-text-secondary-color);\n    }\n\n    .meta-data:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .tags-inline {\n      display: flex;\n      align-items: center;\n      gap: 4px;\n      font-size: 14px;\n    }\n\n    .tags-inline .tag-list {\n      display: flex;\n      align-items: center;\n    }\n\n    .tag-inline {\n      max-width: 100px;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      overflow: hidden;\n    }\n\n    .expand {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      margin-right: 12px;\n    }\n\n    .expand svg {\n      color: var(--affine-icon-color);\n    }\n\n    .meta-data-expanded {\n      padding: 10px 12px 24px;\n      margin: 0 -24px;\n      display: flex;\n      flex-direction: column;\n      gap: 10px;\n      background-color: var(--affine-hover-color-filled);\n      border-radius: 8px;\n    }\n\n    .meta-data-expanded-title {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 0 12px;\n      font-weight: 600;\n      font-size: 14px;\n      color: var(--affine-text-secondary-color);\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    .meta-data-expanded-title:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .meta-data-expanded-title .close {\n      transform: rotate(180deg);\n      border-radius: 4px;\n      display: flex;\n      align-items: center;\n    }\n\n    @media print {\n      .meta-data-expanded-title .close {\n        display: none;\n      }\n\n      .expand {\n        display: none;\n      }\n    }\n\n    .meta-data-expanded-title .close:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .meta-data-expanded-content {\n      display: flex;\n      flex-direction: column;\n      gap: 24px;\n      padding: 0 12px;\n    }\n\n    .meta-data-expanded-column-item {\n      display: flex;\n      flex-direction: column;\n    }\n\n    .meta-data-expanded-column-item .backlink-title {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      fill: var(--affine-icon-color);\n    }\n\n    .meta-data-expanded-column-item .backlinks {\n      margin-left: 24px;\n    }\n\n    .meta-data-expanded-item {\n      display: flex;\n      gap: 8px;\n    }\n\n    .meta-data-expanded-item .value {\n      flex: 1;\n    }\n\n    .add-tag {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n    }\n\n    .add-tag svg {\n      width: 16px;\n      height: 16px;\n      border-radius: 4px;\n      fill: var(--affine-icon-color);\n    }\n\n    .add-tag:hover svg {\n      background-color: var(--affine-hover-color);\n    }\n\n    .tags {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 8px;\n    }\n\n    .tag {\n      padding: 4px 10px;\n      border-radius: 8px;\n      color: var(--affine-text-primary-color);\n      font-size: 13px;\n      line-height: 13px;\n      display: flex;\n      align-items: center;\n      font-weight: 400;\n      cursor: pointer;\n    }\n\n    .backlinks {\n      display: flex;\n      gap: 8px;\n      flex-direction: column;\n    }\n\n    .backlinks .title {\n      height: 28px;\n      color: var(--affine-text-secondary-color);\n      font-size: var(--affine-font-sm);\n    }\n\n    .backlinks .link {\n      display: flex;\n      align-items: center;\n      gap: 5px;\n      font-size: 15px;\n      cursor: pointer;\n      width: max-content;\n      border-radius: 4px;\n      padding: 0 8px 0 4px;\n      margin: 0 -8px 0 -4px;\n    }\n\n    .backlinks .link:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .backlinks .link svg {\n      fill: var(--affine-icon-color);\n    }\n\n    .link-title {\n      border-bottom: 0.5px solid var(--affine-divider-color);\n    }\n\n    .backlinks .link:hover .link-title {\n      border-bottom-color: transparent;\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor doc!: Doc;\n\n  @state()\n  accessor backlinkList!: BacklinkData[];\n\n  @state()\n  accessor showSelect = false;\n\n  @state()\n  accessor expanded = false;\n\n  private _listenBacklinkList = () => {\n    const metaMap = Object.fromEntries(\n      this.doc.collection.meta.docMetas.map(v => [v.id, v])\n    );\n\n    const toData = (backlink: BackLink): BacklinkData => {\n      const docMeta = metaMap[backlink.pageId];\n      if (!docMeta) {\n        console.warn('Unexpected doc meta not found', backlink.pageId);\n      }\n      return {\n        ...backlink,\n        ...docMeta,\n        icon: backlink.type === 'LinkedPage' ? LinkedDocIcon : DocIcon,\n        jump: () => {\n          if (backlink.pageId === this.doc.id) return;\n\n          this.pageRoot.slots.docLinkClicked.emit({\n            docId: backlink.pageId,\n            blockId: backlink.blockId,\n          });\n        },\n      };\n    };\n\n    const backlinkIndexer = this.doc.collection.indexer.backlink;\n\n    if (backlinkIndexer) {\n      const getList = () => {\n        return backlinkIndexer\n          .getBacklink(this.doc.id)\n          .filter(v => v.type === 'LinkedPage')\n          .map(toData);\n      };\n\n      this.backlinkList = getList();\n\n      this._disposables.add(\n        backlinkIndexer.slots.indexUpdated.on(() => {\n          this.backlinkList = getList();\n        })\n      );\n    }\n  };\n\n  private _toggle = () => {\n    this.expanded = !this.expanded;\n  };\n\n  private _selectTags = () => {\n    this._disposables.add({\n      dispose: popTagSelect(this.shadowRoot?.querySelector('.tags') ?? this, {\n        value: this.tags,\n        onChange: tags => (this.tags = tags),\n        options: this.options,\n        onOptionsChange: options => (this.options = options),\n      }),\n    });\n  };\n\n  private _renderTagsInline = () => {\n    const tags = this.tags;\n    const optionMap = Object.fromEntries(this.options.map(v => [v.id, v]));\n    return html` <div class=\"tags-inline\">\n      ${TagsIcon}\n      ${tags.length > 0\n        ? html` <div class=\"tag-list\">\n            ${repeat(\n              tags.slice(0, 3),\n              id => id,\n              (id, i) => {\n                const tag = optionMap[id];\n                if (!tag) {\n                  return null;\n                }\n                return html` <div>${i !== 0 ? html`,&nbsp;` : ''}</div>\n                  <div class=\"tag-inline\">${tag.value}</div>`;\n              }\n            )}\n            ${tags.length > 3 ? html`, and ${tags.length - 3} more` : ''}\n          </div>`\n        : 'Tags'}\n    </div>`;\n  };\n\n  private _renderBacklinkInline = () => {\n    const backlinkButton = new BacklinkButton(this.backlinkList);\n    return backlinkButton;\n  };\n\n  private _renderBacklinkExpanded = () => {\n    const backlinkList = this.backlinkList;\n    if (!backlinkList.length) {\n      return null;\n    }\n\n    const renderLink = (link: BacklinkData) => {\n      return html` <div @click=${link.jump} class=\"link\">\n        ${link.icon}\n        <div class=\"link-title\">${link.title || DEFAULT_DOC_NAME}</div>\n      </div>`;\n    };\n\n    return html`<div class=\"meta-data-expanded-column-item\">\n      <div class=\"backlink-title\">\n        ${DualLinkIcon16}\n        <span class=\"title\">Linked to this doc</span>\n      </div>\n      <div class=\"backlinks\">\n        ${repeat(backlinkList, v => v.pageId, renderLink)}\n      </div>\n    </div>`;\n  };\n\n  private _renderTagsExpanded = () => {\n    const optionMap = Object.fromEntries(this.options.map(v => [v.id, v]));\n\n    return html` <div class=\"meta-data-expanded-item\">\n      <div class=\"type\">${TagsIcon}</div>\n      <div class=\"value\">\n        <div class=\"tags\">\n          ${repeat(\n            this.tags,\n            id => id,\n            id => {\n              const tag = optionMap[id];\n              if (!tag) {\n                return null;\n              }\n              const style = styleMap({\n                backgroundColor: tag.color,\n              });\n              const click = () => {\n                this.pageRoot.slots.tagClicked.emit({ tagId: tag.id });\n              };\n              return html` <div class=\"tag\" @click=${click} style=${style}>\n                ${tag.value}\n              </div>`;\n            }\n          )}\n          ${this.doc.readonly\n            ? nothing\n            : html`<div class=\"add-tag\" @click=\"${this._selectTags}\">\n                ${PlusIcon}\n              </div>`}\n        </div>\n      </div>\n    </div>`;\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this._listenBacklinkList();\n\n    this._disposables.add(\n      this.meta.docMetaUpdated.on(() => {\n        this.requestUpdate();\n      })\n    );\n  }\n\n  override render() {\n    if (!this.expanded) {\n      return html`\n        <div class=\"doc-meta-container caret-ignore\">\n          <div class=\"meta-data caret-ignore\" @click=\"${this._toggle}\">\n            <div class=\"meta-data-content\">\n              ${this._renderBacklinkInline()} ${this._renderTagsInline()}\n            </div>\n            <div class=\"expand\">${ArrowDownSmallIcon}</div>\n          </div>\n        </div>\n      `;\n    }\n\n    return html`\n      <div class=\"doc-meta-container caret-ignore\">\n        <div class=\"meta-data-expanded caret-ignore\">\n          <div class=\"meta-data-expanded-title\" @click=\"${this._toggle}\">\n            <div>文档信息</div>\n            <div class=\"close\">${ArrowDownSmallIcon}</div>\n          </div>\n          <div class=\"meta-data-expanded-content\">\n            ${this._renderBacklinkExpanded()} ${this._renderTagsExpanded()}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'doc-meta-tags': DocMetaTags;\n  }\n}\n"]}